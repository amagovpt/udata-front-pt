import{m as Y,O as M,p,a1 as x,a2 as F,s as ee,W as ue,Z as ge,a3 as ce,i as _e,a4 as de,a5 as D,a6 as C,R as V,w as fe,J as E,a7 as w,V as te,A as ie}from"./hub.6.2.4.js";import{a8 as yt}from"./hub.6.2.4.js";var Te=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function ye(t){var e=t.match(Te);if(e){var i=void 0;return e[3]==="1"?i=!0:e[3]==="0"&&(i=!1),{traceId:e[1],parentSampled:i,parentSpanId:e[2]}}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var z=function(t,e){return z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var n in r)r.hasOwnProperty(n)&&(i[n]=r[n])},z(t,e)};function J(t,e){z(t,e);function i(){this.constructor=t}t.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var m=function(){return m=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},m.apply(this,arguments)};function be(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]]);return i}function Se(t){var e=typeof Symbol=="function"&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function pe(t,e){var i=typeof Symbol=="function"&&t[Symbol.iterator];if(!i)return t;var r=i.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(o){a={error:o}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(a)throw a.error}}return s}function R(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(pe(arguments[e]));return t}var f=typeof __SENTRY_DEBUG__>"u"?!0:__SENTRY_DEBUG__;function X(t){var e=Y().getClient(),i=t||e&&e.getOptions();return!!i&&("tracesSampleRate"in i||"tracesSampler"in i)}function j(t){var e=t||Y(),i=e.getScope();return i&&i.getTransaction()}function v(t){return t/1e3}function Oe(t){return t*1e3}function Ie(){M("error",re),M("unhandledrejection",re)}function re(){var t=j();if(t){var e="internal_error";f&&p.log("[Tracing] Transaction: "+e+" -> Global error occured"),t.setStatus(e)}}var G="finishReason",W=["heartbeatFailed","idleTimeout","documentHidden"],le=function(){function t(e){e===void 0&&(e=1e3),this.spans=[],this._maxlen=e}return t.prototype.add=function(e){this.spans.length>this._maxlen?e.spanRecorder=void 0:this.spans.push(e)},t}(),Re=function(){function t(e){if(this.traceId=ee(),this.spanId=ee().substring(16),this.startTimestamp=x(),this.tags={},this.data={},!e)return this;e.traceId&&(this.traceId=e.traceId),e.spanId&&(this.spanId=e.spanId),e.parentSpanId&&(this.parentSpanId=e.parentSpanId),"sampled"in e&&(this.sampled=e.sampled),e.op&&(this.op=e.op),e.description&&(this.description=e.description),e.data&&(this.data=e.data),e.tags&&(this.tags=e.tags),e.status&&(this.status=e.status),e.startTimestamp&&(this.startTimestamp=e.startTimestamp),e.endTimestamp&&(this.endTimestamp=e.endTimestamp)}return t.prototype.child=function(e){return this.startChild(e)},t.prototype.startChild=function(e){var i=new t(m(m({},e),{parentSpanId:this.spanId,sampled:this.sampled,traceId:this.traceId}));return i.spanRecorder=this.spanRecorder,i.spanRecorder&&i.spanRecorder.add(i),i.transaction=this.transaction,i},t.prototype.setTag=function(e,i){var r;return this.tags=m(m({},this.tags),(r={},r[e]=i,r)),this},t.prototype.setData=function(e,i){var r;return this.data=m(m({},this.data),(r={},r[e]=i,r)),this},t.prototype.setStatus=function(e){return this.status=e,this},t.prototype.setHttpStatus=function(e){this.setTag("http.status_code",String(e));var i=Ee(e);return i!=="unknown_error"&&this.setStatus(i),this},t.prototype.isSuccess=function(){return this.status==="ok"},t.prototype.finish=function(e){this.endTimestamp=typeof e=="number"?e:x()},t.prototype.toTraceparent=function(){var e="";return this.sampled!==void 0&&(e=this.sampled?"-1":"-0"),this.traceId+"-"+this.spanId+e},t.prototype.toContext=function(){return F({data:this.data,description:this.description,endTimestamp:this.endTimestamp,op:this.op,parentSpanId:this.parentSpanId,sampled:this.sampled,spanId:this.spanId,startTimestamp:this.startTimestamp,status:this.status,tags:this.tags,traceId:this.traceId})},t.prototype.updateWithContext=function(e){var i,r,n,s,a;return this.data=(i=e.data,i!=null?i:{}),this.description=e.description,this.endTimestamp=e.endTimestamp,this.op=e.op,this.parentSpanId=e.parentSpanId,this.sampled=e.sampled,this.spanId=(r=e.spanId,r!=null?r:this.spanId),this.startTimestamp=(n=e.startTimestamp,n!=null?n:this.startTimestamp),this.status=e.status,this.tags=(s=e.tags,s!=null?s:{}),this.traceId=(a=e.traceId,a!=null?a:this.traceId),this},t.prototype.getTraceContext=function(){return F({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,trace_id:this.traceId})},t.prototype.toJSON=function(){return F({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,start_timestamp:this.startTimestamp,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this.endTimestamp,trace_id:this.traceId})},t}();function Ee(t){if(t<400&&t>=100)return"ok";if(t>=400&&t<500)switch(t){case 401:return"unauthenticated";case 403:return"permission_denied";case 404:return"not_found";case 409:return"already_exists";case 413:return"failed_precondition";case 429:return"resource_exhausted";default:return"invalid_argument"}if(t>=500&&t<600)switch(t){case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline_exceeded";default:return"internal_error"}return"unknown_error"}var me=function(t){J(e,t);function e(i,r){var n=t.call(this,i)||this;return n._measurements={},n._hub=Y(),ue(r,ge)&&(n._hub=r),n.name=i.name||"",n.metadata=i.metadata||{},n._trimEnd=i.trimEnd,n.transaction=n,n}return e.prototype.setName=function(i){this.name=i},e.prototype.initSpanRecorder=function(i){i===void 0&&(i=1e3),this.spanRecorder||(this.spanRecorder=new le(i)),this.spanRecorder.add(this)},e.prototype.setMeasurements=function(i){this._measurements=m({},i)},e.prototype.setMetadata=function(i){this.metadata=m(m({},this.metadata),i)},e.prototype.finish=function(i){var r=this;if(this.endTimestamp===void 0){if(this.name||(f&&p.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this.name="<unlabeled transaction>"),t.prototype.finish.call(this,i),this.sampled!==!0){f&&p.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled.");var n=this._hub.getClient(),s=n&&n.getTransport&&n.getTransport();s&&s.recordLostEvent&&s.recordLostEvent("sample_rate","transaction");return}var a=this.spanRecorder?this.spanRecorder.spans.filter(function(d){return d!==r&&d.endTimestamp}):[];this._trimEnd&&a.length>0&&(this.endTimestamp=a.reduce(function(d,c){return d.endTimestamp&&c.endTimestamp?d.endTimestamp>c.endTimestamp?d:c:d}).endTimestamp);var o={contexts:{trace:this.getTraceContext()},spans:a,start_timestamp:this.startTimestamp,tags:this.tags,timestamp:this.endTimestamp,transaction:this.name,type:"transaction",sdkProcessingMetadata:this.metadata},u=Object.keys(this._measurements).length>0;return u&&(f&&p.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),o.measurements=this._measurements),f&&p.log("[Tracing] Finishing "+this.op+" transaction: "+this.name+"."),this._hub.captureEvent(o)}},e.prototype.toContext=function(){var i=t.prototype.toContext.call(this);return F(m(m({},i),{name:this.name,trimEnd:this._trimEnd}))},e.prototype.updateWithContext=function(i){var r;return t.prototype.updateWithContext.call(this,i),this.name=(r=i.name,r!=null?r:""),this._trimEnd=i.trimEnd,this},e}(Re),he=1e3,ke=5e3,we=function(t){J(e,t);function e(i,r,n,s){n===void 0&&(n="");var a=t.call(this,s)||this;return a._pushActivity=i,a._popActivity=r,a.transactionSpanId=n,a}return e.prototype.add=function(i){var r=this;i.spanId!==this.transactionSpanId&&(i.finish=function(n){i.endTimestamp=typeof n=="number"?n:x(),r._popActivity(i.spanId)},i.endTimestamp===void 0&&this._pushActivity(i.spanId)),t.prototype.add.call(this,i)},e}(le),Ae=function(t){J(e,t);function e(i,r,n,s){n===void 0&&(n=he),s===void 0&&(s=!1);var a=t.call(this,i,r)||this;return a._idleHub=r,a._idleTimeout=n,a._onScope=s,a.activities={},a._heartbeatCounter=0,a._finished=!1,a._beforeFinishCallbacks=[],r&&s&&(ne(r),f&&p.log("Setting idle transaction on scope. Span ID: "+a.spanId),r.configureScope(function(o){return o.setSpan(a)})),a._initTimeout=setTimeout(function(){a._finished||a.finish()},a._idleTimeout),a}return e.prototype.finish=function(i){var r,n,s=this;if(i===void 0&&(i=x()),this._finished=!0,this.activities={},this.spanRecorder){f&&p.log("[Tracing] finishing IdleTransaction",new Date(i*1e3).toISOString(),this.op);try{for(var a=Se(this._beforeFinishCallbacks),o=a.next();!o.done;o=a.next()){var u=o.value;u(this,i)}}catch(d){r={error:d}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}this.spanRecorder.spans=this.spanRecorder.spans.filter(function(d){if(d.spanId===s.spanId)return!0;d.endTimestamp||(d.endTimestamp=i,d.setStatus("cancelled"),f&&p.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(d,void 0,2)));var c=d.startTimestamp<i;return c||f&&p.log("[Tracing] discarding Span since it happened after Transaction was finished",JSON.stringify(d,void 0,2)),c}),f&&p.log("[Tracing] flushing IdleTransaction")}else f&&p.log("[Tracing] No active IdleTransaction");return this._onScope&&ne(this._idleHub),t.prototype.finish.call(this,i)},e.prototype.registerBeforeFinishCallback=function(i){this._beforeFinishCallbacks.push(i)},e.prototype.initSpanRecorder=function(i){var r=this;if(!this.spanRecorder){var n=function(a){r._finished||r._pushActivity(a)},s=function(a){r._finished||r._popActivity(a)};this.spanRecorder=new we(n,s,this.spanId,i),f&&p.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)},e.prototype._pushActivity=function(i){this._initTimeout&&(clearTimeout(this._initTimeout),this._initTimeout=void 0),f&&p.log("[Tracing] pushActivity: "+i),this.activities[i]=!0,f&&p.log("[Tracing] new activities count",Object.keys(this.activities).length)},e.prototype._popActivity=function(i){var r=this;if(this.activities[i]&&(f&&p.log("[Tracing] popActivity "+i),delete this.activities[i],f&&p.log("[Tracing] new activities count",Object.keys(this.activities).length)),Object.keys(this.activities).length===0){var n=this._idleTimeout,s=x()+n/1e3;setTimeout(function(){r._finished||(r.setTag(G,W[1]),r.finish(s))},n)}},e.prototype._beat=function(){if(!this._finished){var i=Object.keys(this.activities).join("");i===this._prevHeartbeatString?this._heartbeatCounter+=1:this._heartbeatCounter=1,this._prevHeartbeatString=i,this._heartbeatCounter>=3?(f&&p.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus("deadline_exceeded"),this.setTag(G,W[0]),this.finish()):this._pingHeartbeat()}},e.prototype._pingHeartbeat=function(){var i=this;f&&p.log("pinging Heartbeat -> current counter: "+this._heartbeatCounter),setTimeout(function(){i._beat()},ke)},e}(me);function ne(t){if(t){var e=t.getScope();if(e){var i=e.getTransaction();i&&e.setSpan(void 0)}}}function Me(){var t=this.getScope();if(t){var e=t.getSpan();if(e)return{"sentry-trace":e.toTraceparent()}}return{}}function ve(t,e,i){if(!X(e))return t.sampled=!1,t;if(t.sampled!==void 0)return t.setMetadata({transactionSampling:{method:"explicitly_set"}}),t;var r;return typeof e.tracesSampler=="function"?(r=e.tracesSampler(i),t.setMetadata({transactionSampling:{method:"client_sampler",rate:Number(r)}})):i.parentSampled!==void 0?(r=i.parentSampled,t.setMetadata({transactionSampling:{method:"inheritance"}})):(r=e.tracesSampleRate,t.setMetadata({transactionSampling:{method:"client_rate",rate:Number(r)}})),xe(r)?r?(t.sampled=Math.random()<r,t.sampled?(f&&p.log("[Tracing] starting "+t.op+" transaction - "+t.name),t):(f&&p.log("[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = "+Number(r)+")"),t)):(f&&p.log("[Tracing] Discarding transaction because "+(typeof e.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),t.sampled=!1,t):(f&&p.warn("[Tracing] Discarding transaction because of invalid sample rate."),t.sampled=!1,t)}function xe(t){return _e(t)||!(typeof t=="number"||typeof t=="boolean")?(f&&p.warn("[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got "+JSON.stringify(t)+" of type "+JSON.stringify(typeof t)+"."),!1):t<0||t>1?(f&&p.warn("[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got "+t+"."),!1):!0}function Ce(t,e){var i=this.getClient(),r=i&&i.getOptions()||{},n=new me(t,this);return n=ve(n,r,m({parentSampled:t.parentSampled,transactionContext:t},e)),n.sampled&&n.initSpanRecorder(r._experiments&&r._experiments.maxSpans),n}function Ne(t,e,i,r,n){var s=t.getClient(),a=s&&s.getOptions()||{},o=new Ae(e,t,i,r);return o=ve(o,a,m({parentSampled:e.parentSampled,transactionContext:e},n)),o.sampled&&o.initSpanRecorder(a._experiments&&a._experiments.maxSpans),o}function He(){var t=de();t.__SENTRY__&&(t.__SENTRY__.extensions=t.__SENTRY__.extensions||{},t.__SENTRY__.extensions.startTransaction||(t.__SENTRY__.extensions.startTransaction=Ce),t.__SENTRY__.extensions.traceHeaders||(t.__SENTRY__.extensions.traceHeaders=Me))}function Pe(){var t=de();if(t.__SENTRY__){var e={mongodb:function(){var r=C(module,"./integrations/node/mongo");return new r.Mongo},mongoose:function(){var r=C(module,"./integrations/node/mongo");return new r.Mongo({mongoose:!0})},mysql:function(){var r=C(module,"./integrations/node/mysql");return new r.Mysql},pg:function(){var r=C(module,"./integrations/node/postgres");return new r.Postgres}},i=Object.keys(e).filter(function(r){return!!D(r)}).map(function(r){try{return e[r]()}catch(n){return}}).filter(function(r){return r});i.length>0&&(t.__SENTRY__.integrations=R(t.__SENTRY__.integrations||[],i))}}function Fe(){He(),ce()&&Pe(),Ie()}var qe=function(){function t(e){e===void 0&&(e={}),this.name=t.id,this._router=e.router||e.app,this._methods=(Array.isArray(e.methods)?e.methods:[]).concat("use")}return t.prototype.setupOnce=function(){if(!this._router){f&&p.error("ExpressIntegration is missing an Express instance");return}je(this._router,this._methods)},t.id="Express",t}();function ae(t,e){var i=t.length;switch(i){case 2:return function(r,n){var s=n.__sentry_transaction;if(s){var a=s.startChild({description:t.name,op:"express.middleware."+e});n.once("finish",function(){a.finish()})}return t.call(this,r,n)};case 3:return function(r,n,s){var a,o=n.__sentry_transaction,u=(a=o)===null||a===void 0?void 0:a.startChild({description:t.name,op:"express.middleware."+e});t.call(this,r,n,function(){for(var d=[],c=0;c<arguments.length;c++)d[c]=arguments[c];var l;(l=u)===null||l===void 0||l.finish(),s.call.apply(s,R([this],d))})};case 4:return function(r,n,s,a){var o,u=s.__sentry_transaction,d=(o=u)===null||o===void 0?void 0:o.startChild({description:t.name,op:"express.middleware."+e});t.call(this,r,n,s,function(){for(var c=[],l=0;l<arguments.length;l++)c[l]=arguments[l];var h;(h=d)===null||h===void 0||h.finish(),a.call.apply(a,R([this],c))})};default:throw new Error("Express middleware takes 2-4 arguments. Got: "+i)}}function Le(t,e){return t.map(function(i){return typeof i=="function"?ae(i,e):Array.isArray(i)?i.map(function(r){return typeof r=="function"?ae(r,e):r}):i})}function De(t,e){var i=t[e];return t[e]=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return i.call.apply(i,R([this],Le(r,e)))},t}function je(t,e){e===void 0&&(e=[]),e.forEach(function(i){return De(t,i)})}var Be=function(){function t(e){e===void 0&&(e={}),this.name=t.id,this._usePgNative=!!e.usePgNative}return t.prototype.setupOnce=function(e,i){var r,n=D("pg");if(!n){f&&p.error("Postgres Integration was unable to require `pg` package.");return}if(this._usePgNative&&!(!((r=n.native)===null||r===void 0)&&r.Client)){f&&p.error("Postgres Integration was unable to access 'pg-native' bindings.");return}var s=(this._usePgNative?n.native:n).Client;V(s.prototype,"query",function(a){return function(o,u,d){var c,l,h,g=i().getScope(),b=(c=g)===null||c===void 0?void 0:c.getSpan(),T=(l=b)===null||l===void 0?void 0:l.startChild({description:typeof o=="string"?o:o.text,op:"db"});if(typeof d=="function")return a.call(this,o,u,function(I,S){var y;(y=T)===null||y===void 0||y.finish(),d(I,S)});if(typeof u=="function")return a.call(this,o,function(I,S){var y;(y=T)===null||y===void 0||y.finish(),u(I,S)});var _=typeof u<"u"?a.call(this,o,u):a.call(this,o);return fe(_)?_.then(function(I){var S;return(S=T)===null||S===void 0||S.finish(),I}):((h=T)===null||h===void 0||h.finish(),_)}})},t.id="Postgres",t}(),Ue=function(){function t(){this.name=t.id}return t.prototype.setupOnce=function(e,i){var r=D("mysql/lib/Connection.js");if(!r){f&&p.error("Mysql Integration was unable to require `mysql` package.");return}V(r,"createQuery",function(n){return function(s,a,o){var u,d,c=i().getScope(),l=(u=c)===null||u===void 0?void 0:u.getSpan(),h=(d=l)===null||d===void 0?void 0:d.startChild({description:typeof s=="string"?s:s.sql,op:"db"});return typeof o=="function"?n.call(this,s,a,function(g,b,T){var _;(_=h)===null||_===void 0||_.finish(),o(g,b,T)}):typeof a=="function"?n.call(this,s,function(g,b,T){var _;(_=h)===null||_===void 0||_.finish(),a(g,b,T)}):n.call(this,s,a,o)}})},t.id="Mysql",t}(),ze=["aggregate","bulkWrite","countDocuments","createIndex","createIndexes","deleteMany","deleteOne","distinct","drop","dropIndex","dropIndexes","estimatedDocumentCount","find","findOne","findOneAndDelete","findOneAndReplace","findOneAndUpdate","indexes","indexExists","indexInformation","initializeOrderedBulkOp","insertMany","insertOne","isCapped","mapReduce","options","parallelCollectionScan","rename","replaceOne","stats","updateMany","updateOne"],Ge={bulkWrite:["operations"],countDocuments:["query"],createIndex:["fieldOrSpec"],createIndexes:["indexSpecs"],deleteMany:["filter"],deleteOne:["filter"],distinct:["key","query"],dropIndex:["indexName"],find:["query"],findOne:["query"],findOneAndDelete:["filter"],findOneAndReplace:["filter","replacement"],findOneAndUpdate:["filter","update"],indexExists:["indexes"],insertMany:["docs"],insertOne:["doc"],mapReduce:["map","reduce"],rename:["newName"],replaceOne:["filter","doc"],updateMany:["filter","update"],updateOne:["filter","update"]},We=function(){function t(e){e===void 0&&(e={}),this.name=t.id,this._operations=Array.isArray(e.operations)?e.operations:ze,this._describeOperations="describeOperations"in e?e.describeOperations:!0,this._useMongoose=!!e.useMongoose}return t.prototype.setupOnce=function(e,i){var r=this._useMongoose?"mongoose":"mongodb",n=D(r);if(!n){f&&p.error("Mongo Integration was unable to require `"+r+"` package.");return}this._instrumentOperations(n.Collection,this._operations,i)},t.prototype._instrumentOperations=function(e,i,r){var n=this;i.forEach(function(s){return n._patchOperation(e,s,r)})},t.prototype._patchOperation=function(e,i,r){if(i in e.prototype){var n=this._getSpanContextFromOperationArguments.bind(this);V(e.prototype,i,function(s){return function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];var u,d,c,l,h=a[a.length-1],g=r().getScope(),b=(u=g)===null||u===void 0?void 0:u.getSpan();if(typeof h!="function"||i==="mapReduce"&&a.length===2){var T=(d=b)===null||d===void 0?void 0:d.startChild(n(this,i,a)),_=s.call.apply(s,R([this],a));return fe(_)?_.then(function(S){var y;return(y=T)===null||y===void 0||y.finish(),S}):((c=T)===null||c===void 0||c.finish(),_)}var I=(l=b)===null||l===void 0?void 0:l.startChild(n(this,i,a.slice(0,-1)));return s.call.apply(s,R([this],a.slice(0,-1),[function(S,y){var U;(U=I)===null||U===void 0||U.finish(),h(S,y)}]))}})}},t.prototype._getSpanContextFromOperationArguments=function(e,i,r){var n={collectionName:e.collectionName,dbName:e.dbName,namespace:e.namespace},s={op:"db",description:i,data:n},a=Ge[i],o=Array.isArray(this._describeOperations)?this._describeOperations.includes(i):this._describeOperations;if(!a||!o)return s;try{if(i==="mapReduce"){var u=pe(r,2),d=u[0],c=u[1];n[a[0]]=typeof d=="string"?d:d.name||"<anonymous>",n[a[1]]=typeof c=="string"?c:c.name||"<anonymous>"}else for(var l=0;l<a.length;l++)n[a[l]]=JSON.stringify(r[l])}catch(h){}return s},t.id="Mongo",t}(),N=E();function Ye(){N&&N.document?N.document.addEventListener("visibilitychange",function(){var t=j();if(N.document.hidden&&t){var e="cancelled";f&&p.log("[Tracing] Transaction: "+e+" -> since tab moved to the background, op: "+t.op),t.status||t.setStatus(e),t.setTag("visibilitychange","document.hidden"),t.setTag(G,W[2]),t.finish()}}):f&&p.warn("[Tracing] Could not set up background tab detection due to lack of global document")}var $=function(t,e,i){var r;return function(n){e.value>=0&&(n||i)&&(e.delta=e.value-(r||0),(e.delta||r===void 0)&&(r=e.value,t(e)))}},Ve=function(){return"v2-"+Date.now()+"-"+(Math.floor(Math.random()*(9e12-1))+1e12)},Q=function(t,e){return{name:t,value:e!=null?e:-1,delta:0,entries:[],id:Ve()}},K=function(t,e){try{if(PerformanceObserver.supportedEntryTypes.includes(t)){if(t==="first-input"&&!("PerformanceEventTiming"in self))return;var i=new PerformanceObserver(function(r){return r.getEntries().map(e)});return i.observe({type:t,buffered:!0}),i}}catch(r){}},B=function(t,e){var i=function(r){(r.type==="pagehide"||E().document.visibilityState==="hidden")&&(t(r),e&&(removeEventListener("visibilitychange",i,!0),removeEventListener("pagehide",i,!0)))};addEventListener("visibilitychange",i,!0),addEventListener("pagehide",i,!0)},Je=function(t,e){var i=Q("CLS",0),r,n=0,s=[],a=function(u){if(u&&!u.hadRecentInput){var d=s[0],c=s[s.length-1];n&&s.length!==0&&u.startTime-c.startTime<1e3&&u.startTime-d.startTime<5e3?(n+=u.value,s.push(u)):(n=u.value,s=[u]),n>i.value&&(i.value=n,i.entries=s,r&&r())}},o=K("layout-shift",a);o&&(r=$(t,i,e),B(function(){o.takeRecords().map(a),r(!0)}))},q=-1,Xe=function(){return E().document.visibilityState==="hidden"?0:1/0},$e=function(){B(function(t){var e=t.timeStamp;q=e},!0)},Z=function(){return q<0&&(q=Xe(),$e()),{get firstHiddenTime(){return q}}},Qe=function(t,e){var i=Z(),r=Q("FID"),n,s=function(o){n&&o.startTime<i.firstHiddenTime&&(r.value=o.processingStart-o.startTime,r.entries.push(o),n(!0))},a=K("first-input",s);a&&(n=$(t,r,e),B(function(){a.takeRecords().map(s),a.disconnect()},!0))},se={},Ke=function(t,e){var i=Z(),r=Q("LCP"),n,s=function(u){var d=u.startTime;d<i.firstHiddenTime&&(r.value=d,r.entries.push(u)),n&&n()},a=K("largest-contentful-paint",s);if(a){n=$(t,r,e);var o=function(){se[r.id]||(a.takeRecords().map(s),a.disconnect(),se[r.id]=!0,n(!0))};["keydown","click"].forEach(function(u){addEventListener(u,o,{once:!0,capture:!0})}),B(o,!0)}},O=E(),Ze=function(){function t(e){e===void 0&&(e=!1),this._reportAllChanges=e,this._measurements={},this._performanceCursor=0,!ce()&&O&&O.performance&&O.document&&(O.performance.mark&&O.performance.mark("sentry-tracing-init"),this._trackCLS(),this._trackLCP(),this._trackFID())}return t.prototype.addPerformanceEntries=function(e){var i=this;if(!(!O||!O.performance||!O.performance.getEntries||!w)){f&&p.log("[Tracing] Adding & adjusting spans using Performance API");var r=v(w),n,s;if(O.performance.getEntries().slice(this._performanceCursor).forEach(function(o){var u=v(o.startTime),d=v(o.duration);if(!(e.op==="navigation"&&r+u<e.startTimestamp))switch(o.entryType){case"navigation":{et(e,o,r),n=r+v(o.responseStart),s=r+v(o.requestStart);break}case"mark":case"paint":case"measure":{var c=tt(e,o,u,d,r),l=Z(),h=o.startTime<l.firstHiddenTime;o.name==="first-paint"&&h&&(f&&p.log("[Measurements] Adding FP"),i._measurements.fp={value:o.startTime},i._measurements["mark.fp"]={value:c}),o.name==="first-contentful-paint"&&h&&(f&&p.log("[Measurements] Adding FCP"),i._measurements.fcp={value:o.startTime},i._measurements["mark.fcp"]={value:c});break}case"resource":{var g=o.name.replace(O.location.origin,"");it(e,o,g,u,d,r);break}}}),this._performanceCursor=Math.max(performance.getEntries().length-1,0),this._trackNavigator(e),e.op==="pageload"){var a=v(w);typeof n=="number"&&(f&&p.log("[Measurements] Adding TTFB"),this._measurements.ttfb={value:(n-e.startTimestamp)*1e3},typeof s=="number"&&s<=n&&(this._measurements["ttfb.requestTime"]={value:(n-s)*1e3})),["fcp","fp","lcp"].forEach(function(o){if(!(!i._measurements[o]||a>=e.startTimestamp)){var u=i._measurements[o].value,d=a+v(u),c=Math.abs((d-e.startTimestamp)*1e3),l=c-u;f&&p.log("[Measurements] Normalized "+o+" from "+u+" to "+c+" ("+l+")"),i._measurements[o].value=c}}),this._measurements["mark.fid"]&&this._measurements.fid&&k(e,{description:"first input delay",endTimestamp:this._measurements["mark.fid"].value+v(this._measurements.fid.value),op:"web.vitals",startTimestamp:this._measurements["mark.fid"].value}),"fcp"in this._measurements||delete this._measurements.cls,e.setMeasurements(this._measurements),nt(e,this._lcpEntry,this._clsEntry),e.setTag("sentry_reportAllChanges",this._reportAllChanges)}}},t.prototype._trackNavigator=function(e){var i=O.navigator;if(i){var r=i.connection;r&&(r.effectiveType&&e.setTag("effectiveConnectionType",r.effectiveType),r.type&&e.setTag("connectionType",r.type),P(r.rtt)&&(this._measurements["connection.rtt"]={value:r.rtt}),P(r.downlink)&&(this._measurements["connection.downlink"]={value:r.downlink})),P(i.deviceMemory)&&e.setTag("deviceMemory",String(i.deviceMemory)),P(i.hardwareConcurrency)&&e.setTag("hardwareConcurrency",String(i.hardwareConcurrency))}},t.prototype._trackCLS=function(){var e=this;Je(function(i){var r=i.entries.pop();r&&(f&&p.log("[Measurements] Adding CLS"),e._measurements.cls={value:i.value},e._clsEntry=r)})},t.prototype._trackLCP=function(){var e=this;Ke(function(i){var r=i.entries.pop();if(r){var n=v(w),s=v(r.startTime);f&&p.log("[Measurements] Adding LCP"),e._measurements.lcp={value:i.value},e._measurements["mark.lcp"]={value:n+s},e._lcpEntry=r}},this._reportAllChanges)},t.prototype._trackFID=function(){var e=this;Qe(function(i){var r=i.entries.pop();if(r){var n=v(w),s=v(r.startTime);f&&p.log("[Measurements] Adding FID"),e._measurements.fid={value:i.value},e._measurements["mark.fid"]={value:n+s}}})},t}();function et(t,e,i){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(function(r){H(t,e,r,i)}),H(t,e,"secureConnection",i,"TLS/SSL","connectEnd"),H(t,e,"fetch",i,"cache","domainLookupStart"),H(t,e,"domainLookup",i,"DNS"),rt(t,e,i)}function tt(t,e,i,r,n){var s=n+i,a=s+r;return k(t,{description:e.name,endTimestamp:a,op:e.entryType,startTimestamp:s}),s}function it(t,e,i,r,n,s){if(!(e.initiatorType==="xmlhttprequest"||e.initiatorType==="fetch")){var a={};"transferSize"in e&&(a["Transfer Size"]=e.transferSize),"encodedBodySize"in e&&(a["Encoded Body Size"]=e.encodedBodySize),"decodedBodySize"in e&&(a["Decoded Body Size"]=e.decodedBodySize);var o=s+r,u=o+n;k(t,{description:i,endTimestamp:u,op:e.initiatorType?"resource."+e.initiatorType:"resource",startTimestamp:o,data:a})}}function H(t,e,i,r,n,s){var a=s?e[s]:e[i+"End"],o=e[i+"Start"];!o||!a||k(t,{op:"browser",description:n!=null?n:i,startTimestamp:r+v(o),endTimestamp:r+v(a)})}function rt(t,e,i){k(t,{op:"browser",description:"request",startTimestamp:i+v(e.requestStart),endTimestamp:i+v(e.responseEnd)}),k(t,{op:"browser",description:"response",startTimestamp:i+v(e.responseStart),endTimestamp:i+v(e.responseEnd)})}function k(t,e){var i=e.startTimestamp,r=be(e,["startTimestamp"]);return i&&t.startTimestamp>i&&(t.startTimestamp=i),t.startChild(m({startTimestamp:i},r))}function P(t){return typeof t=="number"&&isFinite(t)}function nt(t,e,i){e&&(f&&p.log("[Measurements] Adding LCP Data"),e.element&&t.setTag("lcp.element",te(e.element)),e.id&&t.setTag("lcp.id",e.id),e.url&&t.setTag("lcp.url",e.url.trim().slice(0,200)),t.setTag("lcp.size",e.size)),i&&i.sources&&(f&&p.log("[Measurements] Adding CLS Data"),i.sources.forEach(function(r,n){return t.setTag("cls.source."+(n+1),te(r.node))}))}var at=["localhost",/^\//],L={traceFetch:!0,traceXHR:!0,tracingOrigins:at};function st(t){var e=m(m({},L),t),i=e.traceFetch,r=e.traceXHR,n=e.tracingOrigins,s=e.shouldCreateSpanForRequest,a={},o=function(c){if(a[c])return a[c];var l=n;return a[c]=l.some(function(h){return ie(c,h)})&&!ie(c,"sentry_key"),a[c]},u=o;typeof s=="function"&&(u=function(c){return o(c)&&s(c)});var d={};i&&M("fetch",function(c){ot(c,u,d)}),r&&M("xhr",function(c){ut(c,u,d)})}function ot(t,e,i){if(!(!X()||!(t.fetchData&&e(t.fetchData.url)))){if(t.endTimestamp){var r=t.fetchData.__span;if(!r)return;var n=i[r];n&&(t.response?n.setHttpStatus(t.response.status):t.error&&n.setStatus("internal_error"),n.finish(),delete i[r]);return}var s=j();if(s){var n=s.startChild({data:m(m({},t.fetchData),{type:"fetch"}),description:t.fetchData.method+" "+t.fetchData.url,op:"http.client"});t.fetchData.__span=n.spanId,i[n.spanId]=n;var a=t.args[0]=t.args[0],o=t.args[1]=t.args[1]||{},u=o.headers;ue(a,Request)&&(u=a.headers),u?typeof u.append=="function"?u.append("sentry-trace",n.toTraceparent()):Array.isArray(u)?u=R(u,[["sentry-trace",n.toTraceparent()]]):u=m(m({},u),{"sentry-trace":n.toTraceparent()}):u={"sentry-trace":n.toTraceparent()},o.headers=u}}}function ut(t,e,i){if(!(!X()||t.xhr&&t.xhr.__sentry_own_request__||!(t.xhr&&t.xhr.__sentry_xhr__&&e(t.xhr.__sentry_xhr__.url)))){var r=t.xhr.__sentry_xhr__;if(t.endTimestamp){var n=t.xhr.__sentry_xhr_span_id__;if(!n)return;var s=i[n];s&&(s.setHttpStatus(r.status_code),s.finish(),delete i[n]);return}var a=j();if(a){var s=a.startChild({data:m(m({},r.data),{type:"xhr",method:r.method,url:r.url}),description:r.method+" "+r.url,op:"http.client"});if(t.xhr.__sentry_xhr_span_id__=s.spanId,i[t.xhr.__sentry_xhr_span_id__]=s,t.xhr.setRequestHeader)try{t.xhr.setRequestHeader("sentry-trace",s.toTraceparent())}catch(u){}}}}var A=E();function ct(t,e,i){if(e===void 0&&(e=!0),i===void 0&&(i=!0),!A||!A.location){f&&p.warn("Could not initialize routing instrumentation due to invalid location");return}var r=A.location.href,n;e&&(n=t({name:A.location.pathname,op:"pageload"})),i&&M("history",function(s){var a=s.to,o=s.from;if(o===void 0&&r&&r.indexOf(a)!==-1){r=void 0;return}o!==a&&(r=void 0,n&&(f&&p.log("[Tracing] Finishing current transaction with op: "+n.op),n.finish()),n=t({name:A.location.pathname,op:"navigation"}))})}var dt=600,ft=m({idleTimeout:he,markBackgroundTransactions:!0,maxTransactionDuration:dt,routingInstrumentation:ct,startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0},L),pt=function(){function t(e){this.name=t.id,this._configuredIdleTimeout=void 0;var i=L.tracingOrigins;e&&(this._configuredIdleTimeout=e.idleTimeout,e.tracingOrigins&&Array.isArray(e.tracingOrigins)&&e.tracingOrigins.length!==0?i=e.tracingOrigins:f&&(this._emitOptionsWarning=!0)),this.options=m(m(m({},ft),e),{tracingOrigins:i});var r=this.options._metricOptions;this._metrics=new Ze(r&&r._reportAllChanges)}return t.prototype.setupOnce=function(e,i){var r=this;this._getCurrentHub=i,this._emitOptionsWarning&&(f&&p.warn("[Tracing] You need to define `tracingOrigins` in the options. Set an array of urls or patterns to trace."),f&&p.warn("[Tracing] We added a reasonable default for you: "+L.tracingOrigins));var n=this.options,s=n.routingInstrumentation,a=n.startTransactionOnLocationChange,o=n.startTransactionOnPageLoad,u=n.markBackgroundTransactions,d=n.traceFetch,c=n.traceXHR,l=n.tracingOrigins,h=n.shouldCreateSpanForRequest;s(function(g){return r._createRouteTransaction(g)},o,a),u&&Ye(),st({traceFetch:d,traceXHR:c,tracingOrigins:l,shouldCreateSpanForRequest:h})},t.prototype._createRouteTransaction=function(e){var i=this;if(!this._getCurrentHub){f&&p.warn("[Tracing] Did not create "+e.op+" transaction because _getCurrentHub is invalid.");return}var r=this.options,n=r.beforeNavigate,s=r.idleTimeout,a=r.maxTransactionDuration,o=e.op==="pageload"?lt():void 0,u=m(m(m({},e),o),{trimEnd:!0}),d=typeof n=="function"?n(u):u,c=d===void 0?m(m({},u),{sampled:!1}):d;c.sampled===!1&&f&&p.log("[Tracing] Will not send "+c.op+" transaction because of beforeNavigate."),f&&p.log("[Tracing] Starting "+c.op+" transaction on scope");var l=this._getCurrentHub(),h=E().location,g=Ne(l,c,s,!0,{location:h});return g.registerBeforeFinishCallback(function(b,T){i._metrics.addPerformanceEntries(b),ht(Oe(a),b,T)}),g.setTag("idleTimeout",this._configuredIdleTimeout),g},t.id="BrowserTracing",t}();function lt(){var t=mt("sentry-trace");if(t)return ye(t)}function mt(t){var e=E().document.querySelector("meta[name="+t+"]");return e?e.getAttribute("content"):null}function ht(t,e,i){var r=i-e.startTimestamp,n=i&&(r>t||r<0);n&&(e.setStatus("deadline_exceeded"),e.setTag("maxTransactionDurationExceeded","true"))}const gt=Object.freeze(Object.defineProperty({__proto__:null,BrowserTracing:pt,Express:qe,Mongo:We,Mysql:Ue,Postgres:Be},Symbol.toStringTag,{value:"Module"}));var oe;(function(t){t.Ok="ok",t.DeadlineExceeded="deadline_exceeded",t.Unauthenticated="unauthenticated",t.PermissionDenied="permission_denied",t.NotFound="not_found",t.ResourceExhausted="resource_exhausted",t.InvalidArgument="invalid_argument",t.Unimplemented="unimplemented",t.Unavailable="unavailable",t.InternalError="internal_error",t.UnknownError="unknown_error",t.Cancelled="cancelled",t.AlreadyExists="already_exists",t.FailedPrecondition="failed_precondition",t.Aborted="aborted",t.OutOfRange="out_of_range",t.DataLoss="data_loss"})(oe||(oe={}));Fe();export{pt as BrowserTracing,Ae as IdleTransaction,gt as Integrations,Re as Span,oe as SpanStatus,Te as TRACEPARENT_REGEXP,me as Transaction,Fe as addExtensionMethods,L as defaultRequestInstrumentationOptions,ye as extractTraceparentData,j as getActiveTransaction,X as hasTracingEnabled,st as registerRequestInstrumentation,Ee as spanStatusfromHttpCode,Ne as startIdleTransaction,yt as stripUrlQueryAndFragment};
