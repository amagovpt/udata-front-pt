import{defineComponent as T,openBlock as c,createElementBlock as y,Fragment as q,createVNode as l,mergeProps as we,createElementVNode as t,toDisplayString as a,useTemplateRef as Ge,ref as k,computed as M,onMounted as ue,watchEffect as V,normalizeClass as Y,createBlock as A,unref as e,withCtx as u,createCommentVNode as D,createTextVNode as $,renderSlot as N,renderList as W,readonly as Je,useId as Qe,resolveComponent as x,watchPostEffect as Xe,Teleport as pe,withModifiers as _e,createApp as Ke}from"vue";import{D as ve,L as j,bH as et,v as B,F as U,A as Q,bI as tt,H as X,_ as te,b as ke,bJ as st,h as ze,ao as Z,y as E,B as at,bi as se,bK as ot,bL as lt,ay as Ce,bt as nt,bM as ce,bN as rt,bO as it,bP as dt,at as ut,M as ne,ag as ct,bQ as ft,bR as mt,bo as _t,bS as pt,bT as vt,be as bt,bU as gt,bV as je,a_ as ht,Y as le,a8 as yt,aX as Fe,bW as $t,az as wt,a0 as be,a2 as kt,bX as zt,bY as Ct,aN as Dt,bZ as At,b_ as St,b$ as Re,c0 as Rt,c1 as Tt,c2 as Ot,c3 as Ue,c4 as Bt,c5 as Mt,x as qt,C as Pt,bh as It,c6 as Lt,c7 as xt,bk as jt,a as ge,c8 as Ft,c9 as Ut,ca as Ht,cb as Vt,a9 as He,cc as Et,cd as Yt,ce as Nt,cf as Ve,cg as Wt,ch as Zt,av as Gt,bv as Jt,by as $e,aZ as Qt,bz as Xt,bB as Kt,bC as es,ci as ts,cj as ss,bD as as,bE as os,bF as ls}from"./sentry.6.0.6.js";import{ContentLoader as Te}from"vue-content-loader";import"./_commonjsHelpers.6.0.6.js";function fr(){import.meta.url,import("_").catch(()=>1);async function*v(){}}const ns={class:"fr-ml-1v fr-text--bold"},rs=T({__name:"AvatarWithName",props:{user:{},size:{default:12}},setup(v){return(s,o)=>(c(),y(q,null,[l(ve,we(s.$attrs,{user:s.user,size:s.size,rounded:!0}),null,16,["user","size"]),t("span",ns,a(s.user.first_name)+" "+a(s.user.last_name),1)],64))}}),is={ref:"canvasRef",width:"120",height:"30"},ds={class:"fr-grid-row justify-between"},us={class:"text-xxs fr-m-0 text-mention-grey"},cs={class:"text-xxs fr-m-0 text-mention-grey"},Oe="#B6CFFB",de="#3558A2",fs="rgba(53, 88, 162, 0.7)",ms="rgba(182, 207, 251, 0.7)",_s=T({__name:"SmallChart",props:{data:{},type:{},lastWithLowEmphasis:{type:Boolean,default:!1}},setup(v){const s=v,o=(w,g)=>w.p1DataIndex===n.value.length-1?g:null,b=Ge("canvasRef"),d=k(null),i=k(null),r=M(()=>{const w=Object.keys(s.data);w.sort();let g={};for(const C of w)g[C]=s.data[C];return g}),n=M(()=>Object.keys(r.value)),p=M(()=>Object.values(r.value)),m=M(()=>s.type==="bar"?{barPercentage:1,categoryPercentage:.9,backgroundColor:n.value.map((w,g)=>g===n.value.length-1?s.lastWithLowEmphasis?ms:de:Oe)}:s.type==="line"&&s.lastWithLowEmphasis?{segment:{borderColor:w=>o(w,fs)||de,borderDash:w=>o(w,[3,3])||[6,0]}}:{}),f=M(()=>n.value.length?j(n.value[0],"MM/YY"):null),h=M(()=>n.value.length?j(n.value[n.value.length-1],"MM/YY"):null),_={animation:!1,responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!1}},elements:{bar:{backgroundColor:Oe,borderRadius:2,hoverBackgroundColor:de},line:{backgroundColor:de,borderColor:de,borderJoinStyle:"round",tension:.35},point:{radius:0}},scales:{x:{display:!1,grid:{display:!1},ticks:{display:!1}},y:{display:!1,grid:{display:!1},ticks:{display:!1}}},layout:{padding:{top:1.5}}};return ue(()=>{d.value=b.value?b.value.getContext("2d"):null}),V(()=>{d.value&&(i.value&&i.value.destroy(),i.value=new et(d.value,{data:{labels:n.value,datasets:[{data:p.value,type:s.type,...m.value}]},options:_}))}),(w,g)=>(c(),y("div",null,[t("canvas",is,null,512),t("div",ds,[t("p",us,a(f.value),1),t("p",cs,a(h.value),1)])]))}}),ps={class:"fr-text--sm fr-m-0"},vs={class:"fr-grid-row fr-grid-row--middle"},bs={key:1,class:"h1 line-height-1 fr-m-0"},gs={key:3,class:"fr-ml-1w"},hs={key:0,class:"fr-mt-1w fr-text--regular text-transform-none fr-badge fr-badge--no-icon fr-badge--success"},ys={class:"fr-mr-1v"},ye=T({__name:"StatBox",props:{title:{},data:{},type:{},summary:{}},setup(v){const s=v,{t:o}=B(),b=M(()=>s.data?Object.keys(s.data):[]),d=M(()=>s.data?Object.values(s.data):[]),i=M(()=>b.value.length?b.value.reduce((m,f)=>f>m?f:m):null),r=M(()=>i.value?b.value.indexOf(i.value):null),n=M(()=>r.value!==null?d.value[r.value]:null),p=M(()=>Math.max(...d.value)>0);return(m,f)=>(c(),y("div",{class:Y({"text-mention-grey":!p.value&&!m.summary})},[t("h3",ps,a(m.title),1),t("div",vs,[m.summary===null?(c(),A(e(Te),{key:0,width:92,height:32,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},{default:u(()=>f[0]||(f[0]=[t("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"92",height:"32"},null,-1)])),_:1})):(c(),y("p",bs,a(e(U)(m.summary,2)),1)),m.data===null?(c(),A(e(Te),{key:2,width:120,height:30,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",class:"fr-ml-1w"},{default:u(()=>f[1]||(f[1]=[t("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"120",height:"30"},null,-1)])),_:1})):p.value?(c(),y("div",gs,[l(_s,{type:m.type,data:m.data,lastWithLowEmphasis:!0},null,8,["type","data"])])):D("",!0)]),n.value&&i.value?(c(),y("p",hs,[t("strong",ys," +Â "+a(e(U)(n.value,2)),1),$(" "+a(e(o)(" in "))+" "+a(e(j)(i.value,"MMM YYYY")),1)])):D("",!0)],2))}}),$s=["aria-label"],ws={class:"fr-breadcrumb__list"},G={__name:"Breadcrumb",setup(v){const{t:s}=B();return(o,b)=>(c(),y("nav",{rol:"navigation","aria-label":e(s)("You're here:"),class:"fr-breadcrumb fr-mb-5v"},[t("ol",ws,[N(o.$slots,"default")])],8,$s))}},ks={class:"fr-text--sm fr-my-0"},zs={class:"fr-grid-row fr-grid-row--right not-enlarged"},Cs=["href","title"],Ds=T({__name:"QualityScoreTooltipContent",props:{dataset:{}},setup(v){const{t:s}=B();return(o,b)=>(c(),y(q,null,[t("h5",ks,a(e(s)("Metadata quality:")),1),l(e(Q),{passed:o.dataset.quality.dataset_description_quality,messagePassed:e(s)("Data description filled"),messageFailed:e(s)("Data description empty"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),l(e(Q),{passed:o.dataset.quality.resources_documentation,messagePassed:e(s)("Files documented"),messageFailed:e(s)("Files documentation missing"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),l(e(Q),{passed:o.dataset.quality.license,messagePassed:e(s)("License filled"),messageFailed:e(s)("No license set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),l(e(Q),{passed:o.dataset.quality.update_frequency&&!!o.dataset.quality.update_fulfilled_in_time,messagePassed:e(s)("Update frequency followed"),messageFailed:o.dataset.quality.update_frequency?e(s)("Update frequency not followed"):e(s)("Update frequency not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),l(e(Q),{passed:o.dataset.quality.has_open_format,messagePassed:e(s)("File formats are open"),messageFailed:e(s)("File formats are closed"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),l(e(Q),{passed:o.dataset.quality.temporal_coverage,messagePassed:e(s)("Temporal coverage filled"),messageFailed:e(s)("Temporal coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),l(e(Q),{passed:o.dataset.quality.spatial,messagePassed:e(s)("Spatial coverage filled"),messageFailed:e(s)("Spatial coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),l(e(Q),{passed:o.dataset.quality.all_resources_available,messagePassed:e(s)("All files are available"),messageFailed:e(s)("Some files are unavailable"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),t("div",zs,[t("a",{href:e(tt),target:"_blank",rel:"noopener",title:e(s)("Learn more about this indicator - opens a new window")},a(e(s)("Learn more about this indicator")),9,Cs)])],64))}}),ee=T({__name:"AdminBadge",props:{type:{}},setup(v){return(s,o)=>(c(),y("p",{class:Y(["fr-badge",{"fr-badge--blue-cumulus":s.type==="info","fr-badge--error fr-badge--no-icon":s.type==="error","fr-badge--warning fr-badge--no-icon":s.type==="warning","fr-badge--success fr-badge--no-icon":s.type==="success"}])},[N(s.$slots,"default")],2))}}),As=["aria-describedby"],Ss=["id"],Rs=T({inheritAttrs:!1,__name:"AdminContentWithTooltip",setup(v){const s=X(),o=k(),b=k("");return ue(()=>{o.value&&(b.value=o.value.textContent||"")}),(d,i)=>(c(),y(q,null,[t("p",we(d.$attrs,{"aria-describedby":e(s),ref_key:"contentRef",ref:o}),[N(d.$slots,"default",{},void 0,!0)],16,As),t("span",{class:"fr-hidden-xl fr-tooltip fr-placement",id:e(s),role:"tooltip","aria-hidden":"true"},a(b.value),9,Ss)],64))}});const fe=te(Rs,[["__scopeId","data-v-d192f17a"]]),Ee=T({__name:"AdminLoader",props:{scale:{default:4}},setup(v){return ke(st),(s,o)=>(c(),A(e(ze),{name:"ri-loader-5-line",animation:"spin",scale:s.scale,fill:"var(--blue-cumulus-sun-368-moon-732)"},null,8,["scale"]))}}),Ts={class:"fr-table fr-mb-2w"},Os=T({__name:"AdminTable",props:{loading:{type:Boolean,default:!1}},setup(v){return(s,o)=>(c(),y("div",Ts,[t("table",null,[N(s.$slots,"default",{},void 0,!0)]),s.loading?(c(),A(Z,{key:0,class:"fr-p-4w text-align-center"},{default:u(()=>[l(Ee)]),_:1})):D("",!0)]))}});const ae=te(Os,[["__scopeId","data-v-cae574a4"]]),Bs={class:"fr-text--bold"},Ms={key:1,class:"fr-grid-row fr-grid-row--middle justify-between"},qs=["title"],Ps=T({__name:"AdminTableTh",props:{sorted:{}},emits:["sort"],setup(v,{emit:s}){const o=v,b=s,{t:d}=B(),i=M(()=>o.sorted!==void 0);function r(){return o.sorted==="desc"?b("sort","asc"):b("sort","desc")}return(n,p)=>(c(),y("th",Bs,[i.value?(c(),y("div",Ms,[N(n.$slots,"default",{},void 0,!0),t("button",{class:Y(["fr-ml-1w fr-btn fr-btn--sm fr-btn--tertiary-no-outline",{"fr-icon-arrow-down-line":!n.sorted||n.sorted==="asc","fr-icon-arrow-up-line":n.sorted==="desc","text-grey-500":n.sorted,"text-mention-grey":!n.sorted}]),onClick:r,title:e(d)("Sort")},a(e(d)("Sort")),11,qs)])):N(n.$slots,"default",{key:0},void 0,!0)]))}});const S=te(Ps,[["__scopeId","data-v-5acf0bf0"]]),Is=["aria-describedby"],Ls=["id"],H=T({__name:"Tooltip",setup(v){const s=X("tooltip");return(o,b)=>(c(),y(q,null,[t("p",we(o.$attrs,{"aria-describedby":e(s)}),[N(o.$slots,"default")],16,Is),t("span",{class:"fr-tooltip fr-placement",id:e(s),role:"tooltip","aria-hidden":"true"},[N(o.$slots,"tooltip")],8,Ls)],64))}}),xs=["href"],js={class:"monospace"},Fs={class:"monospace"},Us={class:"monospace"},Hs={class:"monospace"},Vs={class:"monospace"},Es=T({__name:"AdminDatasetsTable",props:{datasets:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(v,{emit:s}){const o=s,b=v,{t:d}=B();function i(f,h){o("sort",f,h)}function r(f){return b.sortedBy===f?b.sortDirection:null}function n(f){return Array.isArray(f.resources)?f.resources.length:f.resources.total}function p(f){return"".concat(se,"dataset/").concat(f.id,"/")}function m(f){return f.deleted?{label:d("Deleted"),type:"error"}:f.archived?{label:d("Archived"),type:"warning"}:f.private?{label:d("Draft"),type:"default"}:{label:d("Public"),type:"info"}}return(f,h)=>(c(),A(ae,{loading:f.loading},{default:u(()=>[t("thead",null,[t("tr",null,[l(S,{onSort:h[0]||(h[0]=_=>i("title",_)),sorted:r("title"),scope:"col"},{default:u(()=>[$(a(e(d)("Title of the dataset")),1)]),_:1},8,["sorted"]),l(S,{scope:"col"},{default:u(()=>[$(a(e(d)("Status")),1)]),_:1}),l(S,{onSort:h[1]||(h[1]=_=>i("created",_)),sorted:r("created"),scope:"col"},{default:u(()=>[$(a(e(d)("Created at")),1)]),_:1},8,["sorted"]),l(S,{onSort:h[2]||(h[2]=_=>i("last_update",_)),sorted:r("last_update"),scope:"col"},{default:u(()=>[$(a(e(d)("Updated at")),1)]),_:1},8,["sorted"]),l(S,{scope:"col"},{default:u(()=>[$(a(e(d)("Files")),1)]),_:1}),l(S,{scope:"col"},{default:u(()=>[$(a(e(d)("Score")),1)]),_:1}),l(S,{scope:"col"},{default:u(()=>[l(H,null,{tooltip:u(()=>[$(a(e(d)("Discussions")),1)]),default:u(()=>[h[6]||(h[6]=t("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),l(S,{onSort:h[3]||(h[3]=_=>i("views",_)),sorted:r("views"),scope:"col"},{default:u(()=>[l(H,null,{tooltip:u(()=>[$(a(e(d)("Views")),1)]),default:u(()=>[h[7]||(h[7]=t("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),l(S,{scope:"col"},{default:u(()=>[l(H,null,{tooltip:u(()=>[$(a(e(d)("Downloads")),1)]),default:u(()=>[h[8]||(h[8]=t("span",{class:"fr-icon--sm fr-icon-download-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),l(S,{onSort:h[4]||(h[4]=_=>i("reuses",_)),sorted:r("reuses"),scope:"col"},{default:u(()=>[l(H,null,{tooltip:u(()=>[$(a(e(d)("Reuses")),1)]),default:u(()=>[h[9]||(h[9]=t("span",{class:"fr-icon--sm fr-icon-line-chart-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),l(S,{onSort:h[5]||(h[5]=_=>i("followers",_)),sorted:r("followers"),scope:"col"},{default:u(()=>[l(H,null,{tooltip:u(()=>[$(a(e(d)("Favorites")),1)]),default:u(()=>[h[10]||(h[10]=t("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"])])]),t("tbody",null,[(c(!0),y(q,null,W(f.datasets,_=>{var w;return c(),y("tr",{key:_.id},[t("td",null,[l(fe,null,{default:u(()=>[t("a",{class:"fr-link fr-reset-link",href:p(_)},[l(e(E),{text:_.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,xs)]),_:2},1024)]),t("td",null,[l(ee,{type:m(_).type},{default:u(()=>[$(a(m(_).label),1)]),_:2},1032,["type"])]),t("td",null,a(e(j)(_.created_at)),1),t("td",null,a(e(j)(_.last_modified)),1),t("td",null,a(n(_)),1),t("td",null,[l(H,null,{tooltip:u(()=>[l(Ds,{dataset:_},null,8,["dataset"])]),default:u(()=>[l(e(at),{class:"w-100",score:_.quality.score},null,8,["score"])]),_:2},1024)]),t("td",js,a(e(U)(_.metrics.discussions)),1),t("td",Fs,a(e(U)(_.metrics.views)),1),t("td",Us,a(e(U)((w=_.metrics.resources_downloads)!=null?w:0)),1),t("td",Hs,a(e(U)(_.metrics.reuses)),1),t("td",Vs,a(e(U)(_.metrics.followers)),1)])}),128))])]),_:1},8,["loading"]))}}),Be=k(null);function J(){const v=s=>{Be.value=s};return{currentOrganization:Je(Be),setCurrentOrganization:v}}const Ys="/_themes/gouvfr/assets/logotype-white.svg",Ns=["href"],Ws=["src","alt"],he=T({__name:"AdminPublishButton",props:{type:{}},setup(v){const s=v,{t:o}=B(),b=M(()=>{switch(s.type){case"dataset":return lt;case"harvester":return"".concat(se,"harvester/new/");case"reuse":return ot}});return(d,i)=>(c(),y("a",{href:b.value,class:"fr-btn fr-icon-add-line fr-btn--icon-left"},[$(a(e(o)("Publish on"))+" ",1),t("img",{class:"fr-ml-1v",src:e(Ys),loading:"lazy",alt:e(Ce)},null,8,Ws)],8,Ns))}}),Zs={key:0},Gs={class:"fr-breadcrumb__link","aria-current":"page"},Js={class:"fr-h3 fr-mb-5v"},Qs={class:"fr-p-3w flex items-center justify-between relative"},Xs=["id"],Ks=["aria-expanded"],ea={class:"flex items-center fr-ml-4v buttons"},ta={class:"fr-col-auto fr-ml-3v fr-m-0"},sa=["disabled","href","title"],aa=["aria-labelledby"],oa={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},la={class:"fr-col"},na={class:"subtitle subtitle--uppercase fr-m-0"},ra={key:0,class:"fr-col-auto fr-grid-row fr-grid-row--middle"},ia=["href"],da={class:"text-align-center fr-py-1w"},ua=["src"],ca={class:"fr-text--bold fr-my-3v"},fa=T({__name:"Datasets",props:{oid:{}},setup(v){const{t:s}=B(),o=v,b=k([]),d=k(!1),i=k(1),r=k(10),n=k(0),p=k("created"),m=k("desc"),f=M(()=>"".concat(m.value==="asc"?"":"-").concat(p.value)),h=k(""),_=nt(h,ct),{currentOrganization:w}=J(),g=ce();function C(P,I){p.value=P,m.value=I}V(async()=>{d.value=!0,b.value=[];try{let P;if(o.oid)P=await rt(o.oid,_.value,i.value,r.value,f.value);else if(g.value)P=await it(g.value.id,_.value,i.value,r.value,f.value);else return;b.value=P.data,i.value=P.page,r.value=P.page_size,n.value=P.total}finally{d.value=!1}});const z=k(!1),R=Qe(),O=k(null),K=k(null),L=k(null),De=k(null),ie=k(null),Ae=k(null);V(async()=>{if(o.oid){{const I=await(await fetch("https://metric-api.data.gouv.fr/api/organizations/data/?organization_id__exact=".concat(o.oid,"&metric_month__sort=desc&page_size=12"))).json();O.value={},L.value={},ie.value={};for(const{metric_month:oe,monthly_download_resource:me,monthly_visit_dataset:We,monthly_visit_reuse:Ze}of I.data)O.value[oe]=We,L.value[oe]=me,ie.value[oe]=Ze}{const I=await(await fetch("https://metric-api.data.gouv.fr/api/organizations_total/data/?organization_id__exact=".concat(o.oid))).json();I.data[0]&&(K.value=I.data[0].visit_dataset,De.value=I.data[0].download_resource,Ae.value=I.data[0].visit_reuse)}}});const Se=M(()=>{if(!O.value||!L.value||!ie.value)return null;let P="month,visit_datasets,download_resource,visit_reuse\n";for(const I in O.value)P+="".concat(I,",").concat(O.value[I],",").concat(L.value[I],",").concat(ie.value[I],"\n");return URL.createObjectURL(new Blob([P],{type:"text/csv"}))});return(P,I)=>{const oe=x("router-link");return c(),y("div",null,[l(G,null,{default:u(()=>[t("li",null,[l(oe,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(s)("Administration")),1)]),_:1})]),e(w)?(c(),y("li",Zs,[l(oe,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(w).name),1)]),_:1})])):D("",!0),t("li",null,[t("a",Gs,a(e(s)("Datasets")),1)])]),_:1}),t("h1",Js,a(e(s)("Datasets")),1),P.oid&&!d.value&&n.value>0?(c(),y("div",{key:0,class:Y(["bg-white border rounded-xxs fr-mb-3w",{"fr-pb-4v":z.value}])},[t("header",Qs,[t("div",null,[t("h4",{class:"fr-mb-1v flex items-center",id:e(R)},[t("button",{type:"button",onClick:I[0]||(I[0]=me=>z.value=!z.value),class:"fr-p-0 fr-text flex items-center font-bold","data-testid":"expand-button","aria-expanded":z.value},[$(a(P.$t("Statistics on your datasets"))+" ",1),I[2]||(I[2]=t("span",{class:"absolute inset-0 z-1"},null,-1))],8,Ks)],8,Xs)]),t("div",ea,[t("p",ta,[t("a",{disabled:!Se.value,href:Se.value||"",rel:"ugc nofollow noopener",title:e(s)("Download file"),download:"stats.csv",class:"relative fr-btn fr-btn--sm fr-btn--icon-left fr-icon-test-tube-line fr-icon-download-line fr-icon--sm z-2"},a(P.$t("Download")),9,sa)]),t("div",{class:Y(["fr-icon--sm fr-ml-4v",{"fr-icon-arrow-up-s-line":z.value,"fr-icon-arrow-down-s-line":!z.value}])},null,2)])]),z.value?(c(),y("section",{key:0,"aria-labelledby":e(R),class:"flex fr-pb-3w fr-pl-3w fr-pr-3w"},[l(e(ye),{title:P.$t("Views"),data:O.value,type:"line",summary:K.value,class:"w-1/3"},null,8,["title","data","summary"]),l(e(ye),{title:P.$t("Downloads"),data:L.value,type:"line",summary:De.value,class:"w-1/3"},null,8,["title","data","summary"]),l(e(ye),{title:P.$t("Reuses Visits"),data:ie.value,type:"line",summary:Ae.value,class:"w-1/3"},null,8,["title","data","summary"])],8,aa)):D("",!0)],2)):D("",!0),t("div",oa,[t("div",la,[t("h2",na,a(e(s)("{n} datasets",n.value)),1)]),P.oid?(c(),y("div",ra,[t("div",null,[t("a",{href:e(dt)(P.oid,n.value),class:"fr-btn fr-btn--sm fr-icon-download-line fr-btn--icon-left"},a(e(s)("Download catalog")),9,ia)])])):D("",!0)]),d.value||n.value>0?(c(),A(Es,{key:1,datasets:b.value,loading:d.value,"sort-direction":m.value,sortedBy:p.value,onSort:C},null,8,["datasets","loading","sort-direction","sortedBy"])):(c(),A(Z,{key:2,class:"fr-my-2w"},{default:u(()=>[t("div",da,[t("img",{src:e(ut),alt:"",loading:"lazy"},null,8,ua),t("p",ca,a(e(s)("You haven't published a dataset yet")),1),l(he,{type:"dataset"})])]),_:1})),n.value>r.value?(c(),A(e(ne),{key:3,page:i.value,"page-size":r.value,"total-results":n.value,onChange:I[1]||(I[1]=me=>i.value=me)},null,8,["page","page-size","total-results"])):D("",!0)])}}});const Me=te(fa,[["__scopeId","data-v-93674b91"]]),ma=["href"],_a={key:0},pa=T({__name:"AdminDataservicesTable",props:{dataservices:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(v){const s=v,{t:o}=B();function b(n){return s.sortedBy===n?s.sortDirection:null}function d(n){return"".concat(se,"dataservices/").concat(n.id,"/")}function i(n){return n.private?{label:o("Draft"),type:"default"}:{label:o("Public"),type:"info"}}function r(n){return n.is_restricted?{label:o("Restricted"),type:"warning"}:{label:o("Open"),type:"success"}}return(n,p)=>(c(),A(ae,{loading:n.loading},{default:u(()=>[t("thead",null,[l(S,{onSort:p[0]||(p[0]=m=>n.$emit("sort","title",m)),sorted:b("title"),scope:"col"},{default:u(()=>[$(a(e(o)("Dataservice title")),1)]),_:1},8,["sorted"]),l(S,null,{default:u(()=>[$(a(e(o)("Status")),1)]),_:1}),l(S,null,{default:u(()=>[$(a(e(o)("Access")),1)]),_:1}),l(S,null,{default:u(()=>[$(a(e(o)("Created at")),1)]),_:1}),l(S,null,{default:u(()=>[$(a(e(o)("Rate Limiting")),1)]),_:1}),l(S,null,{default:u(()=>[$(a(e(o)("Availability")),1)]),_:1})]),t("tbody",null,[(c(!0),y(q,null,W(n.dataservices,m=>(c(),y("tr",null,[t("td",null,[l(fe,null,{default:u(()=>[t("a",{class:"fr-link fr-reset-link",href:d(m)},[l(e(E),{text:m.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,ma)]),_:2},1024)]),t("td",null,[l(ee,{type:i(m).type},{default:u(()=>[$(a(i(m).label),1)]),_:2},1032,["type"])]),t("td",null,[l(ee,{type:r(m).type},{default:u(()=>[$(a(r(m).label),1)]),_:2},1032,["type"])]),t("td",null,a(e(j)(m.created_at)),1),t("td",null,a(m.rate_limiting),1),t("td",null,[m.availability?(c(),y("span",_a,a(m.availability)+"%",1)):D("",!0)])]))),256))])]),_:1},8,["loading"]))}}),va={class:"fr-container--fluid"},ba={key:0},ga={class:"fr-breadcrumb__link","aria-current":"page"},ha={class:"fr-h3"},ya={class:"subtitle subtitle--uppercase"},$a={class:"text-align-center fr-py-1w"},wa=["src"],ka={class:"fr-text--bold fr-my-3v"},qe=T({__name:"Dataservices",props:{oid:{}},setup(v){const{t:s}=B(),o=v,b=k([]),d=k(!1),i=k(1),r=k(10),n=k(0),p=k("title"),m=k("desc"),f=M(()=>"".concat(m.value==="asc"?"":"-").concat(p.value)),{currentOrganization:h}=J(),_=ce();function w(g,C){p.value=g,m.value=C}return V(async()=>{d.value=!0,b.value=[];try{let g;if(o.oid)g=await ft(o.oid,i.value,r.value,f.value);else if(_.value)g=await mt(_.value.id,i.value,r.value,f.value);else return;b.value=g.data,i.value=g.page,r.value=g.page_size,n.value=g.total}finally{d.value=!1}}),(g,C)=>{const z=x("router-link");return c(),y("div",va,[l(G,null,{default:u(()=>[t("li",null,[l(z,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(s)("Administration")),1)]),_:1})]),e(h)?(c(),y("li",ba,[l(z,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(h).name),1)]),_:1})])):D("",!0),t("li",null,[t("a",ga,a(e(s)("Dataservices")),1)])]),_:1}),t("h1",ha,a(e(s)("Dataservices")),1),t("h2",ya,a(e(s)("{n} dataservices",n.value)),1),d.value||n.value>0?(c(),A(pa,{key:0,dataservices:b.value,loading:d.value,sortDirection:m.value,sortedBy:p.value,onSort:w},null,8,["dataservices","loading","sortDirection","sortedBy"])):(c(),A(Z,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:u(()=>[t("div",$a,[t("img",{src:e(_t),alt:"",loading:"lazy"},null,8,wa),t("p",ka,a(e(s)("You haven't published a dataservice yet")),1),l(he,{type:"dataservice"})])]),_:1})),n.value>r.value?(c(),A(e(ne),{key:2,page:i.value,"page-size":r.value,"total-results":n.value,onChange:C[0]||(C[0]=R=>i.value=R)},null,8,["page","page-size","total-results"])):D("",!0)])}}}),za=["href"],Ca={class:"monospace"},Da={class:"monospace"},Aa={class:"monospace"},Sa={class:"monospace"},Ra=T({__name:"AdminReusesTable",props:{reuses:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(v){const s=v,{t:o}=B();function b(r){return s.sortedBy===r?s.sortDirection:null}function d(r){return"".concat(se,"reuse/").concat(r.id,"/")}function i(r){return r.deleted?{label:o("Deleted"),type:"error"}:r.archived?{label:o("Archived"),type:"warning"}:r.private?{label:o("Draft"),type:"default"}:{label:o("Public"),type:"info"}}return(r,n)=>(c(),A(ae,{loading:r.loading},{default:u(()=>[t("thead",null,[l(S,{onSort:n[0]||(n[0]=p=>r.$emit("sort","title",p)),sorted:b("title"),scope:"col"},{default:u(()=>[$(a(e(o)("Reuse title")),1)]),_:1},8,["sorted"]),l(S,null,{default:u(()=>[$(a(e(o)("Status")),1)]),_:1}),l(S,{onSort:n[1]||(n[1]=p=>r.$emit("sort","created",p)),sorted:b("created"),scope:"col"},{default:u(()=>[$(a(e(o)("Created at")),1)]),_:1},8,["sorted"]),l(S,{onSort:n[2]||(n[2]=p=>r.$emit("sort","datasets",p)),sorted:b("datasets"),scope:"col"},{default:u(()=>[$(a(e(o)("Datasets")),1)]),_:1},8,["sorted"]),l(S,{scope:"col"},{default:u(()=>[l(H,null,{tooltip:u(()=>[$(a(e(o)("Discussions")),1)]),default:u(()=>[n[5]||(n[5]=t("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),l(S,{onSort:n[3]||(n[3]=p=>r.$emit("sort","views",p)),sorted:b("views"),scope:"col"},{default:u(()=>[l(H,null,{tooltip:u(()=>[$(a(e(o)("Views")),1)]),default:u(()=>[n[6]||(n[6]=t("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),l(S,{onSort:n[4]||(n[4]=p=>r.$emit("sort","followers",p)),sorted:b("followers"),scope:"col"},{default:u(()=>[l(H,null,{tooltip:u(()=>[$(a(e(o)("Favorites")),1)]),default:u(()=>[n[7]||(n[7]=t("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"])]),t("tbody",null,[(c(!0),y(q,null,W(r.reuses,p=>(c(),y("tr",null,[t("td",null,[l(fe,null,{default:u(()=>[t("a",{class:"fr-link fr-reset-link",href:d(p)},[l(e(E),{text:p.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,za)]),_:2},1024)]),t("td",null,[l(ee,{type:i(p).type},{default:u(()=>[$(a(i(p).label),1)]),_:2},1032,["type"])]),t("td",null,a(e(j)(p.created_at)),1),t("td",Ca,a(e(U)(p.datasets.length)),1),t("td",Da,a(e(U)(p.metrics.discussions)),1),t("td",Aa,a(e(U)(p.metrics.views)),1),t("td",Sa,a(e(U)(p.metrics.followers)),1)]))),256))])]),_:1},8,["loading"]))}}),Ta="/_themes/gouvfr/assets/reuse.svg",Oa={class:"fr-container--fluid"},Ba={key:0},Ma={class:"fr-breadcrumb__link","aria-current":"page"},qa={class:"fr-h3 fr-mb-5v"},Pa={class:"subtitle subtitle--uppercase fr-mb-0"},Ia={class:"text-align-center fr-py-1w"},La=["src"],xa={class:"fr-text--bold fr-my-3v"},Pe=T({__name:"Reuses",props:{oid:{}},setup(v){const{t:s}=B(),o=v,b=k([]),d=k(!1),i=k(1),r=k(10),n=k(0),p=k("created"),m=k("desc"),f=M(()=>"".concat(m.value==="asc"?"":"-").concat(p.value)),{currentOrganization:h}=J(),_=ce();function w(g,C){p.value=g,m.value=C}return V(async()=>{d.value=!0,b.value=[];try{let g;if(o.oid)g=await pt(o.oid,i.value,r.value,f.value);else if(_.value)g=await vt(_.value.id,i.value,r.value,f.value);else return;b.value=g.data,i.value=g.page,r.value=g.page_size,n.value=g.total}finally{d.value=!1}}),(g,C)=>{const z=x("router-link");return c(),y("div",Oa,[l(G,null,{default:u(()=>[t("li",null,[l(z,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(s)("Administration")),1)]),_:1})]),e(h)?(c(),y("li",Ba,[l(z,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(h).name),1)]),_:1})])):D("",!0),t("li",null,[t("a",Ma,a(e(s)("Reuses")),1)])]),_:1}),t("h1",qa,a(e(s)("Reuses")),1),t("h2",Pa,a(e(s)("{n} reuses of your organization",b.value.length)),1),d.value||n.value>0?(c(),A(Ra,{key:0,reuses:b.value,loading:d.value,sortDirection:m.value,sortedBy:p.value,onSort:w},null,8,["reuses","loading","sortDirection","sortedBy"])):(c(),A(Z,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:u(()=>[t("div",Ia,[t("img",{src:e(Ta),alt:"",loading:"lazy"},null,8,La),t("p",xa,a(e(s)("You haven't published a reuse yet")),1),l(he,{type:"reuse"})])]),_:1})),n.value>r.value?(c(),A(e(ne),{key:2,page:i.value,"page-size":r.value,"total-results":n.value,onChange:C[0]||(C[0]=R=>i.value=R)},null,8,["page","page-size","total-results"])):D("",!0)])}}}),ja={class:"fr-breadcrumb__link","aria-current":"page"},Fa={key:0,class:"fr-h1"},Ua={class:"fr-alert fr-alert--info"},Ha={class:"fr-alert__title"},Va={href:"/admin/me/"},Ea=T({__name:"Me",setup(v){const{t:s}=B(),o=ce();return(b,d)=>{const i=x("router-link");return c(),y("div",null,[l(G,null,{default:u(()=>[t("li",null,[l(i,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(s)("Administration")),1)]),_:1})]),t("li",null,[t("a",ja,a(e(s)("Me")),1)])]),_:1}),e(o)?(c(),y("h1",Fa,a(e(o).first_name)+" "+a(e(o).last_name),1)):D("",!0),t("div",Ua,[t("h3",Ha,a(e(s)("This is a WIP page")),1),t("p",null,[t("a",Va,a(e(s)("You can edit your profil on the current admin.")),1)])])])}}}),Ie='<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5 12V18C5 18 5 21 12 21C19 21 19 18 19 18V12" stroke="currentColor" stroke-width="1.5"/>\n<path d="M5 6V12C5 12 5 15 12 15C19 15 19 12 19 12V6" stroke="currentColor" stroke-width="1.5"/>\n<path d="M12 3C19 3 19 6 19 6C19 6 19 9 12 9C5 9 5 6 5 6C5 6 5 3 12 3Z" stroke="currentColor" stroke-width="1.5"/>\n</svg>\n',Ya={class:"fr-sidemenu__item"},Na=["innerHTML"],Wa=T({__name:"AdminSidebarLink",props:{label:{},icon:{},iconHtml:{},to:{}},setup(v){return(s,o)=>{const b=x("TextClamp"),d=x("router-link");return c(),y("li",Ya,[t("div",{class:Y([{"fr-icon-svg fr-icon--sm":s.iconHtml},"fr-enlarge-link fr-sidemenu__link fr-mb-1w"])},[s.iconHtml?(c(),y("div",{key:0,class:"fr-mr-1w fr-grid-row",innerHTML:s.iconHtml},null,8,Na)):s.icon?(c(),y("div",{key:1,class:Y([s.icon,"fr-mr-1w fr-icon--sm"]),"aria-hidden":"true"},null,2)):D("",!0),l(d,{to:s.to},{default:u(()=>[l(b,{text:s.label,"auto-resize":!0,"max-lines":1},null,8,["text"])]),_:1},8,["to"])],2)])}}});const F=te(Wa,[["__scopeId","data-v-65a3b831"]]),Za=["aria-expanded","aria-controls","aria-current"],Ga={class:"fr-mx-1w"},Ja={class:"logo logo--sm"},Qa={class:"fr-mx-1w fr-col text-overflow-ellipsis"},Xa=["id"],Ka={class:"fr-sidemenu__list fr-mx-1w fr-my-3v"},eo=T({__name:"AdminSidebarMenu",props:{user:{},organization:{},isOpened:{type:Boolean}},emits:["open","click"],setup(v){const s=v,{t:o}=B(),b=X("menu");function d(i,r){const n=document.getElementById(b);r(n)&&(i?r(n).collapse.disclose():r(n).collapse.conceal())}return Xe(()=>{setTimeout(()=>{d(s.isOpened,globalThis.dsfr)},200)}),(i,r)=>(c(),y("li",{class:Y(["fr-sidemenu__item",{"fr-sidemenu__item--active":i.isOpened}])},[t("button",{class:"fr-sidemenu__btn","aria-expanded":i.isOpened,"aria-controls":e(b),"aria-current":i.isOpened,onClick:r[0]||(r[0]=n=>i.$emit("open"))},[i.user?(c(),y(q,{key:0},[i.user?(c(),A(e(ve),{key:0,user:i.user,size:24,rounded:!0},null,8,["user"])):D("",!0),t("p",Ga,a(e(o)("My Profile")),1)],64)):i.organization?(c(),y(q,{key:1},[t("div",Ja,[l(bt,{type:"organization",src:i.organization.logo_thumbnail,size:20},null,8,["src"])]),t("p",Qa,a(i.organization.name),1)],64)):D("",!0)],8,Za),t("div",{class:"fr-collapse","data-fr-js-collapse":"",id:e(b)},[t("ul",Ka,[i.user?(c(),y(q,{key:0},[l(F,{icon:"fr-icon-account-circle-line",label:e(o)("Me"),to:{name:"me"}},null,8,["label"]),l(F,{iconHtml:e(Ie),label:e(o)("Datasets"),to:{name:"me-datasets"}},null,8,["iconHtml","label"]),l(F,{icon:"fr-icon-code-s-slash-line",label:e(o)("Dataservices"),to:{name:"me-dataservices"}},null,8,["label"]),l(F,{icon:"fr-icon-line-chart-line",label:e(o)("Reuses"),to:{name:"me-reuses"}},null,8,["label"]),l(F,{icon:"fr-icon-git-pull-request-line",label:e(o)("Community Resources"),to:{name:"me-community-resources"}},null,8,["label"])],64)):i.organization?(c(),y(q,{key:1},[l(F,{iconHtml:e(Ie),label:e(o)("Datasets"),to:{name:"organization-datasets",params:{oid:i.organization.id}},onClick:r[1]||(r[1]=n=>i.$emit("click"))},null,8,["iconHtml","label","to"]),l(F,{icon:"fr-icon-code-s-slash-line",label:e(o)("Dataservices"),to:{name:"organization-dataservices",params:{oid:i.organization.id}},onClick:r[2]||(r[2]=n=>i.$emit("click"))},null,8,["label","to"]),l(F,{icon:"fr-icon-line-chart-line",label:e(o)("Reuses"),to:{name:"organization-reuses",params:{oid:i.organization.id}},onClick:r[3]||(r[3]=n=>i.$emit("click"))},null,8,["label","to"]),l(F,{icon:"fr-icon-chat-3-line",label:e(o)("Discussions"),to:{name:"organization-discussions",params:{oid:i.organization.id}},onClick:r[4]||(r[4]=n=>i.$emit("click"))},null,8,["label","to"]),l(F,{icon:"fr-icon-parent-line",label:e(o)("Members"),to:{name:"organization-members",params:{oid:i.organization.id}},onClick:r[5]||(r[5]=n=>i.$emit("click"))},null,8,["label","to"]),l(F,{icon:"fr-icon-server-line",label:e(o)("Harvesters"),to:{name:"organization-harvesters",params:{oid:i.organization.id}},onClick:r[6]||(r[6]=n=>i.$emit("click"))},null,8,["label","to"]),l(F,{icon:"fr-icon-git-pull-request-line",label:e(o)("Community Resources"),to:{name:"organization-community-resources",params:{oid:i.organization.id}},onClick:r[7]||(r[7]=n=>i.$emit("click"))},null,8,["label","to"]),l(F,{icon:"fr-icon-user-line",label:e(o)("Profile"),to:{name:"organization-profile",params:{oid:i.organization.id}},onClick:r[8]||(r[8]=n=>i.$emit("click"))},null,8,["label","to"])],64)):D("",!0)])],8,Xa)],2))}});const Le=te(eo,[["__scopeId","data-v-fff6053b"]]),to={class:"fr-container--fluid h-100"},so={class:"fr-grid-row h-100 bg-grey-50"},ao={class:"fr-col-12 fr-col-md-4 fr-col-lg-3 fr-col-xl-2"},oo=["aria-label"],lo={class:"fr-sidemenu__inner"},no=["aria-controls"],ro=["id"],io={class:"fr-sidemenu__list"},uo={class:"fr-col-12 fr-col-md-8 fr-col-lg-9 fr-col-xl-10 h-100 fr-px-2w overflow-auto"},co=T({__name:"Admin",setup(v){const{t:s}=B(),o=gt(),b=X("menu"),d=k(null),i=k(),{setCurrentOrganization:r}=J(),n=je();function p(f){return f===i.value}function m(f){i.value=f.id}return ue(async()=>{var f,h;if(d.value=await ht(),o.name||(d.value.organizations.length>0?n.replace({name:"organization-datasets",params:{oid:d.value.organizations[0].id}}):n.replace({name:"me"})),o.name==="me")i.value=(f=le)==null?void 0:f.id;else if(d.value.organizations.length>0){let _=d.value.organizations[0];o.params.oid&&(_=(h=d.value.organizations.find(w=>w.id===o.params.oid))!=null?h:_),m(_),r(_)}}),(f,h)=>{const _=x("router-view");return c(),y("div",to,[t("div",so,[t("div",ao,[t("nav",{class:"fr-sidemenu fr-pr-0","aria-label":e(s)("Administration menu")},[t("div",lo,[t("button",{class:"fr-sidemenu__btn",hidden:"","aria-controls":e(b),"aria-expanded":"false"},a(e(s)("Open menu")),9,no),t("div",{class:"fr-collapse",id:e(b)},[t("ul",io,[e(le)?(c(),A(Le,{key:0,user:e(le),"is-opened":p(e(le).id),onOpen:h[0]||(h[0]=w=>m(e(le)))},null,8,["user","is-opened"])):D("",!0),d.value?(c(!0),y(q,{key:1},W(d.value.organizations,w=>(c(),A(Le,{organization:w,"is-opened":p(w.id),onOpen:()=>m(w),onClick:()=>e(r)(w)},null,8,["organization","is-opened","onOpen","onClick"]))),256)):D("",!0)])],8,ro)])],8,oo)]),t("div",uo,[(c(),A(_,{key:e(o).fullPath,class:"fr-container--fluid"}))])])])}}});const fo=te(co,[["__scopeId","data-v-364348c3"]]),mo=["aria-labelledby","id"],_o={class:"fr-container fr-container--fluid fr-container-md"},po={class:"fr-grid-row fr-grid-row--center"},vo={class:"fr-col-12 fr-col-md-8"},bo={class:"fr-modal__body"},go={class:"fr-modal__header"},ho=["title","aria-controls"],yo={class:"fr-modal__content"},$o=["id"],wo={class:"fr-modal__footer"},ko={class:"fr-btns-group fr-btns-group--right fr-btns-group--sm fr-btns-group--inline-lg fr-btns-group--icon-left"},zo=["disabled"],Co=["disabled"],Do=T({__name:"AdminAddMemberModal",props:{id:{},oid:{},roles:{}},emits:["memberAdded"],setup(v,{emit:s}){const o=v,b=s,{t:d}=B(),{toast:i}=be(),r=k(!1),n=k(),p=k("editor"),m=M(()=>"fr-modal-title-user-"+o.id);async function f(){try{r.value=!0,n.value&&(await $t(o.oid,n.value,p.value),b("memberAdded"),_())}catch(w){i.error(d("An error occurred while update member role."))}finally{r.value=!1}}function h(w){return w.map(g=>{var z;const C={...g,avatar_thumbnail:(z=g.avatar_url)!=null?z:void 0};return{value:C.id,label:C.first_name+" "+C.last_name,image:wt(C,32)}})}function _(){r.value=!1,n.value=void 0,p.value="editor";const w=document.getElementById(o.id);globalThis.dsfr(w).modal.conceal()}return(w,g)=>(c(),A(pe,{to:"body"},[t("dialog",{"aria-labelledby":m.value,role:"dialog",id:w.id,class:"fr-modal"},[t("div",_o,[t("div",po,[t("div",vo,[t("div",bo,[t("div",go,[t("button",{class:"fr-btn--close fr-btn",title:e(d)("Close the modal dialog"),"aria-controls":w.id},a(e(d)("Close")),9,ho)]),t("form",{onSubmit:_e(f,["prevent"])},[t("div",yo,[t("h1",{id:m.value,class:"fr-modal__title fr-mb-2w"},a(e(d)("Add member to the organization")),9,$o),l(yt,{placeholder:w.$t("Search a user"),searchPlaceholder:w.$t("Search a user..."),suggestUrl:"/users/suggest/",values:n.value,onChange:g[0]||(g[0]=C=>n.value=C),allOption:w.$t("Select a user"),addAllOption:!1,onSuggest:h,roundedImages:!0},null,8,["placeholder","searchPlaceholder","values","allOption"]),w.roles.length>0?(c(),A(Fe,{key:0,label:e(d)("Role of the member"),"model-value":p.value,"onUpdate:modelValue":g[1]||(g[1]=C=>p.value=C),options:w.roles},null,8,["label","model-value","options"])):D("",!0)]),t("div",wo,[t("div",ko,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"button",onClick:_,disabled:r.value},a(e(d)("Cancel")),9,zo),t("button",{class:"fr-btn",type:"submit",disabled:r.value},a(e(d)("Add to the organization")),9,Co)])])],32)])])])])],8,mo)]))}}),Ao=["aria-controls"],So=T({__name:"AdminAddMemberButton",props:{oid:{},roles:{}},emits:["memberAdded"],setup(v){const s=v,{t:o}=B(),b=M(()=>"fr-modal-add-user-"+s.oid);return(d,i)=>(c(),y(q,null,[t("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-icon-add-line","data-fr-opened":"false","aria-controls":b.value},a(e(o)("Add member")),9,Ao),l(Do,{id:b.value,oid:d.oid,roles:d.roles,onMemberAdded:i[0]||(i[0]=r=>d.$emit("memberAdded"))},null,8,["id","oid","roles"])],64))}}),Ro={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Ye=T({__name:"AdminDangerZone",setup(v){return(s,o)=>(c(),A(e(kt),{color:"error",type:"secondary",weight:"regular"},{default:u(()=>[t("div",Ro,[N(s.$slots,"default")])]),_:3}))}}),To={class:"fr-px-1v rounded-2 monospace fr-text--sm text-mention-grey bg-grey-100 fr-m-0"},Ne=T({__name:"AdminEmail",props:{email:{}},setup(v){return(s,o)=>(c(),y("p",To,a(s.email),1))}}),Oo=["aria-labelledby","id"],Bo={class:"fr-container fr-container--fluid fr-container-md"},Mo={class:"fr-grid-row fr-grid-row--center"},qo={class:"fr-col-12 fr-col-md-8"},Po={class:"fr-modal__body"},Io={class:"fr-modal__header"},Lo=["title","aria-controls"],xo={class:"fr-modal__content"},jo=["id"],Fo={class:"fr-grid-row fr-grid-row--middle fr-mb-2w"},Uo={class:"fr-text--bold fr-m-0 fr-mr-1v"},Ho={class:"fr-col"},Vo={class:"fr-col-auto"},Eo=["disabled"],Yo={class:"fr-col"},No={class:"fr-m-0 text-grey-500"},Wo={class:"fr-m-0 fr-text--xs text-default-error"},Zo={class:"fr-col-auto"},Go=["disabled"],Jo=T({__name:"AdminEditMemberModal",props:{id:{},member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(v,{emit:s}){const o=v,b=s,d=M(()=>"fr-modal-title-user-"+o.id),{t:i}=B(),{toast:r}=be(),n=k(!1);async function p(_){if(!_.newRole){h();return}try{n.value=!0,await zt(o.oid,_.user.id,_.newRole),b("memberUpdated"),h()}catch(w){r.error(i("An error occurred while update member role."))}finally{n.value=!1}}async function m(_){try{n.value=!0,await Ct(o.oid,_.user.id),b("memberUpdated")}catch(w){r.error(i("An error occurred while removing this member."))}finally{n.value=!1}}function f(_){return o.roles.map(w=>{const g={...w};return g.value===_&&(g.selected=!0),g})}function h(){n.value=!1;const _=document.getElementById(o.id);globalThis.dsfr(_).modal.conceal()}return(_,w)=>(c(),A(pe,{to:"body"},[t("dialog",{"aria-labelledby":d.value,role:"dialog",id:_.id,class:"fr-modal"},[t("div",Bo,[t("div",Mo,[t("div",qo,[t("div",Po,[t("div",Io,[t("button",{class:"fr-btn--close fr-btn",title:e(i)("Close the modal dialog"),"aria-controls":_.id},a(e(i)("Close")),9,Lo)]),t("div",xo,[t("h1",{id:d.value,class:"fr-modal__title fr-mb-2w"},a(e(i)("Edit member")),9,jo),t("div",Fo,[l(e(ve),{class:"fr-mr-1v",user:_.member.user,rounded:!0,size:24},null,8,["user"]),t("p",Uo,a(_.member.user.first_name)+" "+a(_.member.user.last_name),1),_.member.user.email?(c(),A(Ne,{key:0,email:_.member.user.email},null,8,["email"])):D("",!0)]),t("form",{class:"fr-grid-row fr-grid-row--gutters fr-grid-row--bottom",onSubmit:w[1]||(w[1]=_e(g=>p(_.member),["prevent"]))},[t("div",Ho,[_.roles.length>0?(c(),A(Fe,{key:0,label:e(i)("Role of the member"),"model-value":_.member.role,"onUpdate:modelValue":w[0]||(w[0]=g=>_.member.newRole=g),options:f(_.member.role)},null,8,["label","model-value","options"])):D("",!0)]),t("div",Vo,[t("button",{class:"fr-btn",type:"submit",disabled:n.value},a(e(i)("Validate")),9,Eo)])],32),l(Ye,{class:"fr-mt-2w"},{default:u(()=>[t("div",Yo,[t("p",No,a(e(i)("Remove member from the organization")),1),t("p",Wo,a(e(i)("Be careful, this action can't be reverse.")),1)]),t("div",Zo,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-logout-box-r-line",disabled:n.value,onClick:w[2]||(w[2]=g=>m(_.member))},a(e(i)("Remove member")),9,Go)])]),_:1})])])])])])],8,Oo)]))}}),Qo=["aria-controls"],Xo=T({__name:"AdminEditMemberButton",props:{member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(v){const s=v,{t:o}=B(),b=M(()=>"fr-modal-user-"+s.member.user.id);return(d,i)=>(c(),y(q,null,[t("button",{class:"fr-btn fr-btn--sm fr-btn--secondary-grey-500 fr-btn--tertiary-no-outline fr-icon-pencil-line","data-fr-opened":"false","aria-controls":b.value},a(e(o)("Edit")),9,Qo),l(Jo,{id:b.value,member:d.member,oid:d.oid,roles:d.roles,onMemberUpdated:i[0]||(i[0]=r=>d.$emit("memberUpdated"))},null,8,["id","member","oid","roles"])],64))}}),Ko={class:"fr-mt-n9v fr-mb-2w"},el={class:"fr-badge fr-badge--info fr-badge--no-icon"},tl={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},sl={class:"fr-col"},al={class:"fr-grid-row fr-grid-row--middle"},ol={class:"fr-text--bold fr-m-0 fr-mr-1v"},ll={class:"fr-m-0"},nl={class:"fr-ml-3v fr-mt-1-5v fr-mb-0 filet filet-default-grey fr-text--sm"},rl={key:0,class:"fr-col-auto fr-grid-row flex-direction-column"},il=["disabled"],dl=["disabled","aria-controls"],ul=["aria-labelledby","id"],cl={class:"fr-container fr-container--fluid fr-container-md"},fl={class:"fr-grid-row fr-grid-row--center"},ml={class:"fr-col-12 fr-col-md-8"},_l={class:"fr-modal__body"},pl={class:"fr-modal__header"},vl=["title","aria-controls"],bl={class:"fr-modal__content"},gl=["id"],hl={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--right"},yl={class:"fr-col-auto"},$l=["disabled"],wl={class:"fr-col-auto"},kl=["disabled"],zl=T({__name:"AdminMembershipRequest",props:{loading:{type:Boolean},oid:{},request:{},showActions:{type:Boolean}},emits:["accept","refuse"],setup(v,{emit:s}){const o=v,b=s,{t:d}=B(),i=k(""),r=X("modal"),n=X("modalTitle");function p(){const h=document.getElementById(r);globalThis.dsfr(h).modal.conceal()}function m(){b("refuse",o.request.id,i.value),p()}function f(){i.value="",p()}return(h,_)=>{const w=x("AdminMembershipRequest",!0);return c(),A(Z,{class:"drop-shadow rounded-xxs fr-mt-3w"},{default:u(()=>[t("div",Ko,[t("p",el,[_[2]||(_[2]=t("span",{class:"fr-icon-user-add-line fr-icon--sm","aria-hidden":"true"},null,-1)),$(" "+a(e(d)("Membership Request")),1)])]),t("div",tl,[t("div",sl,[t("div",al,[l(e(ve),{class:"fr-mr-1v",user:h.request.user,rounded:!0,size:24},null,8,["user"]),t("p",ol,a(h.request.user.first_name)+" "+a(h.request.user.last_name),1),h.request.user.email?(c(),A(Ne,{key:0,email:h.request.user.email,class:"fr-mr-1v"},null,8,["email"])):D("",!0),t("p",ll,a(e(d)("asks to join the organization.")),1)]),t("div",nl,a(h.request.comment),1)]),h.showActions?(c(),y("div",rl,[t("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-mb-1w fr-icon-check-line",onClick:_[0]||(_[0]=g=>h.$emit("accept",h.request.id)),disabled:h.loading,"data-testid":"accept"},a(e(d)("Accept request")),9,il),t("button",{class:"fr-btn fr-btn--icon-left fr-btn--sm fr-btn--secondary fr-btn--secondary--error fr-icon-close-line",disabled:h.loading,"data-fr-opened":"false","aria-controls":e(r),"data-testid":"refuse"},a(e(d)("Refuse")),9,dl),(c(),A(pe,{to:"body"},[t("dialog",{"aria-labelledby":e(n),role:"dialog",id:e(r),class:"fr-modal","data-testid":"modal"},[t("div",cl,[t("div",fl,[t("div",ml,[t("div",_l,[t("div",pl,[t("button",{class:"fr-btn--close fr-btn",title:e(d)("Close the modal dialog"),"aria-controls":e(r),onClick:_e(f,["prevent"])},a(e(d)("Close")),9,vl)]),t("div",bl,[t("h1",{id:e(n),class:"fr-modal__title fr-mb-2w"},a(e(d)("Refuse membership request")),9,gl),l(w,{class:"fr-mt-4w fr-mb-2w",loading:!1,oid:h.oid,request:h.request,"show-actions":!1},null,8,["oid","request"]),t("form",{onSubmit:_e(m,["prevent"]),onReset:f},[l(Dt,{label:e(d)("You can provide the refusal reason:"),modelValue:i.value,"onUpdate:modelValue":_[1]||(_[1]=g=>i.value=g),"data-testid":"comment-group"},null,8,["label","modelValue"]),t("div",hl,[t("div",yl,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"reset",disabled:h.loading,"data-testid":"cancel-modal-button"},a(e(d)("Cancel")),9,$l)]),t("div",wl,[t("button",{class:"fr-btn",type:"submit",disabled:h.loading,"data-testid":"refuse-modal-button"},a(e(d)("Refuse request")),9,kl)])])],32)])])])])])],8,ul)]))])):D("",!0)])]),_:1})}}}),Cl={key:0},Dl={class:"fr-breadcrumb__link","aria-current":"page"},Al={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-center"},Sl={class:"fr-col-12 fr-col-md"},Rl={class:"fr-h3 fr-mb-0"},Tl={key:0,class:"fr-col-auto"},Ol={class:"subtitle subtitle--uppercase fr-mt-5v fr-mb-0"},Bl={class:"fr-text--bold fr-m-0"},Ml={class:"fr-m-0 fr-text--xs text-mention-grey f-italic inline-flex items-center"},ql={key:0},Pl={key:1},Il={key:0},Ll=T({__name:"Members",props:{oid:{}},setup(v){const s=v;ke(At);const{t:o}=B(),{toast:b}=be(),d=k([]),i=M(()=>St||p.value.some(z=>{var R;return z.user.id===((R=le)==null?void 0:R.id)&&z.role==="admin"})),r=k([]),{currentOrganization:n}=J(),p=k([]),m=k(!1);function f(z){var R,O;return(O=(R=r.value.find(K=>K.value===z))==null?void 0:R.label)!=null?O:z}function h(z){return z==="admin"?"info":"default"}async function _(){m.value=!0,p.value=[];try{const z=await Ue(s.oid);p.value=z.members}finally{m.value=!1}}async function w(){const z=await Re(s.oid);d.value=z}async function g(z){m.value=!0;const R=[];try{await Bt(s.oid,z),R.push(w()),R.push(_())}catch(O){b.error(o("An error occurred while accepting this membership."))}finally{Promise.all(R).finally(()=>m.value=!1)}}async function C(z,R){m.value=!0;const O=[];try{await Mt(s.oid,z,R),O.push(w()),O.push(_())}catch(K){b.error(o("An error occurred while refusing this membership."))}finally{Promise.all(O).finally(()=>m.value=!1)}}return V(()=>{i.value&&Re(s.oid).then(z=>d.value=z)}),ue(()=>{Rt().then(Tt).then(z=>r.value=z),_()}),(z,R)=>{const O=x("router-link"),K=x("TextClamp");return c(),y("div",null,[l(G,null,{default:u(()=>[t("li",null,[l(O,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(o)("Administration")),1)]),_:1})]),e(n)?(c(),y("li",Cl,[l(O,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(n).name),1)]),_:1})])):D("",!0),t("li",null,[t("a",Dl,a(e(o)("Members")),1)])]),_:1}),t("div",Al,[t("div",Sl,[t("h1",Rl,a(e(o)("Members")),1)]),i.value?(c(),y("div",Tl,[l(So,{oid:z.oid,roles:r.value,onMemberAdded:_},null,8,["oid","roles"])])):D("",!0)]),d.value.length?(c(),y(q,{key:0},[t("h2",Ol,a(e(o)("{n} requests",{n:d.value.length})),1),(c(!0),y(q,null,W(d.value,L=>(c(),A(zl,{class:"fr-mb-4w",key:L.id,loading:m.value,oid:z.oid,request:L,"show-actions":!0,onAccept:g,onRefuse:C},null,8,["loading","oid","request"]))),128))],64)):D("",!0),t("h2",{class:Y(["subtitle subtitle--uppercase fr-mb-0",{"fr-mt-n3v":d.value.length,"fr-mt-5v":!d.value.length}])},a(e(o)("{n} members",{n:p.value.length})),3),l(ae,{class:"fr-table--layout-fixed",loading:m.value},{default:u(()=>[t("thead",null,[t("tr",null,[l(S,{scope:"col"},{default:u(()=>[$(a(e(o)("Members")),1)]),_:1}),l(S,{scope:"col"},{default:u(()=>[$(a(e(o)("Status")),1)]),_:1}),l(S,{scope:"col"},{default:u(()=>[$(a(e(o)("Member since")),1)]),_:1}),l(S,{scope:"col"},{default:u(()=>[$(a(e(o)("Last connection")),1)]),_:1}),i.value?(c(),A(S,{key:0,scope:"col"},{default:u(()=>[$(a(e(o)("Action")),1)]),_:1})):D("",!0)])]),t("tbody",null,[(c(!0),y(q,null,W(p.value,L=>(c(),y("tr",{key:L.user.id},[t("td",null,[t("p",Bl,a(L.user.first_name)+" "+a(L.user.last_name),1),t("p",Ml,[l(e(ze),{height:12,width:12,name:"ri-mail-line"}),l(H,null,{default:u(()=>[l(K,{class:"fr-px-1v",text:L.user.email,"auto-resize":!0,"max-lines":1},null,8,["text"])]),_:2},1024)])]),t("td",null,[l(ee,{type:h(L.role)},{default:u(()=>[$(a(f(L.role)),1)]),_:2},1032,["type"])]),t("td",null,a(e(j)(L.since)),1),t("td",null,[L.user.last_login_at?(c(),y("span",ql,a(e(Ot)(L.user.last_login_at)),1)):(c(),y("span",Pl,a(e(o)("No connection")),1))]),i.value?(c(),y("td",Il,[l(Xo,{member:L,oid:z.oid,roles:r.value,onMemberUpdated:_},null,8,["member","oid","roles"])])):D("",!0)]))),128))])]),_:1},8,["loading"])])}}}),xl={class:"fr-container--fluid"},jl={key:0},Fl={class:"fr-breadcrumb__link","aria-current":"page"},Ul={class:"fr-h3 fr-mb-5v"},Hl={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-between"},Vl={class:"fr-col-12 fr-col-md fr-grid-row fr-grid-row--middle"},El={class:"fr-ml-3v fr-my-0 fr-h3"},Yl=["title"],Nl={class:"fr-col-auto"},Wl=["href"],Zl=["id"],Gl=["disabled","onClick"],Jl={class:"fr-col"},Ql={class:"fr-m-0 text-grey-500"},Xl={class:"fr-m-0 fr-text--xs text-default-error"},Kl={class:"fr-col-auto"},en=["disabled","aria-controls"],tn=["aria-labelledby","id"],sn={class:"fr-container fr-container--fluid fr-container-md"},an={class:"fr-grid-row fr-grid-row--center"},on={class:"fr-col-12 fr-col-md-8"},ln={class:"fr-modal__body"},nn={class:"fr-modal__header"},rn=["title","aria-controls"],dn={class:"fr-modal__content"},un=["id"],cn={class:"fr-text--bold"},fn={class:"fr-modal__footer"},mn={class:"fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left"},_n=["disabled"],pn=T({__name:"Profile",props:{oid:{}},setup(v){const{t:s}=B(),{toast:o}=be(),b=v,d=je(),i=k(null),{currentOrganization:r}=J(),n=k(null),{organizationCertified:p}=qt(n),m=k([]),f=k(!1),h=X("modal"),_=X("modalTitle");function w(){r.value&&(f.value=!0,Lt(r.value.id).then(()=>{d.replace("/"),window.location.reload()}).catch(()=>o.error(s("An error occured when deleting the organization."))).finally(()=>f.value=!1))}async function g(C,z){f.value=!0;try{n.value=await xt(C),o.success(s("Organization updated !"))}catch(R){o.error(s("An error occured when updating the organization."))}finally{f.value=!1}if(z&&n.value){f.value=!0;try{const R=await jt(n.value.id,z);n.value.logo_thumbnail=R.image}catch(R){o.error(s("Failed to upload logo, you can upload it again in your management panel"))}finally{f.value=!1}}}return ue(async()=>{f.value=!0;try{n.value=await Ue(b.oid)}finally{f.value=!1}}),(C,z)=>{const R=x("router-link");return c(),y("div",xl,[l(G,null,{default:u(()=>[t("li",null,[l(R,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(s)("Administration")),1)]),_:1})]),e(r)?(c(),y("li",jl,[l(R,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(r).name),1)]),_:1})])):D("",!0),t("li",null,[t("a",Fl,a(e(s)("Profile")),1)])]),_:1}),t("h1",Ul,a(e(s)("Profile")),1),n.value?(c(),A(Z,{key:0,class:"fr-mb-5v"},{default:u(()=>[t("div",Hl,[t("div",Vl,[l(e(Pt),{src:n.value.logo,type:"organization",size:80,class:"rounded-xxs border"},null,8,["src"]),t("div",El,[$(a(n.value.name)+" ",1),e(p)?(c(),y("span",{key:0,class:"fr-icon-success-line fr-icon--lg text-blue-400",title:e(s)("The identity of this public service is certified by {certifier}",{certifier:e(Ce)}),"aria-hidden":"true"},null,8,Yl)):D("",!0)])]),t("div",Nl,[t("a",{href:n.value.page,class:"fr-btn fr-btn--sm fr-btn--secondary fr-btn--secondary-grey-500 fr-btn--icon-left fr-icon-eye-line"},a(e(s)("See the organization page")),9,Wl)])])]),_:1})):D("",!0),i.value?(c(),y("h2",{key:1,class:"subtitle subtitle--uppercase fr-mb-5v",id:i.value.legend},a(e(s)("Edit profile")),9,Zl)):D("",!0),f.value&&!n.value?(c(),A(Ee,{key:2})):D("",!0),n.value?(c(),A(It,{key:3,organization:n.value,errors:m.value,showLegend:!1,showWell:!1,ref_key:"form",ref:i,onSubmit:g},{submitButton:u(({submit:O})=>[t("button",{class:"fr-btn fr-btn--icon-left fr-icon-save-line",disabled:f.value,"data-testid":"submitButton",onClick:O},a(e(s)("Save")),9,Gl)]),default:u(()=>[l(Ye,{class:"fr-mt-6w"},{default:u(()=>[t("div",Jl,[t("p",Ql,a(e(s)("Delete the organization")),1),t("p",Xl,a(e(s)("Be careful, this action can't be reverse.")),1)]),t("div",Kl,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-delete-line",disabled:f.value,"data-fr-opened":"false","aria-controls":e(h)},a(e(s)("Delete")),9,en),(c(),A(pe,{to:"body"},[t("dialog",{"aria-labelledby":e(_),role:"dialog",id:e(h),class:"fr-modal"},[t("div",sn,[t("div",an,[t("div",on,[t("div",ln,[t("div",nn,[t("button",{class:"fr-btn--close fr-btn",title:e(s)("Close the modal dialog"),"aria-controls":e(h)},a(e(s)("Close")),9,rn)]),t("div",dn,[t("h1",{id:e(_),class:"fr-modal__title fr-mb-2w"},a(e(s)("Are you sure you want to delete this organization ?")),9,un),t("p",cn,a(e(s)("This action can't be reverse.")),1),t("p",null,a(e(s)("All content published with this organization will stay online, with the same URL but in an anonymous form, i.e. without being linked to a data producer.")),1),t("p",null,a(e(s)("If you want to delete your published content too, start by deleting the contents before deleting your account.")),1)]),t("div",fn,[t("div",mn,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error",role:"button",disabled:f.value,onClick:w},a(e(s)("Delete")),9,_n)])])])])])])],8,tn)]))])]),_:1})]),_:1},8,["organization","errors"])):D("",!0)])}}});async function vn(v){return(await ge.get("posts/".concat(v,"/"))).data}ke(Vt,Ht,Ut,Ft);async function bn(v,s,o,b){return(await ge.get(He("discussions/"),{params:{org:v,sort:b,page_size:o,page:s}})).data}async function gn(v){switch(v.class){case"Dataservice":return Nt(v.id);case"Dataset":return Yt(v.id);case"Post":return vn(v.id);case"Reuse":return Et(v.id);default:return null}}function hn(v,s){return v===null?null:{title:yn(v),icon:wn(s),page:$n(v)}}function yn(v){return v===null?"":"title"in v?v.title:"headline"in v?v.headline:Ve(v,"Unknown type ".concat(v))}function $n(v){return v===null?"":"page"in v?v.page:"self_web_url"in v?v.self_web_url:Ve(v,"Unknown type ".concat(v))}function wn(v){switch(v){case"Dataservice":return"ri-terminal-line";case"Dataset":return"ri-database-2-line";case"Post":return"ri-article-line";case"Reuse":return"ri-line-chart-line";default:return""}}const kn={class:"fr-text--bold"},zn={key:0},Cn=["href"],Dn={class:"inline-flex items-center"},An=["href"],Sn=T({__name:"AdminDiscussionsTable",props:{discussions:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(v){const s=v,{t:o}=B(),b=k({}),d=k({});V(async()=>{for(const p of s.discussions)if(!(p.subject.id in b.value)){const m=gn(p.subject);b.value[p.subject.id]=m;const f=await b.value[p.subject.id];d.value[p.subject.id]=hn(f,p.subject.class)}});function i(p,m){return m?m.page+"#/discussions/"+p:""}function r(p){return s.sortedBy===p?s.sortDirection:null}function n(p){return p.discussion.slice(-1)[0]}return(p,m)=>(c(),A(ae,{class:"fr-table--layout-fixed",loading:p.loading},{default:u(()=>[t("thead",null,[l(S,{onSort:m[0]||(m[0]=f=>p.$emit("sort","title",f)),sorted:r("title"),scope:"col"},{default:u(()=>[$(a(e(o)("Discussion")),1)]),_:1},8,["sorted"]),l(S,{scope:"col"},{default:u(()=>[$(a(e(o)("Number of comments")),1)]),_:1}),l(S,{scope:"col"},{default:u(()=>[$(a(e(o)("Last comment")),1)]),_:1}),l(S,{onSort:m[1]||(m[1]=f=>p.$emit("sort","closed",f)),sorted:r("closed"),scope:"col"},{default:u(()=>[$(a(e(o)("Closed at")),1)]),_:1},8,["sorted"]),l(S,{scope:"col",style:{width:"25%"}},{default:u(()=>[$(a(e(o)("Link to the discussion")),1)]),_:1})]),t("tbody",null,[(c(!0),y(q,null,W(p.discussions,f=>{var h,_,w;return c(),y("tr",null,[t("td",null,[t("p",kn,[l(e(E),{text:f.title,"auto-resize":!0,"max-lines":1},null,8,["text"])]),d.value[f.subject.id]?(c(),y("p",zn,[t("a",{class:"fr-link inline-flex",href:(h=d.value[f.subject.id])==null?void 0:h.page},[l(e(ze),{height:12,class:"self-center",name:(_=d.value[f.subject.id])==null?void 0:_.icon},null,8,["name"]),l(e(E),{class:"overflow-wrap-anywhere",text:(w=d.value[f.subject.id])==null?void 0:w.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,Cn)])):D("",!0)]),t("td",null,a(f.discussion.length),1),t("td",null,[t("div",null,[t("p",null,a(e(j)(n(f).posted_on)),1),t("p",Dn,[$(a(e(o)("by "))+" ",1),l(e(rs),{class:"fr-ml-1v",user:n(f).posted_by},null,8,["user"])])])]),t("td",null,[f.closed?(c(),y(q,{key:0},[$(a(e(j)(f.closed)),1)],64)):D("",!0)]),t("td",null,[d.value[f.subject.id]?(c(),y("a",{key:0,class:"fr-link inline-flex",href:i(f.id,d.value[f.subject.id]),target:"_blank"},[l(e(E),{text:i(f.id,d.value[f.subject.id]),"auto-resize":!0,"max-lines":1},null,8,["text"])],8,An)):D("",!0)])])}),256))])]),_:1},8,["loading"]))}}),Rn="/_themes/gouvfr/assets/discussion.svg",Tn={class:"fr-container--fluid"},On={key:0},Bn={class:"fr-breadcrumb__link","aria-current":"page"},Mn={class:"fr-h3 fr-mb-5v"},qn={class:"subtitle subtitle--uppercase fr-m-0"},Pn={class:"text-align-center fr-py-1w"},In=["src"],Ln={class:"fr-text--bold fr-my-3v"},xn=T({__name:"Discussions",props:{oid:{}},setup(v){const{t:s}=B(),o=v,b=k(!1),d=k(1),i=k(10),r=k(0),n=k("created"),p=k("desc"),m=M(()=>"".concat(p.value==="asc"?"":"-").concat(n.value)),f=k([]),{currentOrganization:h}=J();function _(w,g){n.value=w,p.value=g}return V(async()=>{b.value=!0,f.value=[];try{const w=await bn(o.oid,d.value,i.value,m.value);f.value=w.data,d.value=w.page,i.value=w.page_size,r.value=w.total}finally{b.value=!1}}),(w,g)=>{const C=x("router-link");return c(),y("div",Tn,[l(G,null,{default:u(()=>[t("li",null,[l(C,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(s)("Administration")),1)]),_:1})]),e(h)?(c(),y("li",On,[l(C,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(h).name),1)]),_:1})])):D("",!0),t("li",null,[t("a",Bn,a(e(s)("Discussions")),1)])]),_:1}),t("h1",Mn,a(e(s)("Discussions")),1),t("h2",qn,a(e(s)("{n} discussions",r.value)),1),b.value||r.value>0?(c(),A(Sn,{key:0,discussions:f.value,loading:b.value,"sort-direction":p.value,sortedBy:n.value,onSort:_},null,8,["discussions","loading","sort-direction","sortedBy"])):(c(),A(Z,{key:1,class:"fr-my-2w"},{default:u(()=>[t("div",Pn,[t("img",{src:e(Rn),alt:"",loading:"lazy"},null,8,In),t("p",Ln,a(e(s)("There is no discussion yet")),1)])]),_:1})),r.value>i.value?(c(),A(e(ne),{key:2,page:d.value,"page-size":i.value,"total-results":r.value,onChange:g[0]||(g[0]=z=>d.value=z)},null,8,["page","page-size","total-results"])):D("",!0)])}}});async function jn(v,s,o){return(await ge.get(He("harvest/sources/"),{params:{owner:v,deleted:!0,page:s,page_size:o}})).data}const Fn="/_themes/gouvfr/assets/harvester.svg",Un={class:"fr-container--fluid"},Hn={key:0},Vn={class:"fr-breadcrumb__link","aria-current":"page"},En={class:"fr-h3 fr-mb-5v"},Yn={class:"subtitle subtitle--uppercase fr-m-0"},Nn=["href"],Wn={class:"text-align-center fr-py-1w"},Zn=["src"],Gn={class:"fr-text--bold fr-my-3v"},Jn=T({__name:"Harvesters",props:{oid:{}},setup(v){const{t:s}=B(),o=v,b=k(!1),d=k(1),i=k(10),r=k(0),n=k([]),p=k({}),{currentOrganization:m}=J();function f(g){return"".concat(se,"harvester/").concat(g.id,"/")}function h(g){return!g.last_job||!p.value[g.last_job.id]?0:p.value[g.last_job.id].items.filter(C=>C.dataservice).length}function _(g){return!g.last_job||!p.value[g.last_job.id]?0:p.value[g.last_job.id].items.filter(C=>C.dataset).length}function w(g){var C;switch((C=g.last_job)==null?void 0:C.status){case"pending":return{label:s("Pending"),type:"default"};case"initializing":return{label:s("Initializing"),type:"info"};case"initialized":return{label:s("Initialized"),type:"default"};case"processing":return{label:s("Processing"),type:"info"};case"done":return{label:s("Done"),type:"success"};case"done-errors":return{label:s("Done with errors"),type:"warning"};case"failed":return{label:s("Failed"),type:"error"};default:return{label:s("No job yet"),type:"default"}}}return V(async()=>{var g;b.value=!0,n.value=[];try{const C=await jn(o.oid,d.value,i.value);n.value=C.data,d.value=C.page,i.value=C.page_size,r.value=C.total;const z=[];for(const O of n.value)(g=O.last_job)!=null&&g.id&&z.push(ge.get("harvest/job/".concat(O.last_job.id,"/")));const R=await Promise.allSettled(z);for(const O of R)O.status==="fulfilled"&&(p.value[O.value.data.id]=O.value.data)}finally{b.value=!1}}),(g,C)=>{const z=x("router-link");return c(),y("div",Un,[l(G,null,{default:u(()=>[t("li",null,[l(z,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(s)("Administration")),1)]),_:1})]),e(m)?(c(),y("li",Hn,[l(z,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(m).name),1)]),_:1})])):D("",!0),t("li",null,[t("a",Vn,a(e(s)("Harvesters")),1)])]),_:1}),t("h1",En,a(e(s)("Harvesters")),1),t("h2",Yn,a(e(s)("{n} harvesters",r.value)),1),b.value||r.value?(c(),A(ae,{key:0,loading:b.value},{default:u(()=>[t("thead",null,[l(S,{scope:"col"},{default:u(()=>[$(a(e(s)("Name")),1)]),_:1}),l(S,{scope:"col"},{default:u(()=>[$(a(e(s)("Status")),1)]),_:1}),l(S,{scope:"col"},{default:u(()=>[$(a(e(s)("Created at")),1)]),_:1}),l(S,{scope:"col"},{default:u(()=>[$(a(e(s)("Last run")),1)]),_:1}),l(S,{scope:"col"},{default:u(()=>[$(a(e(s)("Datasets")),1)]),_:1}),l(S,{scope:"col"},{default:u(()=>[$(a(e(s)("Dataservices")),1)]),_:1})]),t("tbody",null,[(c(!0),y(q,null,W(n.value,R=>{var O;return c(),y("tr",null,[t("td",null,[l(fe,null,{default:u(()=>[t("a",{class:"fr-link fr-reset-link",href:f(R)},[l(e(E),{text:R.name,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Nn)]),_:2},1024)]),t("td",null,[l(ee,{type:w(R).type},{default:u(()=>[$(a(w(R).label),1)]),_:2},1032,["type"])]),t("td",null,a(e(j)(R.created_at)),1),t("td",null,[(O=R.last_job)!=null&&O.ended?(c(),y(q,{key:0},[$(a(e(j)(R.last_job.ended)),1)],64)):(c(),y(q,{key:1},[$(a(e(s)("Not yet")),1)],64))]),t("td",null,a(_(R)),1),t("td",null,a(h(R)),1)])}),256))])]),_:1},8,["loading"])):(c(),A(Z,{key:1,class:"fr-my-2w"},{default:u(()=>[t("div",Wn,[t("img",{src:e(Fn),alt:"",loading:"lazy"},null,8,Zn),t("p",Gn,a(e(s)("There is no harvesters yet")),1),l(he,{type:"harvester"})])]),_:1})),r.value>i.value?(c(),A(e(ne),{key:2,page:d.value,"page-size":i.value,"total-results":r.value,onChange:C[0]||(C[0]=R=>d.value=R)},null,8,["page","page-size","total-results"])):D("",!0)])}}}),Qn=["href"],Xn={key:0},Kn=["href"],er={class:"fr-p-1v monospaced bg-grey-100 fr-text--sm text-mention-grey rounded-xxs"},tr=T({__name:"AdminCommunityResourcesTable",props:{communityResources:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(v){const s=v,{t:o}=B();function b(r){return s.sortedBy===r?s.sortDirection:null}function d(r){return"".concat(se,"dataset/").concat(r.dataset.id,"/community-resource/").concat(r.id,"/")}function i(r){const n=r.extras&&"check:available"in r.extras;return n&&r.extras["check:available"]===!1?{label:o("Unavailable"),type:"error"}:n?{label:o("Available"),type:"info"}:{label:o("Not checked yet"),type:"default"}}return(r,n)=>{const p=x("Vicon");return c(),A(ae,{loading:r.loading},{default:u(()=>[t("thead",null,[l(S,{onSort:n[0]||(n[0]=m=>r.$emit("sort","title",m)),sorted:b("title"),scope:"col"},{default:u(()=>[$(a(e(o)("Resource title")),1)]),_:1},8,["sorted"]),l(S,null,{default:u(()=>[$(a(e(o)("Status")),1)]),_:1}),l(S,null,{default:u(()=>[$(a(e(o)("Format")),1)]),_:1}),l(S,{onSort:n[1]||(n[1]=m=>r.$emit("sort","created_at_internal",m)),sorted:b("created_at_internal"),scope:"col"},{default:u(()=>[$(a(e(o)("Created at")),1)]),_:1},8,["sorted"]),l(S,{onSort:n[2]||(n[2]=m=>r.$emit("sort","last_modified_internal",m)),sorted:b("last_modified_internal"),scope:"col"},{default:u(()=>[$(a(e(o)("Modified at")),1)]),_:1},8,["sorted"])]),t("tbody",null,[(c(!0),y(q,null,W(r.communityResources,m=>{var f,h;return c(),y("tr",null,[t("td",null,[l(fe,{class:"fr-text--bold"},{default:u(()=>[t("a",{class:"fr-link fr-reset-link",href:d(m)},[l(e(E),{text:m.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Qn)]),_:2},1024),r.datasets[m.dataset.id]?(c(),y("p",Xn,[t("a",{class:"fr-link inline-flex",href:(f=r.datasets[m.dataset.id])==null?void 0:f.page},[l(p,{height:12,class:"self-center",name:r.getSubjectTypeIcon("Dataset")},null,8,["name"]),l(e(E),{class:"overflow-wrap-anywhere",text:(h=r.datasets[m.dataset.id])==null?void 0:h.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,Kn)])):D("",!0)]),t("td",null,[l(ee,{type:i(m).type},{default:u(()=>[$(a(i(m).label),1)]),_:2},1032,["type"])]),t("td",null,[t("code",er,a(m.format),1)]),t("td",null,a(e(j)(m.created_at)),1),t("td",null,a(e(j)(m.last_modified)),1)])}),256))])]),_:1},8,["loading"])}}}),sr={class:"fr-container--fluid"},ar={key:0},or={class:"fr-breadcrumb__link","aria-current":"page"},lr={class:"fr-h3 fr-mb-5v"},nr={class:"subtitle subtitle--uppercase fr-m-0"},rr={class:"text-align-center fr-py-1w"},ir=["src"],dr={class:"fr-text--bold fr-my-3v"},xe=T({__name:"CommunityResources",props:{oid:{}},setup(v){const{t:s}=B(),o=v,b=k([]),d=k(!1),i=k(1),r=k(10),n=k(0),p=k("created_at_internal"),m=k("desc"),f=M(()=>"".concat(m.value==="asc"?"":"-").concat(p.value)),{currentOrganization:h}=J(),_=ce();function w(g,C){p.value=g,m.value=C}return V(async()=>{d.value=!0,b.value=[];try{let g;if(o.oid)g=await Wt(o.oid,i.value,r.value,f.value);else if(_.value)g=await Zt(_.value.id,i.value,r.value,f.value);else return;b.value=g.data,i.value=g.page,r.value=g.page_size,n.value=g.total}finally{d.value=!1}}),(g,C)=>{const z=x("router-link");return c(),y("div",sr,[l(G,null,{default:u(()=>[t("li",null,[l(z,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(s)("Administration")),1)]),_:1})]),e(h)?(c(),y("li",ar,[l(z,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(a(e(h).name),1)]),_:1})])):D("",!0),t("li",null,[t("a",or,a(e(s)("Community Resources")),1)])]),_:1}),t("h1",lr,a(e(s)("Community Resources")),1),t("h2",nr,a(e(s)("{n} community resources",b.value.length)),1),d.value||n.value>0?(c(),A(tr,{key:0,"community-resources":b.value,loading:d.value,sortDirection:m.value,sortedBy:p.value,onSort:w},null,8,["community-resources","loading","sortDirection","sortedBy"])):(c(),A(Z,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:u(()=>[t("div",rr,[t("img",{src:e(Gt),alt:"",loading:"lazy"},null,8,ir),t("p",dr,a(e(s)("You haven't published a community resource yet")),1)])]),_:1})),n.value>r.value?(c(),A(e(ne),{key:2,page:i.value,"page-size":r.value,"total-results":n.value,onChange:C[0]||(C[0]=R=>i.value=R)},null,8,["page","page-size","total-results"])):D("",!0)])}}});Jt({admin_root:se,default_lang:$e.global.locale.value,only_locales:$e.global.locale.value,schema_documentation_url:Qt,schema_validata_url:Xt,show_copy_resource_permalink:!0,tabular_api_url:Kt,tabular_page_size:es,title:Ce});const ur=[{path:"/me",children:[{path:"",component:Ea,name:"me"},{path:"datasets",component:Me,name:"me-datasets"},{path:"dataservices",component:qe,name:"me-dataservices"},{path:"reuses",component:Pe,name:"me-reuses"},{path:"community-resources",component:xe,name:"me-community-resources"}]},{path:"/organizations/:oid",children:[{path:"datasets",component:Me,props:!0,name:"organization-datasets"},{path:"dataservices",component:qe,props:!0,name:"organization-dataservices"},{path:"reuses",component:Pe,props:!0,name:"organization-reuses"},{path:"discussions",component:xn,props:!0,name:"organization-discussions"},{path:"members",component:Ll,props:!0,name:"organization-members"},{path:"harvesters",component:Jn,props:!0,name:"organization-harvesters"},{path:"community-resources",component:xe,props:!0,name:"organization-community-resources"},{path:"profile",component:pn,props:!0,name:"organization-profile"}]}],cr=ts({history:ss(),routes:ur}),re=Ke(fo);as(re);re.use(os);re.use(ls);re.use($e);re.use(cr);re.mount("#admin");globalThis.dsfr.start();console.log("JS is injected !");export{fr as __vite_legacy_guard};
