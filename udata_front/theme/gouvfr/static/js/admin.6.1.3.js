import{defineComponent as T,openBlock as c,createElementBlock as $,Fragment as I,createVNode as n,mergeProps as $e,createElementVNode as e,toDisplayString as s,useTemplateRef as Ge,ref as k,computed as B,onMounted as ue,watchEffect as E,normalizeClass as W,createBlock as D,unref as t,withCtx as d,createCommentVNode as A,createTextVNode as y,renderSlot as N,renderList as F,readonly as Ze,useId as Je,resolveComponent as P,watchPostEffect as Ke,Teleport as _e,withModifiers as me,createApp as Xe}from"vue";import{C as pe,K as q,bG as Qe,v as M,E as H,G as K,_ as ee,b as we,bH as et,h as ke,an as G,y as V,A as tt,bh as te,bI as st,bJ as at,ax as ze,bs as ot,bK as de,bL as lt,bM as nt,bN as rt,as as it,L as le,af as ut,bO as dt,bP as ct,bn as ft,bQ as mt,bR as _t,bd as pt,bS as vt,bT as Pe,aZ as bt,X as oe,a7 as gt,aW as qe,bU as ht,ay as yt,$ as ve,a1 as $t,bV as wt,bW as kt,aM as zt,bX as Ct,bY as At,bZ as Se,b_ as Dt,b$ as St,c0 as Rt,c1 as Ue,c2 as Tt,c3 as Ot,x as Bt,B as Mt,bg as xt,c4 as It,c5 as Lt,bj as jt,a as be,c6 as Pt,c7 as qt,c8 as Ut,c9 as Ht,a8 as He,ca as Vt,cb as Et,cc as Yt,cd as Ve,ce as Wt,cf as Nt,au as Ft,bu as Gt,bx as ye,aY as Zt,by as Jt,bA as Kt,bB as Xt,cg as Qt,ch as es,bC as ts,bD as ss,bE as as}from"./sentry.6.1.3.js";import{ContentLoader as Re}from"vue-content-loader";import"./_commonjsHelpers.6.1.3.js";function nr(){import.meta.url,import("_").catch(()=>1);async function*v(){}}const os={class:"fr-ml-1v fr-text--bold"},ls=T({__name:"AvatarWithName",props:{user:{},size:{default:12}},setup(v){return(a,o)=>(c(),$(I,null,[n(pe,$e(a.$attrs,{user:a.user,size:a.size,rounded:!0}),null,16,["user","size"]),e("span",os,s(a.user.first_name)+" "+s(a.user.last_name),1)],64))}}),ns={ref:"canvasRef",width:"120",height:"30"},rs={class:"fr-grid-row justify-between"},is={class:"text-xxs fr-m-0 text-mention-grey"},us={class:"text-xxs fr-m-0 text-mention-grey"},Te="#B6CFFB",ie="#3558A2",ds="rgba(53, 88, 162, 0.7)",cs="rgba(182, 207, 251, 0.7)",fs=T({__name:"SmallChart",props:{data:{},type:{},lastWithLowEmphasis:{type:Boolean,default:!1}},setup(v){const a=v,o=(w,g)=>w.p1DataIndex===l.value.length-1?g:null,b=Ge("canvasRef"),u=k(null),i=k(null),r=B(()=>{const w=Object.keys(a.data);w.sort();let g={};for(const C of w)g[C]=a.data[C];return g}),l=B(()=>Object.keys(r.value)),_=B(()=>Object.values(r.value)),m=B(()=>a.type==="bar"?{barPercentage:1,categoryPercentage:.9,backgroundColor:l.value.map((w,g)=>g===l.value.length-1?a.lastWithLowEmphasis?cs:ie:Te)}:a.type==="line"&&a.lastWithLowEmphasis?{segment:{borderColor:w=>o(w,ds)||ie,borderDash:w=>o(w,[3,3])||[6,0]}}:{}),f=B(()=>l.value.length?q(l.value[0],"MM/YY"):null),h=B(()=>l.value.length?q(l.value[l.value.length-1],"MM/YY"):null),p={animation:!1,responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!1}},elements:{bar:{backgroundColor:Te,borderRadius:2,hoverBackgroundColor:ie},line:{backgroundColor:ie,borderColor:ie,borderJoinStyle:"round",tension:.35},point:{radius:0}},scales:{x:{display:!1,grid:{display:!1},ticks:{display:!1}},y:{display:!1,grid:{display:!1},ticks:{display:!1}}},layout:{padding:{top:1.5}}};return ue(()=>{u.value=b.value?b.value.getContext("2d"):null}),E(()=>{u.value&&(i.value&&i.value.destroy(),i.value=new Qe(u.value,{data:{labels:l.value,datasets:[{data:_.value,type:a.type,...m.value}]},options:p}))}),(w,g)=>(c(),$("div",null,[e("canvas",ns,null,512),e("div",rs,[e("p",is,s(f.value),1),e("p",us,s(h.value),1)])]))}}),ms={class:"fr-text--sm fr-m-0"},_s={class:"fr-grid-row fr-grid-row--middle"},ps={key:1,class:"h1 line-height-1 fr-m-0"},vs={key:3,class:"fr-ml-1w"},bs={key:0,class:"fr-mt-1w fr-text--regular text-transform-none fr-badge fr-badge--no-icon fr-badge--success"},gs={class:"fr-mr-1v"},he=T({__name:"StatBox",props:{title:{},data:{},type:{},summary:{}},setup(v){const a=v,{t:o}=M(),b=B(()=>a.data?Object.keys(a.data):[]),u=B(()=>a.data?Object.values(a.data):[]),i=B(()=>b.value.length?b.value.reduce((m,f)=>f>m?f:m):null),r=B(()=>i.value?b.value.indexOf(i.value):null),l=B(()=>r.value!==null?u.value[r.value]:null),_=B(()=>Math.max(...u.value)>0);return(m,f)=>(c(),$("div",{class:W({"text-mention-grey":!_.value&&!m.summary})},[e("h3",ms,s(m.title),1),e("div",_s,[m.summary===null?(c(),D(t(Re),{key:0,width:92,height:32,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},{default:d(()=>f[0]||(f[0]=[e("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"92",height:"32"},null,-1)])),_:1})):(c(),$("p",ps,s(t(H)(m.summary,2)),1)),m.data===null?(c(),D(t(Re),{key:2,width:120,height:30,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",class:"fr-ml-1w"},{default:d(()=>f[1]||(f[1]=[e("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"120",height:"30"},null,-1)])),_:1})):_.value?(c(),$("div",vs,[n(fs,{type:m.type,data:m.data,lastWithLowEmphasis:!0},null,8,["type","data"])])):A("",!0)]),l.value&&i.value?(c(),$("p",bs,[e("strong",gs," +Â "+s(t(H)(l.value,2)),1),y(" "+s(t(o)(" in "))+" "+s(t(q)(i.value,"MMM YYYY")),1)])):A("",!0)],2))}}),hs=["aria-label"],ys={class:"fr-breadcrumb__list"},Z={__name:"Breadcrumb",setup(v){const{t:a}=M();return(o,b)=>(c(),$("nav",{rol:"navigation","aria-label":t(a)("You're here:"),class:"fr-breadcrumb fr-mb-5v"},[e("ol",ys,[N(o.$slots,"default")])],8,hs))}},Q=T({__name:"AdminBadge",props:{type:{}},setup(v){return(a,o)=>(c(),$("p",{class:W(["fr-badge",{"fr-badge--blue-cumulus":a.type==="info","fr-badge--error fr-badge--no-icon":a.type==="error","fr-badge--warning fr-badge--no-icon":a.type==="warning","fr-badge--success fr-badge--no-icon":a.type==="success"}])},[N(a.$slots,"default")],2))}}),$s=["aria-describedby"],ws=["id"],ks=T({inheritAttrs:!1,__name:"AdminContentWithTooltip",setup(v){const a=K(),o=k(),b=k("");return ue(()=>{o.value&&(b.value=o.value.textContent||"")}),(u,i)=>(c(),$(I,null,[e("p",$e(u.$attrs,{"aria-describedby":t(a),ref_key:"contentRef",ref:o}),[N(u.$slots,"default",{},void 0,!0)],16,$s),e("span",{class:"fr-hidden-xl fr-tooltip fr-placement",id:t(a),role:"tooltip","aria-hidden":"true"},s(b.value),9,ws)],64))}});const ce=ee(ks,[["__scopeId","data-v-d192f17a"]]),Ee=T({__name:"AdminLoader",props:{scale:{default:4}},setup(v){return we(et),(a,o)=>(c(),D(t(ke),{name:"ri-loader-5-line",animation:"spin",scale:a.scale,fill:"var(--blue-cumulus-sun-368-moon-732)"},null,8,["scale"]))}}),zs={class:"fr-table fr-mb-2w"},Cs=T({__name:"AdminTable",props:{loading:{type:Boolean,default:!1}},setup(v){return(a,o)=>(c(),$("div",zs,[e("table",null,[N(a.$slots,"default",{},void 0,!0)]),a.loading?(c(),D(G,{key:0,class:"fr-p-4w text-align-center"},{default:d(()=>[n(Ee)]),_:1})):A("",!0)]))}});const se=ee(Cs,[["__scopeId","data-v-cae574a4"]]),As={class:"fr-text--bold"},Ds={key:1,class:"fr-grid-row fr-grid-row--middle justify-between"},Ss=["title"],Rs=T({__name:"AdminTableTh",props:{sorted:{}},emits:["sort"],setup(v,{emit:a}){const o=v,b=a,{t:u}=M(),i=B(()=>o.sorted!==void 0);function r(){return o.sorted==="desc"?b("sort","asc"):b("sort","desc")}return(l,_)=>(c(),$("th",As,[i.value?(c(),$("div",Ds,[N(l.$slots,"default",{},void 0,!0),e("button",{class:W(["fr-ml-1w fr-btn fr-btn--sm fr-btn--tertiary-no-outline",{"fr-icon-arrow-down-line":!l.sorted||l.sorted==="asc","fr-icon-arrow-up-line":l.sorted==="desc","text-grey-500":l.sorted,"text-mention-grey":!l.sorted}]),onClick:r,title:t(u)("Sort")},s(t(u)("Sort")),11,Ss)])):N(l.$slots,"default",{key:0},void 0,!0)]))}});const S=ee(Rs,[["__scopeId","data-v-5acf0bf0"]]),Ts=["aria-describedby"],Os=["id"],Y=T({__name:"Tooltip",setup(v){const a=K("tooltip");return(o,b)=>(c(),$(I,null,[e("p",$e(o.$attrs,{"aria-describedby":t(a)}),[N(o.$slots,"default")],16,Ts),e("span",{class:"fr-tooltip fr-placement",id:t(a),role:"tooltip","aria-hidden":"true"},[N(o.$slots,"tooltip")],8,Os)],64))}}),Bs=["href"],Ms={class:"monospace"},xs={class:"monospace"},Is={class:"monospace"},Ls={class:"monospace"},js={class:"monospace"},Ps=T({__name:"AdminDatasetsTable",props:{datasets:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(v,{emit:a}){const o=a,b=v,{t:u}=M();function i(f,h){o("sort",f,h)}function r(f){return b.sortedBy===f?b.sortDirection:null}function l(f){return Array.isArray(f.resources)?f.resources.length:f.resources.total}function _(f){return"".concat(te,"dataset/").concat(f.id,"/")}function m(f){return f.deleted?{label:u("Deleted"),type:"error"}:f.archived?{label:u("Archived"),type:"warning"}:f.private?{label:u("Draft"),type:"default"}:{label:u("Public"),type:"info"}}return(f,h)=>(c(),D(se,{loading:f.loading},{default:d(()=>[e("thead",null,[e("tr",null,[n(S,{onSort:h[0]||(h[0]=p=>i("title",p)),sorted:r("title"),scope:"col"},{default:d(()=>[y(s(t(u)("Title of the dataset")),1)]),_:1},8,["sorted"]),n(S,{scope:"col"},{default:d(()=>[y(s(t(u)("Status")),1)]),_:1}),n(S,{onSort:h[1]||(h[1]=p=>i("created",p)),sorted:r("created"),scope:"col"},{default:d(()=>[y(s(t(u)("Created at")),1)]),_:1},8,["sorted"]),n(S,{onSort:h[2]||(h[2]=p=>i("last_update",p)),sorted:r("last_update"),scope:"col"},{default:d(()=>[y(s(t(u)("Updated at")),1)]),_:1},8,["sorted"]),n(S,{scope:"col"},{default:d(()=>[y(s(t(u)("Files")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(s(t(u)("Score")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[n(Y,null,{tooltip:d(()=>[y(s(t(u)("Discussions")),1)]),default:d(()=>[h[6]||(h[6]=e("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),n(S,{onSort:h[3]||(h[3]=p=>i("views",p)),sorted:r("views"),scope:"col"},{default:d(()=>[n(Y,null,{tooltip:d(()=>[y(s(t(u)("Views")),1)]),default:d(()=>[h[7]||(h[7]=e("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),n(S,{scope:"col"},{default:d(()=>[n(Y,null,{tooltip:d(()=>[y(s(t(u)("Downloads")),1)]),default:d(()=>[h[8]||(h[8]=e("span",{class:"fr-icon--sm fr-icon-download-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),n(S,{onSort:h[4]||(h[4]=p=>i("reuses",p)),sorted:r("reuses"),scope:"col"},{default:d(()=>[n(Y,null,{tooltip:d(()=>[y(s(t(u)("Reuses")),1)]),default:d(()=>[h[9]||(h[9]=e("span",{class:"fr-icon--sm fr-icon-line-chart-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),n(S,{onSort:h[5]||(h[5]=p=>i("followers",p)),sorted:r("followers"),scope:"col"},{default:d(()=>[n(Y,null,{tooltip:d(()=>[y(s(t(u)("Favorites")),1)]),default:d(()=>[h[10]||(h[10]=e("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"])])]),e("tbody",null,[(c(!0),$(I,null,F(f.datasets,p=>{var w;return c(),$("tr",{key:p.id},[e("td",null,[n(ce,null,{default:d(()=>[e("a",{class:"fr-link fr-reset-link",href:_(p)},[n(t(V),{text:p.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Bs)]),_:2},1024)]),e("td",null,[n(Q,{type:m(p).type},{default:d(()=>[y(s(m(p).label),1)]),_:2},1032,["type"])]),e("td",null,s(t(q)(p.created_at)),1),e("td",null,s(t(q)(p.last_modified)),1),e("td",null,s(l(p)),1),e("td",null,[n(t(tt),{class:"w-100",score:p.quality.score},null,8,["score"])]),e("td",Ms,s(t(H)(p.metrics.discussions)),1),e("td",xs,s(t(H)(p.metrics.views)),1),e("td",Is,s(t(H)((w=p.metrics.resources_downloads)!=null?w:0)),1),e("td",Ls,s(t(H)(p.metrics.reuses)),1),e("td",js,s(t(H)(p.metrics.followers)),1)])}),128))])]),_:1},8,["loading"]))}}),Oe=k(null);function J(){const v=a=>{Oe.value=a};return{currentOrganization:Ze(Oe),setCurrentOrganization:v}}const qs="/_themes/gouvfr/assets/logotype-white.svg",Us=["href"],Hs=["src","alt"],ge=T({__name:"AdminPublishButton",props:{type:{}},setup(v){const a=v,{t:o}=M(),b=B(()=>{switch(a.type){case"dataset":return at;case"harvester":return"".concat(te,"harvester/new/");case"reuse":return st}});return(u,i)=>(c(),$("a",{href:b.value,class:"fr-btn fr-icon-add-line fr-btn--icon-left"},[y(s(t(o)("Publish on"))+" ",1),e("img",{class:"fr-ml-1v",src:t(qs),loading:"lazy",alt:t(ze)},null,8,Hs)],8,Us))}}),Vs={key:0},Es={class:"fr-breadcrumb__link","aria-current":"page"},Ys={class:"fr-h3 fr-mb-5v"},Ws={class:"fr-p-3w flex items-center justify-between relative"},Ns=["id"],Fs=["aria-expanded"],Gs={class:"flex items-center fr-ml-4v buttons"},Zs={class:"fr-col-auto fr-ml-3v fr-m-0"},Js=["disabled","href","title"],Ks=["aria-labelledby"],Xs={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Qs={class:"fr-col"},ea={class:"subtitle subtitle--uppercase fr-m-0"},ta={key:0,class:"fr-col-auto fr-grid-row fr-grid-row--middle"},sa=["href"],aa={class:"text-align-center fr-py-1w"},oa=["src"],la={class:"fr-text--bold fr-my-3v"},na=T({__name:"Datasets",props:{oid:{}},setup(v){const{t:a}=M(),o=v,b=k([]),u=k(!1),i=k(1),r=k(10),l=k(0),_=k("created"),m=k("desc"),f=B(()=>"".concat(m.value==="asc"?"":"-").concat(_.value)),h=k(""),p=ot(h,ut),{currentOrganization:w}=J(),g=de();function C(x,L){_.value=x,m.value=L}E(async()=>{u.value=!0,b.value=[];try{let x;if(o.oid)x=await lt(o.oid,p.value,i.value,r.value,f.value);else if(g.value)x=await nt(g.value.id,p.value,i.value,r.value,f.value);else return;b.value=x.data,i.value=x.page,r.value=x.page_size,l.value=x.total}finally{u.value=!1}});const z=k(!1),R=Je(),O=k(null),X=k(null),j=k(null),Ce=k(null),re=k(null),Ae=k(null);E(async()=>{if(o.oid){{const L=await(await fetch("https://metric-api.data.gouv.fr/api/organizations/data/?organization_id__exact=".concat(o.oid,"&metric_month__sort=desc&page_size=12"))).json();O.value={},j.value={},re.value={};for(const{metric_month:ae,monthly_download_resource:fe,monthly_visit_dataset:Ne,monthly_visit_reuse:Fe}of L.data)O.value[ae]=Ne,j.value[ae]=fe,re.value[ae]=Fe}{const L=await(await fetch("https://metric-api.data.gouv.fr/api/organizations_total/data/?organization_id__exact=".concat(o.oid))).json();L.data[0]&&(X.value=L.data[0].visit_dataset,Ce.value=L.data[0].download_resource,Ae.value=L.data[0].visit_reuse)}}});const De=B(()=>{if(!O.value||!j.value||!re.value)return null;let x="month,visit_datasets,download_resource,visit_reuse\n";for(const L in O.value)x+="".concat(L,",").concat(O.value[L],",").concat(j.value[L],",").concat(re.value[L],"\n");return URL.createObjectURL(new Blob([x],{type:"text/csv"}))});return(x,L)=>{const ae=P("router-link");return c(),$("div",null,[n(Z,null,{default:d(()=>[e("li",null,[n(ae,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(a)("Administration")),1)]),_:1})]),t(w)?(c(),$("li",Vs,[n(ae,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(w).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",Es,s(t(a)("Datasets")),1)])]),_:1}),e("h1",Ys,s(t(a)("Datasets")),1),x.oid&&!u.value&&l.value>0?(c(),$("div",{key:0,class:W(["bg-white border rounded-xxs fr-mb-3w",{"fr-pb-4v":z.value}])},[e("header",Ws,[e("div",null,[e("h4",{class:"fr-mb-1v flex items-center",id:t(R)},[e("button",{type:"button",onClick:L[0]||(L[0]=fe=>z.value=!z.value),class:"fr-p-0 fr-text flex items-center font-bold","data-testid":"expand-button","aria-expanded":z.value},[y(s(x.$t("Statistics on your datasets"))+" ",1),L[2]||(L[2]=e("span",{class:"absolute inset-0 z-1"},null,-1))],8,Fs)],8,Ns)]),e("div",Gs,[e("p",Zs,[e("a",{disabled:!De.value,href:De.value||"",rel:"ugc nofollow noopener",title:t(a)("Download file"),download:"stats.csv",class:"relative fr-btn fr-btn--sm fr-btn--icon-left fr-icon-test-tube-line fr-icon-download-line fr-icon--sm z-2"},s(x.$t("Download")),9,Js)]),e("div",{class:W(["fr-icon--sm fr-ml-4v",{"fr-icon-arrow-up-s-line":z.value,"fr-icon-arrow-down-s-line":!z.value}])},null,2)])]),z.value?(c(),$("section",{key:0,"aria-labelledby":t(R),class:"flex fr-pb-3w fr-pl-3w fr-pr-3w"},[n(t(he),{title:x.$t("Views"),data:O.value,type:"line",summary:X.value,class:"w-1/3"},null,8,["title","data","summary"]),n(t(he),{title:x.$t("Downloads"),data:j.value,type:"line",summary:Ce.value,class:"w-1/3"},null,8,["title","data","summary"]),n(t(he),{title:x.$t("Reuses Visits"),data:re.value,type:"line",summary:Ae.value,class:"w-1/3"},null,8,["title","data","summary"])],8,Ks)):A("",!0)],2)):A("",!0),e("div",Xs,[e("div",Qs,[e("h2",ea,s(t(a)("{n} datasets",l.value)),1)]),x.oid?(c(),$("div",ta,[e("div",null,[e("a",{href:t(rt)(x.oid,l.value),class:"fr-btn fr-btn--sm fr-icon-download-line fr-btn--icon-left"},s(t(a)("Download catalog")),9,sa)])])):A("",!0)]),u.value||l.value>0?(c(),D(Ps,{key:1,datasets:b.value,loading:u.value,"sort-direction":m.value,sortedBy:_.value,onSort:C},null,8,["datasets","loading","sort-direction","sortedBy"])):(c(),D(G,{key:2,class:"fr-my-2w"},{default:d(()=>[e("div",aa,[e("img",{src:t(it),alt:"",loading:"lazy"},null,8,oa),e("p",la,s(t(a)("You haven't published a dataset yet")),1),n(ge,{type:"dataset"})])]),_:1})),l.value>r.value?(c(),D(t(le),{key:3,page:i.value,"page-size":r.value,"total-results":l.value,onChange:L[1]||(L[1]=fe=>i.value=fe)},null,8,["page","page-size","total-results"])):A("",!0)])}}});const Be=ee(na,[["__scopeId","data-v-93674b91"]]),ra=["href"],ia={key:0},ua=T({__name:"AdminDataservicesTable",props:{dataservices:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(v){const a=v,{t:o}=M();function b(l){return a.sortedBy===l?a.sortDirection:null}function u(l){return"".concat(te,"dataservices/").concat(l.id,"/")}function i(l){return l.private?{label:o("Draft"),type:"default"}:{label:o("Public"),type:"info"}}function r(l){return l.is_restricted?{label:o("Restricted"),type:"warning"}:{label:o("Open"),type:"success"}}return(l,_)=>(c(),D(se,{loading:l.loading},{default:d(()=>[e("thead",null,[n(S,{onSort:_[0]||(_[0]=m=>l.$emit("sort","title",m)),sorted:b("title"),scope:"col"},{default:d(()=>[y(s(t(o)("Dataservice title")),1)]),_:1},8,["sorted"]),n(S,null,{default:d(()=>[y(s(t(o)("Status")),1)]),_:1}),n(S,null,{default:d(()=>[y(s(t(o)("Access")),1)]),_:1}),n(S,null,{default:d(()=>[y(s(t(o)("Created at")),1)]),_:1}),n(S,null,{default:d(()=>[y(s(t(o)("Rate Limiting")),1)]),_:1}),n(S,null,{default:d(()=>[y(s(t(o)("Availability")),1)]),_:1})]),e("tbody",null,[(c(!0),$(I,null,F(l.dataservices,m=>(c(),$("tr",null,[e("td",null,[n(ce,null,{default:d(()=>[e("a",{class:"fr-link fr-reset-link",href:u(m)},[n(t(V),{text:m.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,ra)]),_:2},1024)]),e("td",null,[n(Q,{type:i(m).type},{default:d(()=>[y(s(i(m).label),1)]),_:2},1032,["type"])]),e("td",null,[n(Q,{type:r(m).type},{default:d(()=>[y(s(r(m).label),1)]),_:2},1032,["type"])]),e("td",null,s(t(q)(m.created_at)),1),e("td",null,s(m.rate_limiting),1),e("td",null,[m.availability?(c(),$("span",ia,s(m.availability)+"%",1)):A("",!0)])]))),256))])]),_:1},8,["loading"]))}}),da={class:"fr-container--fluid"},ca={key:0},fa={class:"fr-breadcrumb__link","aria-current":"page"},ma={class:"fr-h3"},_a={class:"subtitle subtitle--uppercase"},pa={class:"text-align-center fr-py-1w"},va=["src"],ba={class:"fr-text--bold fr-my-3v"},Me=T({__name:"Dataservices",props:{oid:{}},setup(v){const{t:a}=M(),o=v,b=k([]),u=k(!1),i=k(1),r=k(10),l=k(0),_=k("title"),m=k("desc"),f=B(()=>"".concat(m.value==="asc"?"":"-").concat(_.value)),{currentOrganization:h}=J(),p=de();function w(g,C){_.value=g,m.value=C}return E(async()=>{u.value=!0,b.value=[];try{let g;if(o.oid)g=await dt(o.oid,i.value,r.value,f.value);else if(p.value)g=await ct(p.value.id,i.value,r.value,f.value);else return;b.value=g.data,i.value=g.page,r.value=g.page_size,l.value=g.total}finally{u.value=!1}}),(g,C)=>{const z=P("router-link");return c(),$("div",da,[n(Z,null,{default:d(()=>[e("li",null,[n(z,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(a)("Administration")),1)]),_:1})]),t(h)?(c(),$("li",ca,[n(z,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(h).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",fa,s(t(a)("Dataservices")),1)])]),_:1}),e("h1",ma,s(t(a)("Dataservices")),1),e("h2",_a,s(t(a)("{n} dataservices",l.value)),1),u.value||l.value>0?(c(),D(ua,{key:0,dataservices:b.value,loading:u.value,sortDirection:m.value,sortedBy:_.value,onSort:w},null,8,["dataservices","loading","sortDirection","sortedBy"])):(c(),D(G,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:d(()=>[e("div",pa,[e("img",{src:t(ft),alt:"",loading:"lazy"},null,8,va),e("p",ba,s(t(a)("You haven't published a dataservice yet")),1),n(ge,{type:"dataservice"})])]),_:1})),l.value>r.value?(c(),D(t(le),{key:2,page:i.value,"page-size":r.value,"total-results":l.value,onChange:C[0]||(C[0]=R=>i.value=R)},null,8,["page","page-size","total-results"])):A("",!0)])}}}),ga=["href"],ha={class:"monospace"},ya={class:"monospace"},$a={class:"monospace"},wa={class:"monospace"},ka=T({__name:"AdminReusesTable",props:{reuses:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(v){const a=v,{t:o}=M();function b(r){return a.sortedBy===r?a.sortDirection:null}function u(r){return"".concat(te,"reuse/").concat(r.id,"/")}function i(r){return r.deleted?{label:o("Deleted"),type:"error"}:r.archived?{label:o("Archived"),type:"warning"}:r.private?{label:o("Draft"),type:"default"}:{label:o("Public"),type:"info"}}return(r,l)=>(c(),D(se,{loading:r.loading},{default:d(()=>[e("thead",null,[n(S,{onSort:l[0]||(l[0]=_=>r.$emit("sort","title",_)),sorted:b("title"),scope:"col"},{default:d(()=>[y(s(t(o)("Reuse title")),1)]),_:1},8,["sorted"]),n(S,null,{default:d(()=>[y(s(t(o)("Status")),1)]),_:1}),n(S,{onSort:l[1]||(l[1]=_=>r.$emit("sort","created",_)),sorted:b("created"),scope:"col"},{default:d(()=>[y(s(t(o)("Created at")),1)]),_:1},8,["sorted"]),n(S,{onSort:l[2]||(l[2]=_=>r.$emit("sort","datasets",_)),sorted:b("datasets"),scope:"col"},{default:d(()=>[y(s(t(o)("Datasets")),1)]),_:1},8,["sorted"]),n(S,{scope:"col"},{default:d(()=>[n(Y,null,{tooltip:d(()=>[y(s(t(o)("Discussions")),1)]),default:d(()=>[l[5]||(l[5]=e("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),n(S,{onSort:l[3]||(l[3]=_=>r.$emit("sort","views",_)),sorted:b("views"),scope:"col"},{default:d(()=>[n(Y,null,{tooltip:d(()=>[y(s(t(o)("Views")),1)]),default:d(()=>[l[6]||(l[6]=e("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),n(S,{onSort:l[4]||(l[4]=_=>r.$emit("sort","followers",_)),sorted:b("followers"),scope:"col"},{default:d(()=>[n(Y,null,{tooltip:d(()=>[y(s(t(o)("Favorites")),1)]),default:d(()=>[l[7]||(l[7]=e("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"])]),e("tbody",null,[(c(!0),$(I,null,F(r.reuses,_=>(c(),$("tr",null,[e("td",null,[n(ce,null,{default:d(()=>[e("a",{class:"fr-link fr-reset-link",href:u(_)},[n(t(V),{text:_.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,ga)]),_:2},1024)]),e("td",null,[n(Q,{type:i(_).type},{default:d(()=>[y(s(i(_).label),1)]),_:2},1032,["type"])]),e("td",null,s(t(q)(_.created_at)),1),e("td",ha,s(t(H)(_.datasets.length)),1),e("td",ya,s(t(H)(_.metrics.discussions)),1),e("td",$a,s(t(H)(_.metrics.views)),1),e("td",wa,s(t(H)(_.metrics.followers)),1)]))),256))])]),_:1},8,["loading"]))}}),za="/_themes/gouvfr/assets/reuse.svg",Ca={class:"fr-container--fluid"},Aa={key:0},Da={class:"fr-breadcrumb__link","aria-current":"page"},Sa={class:"fr-h3 fr-mb-5v"},Ra={class:"subtitle subtitle--uppercase fr-mb-0"},Ta={class:"text-align-center fr-py-1w"},Oa=["src"],Ba={class:"fr-text--bold fr-my-3v"},xe=T({__name:"Reuses",props:{oid:{}},setup(v){const{t:a}=M(),o=v,b=k([]),u=k(!1),i=k(1),r=k(10),l=k(0),_=k("created"),m=k("desc"),f=B(()=>"".concat(m.value==="asc"?"":"-").concat(_.value)),{currentOrganization:h}=J(),p=de();function w(g,C){_.value=g,m.value=C}return E(async()=>{u.value=!0,b.value=[];try{let g;if(o.oid)g=await mt(o.oid,i.value,r.value,f.value);else if(p.value)g=await _t(p.value.id,i.value,r.value,f.value);else return;b.value=g.data,i.value=g.page,r.value=g.page_size,l.value=g.total}finally{u.value=!1}}),(g,C)=>{const z=P("router-link");return c(),$("div",Ca,[n(Z,null,{default:d(()=>[e("li",null,[n(z,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(a)("Administration")),1)]),_:1})]),t(h)?(c(),$("li",Aa,[n(z,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(h).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",Da,s(t(a)("Reuses")),1)])]),_:1}),e("h1",Sa,s(t(a)("Reuses")),1),e("h2",Ra,s(t(a)("{n} reuses of your organization",b.value.length)),1),u.value||l.value>0?(c(),D(ka,{key:0,reuses:b.value,loading:u.value,sortDirection:m.value,sortedBy:_.value,onSort:w},null,8,["reuses","loading","sortDirection","sortedBy"])):(c(),D(G,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:d(()=>[e("div",Ta,[e("img",{src:t(za),alt:"",loading:"lazy"},null,8,Oa),e("p",Ba,s(t(a)("You haven't published a reuse yet")),1),n(ge,{type:"reuse"})])]),_:1})),l.value>r.value?(c(),D(t(le),{key:2,page:i.value,"page-size":r.value,"total-results":l.value,onChange:C[0]||(C[0]=R=>i.value=R)},null,8,["page","page-size","total-results"])):A("",!0)])}}}),Ma={class:"fr-breadcrumb__link","aria-current":"page"},xa={key:0,class:"fr-h1"},Ia={class:"fr-alert fr-alert--info"},La={class:"fr-alert__title"},ja={href:"/admin/me/"},Pa=T({__name:"Me",setup(v){const{t:a}=M(),o=de();return(b,u)=>{const i=P("router-link");return c(),$("div",null,[n(Z,null,{default:d(()=>[e("li",null,[n(i,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(a)("Administration")),1)]),_:1})]),e("li",null,[e("a",Ma,s(t(a)("Me")),1)])]),_:1}),t(o)?(c(),$("h1",xa,s(t(o).first_name)+" "+s(t(o).last_name),1)):A("",!0),e("div",Ia,[e("h3",La,s(t(a)("This is a WIP page")),1),e("p",null,[e("a",ja,s(t(a)("You can edit your profil on the current admin.")),1)])])])}}}),Ie='<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5 12V18C5 18 5 21 12 21C19 21 19 18 19 18V12" stroke="currentColor" stroke-width="1.5"/>\n<path d="M5 6V12C5 12 5 15 12 15C19 15 19 12 19 12V6" stroke="currentColor" stroke-width="1.5"/>\n<path d="M12 3C19 3 19 6 19 6C19 6 19 9 12 9C5 9 5 6 5 6C5 6 5 3 12 3Z" stroke="currentColor" stroke-width="1.5"/>\n</svg>\n',qa={class:"fr-sidemenu__item"},Ua=["innerHTML"],Ha=T({__name:"AdminSidebarLink",props:{label:{},icon:{},iconHtml:{},to:{}},setup(v){return(a,o)=>{const b=P("router-link");return c(),$("li",qa,[e("div",{class:W([{"fr-icon-svg fr-icon--sm":a.iconHtml},"fr-enlarge-link fr-sidemenu__link fr-mb-1w"])},[a.iconHtml?(c(),$("div",{key:0,class:"fr-mr-1w fr-grid-row",innerHTML:a.iconHtml},null,8,Ua)):a.icon?(c(),$("div",{key:1,class:W([a.icon,"fr-mr-1w fr-icon--sm"]),"aria-hidden":"true"},null,2)):A("",!0),n(b,{to:a.to},{default:d(()=>[n(t(V),{text:a.label,"auto-resize":!0,"max-lines":1},null,8,["text"])]),_:1},8,["to"])],2)])}}});const U=ee(Ha,[["__scopeId","data-v-239d0721"]]),Va=["aria-expanded","aria-controls","aria-current"],Ea={class:"fr-mx-1w"},Ya={class:"logo logo--sm"},Wa={class:"fr-mx-1w fr-col text-overflow-ellipsis"},Na=["id"],Fa={class:"fr-sidemenu__list fr-mx-1w fr-my-3v"},Ga=T({__name:"AdminSidebarMenu",props:{user:{},organization:{},isOpened:{type:Boolean}},emits:["open","click"],setup(v){const a=v,{t:o}=M(),b=K("menu");function u(i,r){const l=document.getElementById(b);r(l)&&(i?r(l).collapse.disclose():r(l).collapse.conceal())}return Ke(()=>{setTimeout(()=>{u(a.isOpened,globalThis.dsfr)},200)}),(i,r)=>(c(),$("li",{class:W(["fr-sidemenu__item",{"fr-sidemenu__item--active":i.isOpened}])},[e("button",{class:"fr-sidemenu__btn","aria-expanded":i.isOpened,"aria-controls":t(b),"aria-current":i.isOpened,onClick:r[0]||(r[0]=l=>i.$emit("open"))},[i.user?(c(),$(I,{key:0},[i.user?(c(),D(t(pe),{key:0,user:i.user,size:24,rounded:!0},null,8,["user"])):A("",!0),e("p",Ea,s(t(o)("My Profile")),1)],64)):i.organization?(c(),$(I,{key:1},[e("div",Ya,[n(pt,{type:"organization",src:i.organization.logo_thumbnail,size:20},null,8,["src"])]),e("p",Wa,s(i.organization.name),1)],64)):A("",!0)],8,Va),e("div",{class:"fr-collapse","data-fr-js-collapse":"",id:t(b)},[e("ul",Fa,[i.user?(c(),$(I,{key:0},[n(U,{icon:"fr-icon-account-circle-line",label:t(o)("Me"),to:{name:"me"}},null,8,["label"]),n(U,{iconHtml:t(Ie),label:t(o)("Datasets"),to:{name:"me-datasets"}},null,8,["iconHtml","label"]),n(U,{icon:"fr-icon-code-s-slash-line",label:t(o)("Dataservices"),to:{name:"me-dataservices"}},null,8,["label"]),n(U,{icon:"fr-icon-line-chart-line",label:t(o)("Reuses"),to:{name:"me-reuses"}},null,8,["label"]),n(U,{icon:"fr-icon-git-pull-request-line",label:t(o)("Community Resources"),to:{name:"me-community-resources"}},null,8,["label"])],64)):i.organization?(c(),$(I,{key:1},[n(U,{iconHtml:t(Ie),label:t(o)("Datasets"),to:{name:"organization-datasets",params:{oid:i.organization.id}},onClick:r[1]||(r[1]=l=>i.$emit("click"))},null,8,["iconHtml","label","to"]),n(U,{icon:"fr-icon-code-s-slash-line",label:t(o)("Dataservices"),to:{name:"organization-dataservices",params:{oid:i.organization.id}},onClick:r[2]||(r[2]=l=>i.$emit("click"))},null,8,["label","to"]),n(U,{icon:"fr-icon-line-chart-line",label:t(o)("Reuses"),to:{name:"organization-reuses",params:{oid:i.organization.id}},onClick:r[3]||(r[3]=l=>i.$emit("click"))},null,8,["label","to"]),n(U,{icon:"fr-icon-chat-3-line",label:t(o)("Discussions"),to:{name:"organization-discussions",params:{oid:i.organization.id}},onClick:r[4]||(r[4]=l=>i.$emit("click"))},null,8,["label","to"]),n(U,{icon:"fr-icon-parent-line",label:t(o)("Members"),to:{name:"organization-members",params:{oid:i.organization.id}},onClick:r[5]||(r[5]=l=>i.$emit("click"))},null,8,["label","to"]),n(U,{icon:"fr-icon-server-line",label:t(o)("Harvesters"),to:{name:"organization-harvesters",params:{oid:i.organization.id}},onClick:r[6]||(r[6]=l=>i.$emit("click"))},null,8,["label","to"]),n(U,{icon:"fr-icon-git-pull-request-line",label:t(o)("Community Resources"),to:{name:"organization-community-resources",params:{oid:i.organization.id}},onClick:r[7]||(r[7]=l=>i.$emit("click"))},null,8,["label","to"]),n(U,{icon:"fr-icon-user-line",label:t(o)("Profile"),to:{name:"organization-profile",params:{oid:i.organization.id}},onClick:r[8]||(r[8]=l=>i.$emit("click"))},null,8,["label","to"])],64)):A("",!0)])],8,Na)],2))}});const Le=ee(Ga,[["__scopeId","data-v-130fdfda"]]),Za={class:"fr-container--fluid h-100"},Ja={class:"fr-grid-row h-100 bg-grey-50"},Ka={class:"fr-col-12 fr-col-md-4 fr-col-lg-3 fr-col-xl-2"},Xa=["aria-label"],Qa={class:"fr-sidemenu__inner"},eo=["aria-controls"],to=["id"],so={class:"fr-sidemenu__list"},ao={class:"fr-col-12 fr-col-md-8 fr-col-lg-9 fr-col-xl-10 h-100 fr-px-2w overflow-auto"},oo=T({__name:"Admin",setup(v){const{t:a}=M(),o=vt(),b=K("menu"),u=k(null),i=k(),{setCurrentOrganization:r}=J(),l=Pe();function _(f){return f===i.value}function m(f){i.value=f.id}return ue(async()=>{var f,h;if(u.value=await bt(),o.name||(u.value.organizations.length>0?l.replace({name:"organization-datasets",params:{oid:u.value.organizations[0].id}}):l.replace({name:"me"})),o.name==="me")i.value=(f=oe)==null?void 0:f.id;else if(u.value.organizations.length>0){let p=u.value.organizations[0];o.params.oid&&(p=(h=u.value.organizations.find(w=>w.id===o.params.oid))!=null?h:p),m(p),r(p)}}),(f,h)=>{const p=P("router-view");return c(),$("div",Za,[e("div",Ja,[e("div",Ka,[e("nav",{class:"fr-sidemenu fr-pr-0","aria-label":t(a)("Administration menu")},[e("div",Qa,[e("button",{class:"fr-sidemenu__btn",hidden:"","aria-controls":t(b),"aria-expanded":"false"},s(t(a)("Open menu")),9,eo),e("div",{class:"fr-collapse",id:t(b)},[e("ul",so,[t(oe)?(c(),D(Le,{key:0,user:t(oe),"is-opened":_(t(oe).id),onOpen:h[0]||(h[0]=w=>m(t(oe)))},null,8,["user","is-opened"])):A("",!0),u.value?(c(!0),$(I,{key:1},F(u.value.organizations,w=>(c(),D(Le,{organization:w,"is-opened":_(w.id),onOpen:()=>m(w),onClick:()=>t(r)(w)},null,8,["organization","is-opened","onOpen","onClick"]))),256)):A("",!0)])],8,to)])],8,Xa)]),e("div",ao,[(c(),D(p,{key:t(o).fullPath,class:"fr-container--fluid"}))])])])}}});const lo=ee(oo,[["__scopeId","data-v-4869f570"]]),no=["aria-labelledby","id"],ro={class:"fr-container fr-container--fluid fr-container-md"},io={class:"fr-grid-row fr-grid-row--center"},uo={class:"fr-col-12 fr-col-md-8"},co={class:"fr-modal__body"},fo={class:"fr-modal__header"},mo=["title","aria-controls"],_o={class:"fr-modal__content"},po=["id"],vo={class:"fr-modal__footer"},bo={class:"fr-btns-group fr-btns-group--right fr-btns-group--sm fr-btns-group--inline-lg fr-btns-group--icon-left"},go=["disabled"],ho=["disabled"],yo=T({__name:"AdminAddMemberModal",props:{id:{},oid:{},roles:{}},emits:["memberAdded"],setup(v,{emit:a}){const o=v,b=a,{t:u}=M(),{toast:i}=ve(),r=k(!1),l=k(),_=k("editor"),m=B(()=>"fr-modal-title-user-"+o.id);async function f(){try{r.value=!0,l.value&&(await ht(o.oid,l.value,_.value),b("memberAdded"),p())}catch(w){i.error(u("An error occurred while update member role."))}finally{r.value=!1}}function h(w){return w.map(g=>{var z;const C={...g,avatar_thumbnail:(z=g.avatar_url)!=null?z:void 0};return{value:C.id,label:C.first_name+" "+C.last_name,image:yt(C,32)}})}function p(){r.value=!1,l.value=void 0,_.value="editor";const w=document.getElementById(o.id);globalThis.dsfr(w).modal.conceal()}return(w,g)=>(c(),D(_e,{to:"body"},[e("dialog",{"aria-labelledby":m.value,role:"dialog",id:w.id,class:"fr-modal"},[e("div",ro,[e("div",io,[e("div",uo,[e("div",co,[e("div",fo,[e("button",{class:"fr-btn--close fr-btn",title:t(u)("Close the modal dialog"),"aria-controls":w.id},s(t(u)("Close")),9,mo)]),e("form",{onSubmit:me(f,["prevent"])},[e("div",_o,[e("h1",{id:m.value,class:"fr-modal__title fr-mb-2w"},s(t(u)("Add member to the organization")),9,po),n(gt,{placeholder:w.$t("Search a user"),searchPlaceholder:w.$t("Search a user..."),suggestUrl:"/users/suggest/",values:l.value,onChange:g[0]||(g[0]=C=>l.value=C),allOption:w.$t("Select a user"),addAllOption:!1,onSuggest:h,roundedImages:!0},null,8,["placeholder","searchPlaceholder","values","allOption"]),w.roles.length>0?(c(),D(qe,{key:0,label:t(u)("Role of the member"),"model-value":_.value,"onUpdate:modelValue":g[1]||(g[1]=C=>_.value=C),options:w.roles},null,8,["label","model-value","options"])):A("",!0)]),e("div",vo,[e("div",bo,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"button",onClick:p,disabled:r.value},s(t(u)("Cancel")),9,go),e("button",{class:"fr-btn",type:"submit",disabled:r.value},s(t(u)("Add to the organization")),9,ho)])])],32)])])])])],8,no)]))}}),$o=["aria-controls"],wo=T({__name:"AdminAddMemberButton",props:{oid:{},roles:{}},emits:["memberAdded"],setup(v){const a=v,{t:o}=M(),b=B(()=>"fr-modal-add-user-"+a.oid);return(u,i)=>(c(),$(I,null,[e("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-icon-add-line","data-fr-opened":"false","aria-controls":b.value},s(t(o)("Add member")),9,$o),n(yo,{id:b.value,oid:u.oid,roles:u.roles,onMemberAdded:i[0]||(i[0]=r=>u.$emit("memberAdded"))},null,8,["id","oid","roles"])],64))}}),ko={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Ye=T({__name:"AdminDangerZone",setup(v){return(a,o)=>(c(),D(t($t),{color:"error",type:"secondary",weight:"regular"},{default:d(()=>[e("div",ko,[N(a.$slots,"default")])]),_:3}))}}),zo={class:"fr-px-1v rounded-2 monospace fr-text--sm text-mention-grey bg-grey-100 fr-m-0"},We=T({__name:"AdminEmail",props:{email:{}},setup(v){return(a,o)=>(c(),$("p",zo,s(a.email),1))}}),Co=["aria-labelledby","id"],Ao={class:"fr-container fr-container--fluid fr-container-md"},Do={class:"fr-grid-row fr-grid-row--center"},So={class:"fr-col-12 fr-col-md-8"},Ro={class:"fr-modal__body"},To={class:"fr-modal__header"},Oo=["title","aria-controls"],Bo={class:"fr-modal__content"},Mo=["id"],xo={class:"fr-grid-row fr-grid-row--middle fr-mb-2w"},Io={class:"fr-text--bold fr-m-0 fr-mr-1v"},Lo={class:"fr-col"},jo={class:"fr-col-auto"},Po=["disabled"],qo={class:"fr-col"},Uo={class:"fr-m-0 text-grey-500"},Ho={class:"fr-m-0 fr-text--xs text-default-error"},Vo={class:"fr-col-auto"},Eo=["disabled"],Yo=T({__name:"AdminEditMemberModal",props:{id:{},member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(v,{emit:a}){const o=v,b=a,u=B(()=>"fr-modal-title-user-"+o.id),{t:i}=M(),{toast:r}=ve(),l=k(!1);async function _(p){if(!p.newRole){h();return}try{l.value=!0,await wt(o.oid,p.user.id,p.newRole),b("memberUpdated"),h()}catch(w){r.error(i("An error occurred while update member role."))}finally{l.value=!1}}async function m(p){try{l.value=!0,await kt(o.oid,p.user.id),b("memberUpdated")}catch(w){r.error(i("An error occurred while removing this member."))}finally{l.value=!1}}function f(p){return o.roles.map(w=>{const g={...w};return g.value===p&&(g.selected=!0),g})}function h(){l.value=!1;const p=document.getElementById(o.id);globalThis.dsfr(p).modal.conceal()}return(p,w)=>(c(),D(_e,{to:"body"},[e("dialog",{"aria-labelledby":u.value,role:"dialog",id:p.id,class:"fr-modal"},[e("div",Ao,[e("div",Do,[e("div",So,[e("div",Ro,[e("div",To,[e("button",{class:"fr-btn--close fr-btn",title:t(i)("Close the modal dialog"),"aria-controls":p.id},s(t(i)("Close")),9,Oo)]),e("div",Bo,[e("h1",{id:u.value,class:"fr-modal__title fr-mb-2w"},s(t(i)("Edit member")),9,Mo),e("div",xo,[n(t(pe),{class:"fr-mr-1v",user:p.member.user,rounded:!0,size:24},null,8,["user"]),e("p",Io,s(p.member.user.first_name)+" "+s(p.member.user.last_name),1),p.member.user.email?(c(),D(We,{key:0,email:p.member.user.email},null,8,["email"])):A("",!0)]),e("form",{class:"fr-grid-row fr-grid-row--gutters fr-grid-row--bottom",onSubmit:w[1]||(w[1]=me(g=>_(p.member),["prevent"]))},[e("div",Lo,[p.roles.length>0?(c(),D(qe,{key:0,label:t(i)("Role of the member"),"model-value":p.member.role,"onUpdate:modelValue":w[0]||(w[0]=g=>p.member.newRole=g),options:f(p.member.role)},null,8,["label","model-value","options"])):A("",!0)]),e("div",jo,[e("button",{class:"fr-btn",type:"submit",disabled:l.value},s(t(i)("Validate")),9,Po)])],32),n(Ye,{class:"fr-mt-2w"},{default:d(()=>[e("div",qo,[e("p",Uo,s(t(i)("Remove member from the organization")),1),e("p",Ho,s(t(i)("Be careful, this action can't be reverse.")),1)]),e("div",Vo,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-logout-box-r-line",disabled:l.value,onClick:w[2]||(w[2]=g=>m(p.member))},s(t(i)("Remove member")),9,Eo)])]),_:1})])])])])])],8,Co)]))}}),Wo=["aria-controls"],No=T({__name:"AdminEditMemberButton",props:{member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(v){const a=v,{t:o}=M(),b=B(()=>"fr-modal-user-"+a.member.user.id);return(u,i)=>(c(),$(I,null,[e("button",{class:"fr-btn fr-btn--sm fr-btn--secondary-grey-500 fr-btn--tertiary-no-outline fr-icon-pencil-line","data-fr-opened":"false","aria-controls":b.value},s(t(o)("Edit")),9,Wo),n(Yo,{id:b.value,member:u.member,oid:u.oid,roles:u.roles,onMemberUpdated:i[0]||(i[0]=r=>u.$emit("memberUpdated"))},null,8,["id","member","oid","roles"])],64))}}),Fo={class:"fr-mt-n9v fr-mb-2w"},Go={class:"fr-badge fr-badge--info fr-badge--no-icon"},Zo={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Jo={class:"fr-col"},Ko={class:"fr-grid-row fr-grid-row--middle"},Xo={class:"fr-text--bold fr-m-0 fr-mr-1v"},Qo={class:"fr-m-0"},el={class:"fr-ml-3v fr-mt-1-5v fr-mb-0 filet filet-default-grey fr-text--sm"},tl={key:0,class:"fr-col-auto fr-grid-row flex-direction-column"},sl=["disabled"],al=["disabled","aria-controls"],ol=["aria-labelledby","id"],ll={class:"fr-container fr-container--fluid fr-container-md"},nl={class:"fr-grid-row fr-grid-row--center"},rl={class:"fr-col-12 fr-col-md-8"},il={class:"fr-modal__body"},ul={class:"fr-modal__header"},dl=["title","aria-controls"],cl={class:"fr-modal__content"},fl=["id"],ml={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--right"},_l={class:"fr-col-auto"},pl=["disabled"],vl={class:"fr-col-auto"},bl=["disabled"],gl=T({__name:"AdminMembershipRequest",props:{loading:{type:Boolean},oid:{},request:{},showActions:{type:Boolean}},emits:["accept","refuse"],setup(v,{emit:a}){const o=v,b=a,{t:u}=M(),i=k(""),r=K("modal"),l=K("modalTitle");function _(){const h=document.getElementById(r);globalThis.dsfr(h).modal.conceal()}function m(){b("refuse",o.request.id,i.value),_()}function f(){i.value="",_()}return(h,p)=>{const w=P("AdminMembershipRequest",!0);return c(),D(G,{class:"drop-shadow rounded-xxs fr-mt-3w"},{default:d(()=>[e("div",Fo,[e("p",Go,[p[2]||(p[2]=e("span",{class:"fr-icon-user-add-line fr-icon--sm","aria-hidden":"true"},null,-1)),y(" "+s(t(u)("Membership Request")),1)])]),e("div",Zo,[e("div",Jo,[e("div",Ko,[n(t(pe),{class:"fr-mr-1v",user:h.request.user,rounded:!0,size:24},null,8,["user"]),e("p",Xo,s(h.request.user.first_name)+" "+s(h.request.user.last_name),1),h.request.user.email?(c(),D(We,{key:0,email:h.request.user.email,class:"fr-mr-1v"},null,8,["email"])):A("",!0),e("p",Qo,s(t(u)("asks to join the organization.")),1)]),e("div",el,s(h.request.comment),1)]),h.showActions?(c(),$("div",tl,[e("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-mb-1w fr-icon-check-line",onClick:p[0]||(p[0]=g=>h.$emit("accept",h.request.id)),disabled:h.loading,"data-testid":"accept"},s(t(u)("Accept request")),9,sl),e("button",{class:"fr-btn fr-btn--icon-left fr-btn--sm fr-btn--secondary fr-btn--secondary--error fr-icon-close-line",disabled:h.loading,"data-fr-opened":"false","aria-controls":t(r),"data-testid":"refuse"},s(t(u)("Refuse")),9,al),(c(),D(_e,{to:"body"},[e("dialog",{"aria-labelledby":t(l),role:"dialog",id:t(r),class:"fr-modal","data-testid":"modal"},[e("div",ll,[e("div",nl,[e("div",rl,[e("div",il,[e("div",ul,[e("button",{class:"fr-btn--close fr-btn",title:t(u)("Close the modal dialog"),"aria-controls":t(r),onClick:me(f,["prevent"])},s(t(u)("Close")),9,dl)]),e("div",cl,[e("h1",{id:t(l),class:"fr-modal__title fr-mb-2w"},s(t(u)("Refuse membership request")),9,fl),n(w,{class:"fr-mt-4w fr-mb-2w",loading:!1,oid:h.oid,request:h.request,"show-actions":!1},null,8,["oid","request"]),e("form",{onSubmit:me(m,["prevent"]),onReset:f},[n(zt,{label:t(u)("You can provide the refusal reason:"),modelValue:i.value,"onUpdate:modelValue":p[1]||(p[1]=g=>i.value=g),"data-testid":"comment-group"},null,8,["label","modelValue"]),e("div",ml,[e("div",_l,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"reset",disabled:h.loading,"data-testid":"cancel-modal-button"},s(t(u)("Cancel")),9,pl)]),e("div",vl,[e("button",{class:"fr-btn",type:"submit",disabled:h.loading,"data-testid":"refuse-modal-button"},s(t(u)("Refuse request")),9,bl)])])],32)])])])])])],8,ol)]))])):A("",!0)])]),_:1})}}}),hl={key:0},yl={class:"fr-breadcrumb__link","aria-current":"page"},$l={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-center"},wl={class:"fr-col-12 fr-col-md"},kl={class:"fr-h3 fr-mb-0"},zl={key:0,class:"fr-col-auto"},Cl={class:"subtitle subtitle--uppercase fr-mt-5v fr-mb-0"},Al={class:"fr-text--bold fr-m-0"},Dl={class:"fr-m-0 fr-text--xs text-mention-grey f-italic inline-flex items-center"},Sl={key:0},Rl={key:1},Tl={key:0},Ol=T({__name:"Members",props:{oid:{}},setup(v){const a=v;we(Ct);const{t:o}=M(),{toast:b}=ve(),u=k([]),i=B(()=>At||_.value.some(z=>{var R;return z.user.id===((R=oe)==null?void 0:R.id)&&z.role==="admin"})),r=k([]),{currentOrganization:l}=J(),_=k([]),m=k(!1);function f(z){var R,O;return(O=(R=r.value.find(X=>X.value===z))==null?void 0:R.label)!=null?O:z}function h(z){return z==="admin"?"info":"default"}async function p(){m.value=!0,_.value=[];try{const z=await Ue(a.oid);_.value=z.members}finally{m.value=!1}}async function w(){const z=await Se(a.oid);u.value=z}async function g(z){m.value=!0;const R=[];try{await Tt(a.oid,z),R.push(w()),R.push(p())}catch(O){b.error(o("An error occurred while accepting this membership."))}finally{Promise.all(R).finally(()=>m.value=!1)}}async function C(z,R){m.value=!0;const O=[];try{await Ot(a.oid,z,R),O.push(w()),O.push(p())}catch(X){b.error(o("An error occurred while refusing this membership."))}finally{Promise.all(O).finally(()=>m.value=!1)}}return E(()=>{i.value&&Se(a.oid).then(z=>u.value=z)}),ue(()=>{Dt().then(St).then(z=>r.value=z),p()}),(z,R)=>{const O=P("router-link"),X=P("TextClamp");return c(),$("div",null,[n(Z,null,{default:d(()=>[e("li",null,[n(O,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(o)("Administration")),1)]),_:1})]),t(l)?(c(),$("li",hl,[n(O,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(l).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",yl,s(t(o)("Members")),1)])]),_:1}),e("div",$l,[e("div",wl,[e("h1",kl,s(t(o)("Members")),1)]),i.value?(c(),$("div",zl,[n(wo,{oid:z.oid,roles:r.value,onMemberAdded:p},null,8,["oid","roles"])])):A("",!0)]),u.value.length?(c(),$(I,{key:0},[e("h2",Cl,s(t(o)("{n} requests",{n:u.value.length})),1),(c(!0),$(I,null,F(u.value,j=>(c(),D(gl,{class:"fr-mb-4w",key:j.id,loading:m.value,oid:z.oid,request:j,"show-actions":!0,onAccept:g,onRefuse:C},null,8,["loading","oid","request"]))),128))],64)):A("",!0),e("h2",{class:W(["subtitle subtitle--uppercase fr-mb-0",{"fr-mt-n3v":u.value.length,"fr-mt-5v":!u.value.length}])},s(t(o)("{n} members",{n:_.value.length})),3),n(se,{class:"fr-table--layout-fixed",loading:m.value},{default:d(()=>[e("thead",null,[e("tr",null,[n(S,{scope:"col"},{default:d(()=>[y(s(t(o)("Members")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(s(t(o)("Status")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(s(t(o)("Member since")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(s(t(o)("Last connection")),1)]),_:1}),i.value?(c(),D(S,{key:0,scope:"col"},{default:d(()=>[y(s(t(o)("Action")),1)]),_:1})):A("",!0)])]),e("tbody",null,[(c(!0),$(I,null,F(_.value,j=>(c(),$("tr",{key:j.user.id},[e("td",null,[e("p",Al,s(j.user.first_name)+" "+s(j.user.last_name),1),e("p",Dl,[n(t(ke),{height:12,width:12,name:"ri-mail-line"}),n(Y,null,{default:d(()=>[n(X,{class:"fr-px-1v",text:j.user.email,"auto-resize":!0,"max-lines":1},null,8,["text"])]),_:2},1024)])]),e("td",null,[n(Q,{type:h(j.role)},{default:d(()=>[y(s(f(j.role)),1)]),_:2},1032,["type"])]),e("td",null,s(t(q)(j.since)),1),e("td",null,[j.user.last_login_at?(c(),$("span",Sl,s(t(Rt)(j.user.last_login_at)),1)):(c(),$("span",Rl,s(t(o)("No connection")),1))]),i.value?(c(),$("td",Tl,[n(No,{member:j,oid:z.oid,roles:r.value,onMemberUpdated:p},null,8,["member","oid","roles"])])):A("",!0)]))),128))])]),_:1},8,["loading"])])}}}),Bl={class:"fr-container--fluid"},Ml={key:0},xl={class:"fr-breadcrumb__link","aria-current":"page"},Il={class:"fr-h3 fr-mb-5v"},Ll={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-between"},jl={class:"fr-col-12 fr-col-md fr-grid-row fr-grid-row--middle"},Pl={class:"fr-ml-3v fr-my-0 fr-h3"},ql=["title"],Ul={class:"fr-col-auto"},Hl=["href"],Vl=["id"],El=["disabled","onClick"],Yl={class:"fr-col"},Wl={class:"fr-m-0 text-grey-500"},Nl={class:"fr-m-0 fr-text--xs text-default-error"},Fl={class:"fr-col-auto"},Gl=["disabled","aria-controls"],Zl=["aria-labelledby","id"],Jl={class:"fr-container fr-container--fluid fr-container-md"},Kl={class:"fr-grid-row fr-grid-row--center"},Xl={class:"fr-col-12 fr-col-md-8"},Ql={class:"fr-modal__body"},en={class:"fr-modal__header"},tn=["title","aria-controls"],sn={class:"fr-modal__content"},an=["id"],on={class:"fr-text--bold"},ln={class:"fr-modal__footer"},nn={class:"fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left"},rn=["disabled"],un=T({__name:"Profile",props:{oid:{}},setup(v){const{t:a}=M(),{toast:o}=ve(),b=v,u=Pe(),i=k(null),{currentOrganization:r}=J(),l=k(null),{organizationCertified:_}=Bt(l),m=k([]),f=k(!1),h=K("modal"),p=K("modalTitle");function w(){r.value&&(f.value=!0,It(r.value.id).then(()=>{u.replace("/"),window.location.reload()}).catch(()=>o.error(a("An error occured when deleting the organization."))).finally(()=>f.value=!1))}async function g(C,z){f.value=!0;try{l.value=await Lt(C),o.success(a("Organization updated !"))}catch(R){o.error(a("An error occured when updating the organization."))}finally{f.value=!1}if(z&&l.value){f.value=!0;try{const R=await jt(l.value.id,z);l.value.logo_thumbnail=R.image}catch(R){o.error(a("Failed to upload logo, you can upload it again in your management panel"))}finally{f.value=!1}}}return ue(async()=>{f.value=!0;try{l.value=await Ue(b.oid)}finally{f.value=!1}}),(C,z)=>{const R=P("router-link");return c(),$("div",Bl,[n(Z,null,{default:d(()=>[e("li",null,[n(R,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(a)("Administration")),1)]),_:1})]),t(r)?(c(),$("li",Ml,[n(R,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(r).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",xl,s(t(a)("Profile")),1)])]),_:1}),e("h1",Il,s(t(a)("Profile")),1),l.value?(c(),D(G,{key:0,class:"fr-mb-5v"},{default:d(()=>[e("div",Ll,[e("div",jl,[n(t(Mt),{src:l.value.logo,type:"organization",size:80,class:"rounded-xxs border"},null,8,["src"]),e("div",Pl,[y(s(l.value.name)+" ",1),t(_)?(c(),$("span",{key:0,class:"fr-icon-success-line fr-icon--lg text-blue-400",title:t(a)("The identity of this public service is certified by {certifier}",{certifier:t(ze)}),"aria-hidden":"true"},null,8,ql)):A("",!0)])]),e("div",Ul,[e("a",{href:l.value.page,class:"fr-btn fr-btn--sm fr-btn--secondary fr-btn--secondary-grey-500 fr-btn--icon-left fr-icon-eye-line"},s(t(a)("See the organization page")),9,Hl)])])]),_:1})):A("",!0),i.value?(c(),$("h2",{key:1,class:"subtitle subtitle--uppercase fr-mb-5v",id:i.value.legend},s(t(a)("Edit profile")),9,Vl)):A("",!0),f.value&&!l.value?(c(),D(Ee,{key:2})):A("",!0),l.value?(c(),D(xt,{key:3,organization:l.value,errors:m.value,showLegend:!1,showWell:!1,ref_key:"form",ref:i,onSubmit:g},{submitButton:d(({submit:O})=>[e("button",{class:"fr-btn fr-btn--icon-left fr-icon-save-line",disabled:f.value,"data-testid":"submitButton",onClick:O},s(t(a)("Save")),9,El)]),default:d(()=>[n(Ye,{class:"fr-mt-6w"},{default:d(()=>[e("div",Yl,[e("p",Wl,s(t(a)("Delete the organization")),1),e("p",Nl,s(t(a)("Be careful, this action can't be reverse.")),1)]),e("div",Fl,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-delete-line",disabled:f.value,"data-fr-opened":"false","aria-controls":t(h)},s(t(a)("Delete")),9,Gl),(c(),D(_e,{to:"body"},[e("dialog",{"aria-labelledby":t(p),role:"dialog",id:t(h),class:"fr-modal"},[e("div",Jl,[e("div",Kl,[e("div",Xl,[e("div",Ql,[e("div",en,[e("button",{class:"fr-btn--close fr-btn",title:t(a)("Close the modal dialog"),"aria-controls":t(h)},s(t(a)("Close")),9,tn)]),e("div",sn,[e("h1",{id:t(p),class:"fr-modal__title fr-mb-2w"},s(t(a)("Are you sure you want to delete this organization ?")),9,an),e("p",on,s(t(a)("This action can't be reverse.")),1),e("p",null,s(t(a)("All content published with this organization will stay online, with the same URL but in an anonymous form, i.e. without being linked to a data producer.")),1),e("p",null,s(t(a)("If you want to delete your published content too, start by deleting the contents before deleting your account.")),1)]),e("div",ln,[e("div",nn,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error",role:"button",disabled:f.value,onClick:w},s(t(a)("Delete")),9,rn)])])])])])])],8,Zl)]))])]),_:1})]),_:1},8,["organization","errors"])):A("",!0)])}}});async function dn(v){return(await be.get("posts/".concat(v,"/"))).data}we(Ht,Ut,qt,Pt);async function cn(v,a,o,b){return(await be.get(He("discussions/"),{params:{org:v,sort:b,page_size:o,page:a}})).data}async function fn(v){switch(v.class){case"Dataservice":return Yt(v.id);case"Dataset":return Et(v.id);case"Post":return dn(v.id);case"Reuse":return Vt(v.id);default:return null}}function mn(v,a){return v===null?null:{title:_n(v),icon:vn(a),page:pn(v)}}function _n(v){return v===null?"":"title"in v?v.title:"headline"in v?v.headline:Ve(v,"Unknown type ".concat(v))}function pn(v){return v===null?"":"page"in v?v.page:"self_web_url"in v?v.self_web_url:Ve(v,"Unknown type ".concat(v))}function vn(v){switch(v){case"Dataservice":return"ri-terminal-line";case"Dataset":return"ri-database-2-line";case"Post":return"ri-article-line";case"Reuse":return"ri-line-chart-line";default:return""}}const bn={class:"fr-text--bold"},gn={key:0},hn=["href"],yn={class:"inline-flex items-center"},$n=["href"],wn=T({__name:"AdminDiscussionsTable",props:{discussions:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(v){const a=v,{t:o}=M(),b=k({}),u=k({});E(async()=>{for(const _ of a.discussions)if(!(_.subject.id in b.value)){const m=fn(_.subject);b.value[_.subject.id]=m;const f=await b.value[_.subject.id];u.value[_.subject.id]=mn(f,_.subject.class)}});function i(_,m){return m?m.page+"#/discussions/"+_:""}function r(_){return a.sortedBy===_?a.sortDirection:null}function l(_){return _.discussion.slice(-1)[0]}return(_,m)=>(c(),D(se,{class:"fr-table--layout-fixed",loading:_.loading},{default:d(()=>[e("thead",null,[n(S,{onSort:m[0]||(m[0]=f=>_.$emit("sort","title",f)),sorted:r("title"),scope:"col"},{default:d(()=>[y(s(t(o)("Discussion")),1)]),_:1},8,["sorted"]),n(S,{scope:"col"},{default:d(()=>[y(s(t(o)("Number of comments")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(s(t(o)("Last comment")),1)]),_:1}),n(S,{onSort:m[1]||(m[1]=f=>_.$emit("sort","closed",f)),sorted:r("closed"),scope:"col"},{default:d(()=>[y(s(t(o)("Closed at")),1)]),_:1},8,["sorted"]),n(S,{scope:"col",style:{width:"25%"}},{default:d(()=>[y(s(t(o)("Link to the discussion")),1)]),_:1})]),e("tbody",null,[(c(!0),$(I,null,F(_.discussions,f=>{var h,p,w;return c(),$("tr",null,[e("td",null,[e("p",bn,[n(t(V),{text:f.title,"auto-resize":!0,"max-lines":1},null,8,["text"])]),u.value[f.subject.id]?(c(),$("p",gn,[e("a",{class:"fr-link inline-flex",href:(h=u.value[f.subject.id])==null?void 0:h.page},[n(t(ke),{height:12,class:"self-center",name:(p=u.value[f.subject.id])==null?void 0:p.icon},null,8,["name"]),n(t(V),{class:"overflow-wrap-anywhere",text:(w=u.value[f.subject.id])==null?void 0:w.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,hn)])):A("",!0)]),e("td",null,s(f.discussion.length),1),e("td",null,[e("div",null,[e("p",null,s(t(q)(l(f).posted_on)),1),e("p",yn,[y(s(t(o)("by "))+" ",1),n(t(ls),{class:"fr-ml-1v",user:l(f).posted_by},null,8,["user"])])])]),e("td",null,[f.closed?(c(),$(I,{key:0},[y(s(t(q)(f.closed)),1)],64)):A("",!0)]),e("td",null,[u.value[f.subject.id]?(c(),$("a",{key:0,class:"fr-link inline-flex",href:i(f.id,u.value[f.subject.id]),target:"_blank"},[n(t(V),{text:i(f.id,u.value[f.subject.id]),"auto-resize":!0,"max-lines":1},null,8,["text"])],8,$n)):A("",!0)])])}),256))])]),_:1},8,["loading"]))}}),kn="/_themes/gouvfr/assets/discussion.svg",zn={class:"fr-container--fluid"},Cn={key:0},An={class:"fr-breadcrumb__link","aria-current":"page"},Dn={class:"fr-h3 fr-mb-5v"},Sn={class:"subtitle subtitle--uppercase fr-m-0"},Rn={class:"text-align-center fr-py-1w"},Tn=["src"],On={class:"fr-text--bold fr-my-3v"},Bn=T({__name:"Discussions",props:{oid:{}},setup(v){const{t:a}=M(),o=v,b=k(!1),u=k(1),i=k(10),r=k(0),l=k("created"),_=k("desc"),m=B(()=>"".concat(_.value==="asc"?"":"-").concat(l.value)),f=k([]),{currentOrganization:h}=J();function p(w,g){l.value=w,_.value=g}return E(async()=>{b.value=!0,f.value=[];try{const w=await cn(o.oid,u.value,i.value,m.value);f.value=w.data,u.value=w.page,i.value=w.page_size,r.value=w.total}finally{b.value=!1}}),(w,g)=>{const C=P("router-link");return c(),$("div",zn,[n(Z,null,{default:d(()=>[e("li",null,[n(C,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(a)("Administration")),1)]),_:1})]),t(h)?(c(),$("li",Cn,[n(C,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(h).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",An,s(t(a)("Discussions")),1)])]),_:1}),e("h1",Dn,s(t(a)("Discussions")),1),e("h2",Sn,s(t(a)("{n} discussions",r.value)),1),b.value||r.value>0?(c(),D(wn,{key:0,discussions:f.value,loading:b.value,"sort-direction":_.value,sortedBy:l.value,onSort:p},null,8,["discussions","loading","sort-direction","sortedBy"])):(c(),D(G,{key:1,class:"fr-my-2w"},{default:d(()=>[e("div",Rn,[e("img",{src:t(kn),alt:"",loading:"lazy"},null,8,Tn),e("p",On,s(t(a)("There is no discussion yet")),1)])]),_:1})),r.value>i.value?(c(),D(t(le),{key:2,page:u.value,"page-size":i.value,"total-results":r.value,onChange:g[0]||(g[0]=z=>u.value=z)},null,8,["page","page-size","total-results"])):A("",!0)])}}});async function Mn(v,a,o){return(await be.get(He("harvest/sources/"),{params:{owner:v,deleted:!0,page:a,page_size:o}})).data}const xn="/_themes/gouvfr/assets/harvester.svg",In={class:"fr-container--fluid"},Ln={key:0},jn={class:"fr-breadcrumb__link","aria-current":"page"},Pn={class:"fr-h3 fr-mb-5v"},qn={class:"subtitle subtitle--uppercase fr-m-0"},Un=["href"],Hn={class:"text-align-center fr-py-1w"},Vn=["src"],En={class:"fr-text--bold fr-my-3v"},Yn=T({__name:"Harvesters",props:{oid:{}},setup(v){const{t:a}=M(),o=v,b=k(!1),u=k(1),i=k(10),r=k(0),l=k([]),_=k({}),{currentOrganization:m}=J();function f(g){return"".concat(te,"harvester/").concat(g.id,"/")}function h(g){return!g.last_job||!_.value[g.last_job.id]?0:_.value[g.last_job.id].items.filter(C=>C.dataservice).length}function p(g){return!g.last_job||!_.value[g.last_job.id]?0:_.value[g.last_job.id].items.filter(C=>C.dataset).length}function w(g){var C;switch((C=g.last_job)==null?void 0:C.status){case"pending":return{label:a("Pending"),type:"default"};case"initializing":return{label:a("Initializing"),type:"info"};case"initialized":return{label:a("Initialized"),type:"default"};case"processing":return{label:a("Processing"),type:"info"};case"done":return{label:a("Done"),type:"success"};case"done-errors":return{label:a("Done with errors"),type:"warning"};case"failed":return{label:a("Failed"),type:"error"};default:return{label:a("No job yet"),type:"default"}}}return E(async()=>{var g;b.value=!0,l.value=[];try{const C=await Mn(o.oid,u.value,i.value);l.value=C.data,u.value=C.page,i.value=C.page_size,r.value=C.total;const z=[];for(const O of l.value)(g=O.last_job)!=null&&g.id&&z.push(be.get("harvest/job/".concat(O.last_job.id,"/")));const R=await Promise.allSettled(z);for(const O of R)O.status==="fulfilled"&&(_.value[O.value.data.id]=O.value.data)}finally{b.value=!1}}),(g,C)=>{const z=P("router-link");return c(),$("div",In,[n(Z,null,{default:d(()=>[e("li",null,[n(z,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(a)("Administration")),1)]),_:1})]),t(m)?(c(),$("li",Ln,[n(z,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(m).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",jn,s(t(a)("Harvesters")),1)])]),_:1}),e("h1",Pn,s(t(a)("Harvesters")),1),e("h2",qn,s(t(a)("{n} harvesters",r.value)),1),b.value||r.value?(c(),D(se,{key:0,loading:b.value},{default:d(()=>[e("thead",null,[n(S,{scope:"col"},{default:d(()=>[y(s(t(a)("Name")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(s(t(a)("Status")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(s(t(a)("Created at")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(s(t(a)("Last run")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(s(t(a)("Datasets")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(s(t(a)("Dataservices")),1)]),_:1})]),e("tbody",null,[(c(!0),$(I,null,F(l.value,R=>{var O;return c(),$("tr",null,[e("td",null,[n(ce,null,{default:d(()=>[e("a",{class:"fr-link fr-reset-link",href:f(R)},[n(t(V),{text:R.name,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Un)]),_:2},1024)]),e("td",null,[n(Q,{type:w(R).type},{default:d(()=>[y(s(w(R).label),1)]),_:2},1032,["type"])]),e("td",null,s(t(q)(R.created_at)),1),e("td",null,[(O=R.last_job)!=null&&O.ended?(c(),$(I,{key:0},[y(s(t(q)(R.last_job.ended)),1)],64)):(c(),$(I,{key:1},[y(s(t(a)("Not yet")),1)],64))]),e("td",null,s(p(R)),1),e("td",null,s(h(R)),1)])}),256))])]),_:1},8,["loading"])):(c(),D(G,{key:1,class:"fr-my-2w"},{default:d(()=>[e("div",Hn,[e("img",{src:t(xn),alt:"",loading:"lazy"},null,8,Vn),e("p",En,s(t(a)("There is no harvesters yet")),1),n(ge,{type:"harvester"})])]),_:1})),r.value>i.value?(c(),D(t(le),{key:2,page:u.value,"page-size":i.value,"total-results":r.value,onChange:C[0]||(C[0]=R=>u.value=R)},null,8,["page","page-size","total-results"])):A("",!0)])}}}),Wn=["href"],Nn={key:0},Fn=["href"],Gn={class:"fr-p-1v monospaced bg-grey-100 fr-text--sm text-mention-grey rounded-xxs"},Zn=T({__name:"AdminCommunityResourcesTable",props:{communityResources:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(v){const a=v,{t:o}=M();function b(r){return a.sortedBy===r?a.sortDirection:null}function u(r){return"".concat(te,"dataset/").concat(r.dataset.id,"/community-resource/").concat(r.id,"/")}function i(r){const l=r.extras&&"check:available"in r.extras;return l&&r.extras["check:available"]===!1?{label:o("Unavailable"),type:"error"}:l?{label:o("Available"),type:"info"}:{label:o("Not checked yet"),type:"default"}}return(r,l)=>{const _=P("Vicon");return c(),D(se,{loading:r.loading},{default:d(()=>[e("thead",null,[n(S,{onSort:l[0]||(l[0]=m=>r.$emit("sort","title",m)),sorted:b("title"),scope:"col"},{default:d(()=>[y(s(t(o)("Resource title")),1)]),_:1},8,["sorted"]),n(S,null,{default:d(()=>[y(s(t(o)("Status")),1)]),_:1}),n(S,null,{default:d(()=>[y(s(t(o)("Format")),1)]),_:1}),n(S,{onSort:l[1]||(l[1]=m=>r.$emit("sort","created_at_internal",m)),sorted:b("created_at_internal"),scope:"col"},{default:d(()=>[y(s(t(o)("Created at")),1)]),_:1},8,["sorted"]),n(S,{onSort:l[2]||(l[2]=m=>r.$emit("sort","last_modified_internal",m)),sorted:b("last_modified_internal"),scope:"col"},{default:d(()=>[y(s(t(o)("Modified at")),1)]),_:1},8,["sorted"])]),e("tbody",null,[(c(!0),$(I,null,F(r.communityResources,m=>{var f,h;return c(),$("tr",null,[e("td",null,[n(ce,{class:"fr-text--bold"},{default:d(()=>[e("a",{class:"fr-link fr-reset-link",href:u(m)},[n(t(V),{text:m.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Wn)]),_:2},1024),r.datasets[m.dataset.id]?(c(),$("p",Nn,[e("a",{class:"fr-link inline-flex",href:(f=r.datasets[m.dataset.id])==null?void 0:f.page},[n(_,{height:12,class:"self-center",name:r.getSubjectTypeIcon("Dataset")},null,8,["name"]),n(t(V),{class:"overflow-wrap-anywhere",text:(h=r.datasets[m.dataset.id])==null?void 0:h.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,Fn)])):A("",!0)]),e("td",null,[n(Q,{type:i(m).type},{default:d(()=>[y(s(i(m).label),1)]),_:2},1032,["type"])]),e("td",null,[e("code",Gn,s(m.format),1)]),e("td",null,s(t(q)(m.created_at)),1),e("td",null,s(t(q)(m.last_modified)),1)])}),256))])]),_:1},8,["loading"])}}}),Jn={class:"fr-container--fluid"},Kn={key:0},Xn={class:"fr-breadcrumb__link","aria-current":"page"},Qn={class:"fr-h3 fr-mb-5v"},er={class:"subtitle subtitle--uppercase fr-m-0"},tr={class:"text-align-center fr-py-1w"},sr=["src"],ar={class:"fr-text--bold fr-my-3v"},je=T({__name:"CommunityResources",props:{oid:{}},setup(v){const{t:a}=M(),o=v,b=k([]),u=k(!1),i=k(1),r=k(10),l=k(0),_=k("created_at_internal"),m=k("desc"),f=B(()=>"".concat(m.value==="asc"?"":"-").concat(_.value)),{currentOrganization:h}=J(),p=de();function w(g,C){_.value=g,m.value=C}return E(async()=>{u.value=!0,b.value=[];try{let g;if(o.oid)g=await Wt(o.oid,i.value,r.value,f.value);else if(p.value)g=await Nt(p.value.id,i.value,r.value,f.value);else return;b.value=g.data,i.value=g.page,r.value=g.page_size,l.value=g.total}finally{u.value=!1}}),(g,C)=>{const z=P("router-link");return c(),$("div",Jn,[n(Z,null,{default:d(()=>[e("li",null,[n(z,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(a)("Administration")),1)]),_:1})]),t(h)?(c(),$("li",Kn,[n(z,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(s(t(h).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",Xn,s(t(a)("Community Resources")),1)])]),_:1}),e("h1",Qn,s(t(a)("Community Resources")),1),e("h2",er,s(t(a)("{n} community resources",b.value.length)),1),u.value||l.value>0?(c(),D(Zn,{key:0,"community-resources":b.value,loading:u.value,sortDirection:m.value,sortedBy:_.value,onSort:w},null,8,["community-resources","loading","sortDirection","sortedBy"])):(c(),D(G,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:d(()=>[e("div",tr,[e("img",{src:t(Ft),alt:"",loading:"lazy"},null,8,sr),e("p",ar,s(t(a)("You haven't published a community resource yet")),1)])]),_:1})),l.value>r.value?(c(),D(t(le),{key:2,page:i.value,"page-size":r.value,"total-results":l.value,onChange:C[0]||(C[0]=R=>i.value=R)},null,8,["page","page-size","total-results"])):A("",!0)])}}});Gt({admin_root:te,default_lang:ye.global.locale.value,only_locales:ye.global.locale.value,schema_documentation_url:Zt,schema_validata_url:Jt,show_copy_resource_permalink:!0,tabular_api_url:Kt,tabular_page_size:Xt,title:ze});const or=[{path:"/me",children:[{path:"",component:Pa,name:"me"},{path:"datasets",component:Be,name:"me-datasets"},{path:"dataservices",component:Me,name:"me-dataservices"},{path:"reuses",component:xe,name:"me-reuses"},{path:"community-resources",component:je,name:"me-community-resources"}]},{path:"/organizations/:oid",children:[{path:"datasets",component:Be,props:!0,name:"organization-datasets"},{path:"dataservices",component:Me,props:!0,name:"organization-dataservices"},{path:"reuses",component:xe,props:!0,name:"organization-reuses"},{path:"discussions",component:Bn,props:!0,name:"organization-discussions"},{path:"members",component:Ol,props:!0,name:"organization-members"},{path:"harvesters",component:Yn,props:!0,name:"organization-harvesters"},{path:"community-resources",component:je,props:!0,name:"organization-community-resources"},{path:"profile",component:un,props:!0,name:"organization-profile"}]}],lr=Qt({history:es(),routes:or}),ne=Xe(lo);ts(ne);ne.use(ss);ne.use(as);ne.use(ye);ne.use(lr);ne.mount("#admin");globalThis.dsfr.start();console.log("JS is injected !");export{nr as __vite_legacy_guard};
