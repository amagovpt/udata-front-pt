System.register(["vue","./sentry-legacy.6.0.6.js","vue-content-loader","./_commonjsHelpers-legacy.6.0.6.js"],(function(e,a){"use strict";var l,t,r,s,n,o,i,u,d,c,f,m,v,p,b,g,y,_,h,w,k,x,z,C,$,A,D,S,B,j,R,M,P,q,T,O,F,L,U,I,V,E,H,Y,N,W,Z,J,Q,X,K,G,ee,ae,le,te,re,se,ne,oe,ie,ue,de,ce,fe,me,ve,pe,be,ge,ye,_e,he,we,ke,xe,ze,Ce,$e,Ae,De,Se,Be,je,Re,Me,Pe,qe,Te,Oe,Fe,Le,Ue,Ie,Ve,Ee,He,Ye,Ne,We,Ze,Je,Qe,Xe,Ke,Ge,ea,aa,la,ta,ra,sa,na,oa;return{setters:[e=>{l=e.defineComponent,t=e.openBlock,r=e.createElementBlock,s=e.Fragment,n=e.createVNode,o=e.mergeProps,i=e.createElementVNode,u=e.toDisplayString,d=e.useTemplateRef,c=e.ref,f=e.computed,m=e.onMounted,v=e.watchEffect,p=e.normalizeClass,b=e.createBlock,g=e.unref,y=e.withCtx,_=e.createCommentVNode,h=e.createTextVNode,w=e.renderSlot,k=e.renderList,x=e.readonly,z=e.useId,C=e.resolveComponent,$=e.watchPostEffect,A=e.Teleport,D=e.withModifiers,S=e.createApp},e=>{B=e.D,j=e.L,R=e.bH,M=e.v,P=e.F,q=e.A,T=e.bI,O=e.H,F=e._,L=e.b,U=e.bJ,I=e.h,V=e.ao,E=e.y,H=e.B,Y=e.bi,N=e.bK,W=e.bL,Z=e.ay,J=e.bt,Q=e.bM,X=e.bN,K=e.bO,G=e.bP,ee=e.at,ae=e.M,le=e.ag,te=e.bQ,re=e.bR,se=e.bo,ne=e.bS,oe=e.bT,ie=e.be,ue=e.bU,de=e.bV,ce=e.a_,fe=e.Y,me=e.a8,ve=e.aX,pe=e.bW,be=e.az,ge=e.a0,ye=e.a2,_e=e.bX,he=e.bY,we=e.aN,ke=e.bZ,xe=e.b_,ze=e.b$,Ce=e.c0,$e=e.c1,Ae=e.c2,De=e.c3,Se=e.c4,Be=e.c5,je=e.x,Re=e.C,Me=e.bh,Pe=e.c6,qe=e.c7,Te=e.bk,Oe=e.a,Fe=e.c8,Le=e.c9,Ue=e.ca,Ie=e.cb,Ve=e.a9,Ee=e.cc,He=e.cd,Ye=e.ce,Ne=e.cf,We=e.cg,Ze=e.ch,Je=e.av,Qe=e.bv,Xe=e.by,Ke=e.aZ,Ge=e.bz,ea=e.bB,aa=e.bC,la=e.ci,ta=e.cj,ra=e.bD,sa=e.bE,na=e.bF},e=>{oa=e.ContentLoader},null],execute:function(){const e={class:"fr-ml-1v fr-text--bold"},a=l({__name:"AvatarWithName",props:{user:{},size:{default:12}},setup:a=>(a,l)=>(t(),r(s,null,[n(B,o(a.$attrs,{user:a.user,size:a.size,rounded:!0}),null,16,["user","size"]),i("span",e,u(a.user.first_name)+" "+u(a.user.last_name),1)],64))}),ia={ref:"canvasRef",width:"120",height:"30"},ua={class:"fr-grid-row justify-between"},da={class:"text-xxs fr-m-0 text-mention-grey"},ca={class:"text-xxs fr-m-0 text-mention-grey"},fa="#B6CFFB",ma="#3558A2",va=l({__name:"SmallChart",props:{data:{},type:{},lastWithLowEmphasis:{type:Boolean,default:!1}},setup(e){const a=e,l=(e,a)=>e.p1DataIndex===b.value.length-1?a:null,s=d("canvasRef"),n=c(null),o=c(null),p=f((()=>{const e=Object.keys(a.data);e.sort();let l={};for(const t of e)l[t]=a.data[t];return l})),b=f((()=>Object.keys(p.value))),g=f((()=>Object.values(p.value))),y=f((()=>"bar"===a.type?{barPercentage:1,categoryPercentage:.9,backgroundColor:b.value.map(((e,l)=>l===b.value.length-1?a.lastWithLowEmphasis?"rgba(182, 207, 251, 0.7)":ma:fa))}:"line"===a.type&&a.lastWithLowEmphasis?{segment:{borderColor:e=>l(e,"rgba(53, 88, 162, 0.7)")||ma,borderDash:e=>l(e,[3,3])||[6,0]}}:{})),_=f((()=>b.value.length?j(b.value[0],"MM/YY"):null)),h=f((()=>b.value.length?j(b.value[b.value.length-1],"MM/YY"):null)),w={animation:!1,responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!1}},elements:{bar:{backgroundColor:fa,borderRadius:2,hoverBackgroundColor:ma},line:{backgroundColor:ma,borderColor:ma,borderJoinStyle:"round",tension:.35},point:{radius:0}},scales:{x:{display:!1,grid:{display:!1},ticks:{display:!1}},y:{display:!1,grid:{display:!1},ticks:{display:!1}}},layout:{padding:{top:1.5}}};return m((()=>{n.value=s.value?s.value.getContext("2d"):null})),v((()=>{n.value&&(o.value&&o.value.destroy(),o.value=new R(n.value,{data:{labels:b.value,datasets:[{data:g.value,type:a.type,...y.value}]},options:w}))})),(e,a)=>(t(),r("div",null,[i("canvas",ia,null,512),i("div",ua,[i("p",da,u(_.value),1),i("p",ca,u(h.value),1)])]))}}),pa={class:"fr-text--sm fr-m-0"},ba={class:"fr-grid-row fr-grid-row--middle"},ga={key:1,class:"h1 line-height-1 fr-m-0"},ya={key:3,class:"fr-ml-1w"},_a={key:0,class:"fr-mt-1w fr-text--regular text-transform-none fr-badge fr-badge--no-icon fr-badge--success"},ha={class:"fr-mr-1v"},wa=l({__name:"StatBox",props:{title:{},data:{},type:{},summary:{}},setup(e){const a=e,{t:l}=M(),s=f((()=>a.data?Object.keys(a.data):[])),o=f((()=>a.data?Object.values(a.data):[])),d=f((()=>s.value.length?s.value.reduce(((e,a)=>a>e?a:e)):null)),c=f((()=>d.value?s.value.indexOf(d.value):null)),m=f((()=>null!==c.value?o.value[c.value]:null)),v=f((()=>Math.max(...o.value)>0));return(e,a)=>(t(),r("div",{class:p({"text-mention-grey":!v.value&&!e.summary})},[i("h3",pa,u(e.title),1),i("div",ba,[null===e.summary?(t(),b(g(oa),{key:0,width:92,height:32,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},{default:y((()=>a[0]||(a[0]=[i("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"92",height:"32"},null,-1)]))),_:1})):(t(),r("p",ga,u(g(P)(e.summary,2)),1)),null===e.data?(t(),b(g(oa),{key:2,width:120,height:30,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",class:"fr-ml-1w"},{default:y((()=>a[1]||(a[1]=[i("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"120",height:"30"},null,-1)]))),_:1})):v.value?(t(),r("div",ya,[n(va,{type:e.type,data:e.data,lastWithLowEmphasis:!0},null,8,["type","data"])])):_("",!0)]),m.value&&d.value?(t(),r("p",_a,[i("strong",ha," +Â "+u(g(P)(m.value,2)),1),h(" "+u(g(l)(" in "))+" "+u(g(j)(d.value,"MMM YYYY")),1)])):_("",!0)],2))}}),ka=["aria-label"],xa={class:"fr-breadcrumb__list"},za={__name:"Breadcrumb",setup(e){const{t:a}=M();return(e,l)=>(t(),r("nav",{rol:"navigation","aria-label":g(a)("You're here:"),class:"fr-breadcrumb fr-mb-5v"},[i("ol",xa,[w(e.$slots,"default")])],8,ka))}},Ca={class:"fr-text--sm fr-my-0"},$a={class:"fr-grid-row fr-grid-row--right not-enlarged"},Aa=["href","title"],Da=l({__name:"QualityScoreTooltipContent",props:{dataset:{}},setup(e){const{t:a}=M();return(e,l)=>(t(),r(s,null,[i("h5",Ca,u(g(a)("Metadata quality:")),1),n(g(q),{passed:e.dataset.quality.dataset_description_quality,messagePassed:g(a)("Data description filled"),messageFailed:g(a)("Data description empty"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(g(q),{passed:e.dataset.quality.resources_documentation,messagePassed:g(a)("Files documented"),messageFailed:g(a)("Files documentation missing"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(g(q),{passed:e.dataset.quality.license,messagePassed:g(a)("License filled"),messageFailed:g(a)("No license set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(g(q),{passed:e.dataset.quality.update_frequency&&!!e.dataset.quality.update_fulfilled_in_time,messagePassed:g(a)("Update frequency followed"),messageFailed:e.dataset.quality.update_frequency?g(a)("Update frequency not followed"):g(a)("Update frequency not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(g(q),{passed:e.dataset.quality.has_open_format,messagePassed:g(a)("File formats are open"),messageFailed:g(a)("File formats are closed"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(g(q),{passed:e.dataset.quality.temporal_coverage,messagePassed:g(a)("Temporal coverage filled"),messageFailed:g(a)("Temporal coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(g(q),{passed:e.dataset.quality.spatial,messagePassed:g(a)("Spatial coverage filled"),messageFailed:g(a)("Spatial coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(g(q),{passed:e.dataset.quality.all_resources_available,messagePassed:g(a)("All files are available"),messageFailed:g(a)("Some files are unavailable"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),i("div",$a,[i("a",{href:g(T),target:"_blank",rel:"noopener",title:g(a)("Learn more about this indicator - opens a new window")},u(g(a)("Learn more about this indicator")),9,Aa)])],64))}}),Sa=l({__name:"AdminBadge",props:{type:{}},setup:e=>(e,a)=>(t(),r("p",{class:p(["fr-badge",{"fr-badge--blue-cumulus":"info"===e.type,"fr-badge--error fr-badge--no-icon":"error"===e.type,"fr-badge--warning fr-badge--no-icon":"warning"===e.type,"fr-badge--success fr-badge--no-icon":"success"===e.type}])},[w(e.$slots,"default")],2))}),Ba=["aria-describedby"],ja=["id"],Ra=F(l({inheritAttrs:!1,__name:"AdminContentWithTooltip",setup(e){const a=O(),l=c(),n=c("");return m((()=>{l.value&&(n.value=l.value.textContent||"")})),(e,d)=>(t(),r(s,null,[i("p",o(e.$attrs,{"aria-describedby":g(a),ref_key:"contentRef",ref:l}),[w(e.$slots,"default",{},void 0,!0)],16,Ba),i("span",{class:"fr-hidden-xl fr-tooltip fr-placement",id:g(a),role:"tooltip","aria-hidden":"true"},u(n.value),9,ja)],64))}}),[["__scopeId","data-v-d192f17a"]]),Ma=l({__name:"AdminLoader",props:{scale:{default:4}},setup:e=>(L(U),(e,a)=>(t(),b(g(I),{name:"ri-loader-5-line",animation:"spin",scale:e.scale,fill:"var(--blue-cumulus-sun-368-moon-732)"},null,8,["scale"])))}),Pa={class:"fr-table fr-mb-2w"},qa=l({__name:"AdminTable",props:{loading:{type:Boolean,default:!1}},setup:e=>(e,a)=>(t(),r("div",Pa,[i("table",null,[w(e.$slots,"default",{},void 0,!0)]),e.loading?(t(),b(V,{key:0,class:"fr-p-4w text-align-center"},{default:y((()=>[n(Ma)])),_:1})):_("",!0)]))}),Ta=F(qa,[["__scopeId","data-v-cae574a4"]]),Oa={class:"fr-text--bold"},Fa={key:1,class:"fr-grid-row fr-grid-row--middle justify-between"},La=["title"],Ua=F(l({__name:"AdminTableTh",props:{sorted:{}},emits:["sort"],setup(e,{emit:a}){const l=e,s=a,{t:n}=M(),o=f((()=>void 0!==l.sorted));function d(){return"desc"===l.sorted?s("sort","asc"):s("sort","desc")}return(e,a)=>(t(),r("th",Oa,[o.value?(t(),r("div",Fa,[w(e.$slots,"default",{},void 0,!0),i("button",{class:p(["fr-ml-1w fr-btn fr-btn--sm fr-btn--tertiary-no-outline",{"fr-icon-arrow-down-line":!e.sorted||"asc"===e.sorted,"fr-icon-arrow-up-line":"desc"===e.sorted,"text-grey-500":e.sorted,"text-mention-grey":!e.sorted}]),onClick:d,title:g(n)("Sort")},u(g(n)("Sort")),11,La)])):w(e.$slots,"default",{key:0},void 0,!0)]))}}),[["__scopeId","data-v-5acf0bf0"]]),Ia=["aria-describedby"],Va=["id"],Ea=l({__name:"Tooltip",setup(e){const a=O("tooltip");return(e,l)=>(t(),r(s,null,[i("p",o(e.$attrs,{"aria-describedby":g(a)}),[w(e.$slots,"default")],16,Ia),i("span",{class:"fr-tooltip fr-placement",id:g(a),role:"tooltip","aria-hidden":"true"},[w(e.$slots,"tooltip")],8,Va)],64))}}),Ha=["href"],Ya={class:"monospace"},Na={class:"monospace"},Wa={class:"monospace"},Za={class:"monospace"},Ja={class:"monospace"},Qa=l({__name:"AdminDatasetsTable",props:{datasets:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(e,{emit:a}){const l=a,o=e,{t:d}=M();function c(e,a){l("sort",e,a)}function f(e){return o.sortedBy===e?o.sortDirection:null}function m(e){return Array.isArray(e.resources)?e.resources.length:e.resources.total}function v(e){return`${Y}dataset/${e.id}/`}function p(e){return e.deleted?{label:d("Deleted"),type:"error"}:e.archived?{label:d("Archived"),type:"warning"}:e.private?{label:d("Draft"),type:"default"}:{label:d("Public"),type:"info"}}return(e,a)=>(t(),b(Ta,{loading:e.loading},{default:y((()=>[i("thead",null,[i("tr",null,[n(Ua,{onSort:a[0]||(a[0]=e=>c("title",e)),sorted:f("title"),scope:"col"},{default:y((()=>[h(u(g(d)("Title of the dataset")),1)])),_:1},8,["sorted"]),n(Ua,{scope:"col"},{default:y((()=>[h(u(g(d)("Status")),1)])),_:1}),n(Ua,{onSort:a[1]||(a[1]=e=>c("created",e)),sorted:f("created"),scope:"col"},{default:y((()=>[h(u(g(d)("Created at")),1)])),_:1},8,["sorted"]),n(Ua,{onSort:a[2]||(a[2]=e=>c("last_update",e)),sorted:f("last_update"),scope:"col"},{default:y((()=>[h(u(g(d)("Updated at")),1)])),_:1},8,["sorted"]),n(Ua,{scope:"col"},{default:y((()=>[h(u(g(d)("Files")),1)])),_:1}),n(Ua,{scope:"col"},{default:y((()=>[h(u(g(d)("Score")),1)])),_:1}),n(Ua,{scope:"col"},{default:y((()=>[n(Ea,null,{tooltip:y((()=>[h(u(g(d)("Discussions")),1)])),default:y((()=>[a[6]||(a[6]=i("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),n(Ua,{onSort:a[3]||(a[3]=e=>c("views",e)),sorted:f("views"),scope:"col"},{default:y((()=>[n(Ea,null,{tooltip:y((()=>[h(u(g(d)("Views")),1)])),default:y((()=>[a[7]||(a[7]=i("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),n(Ua,{scope:"col"},{default:y((()=>[n(Ea,null,{tooltip:y((()=>[h(u(g(d)("Downloads")),1)])),default:y((()=>[a[8]||(a[8]=i("span",{class:"fr-icon--sm fr-icon-download-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),n(Ua,{onSort:a[4]||(a[4]=e=>c("reuses",e)),sorted:f("reuses"),scope:"col"},{default:y((()=>[n(Ea,null,{tooltip:y((()=>[h(u(g(d)("Reuses")),1)])),default:y((()=>[a[9]||(a[9]=i("span",{class:"fr-icon--sm fr-icon-line-chart-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),n(Ua,{onSort:a[5]||(a[5]=e=>c("followers",e)),sorted:f("followers"),scope:"col"},{default:y((()=>[n(Ea,null,{tooltip:y((()=>[h(u(g(d)("Favorites")),1)])),default:y((()=>[a[10]||(a[10]=i("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"])])]),i("tbody",null,[(t(!0),r(s,null,k(e.datasets,(e=>{var a;return t(),r("tr",{key:e.id},[i("td",null,[n(Ra,null,{default:y((()=>[i("a",{class:"fr-link fr-reset-link",href:v(e)},[n(g(E),{text:e.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Ha)])),_:2},1024)]),i("td",null,[n(Sa,{type:p(e).type},{default:y((()=>[h(u(p(e).label),1)])),_:2},1032,["type"])]),i("td",null,u(g(j)(e.created_at)),1),i("td",null,u(g(j)(e.last_modified)),1),i("td",null,u(m(e)),1),i("td",null,[n(Ea,null,{tooltip:y((()=>[n(Da,{dataset:e},null,8,["dataset"])])),default:y((()=>[n(g(H),{class:"w-100",score:e.quality.score},null,8,["score"])])),_:2},1024)]),i("td",Ya,u(g(P)(e.metrics.discussions)),1),i("td",Na,u(g(P)(e.metrics.views)),1),i("td",Wa,u(g(P)(null!==(a=e.metrics.resources_downloads)&&void 0!==a?a:0)),1),i("td",Za,u(g(P)(e.metrics.reuses)),1),i("td",Ja,u(g(P)(e.metrics.followers)),1)])})),128))])])),_:1},8,["loading"]))}}),Xa=c(null);function Ka(){return{currentOrganization:x(Xa),setCurrentOrganization:e=>{Xa.value=e}}}const Ga=["href"],el=["src","alt"],al=l({__name:"AdminPublishButton",props:{type:{}},setup(e){const a=e,{t:l}=M(),s=f((()=>{switch(a.type){case"dataset":return W;case"harvester":return`${Y}harvester/new/`;case"reuse":return N}}));return(e,a)=>(t(),r("a",{href:s.value,class:"fr-btn fr-icon-add-line fr-btn--icon-left"},[h(u(g(l)("Publish on"))+" ",1),i("img",{class:"fr-ml-1v",src:g("/_themes/gouvfr/assets/logotype-white.svg"),loading:"lazy",alt:g(Z)},null,8,el)],8,Ga))}}),ll={key:0},tl={class:"fr-breadcrumb__link","aria-current":"page"},rl={class:"fr-h3 fr-mb-5v"},sl={class:"fr-p-3w flex items-center justify-between relative"},nl=["id"],ol=["aria-expanded"],il={class:"flex items-center fr-ml-4v buttons"},ul={class:"fr-col-auto fr-ml-3v fr-m-0"},dl=["disabled","href","title"],cl=["aria-labelledby"],fl={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},ml={class:"fr-col"},vl={class:"subtitle subtitle--uppercase fr-m-0"},pl={key:0,class:"fr-col-auto fr-grid-row fr-grid-row--middle"},bl=["href"],gl={class:"text-align-center fr-py-1w"},yl=["src"],_l={class:"fr-text--bold fr-my-3v"},hl=l({__name:"Datasets",props:{oid:{}},setup(e){const{t:a}=M(),l=e,s=c([]),o=c(!1),d=c(1),m=c(10),w=c(0),k=c("created"),x=c("desc"),$=f((()=>`${"asc"===x.value?"":"-"}${k.value}`)),A=c(""),D=J(A,le),{currentOrganization:S}=Ka(),B=Q();function j(e,a){k.value=e,x.value=a}v((async()=>{o.value=!0,s.value=[];try{let e;if(l.oid)e=await X(l.oid,D.value,d.value,m.value,$.value);else{if(!B.value)return;e=await K(B.value.id,D.value,d.value,m.value,$.value)}s.value=e.data,d.value=e.page,m.value=e.page_size,w.value=e.total}finally{o.value=!1}}));const R=c(!1),P=z(),q=c(null),T=c(null),O=c(null),F=c(null),L=c(null),U=c(null);v((async()=>{if(l.oid){{const e=await fetch(`https://metric-api.data.gouv.fr/api/organizations/data/?organization_id__exact=${l.oid}&metric_month__sort=desc&page_size=12`),a=await e.json();q.value={},O.value={},L.value={};for(const{metric_month:l,monthly_download_resource:t,monthly_visit_dataset:r,monthly_visit_reuse:s}of a.data)q.value[l]=r,O.value[l]=t,L.value[l]=s}{const e=await fetch(`https://metric-api.data.gouv.fr/api/organizations_total/data/?organization_id__exact=${l.oid}`),a=await e.json();a.data[0]&&(T.value=a.data[0].visit_dataset,F.value=a.data[0].download_resource,U.value=a.data[0].visit_reuse)}}}));const I=f((()=>{if(!q.value||!O.value||!L.value)return null;let e="month,visit_datasets,download_resource,visit_reuse\n";for(const a in q.value)e+=`${a},${q.value[a]},${O.value[a]},${L.value[a]}\n`;return URL.createObjectURL(new Blob([e],{type:"text/csv"}))}));return(e,l)=>{const c=C("router-link");return t(),r("div",null,[n(za,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(a)("Administration")),1)])),_:1})]),g(S)?(t(),r("li",ll,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(S).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",tl,u(g(a)("Datasets")),1)])])),_:1}),i("h1",rl,u(g(a)("Datasets")),1),e.oid&&!o.value&&w.value>0?(t(),r("div",{key:0,class:p(["bg-white border rounded-xxs fr-mb-3w",{"fr-pb-4v":R.value}])},[i("header",sl,[i("div",null,[i("h4",{class:"fr-mb-1v flex items-center",id:g(P)},[i("button",{type:"button",onClick:l[0]||(l[0]=e=>R.value=!R.value),class:"fr-p-0 fr-text flex items-center font-bold","data-testid":"expand-button","aria-expanded":R.value},[h(u(e.$t("Statistics on your datasets"))+" ",1),l[2]||(l[2]=i("span",{class:"absolute inset-0 z-1"},null,-1))],8,ol)],8,nl)]),i("div",il,[i("p",ul,[i("a",{disabled:!I.value,href:I.value||"",rel:"ugc nofollow noopener",title:g(a)("Download file"),download:"stats.csv",class:"relative fr-btn fr-btn--sm fr-btn--icon-left fr-icon-test-tube-line fr-icon-download-line fr-icon--sm z-2"},u(e.$t("Download")),9,dl)]),i("div",{class:p(["fr-icon--sm fr-ml-4v",{"fr-icon-arrow-up-s-line":R.value,"fr-icon-arrow-down-s-line":!R.value}])},null,2)])]),R.value?(t(),r("section",{key:0,"aria-labelledby":g(P),class:"flex fr-pb-3w fr-pl-3w fr-pr-3w"},[n(g(wa),{title:e.$t("Views"),data:q.value,type:"line",summary:T.value,class:"w-1/3"},null,8,["title","data","summary"]),n(g(wa),{title:e.$t("Downloads"),data:O.value,type:"line",summary:F.value,class:"w-1/3"},null,8,["title","data","summary"]),n(g(wa),{title:e.$t("Reuses Visits"),data:L.value,type:"line",summary:U.value,class:"w-1/3"},null,8,["title","data","summary"])],8,cl)):_("",!0)],2)):_("",!0),i("div",fl,[i("div",ml,[i("h2",vl,u(g(a)("{n} datasets",w.value)),1)]),e.oid?(t(),r("div",pl,[i("div",null,[i("a",{href:g(G)(e.oid,w.value),class:"fr-btn fr-btn--sm fr-icon-download-line fr-btn--icon-left"},u(g(a)("Download catalog")),9,bl)])])):_("",!0)]),o.value||w.value>0?(t(),b(Qa,{key:1,datasets:s.value,loading:o.value,"sort-direction":x.value,sortedBy:k.value,onSort:j},null,8,["datasets","loading","sort-direction","sortedBy"])):(t(),b(V,{key:2,class:"fr-my-2w"},{default:y((()=>[i("div",gl,[i("img",{src:g(ee),alt:"",loading:"lazy"},null,8,yl),i("p",_l,u(g(a)("You haven't published a dataset yet")),1),n(al,{type:"dataset"})])])),_:1})),w.value>m.value?(t(),b(g(ae),{key:3,page:d.value,"page-size":m.value,"total-results":w.value,onChange:l[1]||(l[1]=e=>d.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}}),wl=F(hl,[["__scopeId","data-v-93674b91"]]),kl=["href"],xl={key:0},zl=l({__name:"AdminDataservicesTable",props:{dataservices:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(e){const a=e,{t:l}=M();function o(e){return`${Y}dataservices/${e.id}/`}function d(e){return e.private?{label:l("Draft"),type:"default"}:{label:l("Public"),type:"info"}}function c(e){return e.is_restricted?{label:l("Restricted"),type:"warning"}:{label:l("Open"),type:"success"}}return(e,f)=>(t(),b(Ta,{loading:e.loading},{default:y((()=>{return[i("thead",null,[n(Ua,{onSort:f[0]||(f[0]=a=>e.$emit("sort","title",a)),sorted:(m="title",a.sortedBy===m?a.sortDirection:null),scope:"col"},{default:y((()=>[h(u(g(l)("Dataservice title")),1)])),_:1},8,["sorted"]),n(Ua,null,{default:y((()=>[h(u(g(l)("Status")),1)])),_:1}),n(Ua,null,{default:y((()=>[h(u(g(l)("Access")),1)])),_:1}),n(Ua,null,{default:y((()=>[h(u(g(l)("Created at")),1)])),_:1}),n(Ua,null,{default:y((()=>[h(u(g(l)("Rate Limiting")),1)])),_:1}),n(Ua,null,{default:y((()=>[h(u(g(l)("Availability")),1)])),_:1})]),i("tbody",null,[(t(!0),r(s,null,k(e.dataservices,(e=>(t(),r("tr",null,[i("td",null,[n(Ra,null,{default:y((()=>[i("a",{class:"fr-link fr-reset-link",href:o(e)},[n(g(E),{text:e.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,kl)])),_:2},1024)]),i("td",null,[n(Sa,{type:d(e).type},{default:y((()=>[h(u(d(e).label),1)])),_:2},1032,["type"])]),i("td",null,[n(Sa,{type:c(e).type},{default:y((()=>[h(u(c(e).label),1)])),_:2},1032,["type"])]),i("td",null,u(g(j)(e.created_at)),1),i("td",null,u(e.rate_limiting),1),i("td",null,[e.availability?(t(),r("span",xl,u(e.availability)+"%",1)):_("",!0)])])))),256))])];var m})),_:1},8,["loading"]))}}),Cl={class:"fr-container--fluid"},$l={key:0},Al={class:"fr-breadcrumb__link","aria-current":"page"},Dl={class:"fr-h3"},Sl={class:"subtitle subtitle--uppercase"},Bl={class:"text-align-center fr-py-1w"},jl=["src"],Rl={class:"fr-text--bold fr-my-3v"},Ml=l({__name:"Dataservices",props:{oid:{}},setup(e){const{t:a}=M(),l=e,s=c([]),o=c(!1),d=c(1),m=c(10),p=c(0),w=c("title"),k=c("desc"),x=f((()=>`${"asc"===k.value?"":"-"}${w.value}`)),{currentOrganization:z}=Ka(),$=Q();function A(e,a){w.value=e,k.value=a}return v((async()=>{o.value=!0,s.value=[];try{let e;if(l.oid)e=await te(l.oid,d.value,m.value,x.value);else{if(!$.value)return;e=await re($.value.id,d.value,m.value,x.value)}s.value=e.data,d.value=e.page,m.value=e.page_size,p.value=e.total}finally{o.value=!1}})),(e,l)=>{const c=C("router-link");return t(),r("div",Cl,[n(za,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(a)("Administration")),1)])),_:1})]),g(z)?(t(),r("li",$l,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(z).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Al,u(g(a)("Dataservices")),1)])])),_:1}),i("h1",Dl,u(g(a)("Dataservices")),1),i("h2",Sl,u(g(a)("{n} dataservices",p.value)),1),o.value||p.value>0?(t(),b(zl,{key:0,dataservices:s.value,loading:o.value,sortDirection:k.value,sortedBy:w.value,onSort:A},null,8,["dataservices","loading","sortDirection","sortedBy"])):(t(),b(V,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:y((()=>[i("div",Bl,[i("img",{src:g(se),alt:"",loading:"lazy"},null,8,jl),i("p",Rl,u(g(a)("You haven't published a dataservice yet")),1),n(al,{type:"dataservice"})])])),_:1})),p.value>m.value?(t(),b(g(ae),{key:2,page:d.value,"page-size":m.value,"total-results":p.value,onChange:l[0]||(l[0]=e=>d.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}}),Pl=["href"],ql={class:"monospace"},Tl={class:"monospace"},Ol={class:"monospace"},Fl={class:"monospace"},Ll=l({__name:"AdminReusesTable",props:{reuses:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(e){const a=e,{t:l}=M();function o(e){return a.sortedBy===e?a.sortDirection:null}function d(e){return`${Y}reuse/${e.id}/`}function c(e){return e.deleted?{label:l("Deleted"),type:"error"}:e.archived?{label:l("Archived"),type:"warning"}:e.private?{label:l("Draft"),type:"default"}:{label:l("Public"),type:"info"}}return(e,a)=>(t(),b(Ta,{loading:e.loading},{default:y((()=>[i("thead",null,[n(Ua,{onSort:a[0]||(a[0]=a=>e.$emit("sort","title",a)),sorted:o("title"),scope:"col"},{default:y((()=>[h(u(g(l)("Reuse title")),1)])),_:1},8,["sorted"]),n(Ua,null,{default:y((()=>[h(u(g(l)("Status")),1)])),_:1}),n(Ua,{onSort:a[1]||(a[1]=a=>e.$emit("sort","created",a)),sorted:o("created"),scope:"col"},{default:y((()=>[h(u(g(l)("Created at")),1)])),_:1},8,["sorted"]),n(Ua,{onSort:a[2]||(a[2]=a=>e.$emit("sort","datasets",a)),sorted:o("datasets"),scope:"col"},{default:y((()=>[h(u(g(l)("Datasets")),1)])),_:1},8,["sorted"]),n(Ua,{scope:"col"},{default:y((()=>[n(Ea,null,{tooltip:y((()=>[h(u(g(l)("Discussions")),1)])),default:y((()=>[a[5]||(a[5]=i("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),n(Ua,{onSort:a[3]||(a[3]=a=>e.$emit("sort","views",a)),sorted:o("views"),scope:"col"},{default:y((()=>[n(Ea,null,{tooltip:y((()=>[h(u(g(l)("Views")),1)])),default:y((()=>[a[6]||(a[6]=i("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),n(Ua,{onSort:a[4]||(a[4]=a=>e.$emit("sort","followers",a)),sorted:o("followers"),scope:"col"},{default:y((()=>[n(Ea,null,{tooltip:y((()=>[h(u(g(l)("Favorites")),1)])),default:y((()=>[a[7]||(a[7]=i("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"])]),i("tbody",null,[(t(!0),r(s,null,k(e.reuses,(e=>(t(),r("tr",null,[i("td",null,[n(Ra,null,{default:y((()=>[i("a",{class:"fr-link fr-reset-link",href:d(e)},[n(g(E),{text:e.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Pl)])),_:2},1024)]),i("td",null,[n(Sa,{type:c(e).type},{default:y((()=>[h(u(c(e).label),1)])),_:2},1032,["type"])]),i("td",null,u(g(j)(e.created_at)),1),i("td",ql,u(g(P)(e.datasets.length)),1),i("td",Tl,u(g(P)(e.metrics.discussions)),1),i("td",Ol,u(g(P)(e.metrics.views)),1),i("td",Fl,u(g(P)(e.metrics.followers)),1)])))),256))])])),_:1},8,["loading"]))}}),Ul={class:"fr-container--fluid"},Il={key:0},Vl={class:"fr-breadcrumb__link","aria-current":"page"},El={class:"fr-h3 fr-mb-5v"},Hl={class:"subtitle subtitle--uppercase fr-mb-0"},Yl={class:"text-align-center fr-py-1w"},Nl=["src"],Wl={class:"fr-text--bold fr-my-3v"},Zl=l({__name:"Reuses",props:{oid:{}},setup(e){const{t:a}=M(),l=e,s=c([]),o=c(!1),d=c(1),m=c(10),p=c(0),w=c("created"),k=c("desc"),x=f((()=>`${"asc"===k.value?"":"-"}${w.value}`)),{currentOrganization:z}=Ka(),$=Q();function A(e,a){w.value=e,k.value=a}return v((async()=>{o.value=!0,s.value=[];try{let e;if(l.oid)e=await ne(l.oid,d.value,m.value,x.value);else{if(!$.value)return;e=await oe($.value.id,d.value,m.value,x.value)}s.value=e.data,d.value=e.page,m.value=e.page_size,p.value=e.total}finally{o.value=!1}})),(e,l)=>{const c=C("router-link");return t(),r("div",Ul,[n(za,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(a)("Administration")),1)])),_:1})]),g(z)?(t(),r("li",Il,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(z).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Vl,u(g(a)("Reuses")),1)])])),_:1}),i("h1",El,u(g(a)("Reuses")),1),i("h2",Hl,u(g(a)("{n} reuses of your organization",s.value.length)),1),o.value||p.value>0?(t(),b(Ll,{key:0,reuses:s.value,loading:o.value,sortDirection:k.value,sortedBy:w.value,onSort:A},null,8,["reuses","loading","sortDirection","sortedBy"])):(t(),b(V,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:y((()=>[i("div",Yl,[i("img",{src:g("/_themes/gouvfr/assets/reuse.svg"),alt:"",loading:"lazy"},null,8,Nl),i("p",Wl,u(g(a)("You haven't published a reuse yet")),1),n(al,{type:"reuse"})])])),_:1})),p.value>m.value?(t(),b(g(ae),{key:2,page:d.value,"page-size":m.value,"total-results":p.value,onChange:l[0]||(l[0]=e=>d.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}}),Jl={class:"fr-breadcrumb__link","aria-current":"page"},Ql={key:0,class:"fr-h1"},Xl={class:"fr-alert fr-alert--info"},Kl={class:"fr-alert__title"},Gl={href:"/admin/me/"},et=l({__name:"Me",setup(e){const{t:a}=M(),l=Q();return(e,s)=>{const o=C("router-link");return t(),r("div",null,[n(za,null,{default:y((()=>[i("li",null,[n(o,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(a)("Administration")),1)])),_:1})]),i("li",null,[i("a",Jl,u(g(a)("Me")),1)])])),_:1}),g(l)?(t(),r("h1",Ql,u(g(l).first_name)+" "+u(g(l).last_name),1)):_("",!0),i("div",Xl,[i("h3",Kl,u(g(a)("This is a WIP page")),1),i("p",null,[i("a",Gl,u(g(a)("You can edit your profil on the current admin.")),1)])])])}}}),at='<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5 12V18C5 18 5 21 12 21C19 21 19 18 19 18V12" stroke="currentColor" stroke-width="1.5"/>\n<path d="M5 6V12C5 12 5 15 12 15C19 15 19 12 19 12V6" stroke="currentColor" stroke-width="1.5"/>\n<path d="M12 3C19 3 19 6 19 6C19 6 19 9 12 9C5 9 5 6 5 6C5 6 5 3 12 3Z" stroke="currentColor" stroke-width="1.5"/>\n</svg>\n',lt={class:"fr-sidemenu__item"},tt=["innerHTML"],rt=F(l({__name:"AdminSidebarLink",props:{label:{},icon:{},iconHtml:{},to:{}},setup:e=>(e,a)=>{const l=C("TextClamp"),s=C("router-link");return t(),r("li",lt,[i("div",{class:p([{"fr-icon-svg fr-icon--sm":e.iconHtml},"fr-enlarge-link fr-sidemenu__link fr-mb-1w"])},[e.iconHtml?(t(),r("div",{key:0,class:"fr-mr-1w fr-grid-row",innerHTML:e.iconHtml},null,8,tt)):e.icon?(t(),r("div",{key:1,class:p([e.icon,"fr-mr-1w fr-icon--sm"]),"aria-hidden":"true"},null,2)):_("",!0),n(s,{to:e.to},{default:y((()=>[n(l,{text:e.label,"auto-resize":!0,"max-lines":1},null,8,["text"])])),_:1},8,["to"])],2)])}}),[["__scopeId","data-v-65a3b831"]]),st=["aria-expanded","aria-controls","aria-current"],nt={class:"fr-mx-1w"},ot={class:"logo logo--sm"},it={class:"fr-mx-1w fr-col text-overflow-ellipsis"},ut=["id"],dt={class:"fr-sidemenu__list fr-mx-1w fr-my-3v"},ct=l({__name:"AdminSidebarMenu",props:{user:{},organization:{},isOpened:{type:Boolean}},emits:["open","click"],setup(e){const a=e,{t:l}=M(),o=O("menu");return $((()=>{setTimeout((()=>{!function(e,a){const l=document.getElementById(o);a(l)&&(e?a(l).collapse.disclose():a(l).collapse.conceal())}(a.isOpened,globalThis.dsfr)}),200)})),(e,a)=>(t(),r("li",{class:p(["fr-sidemenu__item",{"fr-sidemenu__item--active":e.isOpened}])},[i("button",{class:"fr-sidemenu__btn","aria-expanded":e.isOpened,"aria-controls":g(o),"aria-current":e.isOpened,onClick:a[0]||(a[0]=a=>e.$emit("open"))},[e.user?(t(),r(s,{key:0},[e.user?(t(),b(g(B),{key:0,user:e.user,size:24,rounded:!0},null,8,["user"])):_("",!0),i("p",nt,u(g(l)("My Profile")),1)],64)):e.organization?(t(),r(s,{key:1},[i("div",ot,[n(ie,{type:"organization",src:e.organization.logo_thumbnail,size:20},null,8,["src"])]),i("p",it,u(e.organization.name),1)],64)):_("",!0)],8,st),i("div",{class:"fr-collapse","data-fr-js-collapse":"",id:g(o)},[i("ul",dt,[e.user?(t(),r(s,{key:0},[n(rt,{icon:"fr-icon-account-circle-line",label:g(l)("Me"),to:{name:"me"}},null,8,["label"]),n(rt,{iconHtml:g(at),label:g(l)("Datasets"),to:{name:"me-datasets"}},null,8,["iconHtml","label"]),n(rt,{icon:"fr-icon-code-s-slash-line",label:g(l)("Dataservices"),to:{name:"me-dataservices"}},null,8,["label"]),n(rt,{icon:"fr-icon-line-chart-line",label:g(l)("Reuses"),to:{name:"me-reuses"}},null,8,["label"]),n(rt,{icon:"fr-icon-git-pull-request-line",label:g(l)("Community Resources"),to:{name:"me-community-resources"}},null,8,["label"])],64)):e.organization?(t(),r(s,{key:1},[n(rt,{iconHtml:g(at),label:g(l)("Datasets"),to:{name:"organization-datasets",params:{oid:e.organization.id}},onClick:a[1]||(a[1]=a=>e.$emit("click"))},null,8,["iconHtml","label","to"]),n(rt,{icon:"fr-icon-code-s-slash-line",label:g(l)("Dataservices"),to:{name:"organization-dataservices",params:{oid:e.organization.id}},onClick:a[2]||(a[2]=a=>e.$emit("click"))},null,8,["label","to"]),n(rt,{icon:"fr-icon-line-chart-line",label:g(l)("Reuses"),to:{name:"organization-reuses",params:{oid:e.organization.id}},onClick:a[3]||(a[3]=a=>e.$emit("click"))},null,8,["label","to"]),n(rt,{icon:"fr-icon-chat-3-line",label:g(l)("Discussions"),to:{name:"organization-discussions",params:{oid:e.organization.id}},onClick:a[4]||(a[4]=a=>e.$emit("click"))},null,8,["label","to"]),n(rt,{icon:"fr-icon-parent-line",label:g(l)("Members"),to:{name:"organization-members",params:{oid:e.organization.id}},onClick:a[5]||(a[5]=a=>e.$emit("click"))},null,8,["label","to"]),n(rt,{icon:"fr-icon-server-line",label:g(l)("Harvesters"),to:{name:"organization-harvesters",params:{oid:e.organization.id}},onClick:a[6]||(a[6]=a=>e.$emit("click"))},null,8,["label","to"]),n(rt,{icon:"fr-icon-git-pull-request-line",label:g(l)("Community Resources"),to:{name:"organization-community-resources",params:{oid:e.organization.id}},onClick:a[7]||(a[7]=a=>e.$emit("click"))},null,8,["label","to"]),n(rt,{icon:"fr-icon-user-line",label:g(l)("Profile"),to:{name:"organization-profile",params:{oid:e.organization.id}},onClick:a[8]||(a[8]=a=>e.$emit("click"))},null,8,["label","to"])],64)):_("",!0)])],8,ut)],2))}}),ft=F(ct,[["__scopeId","data-v-fff6053b"]]),mt={class:"fr-container--fluid h-100"},vt={class:"fr-grid-row h-100 bg-grey-50"},pt={class:"fr-col-12 fr-col-md-4 fr-col-lg-3 fr-col-xl-2"},bt=["aria-label"],gt={class:"fr-sidemenu__inner"},yt=["aria-controls"],_t=["id"],ht={class:"fr-sidemenu__list"},wt={class:"fr-col-12 fr-col-md-8 fr-col-lg-9 fr-col-xl-10 h-100 fr-px-2w overflow-auto"},kt=l({__name:"Admin",setup(e){const{t:a}=M(),l=ue(),n=O("menu"),o=c(null),d=c(),{setCurrentOrganization:f}=Ka(),v=de();function p(e){return e===d.value}function y(e){d.value=e.id}return m((async()=>{var e;if(o.value=await ce(),l.name||(o.value.organizations.length>0?v.replace({name:"organization-datasets",params:{oid:o.value.organizations[0].id}}):v.replace({name:"me"})),"me"===l.name)d.value=null===(e=fe)||void 0===e?void 0:e.id;else if(o.value.organizations.length>0){let e=o.value.organizations[0];var a;l.params.oid&&(e=null!==(a=o.value.organizations.find((e=>e.id===l.params.oid)))&&void 0!==a?a:e),y(e),f(e)}})),(e,d)=>{const c=C("router-view");return t(),r("div",mt,[i("div",vt,[i("div",pt,[i("nav",{class:"fr-sidemenu fr-pr-0","aria-label":g(a)("Administration menu")},[i("div",gt,[i("button",{class:"fr-sidemenu__btn",hidden:"","aria-controls":g(n),"aria-expanded":"false"},u(g(a)("Open menu")),9,yt),i("div",{class:"fr-collapse",id:g(n)},[i("ul",ht,[g(fe)?(t(),b(ft,{key:0,user:g(fe),"is-opened":p(g(fe).id),onOpen:d[0]||(d[0]=e=>y(g(fe)))},null,8,["user","is-opened"])):_("",!0),o.value?(t(!0),r(s,{key:1},k(o.value.organizations,(e=>(t(),b(ft,{organization:e,"is-opened":p(e.id),onOpen:()=>y(e),onClick:()=>g(f)(e)},null,8,["organization","is-opened","onOpen","onClick"])))),256)):_("",!0)])],8,_t)])],8,bt)]),i("div",wt,[(t(),b(c,{key:g(l).fullPath,class:"fr-container--fluid"}))])])])}}}),xt=F(kt,[["__scopeId","data-v-364348c3"]]),zt=["aria-labelledby","id"],Ct={class:"fr-container fr-container--fluid fr-container-md"},$t={class:"fr-grid-row fr-grid-row--center"},At={class:"fr-col-12 fr-col-md-8"},Dt={class:"fr-modal__body"},St={class:"fr-modal__header"},Bt=["title","aria-controls"],jt={class:"fr-modal__content"},Rt=["id"],Mt={class:"fr-modal__footer"},Pt={class:"fr-btns-group fr-btns-group--right fr-btns-group--sm fr-btns-group--inline-lg fr-btns-group--icon-left"},qt=["disabled"],Tt=["disabled"],Ot=l({__name:"AdminAddMemberModal",props:{id:{},oid:{},roles:{}},emits:["memberAdded"],setup(e,{emit:a}){const l=e,r=a,{t:s}=M(),{toast:o}=ge(),d=c(!1),m=c(),v=c("editor"),p=f((()=>"fr-modal-title-user-"+l.id));async function y(){try{d.value=!0,m.value&&(await pe(l.oid,m.value,v.value),r("memberAdded"),w())}catch(e){o.error(s("An error occurred while update member role."))}finally{d.value=!1}}function h(e){return e.map((e=>{var a;const l={...e,avatar_thumbnail:null!==(a=e.avatar_url)&&void 0!==a?a:void 0};return{value:l.id,label:l.first_name+" "+l.last_name,image:be(l,32)}}))}function w(){d.value=!1,m.value=void 0,v.value="editor";const e=document.getElementById(l.id);globalThis.dsfr(e).modal.conceal()}return(e,a)=>(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":p.value,role:"dialog",id:e.id,class:"fr-modal"},[i("div",Ct,[i("div",$t,[i("div",At,[i("div",Dt,[i("div",St,[i("button",{class:"fr-btn--close fr-btn",title:g(s)("Close the modal dialog"),"aria-controls":e.id},u(g(s)("Close")),9,Bt)]),i("form",{onSubmit:D(y,["prevent"])},[i("div",jt,[i("h1",{id:p.value,class:"fr-modal__title fr-mb-2w"},u(g(s)("Add member to the organization")),9,Rt),n(me,{placeholder:e.$t("Search a user"),searchPlaceholder:e.$t("Search a user..."),suggestUrl:"/users/suggest/",values:m.value,onChange:a[0]||(a[0]=e=>m.value=e),allOption:e.$t("Select a user"),addAllOption:!1,onSuggest:h,roundedImages:!0},null,8,["placeholder","searchPlaceholder","values","allOption"]),e.roles.length>0?(t(),b(ve,{key:0,label:g(s)("Role of the member"),"model-value":v.value,"onUpdate:modelValue":a[1]||(a[1]=e=>v.value=e),options:e.roles},null,8,["label","model-value","options"])):_("",!0)]),i("div",Mt,[i("div",Pt,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"button",onClick:w,disabled:d.value},u(g(s)("Cancel")),9,qt),i("button",{class:"fr-btn",type:"submit",disabled:d.value},u(g(s)("Add to the organization")),9,Tt)])])],32)])])])])],8,zt)]))}}),Ft=["aria-controls"],Lt=l({__name:"AdminAddMemberButton",props:{oid:{},roles:{}},emits:["memberAdded"],setup(e){const a=e,{t:l}=M(),o=f((()=>"fr-modal-add-user-"+a.oid));return(e,a)=>(t(),r(s,null,[i("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-icon-add-line","data-fr-opened":"false","aria-controls":o.value},u(g(l)("Add member")),9,Ft),n(Ot,{id:o.value,oid:e.oid,roles:e.roles,onMemberAdded:a[0]||(a[0]=a=>e.$emit("memberAdded"))},null,8,["id","oid","roles"])],64))}}),Ut={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},It=l({__name:"AdminDangerZone",setup:e=>(e,a)=>(t(),b(g(ye),{color:"error",type:"secondary",weight:"regular"},{default:y((()=>[i("div",Ut,[w(e.$slots,"default")])])),_:3}))}),Vt={class:"fr-px-1v rounded-2 monospace fr-text--sm text-mention-grey bg-grey-100 fr-m-0"},Et=l({__name:"AdminEmail",props:{email:{}},setup:e=>(e,a)=>(t(),r("p",Vt,u(e.email),1))}),Ht=["aria-labelledby","id"],Yt={class:"fr-container fr-container--fluid fr-container-md"},Nt={class:"fr-grid-row fr-grid-row--center"},Wt={class:"fr-col-12 fr-col-md-8"},Zt={class:"fr-modal__body"},Jt={class:"fr-modal__header"},Qt=["title","aria-controls"],Xt={class:"fr-modal__content"},Kt=["id"],Gt={class:"fr-grid-row fr-grid-row--middle fr-mb-2w"},er={class:"fr-text--bold fr-m-0 fr-mr-1v"},ar={class:"fr-col"},lr={class:"fr-col-auto"},tr=["disabled"],rr={class:"fr-col"},sr={class:"fr-m-0 text-grey-500"},nr={class:"fr-m-0 fr-text--xs text-default-error"},or={class:"fr-col-auto"},ir=["disabled"],ur=l({__name:"AdminEditMemberModal",props:{id:{},member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(e,{emit:a}){const l=e,r=a,s=f((()=>"fr-modal-title-user-"+l.id)),{t:o}=M(),{toast:d}=ge(),m=c(!1);function v(){m.value=!1;const e=document.getElementById(l.id);globalThis.dsfr(e).modal.conceal()}return(e,a)=>{return t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":s.value,role:"dialog",id:e.id,class:"fr-modal"},[i("div",Yt,[i("div",Nt,[i("div",Wt,[i("div",Zt,[i("div",Jt,[i("button",{class:"fr-btn--close fr-btn",title:g(o)("Close the modal dialog"),"aria-controls":e.id},u(g(o)("Close")),9,Qt)]),i("div",Xt,[i("h1",{id:s.value,class:"fr-modal__title fr-mb-2w"},u(g(o)("Edit member")),9,Kt),i("div",Gt,[n(g(B),{class:"fr-mr-1v",user:e.member.user,rounded:!0,size:24},null,8,["user"]),i("p",er,u(e.member.user.first_name)+" "+u(e.member.user.last_name),1),e.member.user.email?(t(),b(Et,{key:0,email:e.member.user.email},null,8,["email"])):_("",!0)]),i("form",{class:"fr-grid-row fr-grid-row--gutters fr-grid-row--bottom",onSubmit:a[1]||(a[1]=D((a=>async function(e){if(e.newRole)try{m.value=!0,await _e(l.oid,e.user.id,e.newRole),r("memberUpdated"),v()}catch(a){d.error(o("An error occurred while update member role."))}finally{m.value=!1}else v()}(e.member)),["prevent"]))},[i("div",ar,[e.roles.length>0?(t(),b(ve,{key:0,label:g(o)("Role of the member"),"model-value":e.member.role,"onUpdate:modelValue":a[0]||(a[0]=a=>e.member.newRole=a),options:(c=e.member.role,l.roles.map((e=>{const a={...e};return a.value===c&&(a.selected=!0),a})))},null,8,["label","model-value","options"])):_("",!0)]),i("div",lr,[i("button",{class:"fr-btn",type:"submit",disabled:m.value},u(g(o)("Validate")),9,tr)])],32),n(It,{class:"fr-mt-2w"},{default:y((()=>[i("div",rr,[i("p",sr,u(g(o)("Remove member from the organization")),1),i("p",nr,u(g(o)("Be careful, this action can't be reverse.")),1)]),i("div",or,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-logout-box-r-line",disabled:m.value,onClick:a[2]||(a[2]=a=>async function(e){try{m.value=!0,await he(l.oid,e.user.id),r("memberUpdated")}catch(a){d.error(o("An error occurred while removing this member."))}finally{m.value=!1}}(e.member))},u(g(o)("Remove member")),9,ir)])])),_:1})])])])])])],8,Ht)]);var c}}}),dr=["aria-controls"],cr=l({__name:"AdminEditMemberButton",props:{member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(e){const a=e,{t:l}=M(),o=f((()=>"fr-modal-user-"+a.member.user.id));return(e,a)=>(t(),r(s,null,[i("button",{class:"fr-btn fr-btn--sm fr-btn--secondary-grey-500 fr-btn--tertiary-no-outline fr-icon-pencil-line","data-fr-opened":"false","aria-controls":o.value},u(g(l)("Edit")),9,dr),n(ur,{id:o.value,member:e.member,oid:e.oid,roles:e.roles,onMemberUpdated:a[0]||(a[0]=a=>e.$emit("memberUpdated"))},null,8,["id","member","oid","roles"])],64))}}),fr={class:"fr-mt-n9v fr-mb-2w"},mr={class:"fr-badge fr-badge--info fr-badge--no-icon"},vr={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},pr={class:"fr-col"},br={class:"fr-grid-row fr-grid-row--middle"},gr={class:"fr-text--bold fr-m-0 fr-mr-1v"},yr={class:"fr-m-0"},_r={class:"fr-ml-3v fr-mt-1-5v fr-mb-0 filet filet-default-grey fr-text--sm"},hr={key:0,class:"fr-col-auto fr-grid-row flex-direction-column"},wr=["disabled"],kr=["disabled","aria-controls"],xr=["aria-labelledby","id"],zr={class:"fr-container fr-container--fluid fr-container-md"},Cr={class:"fr-grid-row fr-grid-row--center"},$r={class:"fr-col-12 fr-col-md-8"},Ar={class:"fr-modal__body"},Dr={class:"fr-modal__header"},Sr=["title","aria-controls"],Br={class:"fr-modal__content"},jr=["id"],Rr={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--right"},Mr={class:"fr-col-auto"},Pr=["disabled"],qr={class:"fr-col-auto"},Tr=["disabled"],Or=l({__name:"AdminMembershipRequest",props:{loading:{type:Boolean},oid:{},request:{},showActions:{type:Boolean}},emits:["accept","refuse"],setup(e,{emit:a}){const l=e,s=a,{t:o}=M(),d=c(""),f=O("modal"),m=O("modalTitle");function v(){const e=document.getElementById(f);globalThis.dsfr(e).modal.conceal()}function p(){s("refuse",l.request.id,d.value),v()}function w(){d.value="",v()}return(e,a)=>{const l=C("AdminMembershipRequest",!0);return t(),b(V,{class:"drop-shadow rounded-xxs fr-mt-3w"},{default:y((()=>[i("div",fr,[i("p",mr,[a[2]||(a[2]=i("span",{class:"fr-icon-user-add-line fr-icon--sm","aria-hidden":"true"},null,-1)),h(" "+u(g(o)("Membership Request")),1)])]),i("div",vr,[i("div",pr,[i("div",br,[n(g(B),{class:"fr-mr-1v",user:e.request.user,rounded:!0,size:24},null,8,["user"]),i("p",gr,u(e.request.user.first_name)+" "+u(e.request.user.last_name),1),e.request.user.email?(t(),b(Et,{key:0,email:e.request.user.email,class:"fr-mr-1v"},null,8,["email"])):_("",!0),i("p",yr,u(g(o)("asks to join the organization.")),1)]),i("div",_r,u(e.request.comment),1)]),e.showActions?(t(),r("div",hr,[i("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-mb-1w fr-icon-check-line",onClick:a[0]||(a[0]=a=>e.$emit("accept",e.request.id)),disabled:e.loading,"data-testid":"accept"},u(g(o)("Accept request")),9,wr),i("button",{class:"fr-btn fr-btn--icon-left fr-btn--sm fr-btn--secondary fr-btn--secondary--error fr-icon-close-line",disabled:e.loading,"data-fr-opened":"false","aria-controls":g(f),"data-testid":"refuse"},u(g(o)("Refuse")),9,kr),(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":g(m),role:"dialog",id:g(f),class:"fr-modal","data-testid":"modal"},[i("div",zr,[i("div",Cr,[i("div",$r,[i("div",Ar,[i("div",Dr,[i("button",{class:"fr-btn--close fr-btn",title:g(o)("Close the modal dialog"),"aria-controls":g(f),onClick:D(w,["prevent"])},u(g(o)("Close")),9,Sr)]),i("div",Br,[i("h1",{id:g(m),class:"fr-modal__title fr-mb-2w"},u(g(o)("Refuse membership request")),9,jr),n(l,{class:"fr-mt-4w fr-mb-2w",loading:!1,oid:e.oid,request:e.request,"show-actions":!1},null,8,["oid","request"]),i("form",{onSubmit:D(p,["prevent"]),onReset:w},[n(we,{label:g(o)("You can provide the refusal reason:"),modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=e=>d.value=e),"data-testid":"comment-group"},null,8,["label","modelValue"]),i("div",Rr,[i("div",Mr,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"reset",disabled:e.loading,"data-testid":"cancel-modal-button"},u(g(o)("Cancel")),9,Pr)]),i("div",qr,[i("button",{class:"fr-btn",type:"submit",disabled:e.loading,"data-testid":"refuse-modal-button"},u(g(o)("Refuse request")),9,Tr)])])],32)])])])])])],8,xr)]))])):_("",!0)])])),_:1})}}}),Fr={key:0},Lr={class:"fr-breadcrumb__link","aria-current":"page"},Ur={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-center"},Ir={class:"fr-col-12 fr-col-md"},Vr={class:"fr-h3 fr-mb-0"},Er={key:0,class:"fr-col-auto"},Hr={class:"subtitle subtitle--uppercase fr-mt-5v fr-mb-0"},Yr={class:"fr-text--bold fr-m-0"},Nr={class:"fr-m-0 fr-text--xs text-mention-grey f-italic inline-flex items-center"},Wr={key:0},Zr={key:1},Jr={key:0},Qr=l({__name:"Members",props:{oid:{}},setup(e){const a=e;L(ke);const{t:l}=M(),{toast:o}=ge(),d=c([]),w=f((()=>xe||$.value.some((e=>{var a;return e.user.id===(null===(a=fe)||void 0===a?void 0:a.id)&&"admin"===e.role})))),x=c([]),{currentOrganization:z}=Ka(),$=c([]),A=c(!1);function D(e){var a,l;return null!==(a=null===(l=x.value.find((a=>a.value===e)))||void 0===l?void 0:l.label)&&void 0!==a?a:e}async function S(){A.value=!0,$.value=[];try{const e=await De(a.oid);$.value=e.members}finally{A.value=!1}}async function B(){const e=await ze(a.oid);d.value=e}async function R(e){A.value=!0;const t=[];try{await Se(a.oid,e),t.push(B()),t.push(S())}catch(r){o.error(l("An error occurred while accepting this membership."))}finally{Promise.all(t).finally((()=>A.value=!1))}}async function P(e,t){A.value=!0;const r=[];try{await Be(a.oid,e,t),r.push(B()),r.push(S())}catch(s){o.error(l("An error occurred while refusing this membership."))}finally{Promise.all(r).finally((()=>A.value=!1))}}return v((()=>{w.value&&ze(a.oid).then((e=>d.value=e))})),m((()=>{Ce().then($e).then((e=>x.value=e)),S()})),(e,a)=>{const o=C("router-link"),c=C("TextClamp");return t(),r("div",null,[n(za,null,{default:y((()=>[i("li",null,[n(o,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),g(z)?(t(),r("li",Fr,[n(o,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(z).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Lr,u(g(l)("Members")),1)])])),_:1}),i("div",Ur,[i("div",Ir,[i("h1",Vr,u(g(l)("Members")),1)]),w.value?(t(),r("div",Er,[n(Lt,{oid:e.oid,roles:x.value,onMemberAdded:S},null,8,["oid","roles"])])):_("",!0)]),d.value.length?(t(),r(s,{key:0},[i("h2",Hr,u(g(l)("{n} requests",{n:d.value.length})),1),(t(!0),r(s,null,k(d.value,(a=>(t(),b(Or,{class:"fr-mb-4w",key:a.id,loading:A.value,oid:e.oid,request:a,"show-actions":!0,onAccept:R,onRefuse:P},null,8,["loading","oid","request"])))),128))],64)):_("",!0),i("h2",{class:p(["subtitle subtitle--uppercase fr-mb-0",{"fr-mt-n3v":d.value.length,"fr-mt-5v":!d.value.length}])},u(g(l)("{n} members",{n:$.value.length})),3),n(Ta,{class:"fr-table--layout-fixed",loading:A.value},{default:y((()=>[i("thead",null,[i("tr",null,[n(Ua,{scope:"col"},{default:y((()=>[h(u(g(l)("Members")),1)])),_:1}),n(Ua,{scope:"col"},{default:y((()=>[h(u(g(l)("Status")),1)])),_:1}),n(Ua,{scope:"col"},{default:y((()=>[h(u(g(l)("Member since")),1)])),_:1}),n(Ua,{scope:"col"},{default:y((()=>[h(u(g(l)("Last connection")),1)])),_:1}),w.value?(t(),b(Ua,{key:0,scope:"col"},{default:y((()=>[h(u(g(l)("Action")),1)])),_:1})):_("",!0)])]),i("tbody",null,[(t(!0),r(s,null,k($.value,(a=>{return t(),r("tr",{key:a.user.id},[i("td",null,[i("p",Yr,u(a.user.first_name)+" "+u(a.user.last_name),1),i("p",Nr,[n(g(I),{height:12,width:12,name:"ri-mail-line"}),n(Ea,null,{default:y((()=>[n(c,{class:"fr-px-1v",text:a.user.email,"auto-resize":!0,"max-lines":1},null,8,["text"])])),_:2},1024)])]),i("td",null,[n(Sa,{type:(s=a.role,"admin"===s?"info":"default")},{default:y((()=>[h(u(D(a.role)),1)])),_:2},1032,["type"])]),i("td",null,u(g(j)(a.since)),1),i("td",null,[a.user.last_login_at?(t(),r("span",Wr,u(g(Ae)(a.user.last_login_at)),1)):(t(),r("span",Zr,u(g(l)("No connection")),1))]),w.value?(t(),r("td",Jr,[n(cr,{member:a,oid:e.oid,roles:x.value,onMemberUpdated:S},null,8,["member","oid","roles"])])):_("",!0)]);var s})),128))])])),_:1},8,["loading"])])}}}),Xr={class:"fr-container--fluid"},Kr={key:0},Gr={class:"fr-breadcrumb__link","aria-current":"page"},es={class:"fr-h3 fr-mb-5v"},as={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-between"},ls={class:"fr-col-12 fr-col-md fr-grid-row fr-grid-row--middle"},ts={class:"fr-ml-3v fr-my-0 fr-h3"},rs=["title"],ss={class:"fr-col-auto"},ns=["href"],os=["id"],is=["disabled","onClick"],us={class:"fr-col"},ds={class:"fr-m-0 text-grey-500"},cs={class:"fr-m-0 fr-text--xs text-default-error"},fs={class:"fr-col-auto"},ms=["disabled","aria-controls"],vs=["aria-labelledby","id"],ps={class:"fr-container fr-container--fluid fr-container-md"},bs={class:"fr-grid-row fr-grid-row--center"},gs={class:"fr-col-12 fr-col-md-8"},ys={class:"fr-modal__body"},_s={class:"fr-modal__header"},hs=["title","aria-controls"],ws={class:"fr-modal__content"},ks=["id"],xs={class:"fr-text--bold"},zs={class:"fr-modal__footer"},Cs={class:"fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left"},$s=["disabled"],As=l({__name:"Profile",props:{oid:{}},setup(e){const{t:a}=M(),{toast:l}=ge(),s=e,o=de(),d=c(null),{currentOrganization:f}=Ka(),v=c(null),{organizationCertified:p}=je(v),w=c([]),k=c(!1),x=O("modal"),z=O("modalTitle");function $(){f.value&&(k.value=!0,Pe(f.value.id).then((()=>{o.replace("/"),window.location.reload()})).catch((()=>l.error(a("An error occured when deleting the organization.")))).finally((()=>k.value=!1)))}async function D(e,t){k.value=!0;try{v.value=await qe(e),l.success(a("Organization updated !"))}catch(r){l.error(a("An error occured when updating the organization."))}finally{k.value=!1}if(t&&v.value){k.value=!0;try{const e=await Te(v.value.id,t);v.value.logo_thumbnail=e.image}catch(r){l.error(a("Failed to upload logo, you can upload it again in your management panel"))}finally{k.value=!1}}}return m((async()=>{k.value=!0;try{v.value=await De(s.oid)}finally{k.value=!1}})),(e,l)=>{const s=C("router-link");return t(),r("div",Xr,[n(za,null,{default:y((()=>[i("li",null,[n(s,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(a)("Administration")),1)])),_:1})]),g(f)?(t(),r("li",Kr,[n(s,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(f).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Gr,u(g(a)("Profile")),1)])])),_:1}),i("h1",es,u(g(a)("Profile")),1),v.value?(t(),b(V,{key:0,class:"fr-mb-5v"},{default:y((()=>[i("div",as,[i("div",ls,[n(g(Re),{src:v.value.logo,type:"organization",size:80,class:"rounded-xxs border"},null,8,["src"]),i("div",ts,[h(u(v.value.name)+" ",1),g(p)?(t(),r("span",{key:0,class:"fr-icon-success-line fr-icon--lg text-blue-400",title:g(a)("The identity of this public service is certified by {certifier}",{certifier:g(Z)}),"aria-hidden":"true"},null,8,rs)):_("",!0)])]),i("div",ss,[i("a",{href:v.value.page,class:"fr-btn fr-btn--sm fr-btn--secondary fr-btn--secondary-grey-500 fr-btn--icon-left fr-icon-eye-line"},u(g(a)("See the organization page")),9,ns)])])])),_:1})):_("",!0),d.value?(t(),r("h2",{key:1,class:"subtitle subtitle--uppercase fr-mb-5v",id:d.value.legend},u(g(a)("Edit profile")),9,os)):_("",!0),k.value&&!v.value?(t(),b(Ma,{key:2})):_("",!0),v.value?(t(),b(Me,{key:3,organization:v.value,errors:w.value,showLegend:!1,showWell:!1,ref_key:"form",ref:d,onSubmit:D},{submitButton:y((({submit:e})=>[i("button",{class:"fr-btn fr-btn--icon-left fr-icon-save-line",disabled:k.value,"data-testid":"submitButton",onClick:e},u(g(a)("Save")),9,is)])),default:y((()=>[n(It,{class:"fr-mt-6w"},{default:y((()=>[i("div",us,[i("p",ds,u(g(a)("Delete the organization")),1),i("p",cs,u(g(a)("Be careful, this action can't be reverse.")),1)]),i("div",fs,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-delete-line",disabled:k.value,"data-fr-opened":"false","aria-controls":g(x)},u(g(a)("Delete")),9,ms),(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":g(z),role:"dialog",id:g(x),class:"fr-modal"},[i("div",ps,[i("div",bs,[i("div",gs,[i("div",ys,[i("div",_s,[i("button",{class:"fr-btn--close fr-btn",title:g(a)("Close the modal dialog"),"aria-controls":g(x)},u(g(a)("Close")),9,hs)]),i("div",ws,[i("h1",{id:g(z),class:"fr-modal__title fr-mb-2w"},u(g(a)("Are you sure you want to delete this organization ?")),9,ks),i("p",xs,u(g(a)("This action can't be reverse.")),1),i("p",null,u(g(a)("All content published with this organization will stay online, with the same URL but in an anonymous form, i.e. without being linked to a data producer.")),1),i("p",null,u(g(a)("If you want to delete your published content too, start by deleting the contents before deleting your account.")),1)]),i("div",zs,[i("div",Cs,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error",role:"button",disabled:k.value,onClick:$},u(g(a)("Delete")),9,$s)])])])])])])],8,vs)]))])])),_:1})])),_:1},8,["organization","errors"])):_("",!0)])}}});async function Ds(e){switch(e.class){case"Dataservice":return Ye(e.id);case"Dataset":return He(e.id);case"Post":return async function(e){return(await Oe.get(`posts/${e}/`)).data}(e.id);case"Reuse":return Ee(e.id);default:return null}}function Ss(e,a){return null===e?null:{title:Bs(e),icon:Rs(a),page:js(e)}}function Bs(e){return null===e?"":"title"in e?e.title:"headline"in e?e.headline:Ne(e,`Unknown type ${e}`)}function js(e){return null===e?"":"page"in e?e.page:"self_web_url"in e?e.self_web_url:Ne(e,`Unknown type ${e}`)}function Rs(e){switch(e){case"Dataservice":return"ri-terminal-line";case"Dataset":return"ri-database-2-line";case"Post":return"ri-article-line";case"Reuse":return"ri-line-chart-line";default:return""}}L(Ie,Ue,Le,Fe);const Ms={class:"fr-text--bold"},Ps={key:0},qs=["href"],Ts={class:"inline-flex items-center"},Os=["href"],Fs=l({__name:"AdminDiscussionsTable",props:{discussions:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(e){const l=e,{t:o}=M(),d=c({}),f=c({});function m(e,a){return a?a.page+"#/discussions/"+e:""}function p(e){return l.sortedBy===e?l.sortDirection:null}function w(e){return e.discussion.slice(-1)[0]}return v((async()=>{for(const e of l.discussions)if(!(e.subject.id in d.value)){const a=Ds(e.subject);d.value[e.subject.id]=a;const l=await d.value[e.subject.id];f.value[e.subject.id]=Ss(l,e.subject.class)}})),(e,l)=>(t(),b(Ta,{class:"fr-table--layout-fixed",loading:e.loading},{default:y((()=>[i("thead",null,[n(Ua,{onSort:l[0]||(l[0]=a=>e.$emit("sort","title",a)),sorted:p("title"),scope:"col"},{default:y((()=>[h(u(g(o)("Discussion")),1)])),_:1},8,["sorted"]),n(Ua,{scope:"col"},{default:y((()=>[h(u(g(o)("Number of comments")),1)])),_:1}),n(Ua,{scope:"col"},{default:y((()=>[h(u(g(o)("Last comment")),1)])),_:1}),n(Ua,{onSort:l[1]||(l[1]=a=>e.$emit("sort","closed",a)),sorted:p("closed"),scope:"col"},{default:y((()=>[h(u(g(o)("Closed at")),1)])),_:1},8,["sorted"]),n(Ua,{scope:"col",style:{width:"25%"}},{default:y((()=>[h(u(g(o)("Link to the discussion")),1)])),_:1})]),i("tbody",null,[(t(!0),r(s,null,k(e.discussions,(e=>{var l,d,c;return t(),r("tr",null,[i("td",null,[i("p",Ms,[n(g(E),{text:e.title,"auto-resize":!0,"max-lines":1},null,8,["text"])]),f.value[e.subject.id]?(t(),r("p",Ps,[i("a",{class:"fr-link inline-flex",href:null===(l=f.value[e.subject.id])||void 0===l?void 0:l.page},[n(g(I),{height:12,class:"self-center",name:null===(d=f.value[e.subject.id])||void 0===d?void 0:d.icon},null,8,["name"]),n(g(E),{class:"overflow-wrap-anywhere",text:null===(c=f.value[e.subject.id])||void 0===c?void 0:c.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,qs)])):_("",!0)]),i("td",null,u(e.discussion.length),1),i("td",null,[i("div",null,[i("p",null,u(g(j)(w(e).posted_on)),1),i("p",Ts,[h(u(g(o)("by "))+" ",1),n(g(a),{class:"fr-ml-1v",user:w(e).posted_by},null,8,["user"])])])]),i("td",null,[e.closed?(t(),r(s,{key:0},[h(u(g(j)(e.closed)),1)],64)):_("",!0)]),i("td",null,[f.value[e.subject.id]?(t(),r("a",{key:0,class:"fr-link inline-flex",href:m(e.id,f.value[e.subject.id]),target:"_blank"},[n(g(E),{text:m(e.id,f.value[e.subject.id]),"auto-resize":!0,"max-lines":1},null,8,["text"])],8,Os)):_("",!0)])])})),256))])])),_:1},8,["loading"]))}}),Ls={class:"fr-container--fluid"},Us={key:0},Is={class:"fr-breadcrumb__link","aria-current":"page"},Vs={class:"fr-h3 fr-mb-5v"},Es={class:"subtitle subtitle--uppercase fr-m-0"},Hs={class:"text-align-center fr-py-1w"},Ys=["src"],Ns={class:"fr-text--bold fr-my-3v"},Ws=l({__name:"Discussions",props:{oid:{}},setup(e){const{t:a}=M(),l=e,s=c(!1),o=c(1),d=c(10),m=c(0),p=c("created"),w=c("desc"),k=f((()=>`${"asc"===w.value?"":"-"}${p.value}`)),x=c([]),{currentOrganization:z}=Ka();function $(e,a){p.value=e,w.value=a}return v((async()=>{s.value=!0,x.value=[];try{const e=await async function(e,a,l,t){return(await Oe.get(Ve("discussions/"),{params:{org:e,sort:t,page_size:l,page:a}})).data}(l.oid,o.value,d.value,k.value);x.value=e.data,o.value=e.page,d.value=e.page_size,m.value=e.total}finally{s.value=!1}})),(e,l)=>{const c=C("router-link");return t(),r("div",Ls,[n(za,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(a)("Administration")),1)])),_:1})]),g(z)?(t(),r("li",Us,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(z).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Is,u(g(a)("Discussions")),1)])])),_:1}),i("h1",Vs,u(g(a)("Discussions")),1),i("h2",Es,u(g(a)("{n} discussions",m.value)),1),s.value||m.value>0?(t(),b(Fs,{key:0,discussions:x.value,loading:s.value,"sort-direction":w.value,sortedBy:p.value,onSort:$},null,8,["discussions","loading","sort-direction","sortedBy"])):(t(),b(V,{key:1,class:"fr-my-2w"},{default:y((()=>[i("div",Hs,[i("img",{src:g("/_themes/gouvfr/assets/discussion.svg"),alt:"",loading:"lazy"},null,8,Ys),i("p",Ns,u(g(a)("There is no discussion yet")),1)])])),_:1})),m.value>d.value?(t(),b(g(ae),{key:2,page:o.value,"page-size":d.value,"total-results":m.value,onChange:l[0]||(l[0]=e=>o.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}}),Zs={class:"fr-container--fluid"},Js={key:0},Qs={class:"fr-breadcrumb__link","aria-current":"page"},Xs={class:"fr-h3 fr-mb-5v"},Ks={class:"subtitle subtitle--uppercase fr-m-0"},Gs=["href"],en={class:"text-align-center fr-py-1w"},an=["src"],ln={class:"fr-text--bold fr-my-3v"},tn=l({__name:"Harvesters",props:{oid:{}},setup(e){const{t:a}=M(),l=e,o=c(!1),d=c(1),f=c(10),m=c(0),p=c([]),w=c({}),{currentOrganization:x}=Ka();function z(e){return`${Y}harvester/${e.id}/`}function $(e){return e.last_job&&w.value[e.last_job.id]?w.value[e.last_job.id].items.filter((e=>e.dataservice)).length:0}function A(e){return e.last_job&&w.value[e.last_job.id]?w.value[e.last_job.id].items.filter((e=>e.dataset)).length:0}function D(e){var l;switch(null===(l=e.last_job)||void 0===l?void 0:l.status){case"pending":return{label:a("Pending"),type:"default"};case"initializing":return{label:a("Initializing"),type:"info"};case"initialized":return{label:a("Initialized"),type:"default"};case"processing":return{label:a("Processing"),type:"info"};case"done":return{label:a("Done"),type:"success"};case"done-errors":return{label:a("Done with errors"),type:"warning"};case"failed":return{label:a("Failed"),type:"error"};default:return{label:a("No job yet"),type:"default"}}}return v((async()=>{o.value=!0,p.value=[];try{const a=await async function(e,a,l){return(await Oe.get(Ve("harvest/sources/"),{params:{owner:e,deleted:!0,page:a,page_size:l}})).data}(l.oid,d.value,f.value);p.value=a.data,d.value=a.page,f.value=a.page_size,m.value=a.total;const t=[];for(const l of p.value){var e;null!==(e=l.last_job)&&void 0!==e&&e.id&&t.push(Oe.get(`harvest/job/${l.last_job.id}/`))}const r=await Promise.allSettled(t);for(const e of r)"fulfilled"===e.status&&(w.value[e.value.data.id]=e.value.data)}finally{o.value=!1}})),(e,l)=>{const c=C("router-link");return t(),r("div",Zs,[n(za,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(a)("Administration")),1)])),_:1})]),g(x)?(t(),r("li",Js,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(x).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Qs,u(g(a)("Harvesters")),1)])])),_:1}),i("h1",Xs,u(g(a)("Harvesters")),1),i("h2",Ks,u(g(a)("{n} harvesters",m.value)),1),o.value||m.value?(t(),b(Ta,{key:0,loading:o.value},{default:y((()=>[i("thead",null,[n(Ua,{scope:"col"},{default:y((()=>[h(u(g(a)("Name")),1)])),_:1}),n(Ua,{scope:"col"},{default:y((()=>[h(u(g(a)("Status")),1)])),_:1}),n(Ua,{scope:"col"},{default:y((()=>[h(u(g(a)("Created at")),1)])),_:1}),n(Ua,{scope:"col"},{default:y((()=>[h(u(g(a)("Last run")),1)])),_:1}),n(Ua,{scope:"col"},{default:y((()=>[h(u(g(a)("Datasets")),1)])),_:1}),n(Ua,{scope:"col"},{default:y((()=>[h(u(g(a)("Dataservices")),1)])),_:1})]),i("tbody",null,[(t(!0),r(s,null,k(p.value,(e=>{var l;return t(),r("tr",null,[i("td",null,[n(Ra,null,{default:y((()=>[i("a",{class:"fr-link fr-reset-link",href:z(e)},[n(g(E),{text:e.name,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Gs)])),_:2},1024)]),i("td",null,[n(Sa,{type:D(e).type},{default:y((()=>[h(u(D(e).label),1)])),_:2},1032,["type"])]),i("td",null,u(g(j)(e.created_at)),1),i("td",null,[null!==(l=e.last_job)&&void 0!==l&&l.ended?(t(),r(s,{key:0},[h(u(g(j)(e.last_job.ended)),1)],64)):(t(),r(s,{key:1},[h(u(g(a)("Not yet")),1)],64))]),i("td",null,u(A(e)),1),i("td",null,u($(e)),1)])})),256))])])),_:1},8,["loading"])):(t(),b(V,{key:1,class:"fr-my-2w"},{default:y((()=>[i("div",en,[i("img",{src:g("/_themes/gouvfr/assets/harvester.svg"),alt:"",loading:"lazy"},null,8,an),i("p",ln,u(g(a)("There is no harvesters yet")),1),n(al,{type:"harvester"})])])),_:1})),m.value>f.value?(t(),b(g(ae),{key:2,page:d.value,"page-size":f.value,"total-results":m.value,onChange:l[0]||(l[0]=e=>d.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}}),rn=["href"],sn={key:0},nn=["href"],on={class:"fr-p-1v monospaced bg-grey-100 fr-text--sm text-mention-grey rounded-xxs"},un=l({__name:"AdminCommunityResourcesTable",props:{communityResources:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(e){const a=e,{t:l}=M();function o(e){return a.sortedBy===e?a.sortDirection:null}function d(e){return`${Y}dataset/${e.dataset.id}/community-resource/${e.id}/`}function c(e){const a=e.extras&&"check:available"in e.extras;return a&&!1===e.extras["check:available"]?{label:l("Unavailable"),type:"error"}:a?{label:l("Available"),type:"info"}:{label:l("Not checked yet"),type:"default"}}return(e,a)=>{const f=C("Vicon");return t(),b(Ta,{loading:e.loading},{default:y((()=>[i("thead",null,[n(Ua,{onSort:a[0]||(a[0]=a=>e.$emit("sort","title",a)),sorted:o("title"),scope:"col"},{default:y((()=>[h(u(g(l)("Resource title")),1)])),_:1},8,["sorted"]),n(Ua,null,{default:y((()=>[h(u(g(l)("Status")),1)])),_:1}),n(Ua,null,{default:y((()=>[h(u(g(l)("Format")),1)])),_:1}),n(Ua,{onSort:a[1]||(a[1]=a=>e.$emit("sort","created_at_internal",a)),sorted:o("created_at_internal"),scope:"col"},{default:y((()=>[h(u(g(l)("Created at")),1)])),_:1},8,["sorted"]),n(Ua,{onSort:a[2]||(a[2]=a=>e.$emit("sort","last_modified_internal",a)),sorted:o("last_modified_internal"),scope:"col"},{default:y((()=>[h(u(g(l)("Modified at")),1)])),_:1},8,["sorted"])]),i("tbody",null,[(t(!0),r(s,null,k(e.communityResources,(a=>{var l,s;return t(),r("tr",null,[i("td",null,[n(Ra,{class:"fr-text--bold"},{default:y((()=>[i("a",{class:"fr-link fr-reset-link",href:d(a)},[n(g(E),{text:a.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,rn)])),_:2},1024),e.datasets[a.dataset.id]?(t(),r("p",sn,[i("a",{class:"fr-link inline-flex",href:null===(l=e.datasets[a.dataset.id])||void 0===l?void 0:l.page},[n(f,{height:12,class:"self-center",name:e.getSubjectTypeIcon("Dataset")},null,8,["name"]),n(g(E),{class:"overflow-wrap-anywhere",text:null===(s=e.datasets[a.dataset.id])||void 0===s?void 0:s.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,nn)])):_("",!0)]),i("td",null,[n(Sa,{type:c(a).type},{default:y((()=>[h(u(c(a).label),1)])),_:2},1032,["type"])]),i("td",null,[i("code",on,u(a.format),1)]),i("td",null,u(g(j)(a.created_at)),1),i("td",null,u(g(j)(a.last_modified)),1)])})),256))])])),_:1},8,["loading"])}}}),dn={class:"fr-container--fluid"},cn={key:0},fn={class:"fr-breadcrumb__link","aria-current":"page"},mn={class:"fr-h3 fr-mb-5v"},vn={class:"subtitle subtitle--uppercase fr-m-0"},pn={class:"text-align-center fr-py-1w"},bn=["src"],gn={class:"fr-text--bold fr-my-3v"},yn=l({__name:"CommunityResources",props:{oid:{}},setup(e){const{t:a}=M(),l=e,s=c([]),o=c(!1),d=c(1),m=c(10),p=c(0),w=c("created_at_internal"),k=c("desc"),x=f((()=>`${"asc"===k.value?"":"-"}${w.value}`)),{currentOrganization:z}=Ka(),$=Q();function A(e,a){w.value=e,k.value=a}return v((async()=>{o.value=!0,s.value=[];try{let e;if(l.oid)e=await We(l.oid,d.value,m.value,x.value);else{if(!$.value)return;e=await Ze($.value.id,d.value,m.value,x.value)}s.value=e.data,d.value=e.page,m.value=e.page_size,p.value=e.total}finally{o.value=!1}})),(e,l)=>{const c=C("router-link");return t(),r("div",dn,[n(za,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(a)("Administration")),1)])),_:1})]),g(z)?(t(),r("li",cn,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(z).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",fn,u(g(a)("Community Resources")),1)])])),_:1}),i("h1",mn,u(g(a)("Community Resources")),1),i("h2",vn,u(g(a)("{n} community resources",s.value.length)),1),o.value||p.value>0?(t(),b(un,{key:0,"community-resources":s.value,loading:o.value,sortDirection:k.value,sortedBy:w.value,onSort:A},null,8,["community-resources","loading","sortDirection","sortedBy"])):(t(),b(V,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:y((()=>[i("div",pn,[i("img",{src:g(Je),alt:"",loading:"lazy"},null,8,bn),i("p",gn,u(g(a)("You haven't published a community resource yet")),1)])])),_:1})),p.value>m.value?(t(),b(g(ae),{key:2,page:d.value,"page-size":m.value,"total-results":p.value,onChange:l[0]||(l[0]=e=>d.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}});Qe({admin_root:Y,default_lang:Xe.global.locale.value,only_locales:Xe.global.locale.value,schema_documentation_url:Ke,schema_validata_url:Ge,show_copy_resource_permalink:!0,tabular_api_url:ea,tabular_page_size:aa,title:Z});const _n=[{path:"/me",children:[{path:"",component:et,name:"me"},{path:"datasets",component:wl,name:"me-datasets"},{path:"dataservices",component:Ml,name:"me-dataservices"},{path:"reuses",component:Zl,name:"me-reuses"},{path:"community-resources",component:yn,name:"me-community-resources"}]},{path:"/organizations/:oid",children:[{path:"datasets",component:wl,props:!0,name:"organization-datasets"},{path:"dataservices",component:Ml,props:!0,name:"organization-dataservices"},{path:"reuses",component:Zl,props:!0,name:"organization-reuses"},{path:"discussions",component:Ws,props:!0,name:"organization-discussions"},{path:"members",component:Qr,props:!0,name:"organization-members"},{path:"harvesters",component:tn,props:!0,name:"organization-harvesters"},{path:"community-resources",component:yn,props:!0,name:"organization-community-resources"},{path:"profile",component:As,props:!0,name:"organization-profile"}]}],hn=la({history:ta(),routes:_n}),wn=S(xt);ra(wn),wn.use(sa),wn.use(na),wn.use(Xe),wn.use(hn),wn.mount("#admin"),globalThis.dsfr.start(),console.log("JS is injected !")}}}));
