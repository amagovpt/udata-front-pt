System.register(["vue","./sentry-legacy.6.1.3.js","vue-content-loader","./_commonjsHelpers-legacy.6.1.3.js"],(function(e,l){"use strict";var a,t,r,s,n,o,i,u,d,c,f,m,v,p,b,g,y,_,h,w,k,x,z,C,$,A,D,B,S,j,R,M,O,T,P,q,L,E,I,V,U,Y,H,N,W,F,Z,J,G,K,X,Q,ee,le,ae,te,re,se,ne,oe,ie,ue,de,ce,fe,me,ve,pe,be,ge,ye,_e,he,we,ke,xe,ze,Ce,$e,Ae,De,Be,Se,je,Re,Me,Oe,Te,Pe,qe,Le,Ee,Ie,Ve,Ue,Ye,He,Ne,We,Fe,Ze,Je,Ge,Ke,Xe,Qe,el,ll,al,tl,rl,sl;return{setters:[e=>{a=e.defineComponent,t=e.openBlock,r=e.createElementBlock,s=e.Fragment,n=e.createVNode,o=e.mergeProps,i=e.createElementVNode,u=e.toDisplayString,d=e.useTemplateRef,c=e.ref,f=e.computed,m=e.onMounted,v=e.watchEffect,p=e.normalizeClass,b=e.createBlock,g=e.unref,y=e.withCtx,_=e.createCommentVNode,h=e.createTextVNode,w=e.renderSlot,k=e.renderList,x=e.readonly,z=e.useId,C=e.resolveComponent,$=e.watchPostEffect,A=e.Teleport,D=e.withModifiers,B=e.createApp},e=>{S=e.C,j=e.K,R=e.bG,M=e.v,O=e.E,T=e.G,P=e._,q=e.b,L=e.bH,E=e.h,I=e.an,V=e.y,U=e.A,Y=e.bh,H=e.bI,N=e.bJ,W=e.ax,F=e.bs,Z=e.bK,J=e.bL,G=e.bM,K=e.bN,X=e.as,Q=e.L,ee=e.af,le=e.bO,ae=e.bP,te=e.bn,re=e.bQ,se=e.bR,ne=e.bd,oe=e.bS,ie=e.bT,ue=e.aZ,de=e.X,ce=e.a7,fe=e.aW,me=e.bU,ve=e.ay,pe=e.$,be=e.a1,ge=e.bV,ye=e.bW,_e=e.aM,he=e.bX,we=e.bY,ke=e.bZ,xe=e.b_,ze=e.b$,Ce=e.c0,$e=e.c1,Ae=e.c2,De=e.c3,Be=e.x,Se=e.B,je=e.bg,Re=e.c4,Me=e.c5,Oe=e.bj,Te=e.a,Pe=e.c6,qe=e.c7,Le=e.c8,Ee=e.c9,Ie=e.a8,Ve=e.ca,Ue=e.cb,Ye=e.cc,He=e.cd,Ne=e.ce,We=e.cf,Fe=e.au,Ze=e.bu,Je=e.bx,Ge=e.aY,Ke=e.by,Xe=e.bA,Qe=e.bB,el=e.cg,ll=e.ch,al=e.bC,tl=e.bD,rl=e.bE},e=>{sl=e.ContentLoader},null],execute:function(){const e={class:"fr-ml-1v fr-text--bold"},l=a({__name:"AvatarWithName",props:{user:{},size:{default:12}},setup:l=>(l,a)=>(t(),r(s,null,[n(S,o(l.$attrs,{user:l.user,size:l.size,rounded:!0}),null,16,["user","size"]),i("span",e,u(l.user.first_name)+" "+u(l.user.last_name),1)],64))}),nl={ref:"canvasRef",width:"120",height:"30"},ol={class:"fr-grid-row justify-between"},il={class:"text-xxs fr-m-0 text-mention-grey"},ul={class:"text-xxs fr-m-0 text-mention-grey"},dl="#B6CFFB",cl="#3558A2",fl=a({__name:"SmallChart",props:{data:{},type:{},lastWithLowEmphasis:{type:Boolean,default:!1}},setup(e){const l=e,a=(e,l)=>e.p1DataIndex===b.value.length-1?l:null,s=d("canvasRef"),n=c(null),o=c(null),p=f((()=>{const e=Object.keys(l.data);e.sort();let a={};for(const t of e)a[t]=l.data[t];return a})),b=f((()=>Object.keys(p.value))),g=f((()=>Object.values(p.value))),y=f((()=>"bar"===l.type?{barPercentage:1,categoryPercentage:.9,backgroundColor:b.value.map(((e,a)=>a===b.value.length-1?l.lastWithLowEmphasis?"rgba(182, 207, 251, 0.7)":cl:dl))}:"line"===l.type&&l.lastWithLowEmphasis?{segment:{borderColor:e=>a(e,"rgba(53, 88, 162, 0.7)")||cl,borderDash:e=>a(e,[3,3])||[6,0]}}:{})),_=f((()=>b.value.length?j(b.value[0],"MM/YY"):null)),h=f((()=>b.value.length?j(b.value[b.value.length-1],"MM/YY"):null)),w={animation:!1,responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!1}},elements:{bar:{backgroundColor:dl,borderRadius:2,hoverBackgroundColor:cl},line:{backgroundColor:cl,borderColor:cl,borderJoinStyle:"round",tension:.35},point:{radius:0}},scales:{x:{display:!1,grid:{display:!1},ticks:{display:!1}},y:{display:!1,grid:{display:!1},ticks:{display:!1}}},layout:{padding:{top:1.5}}};return m((()=>{n.value=s.value?s.value.getContext("2d"):null})),v((()=>{n.value&&(o.value&&o.value.destroy(),o.value=new R(n.value,{data:{labels:b.value,datasets:[{data:g.value,type:l.type,...y.value}]},options:w}))})),(e,l)=>(t(),r("div",null,[i("canvas",nl,null,512),i("div",ol,[i("p",il,u(_.value),1),i("p",ul,u(h.value),1)])]))}}),ml={class:"fr-text--sm fr-m-0"},vl={class:"fr-grid-row fr-grid-row--middle"},pl={key:1,class:"h1 line-height-1 fr-m-0"},bl={key:3,class:"fr-ml-1w"},gl={key:0,class:"fr-mt-1w fr-text--regular text-transform-none fr-badge fr-badge--no-icon fr-badge--success"},yl={class:"fr-mr-1v"},_l=a({__name:"StatBox",props:{title:{},data:{},type:{},summary:{}},setup(e){const l=e,{t:a}=M(),s=f((()=>l.data?Object.keys(l.data):[])),o=f((()=>l.data?Object.values(l.data):[])),d=f((()=>s.value.length?s.value.reduce(((e,l)=>l>e?l:e)):null)),c=f((()=>d.value?s.value.indexOf(d.value):null)),m=f((()=>null!==c.value?o.value[c.value]:null)),v=f((()=>Math.max(...o.value)>0));return(e,l)=>(t(),r("div",{class:p({"text-mention-grey":!v.value&&!e.summary})},[i("h3",ml,u(e.title),1),i("div",vl,[null===e.summary?(t(),b(g(sl),{key:0,width:92,height:32,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},{default:y((()=>l[0]||(l[0]=[i("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"92",height:"32"},null,-1)]))),_:1})):(t(),r("p",pl,u(g(O)(e.summary,2)),1)),null===e.data?(t(),b(g(sl),{key:2,width:120,height:30,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",class:"fr-ml-1w"},{default:y((()=>l[1]||(l[1]=[i("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"120",height:"30"},null,-1)]))),_:1})):v.value?(t(),r("div",bl,[n(fl,{type:e.type,data:e.data,lastWithLowEmphasis:!0},null,8,["type","data"])])):_("",!0)]),m.value&&d.value?(t(),r("p",gl,[i("strong",yl," +Â "+u(g(O)(m.value,2)),1),h(" "+u(g(a)(" in "))+" "+u(g(j)(d.value,"MMM YYYY")),1)])):_("",!0)],2))}}),hl=["aria-label"],wl={class:"fr-breadcrumb__list"},kl={__name:"Breadcrumb",setup(e){const{t:l}=M();return(e,a)=>(t(),r("nav",{rol:"navigation","aria-label":g(l)("You're here:"),class:"fr-breadcrumb fr-mb-5v"},[i("ol",wl,[w(e.$slots,"default")])],8,hl))}},xl=a({__name:"AdminBadge",props:{type:{}},setup:e=>(e,l)=>(t(),r("p",{class:p(["fr-badge",{"fr-badge--blue-cumulus":"info"===e.type,"fr-badge--error fr-badge--no-icon":"error"===e.type,"fr-badge--warning fr-badge--no-icon":"warning"===e.type,"fr-badge--success fr-badge--no-icon":"success"===e.type}])},[w(e.$slots,"default")],2))}),zl=["aria-describedby"],Cl=["id"],$l=P(a({inheritAttrs:!1,__name:"AdminContentWithTooltip",setup(e){const l=T(),a=c(),n=c("");return m((()=>{a.value&&(n.value=a.value.textContent||"")})),(e,d)=>(t(),r(s,null,[i("p",o(e.$attrs,{"aria-describedby":g(l),ref_key:"contentRef",ref:a}),[w(e.$slots,"default",{},void 0,!0)],16,zl),i("span",{class:"fr-hidden-xl fr-tooltip fr-placement",id:g(l),role:"tooltip","aria-hidden":"true"},u(n.value),9,Cl)],64))}}),[["__scopeId","data-v-d192f17a"]]),Al=a({__name:"AdminLoader",props:{scale:{default:4}},setup:e=>(q(L),(e,l)=>(t(),b(g(E),{name:"ri-loader-5-line",animation:"spin",scale:e.scale,fill:"var(--blue-cumulus-sun-368-moon-732)"},null,8,["scale"])))}),Dl={class:"fr-table fr-mb-2w"},Bl=a({__name:"AdminTable",props:{loading:{type:Boolean,default:!1}},setup:e=>(e,l)=>(t(),r("div",Dl,[i("table",null,[w(e.$slots,"default",{},void 0,!0)]),e.loading?(t(),b(I,{key:0,class:"fr-p-4w text-align-center"},{default:y((()=>[n(Al)])),_:1})):_("",!0)]))}),Sl=P(Bl,[["__scopeId","data-v-cae574a4"]]),jl={class:"fr-text--bold"},Rl={key:1,class:"fr-grid-row fr-grid-row--middle justify-between"},Ml=["title"],Ol=P(a({__name:"AdminTableTh",props:{sorted:{}},emits:["sort"],setup(e,{emit:l}){const a=e,s=l,{t:n}=M(),o=f((()=>void 0!==a.sorted));function d(){return"desc"===a.sorted?s("sort","asc"):s("sort","desc")}return(e,l)=>(t(),r("th",jl,[o.value?(t(),r("div",Rl,[w(e.$slots,"default",{},void 0,!0),i("button",{class:p(["fr-ml-1w fr-btn fr-btn--sm fr-btn--tertiary-no-outline",{"fr-icon-arrow-down-line":!e.sorted||"asc"===e.sorted,"fr-icon-arrow-up-line":"desc"===e.sorted,"text-grey-500":e.sorted,"text-mention-grey":!e.sorted}]),onClick:d,title:g(n)("Sort")},u(g(n)("Sort")),11,Ml)])):w(e.$slots,"default",{key:0},void 0,!0)]))}}),[["__scopeId","data-v-5acf0bf0"]]),Tl=["aria-describedby"],Pl=["id"],ql=a({__name:"Tooltip",setup(e){const l=T("tooltip");return(e,a)=>(t(),r(s,null,[i("p",o(e.$attrs,{"aria-describedby":g(l)}),[w(e.$slots,"default")],16,Tl),i("span",{class:"fr-tooltip fr-placement",id:g(l),role:"tooltip","aria-hidden":"true"},[w(e.$slots,"tooltip")],8,Pl)],64))}}),Ll=["href"],El={class:"monospace"},Il={class:"monospace"},Vl={class:"monospace"},Ul={class:"monospace"},Yl={class:"monospace"},Hl=a({__name:"AdminDatasetsTable",props:{datasets:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(e,{emit:l}){const a=l,o=e,{t:d}=M();function c(e,l){a("sort",e,l)}function f(e){return o.sortedBy===e?o.sortDirection:null}function m(e){return Array.isArray(e.resources)?e.resources.length:e.resources.total}function v(e){return`${Y}dataset/${e.id}/`}function p(e){return e.deleted?{label:d("Deleted"),type:"error"}:e.archived?{label:d("Archived"),type:"warning"}:e.private?{label:d("Draft"),type:"default"}:{label:d("Public"),type:"info"}}return(e,l)=>(t(),b(Sl,{loading:e.loading},{default:y((()=>[i("thead",null,[i("tr",null,[n(Ol,{onSort:l[0]||(l[0]=e=>c("title",e)),sorted:f("title"),scope:"col"},{default:y((()=>[h(u(g(d)("Title of the dataset")),1)])),_:1},8,["sorted"]),n(Ol,{scope:"col"},{default:y((()=>[h(u(g(d)("Status")),1)])),_:1}),n(Ol,{onSort:l[1]||(l[1]=e=>c("created",e)),sorted:f("created"),scope:"col"},{default:y((()=>[h(u(g(d)("Created at")),1)])),_:1},8,["sorted"]),n(Ol,{onSort:l[2]||(l[2]=e=>c("last_update",e)),sorted:f("last_update"),scope:"col"},{default:y((()=>[h(u(g(d)("Updated at")),1)])),_:1},8,["sorted"]),n(Ol,{scope:"col"},{default:y((()=>[h(u(g(d)("Files")),1)])),_:1}),n(Ol,{scope:"col"},{default:y((()=>[h(u(g(d)("Score")),1)])),_:1}),n(Ol,{scope:"col"},{default:y((()=>[n(ql,null,{tooltip:y((()=>[h(u(g(d)("Discussions")),1)])),default:y((()=>[l[6]||(l[6]=i("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),n(Ol,{onSort:l[3]||(l[3]=e=>c("views",e)),sorted:f("views"),scope:"col"},{default:y((()=>[n(ql,null,{tooltip:y((()=>[h(u(g(d)("Views")),1)])),default:y((()=>[l[7]||(l[7]=i("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),n(Ol,{scope:"col"},{default:y((()=>[n(ql,null,{tooltip:y((()=>[h(u(g(d)("Downloads")),1)])),default:y((()=>[l[8]||(l[8]=i("span",{class:"fr-icon--sm fr-icon-download-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),n(Ol,{onSort:l[4]||(l[4]=e=>c("reuses",e)),sorted:f("reuses"),scope:"col"},{default:y((()=>[n(ql,null,{tooltip:y((()=>[h(u(g(d)("Reuses")),1)])),default:y((()=>[l[9]||(l[9]=i("span",{class:"fr-icon--sm fr-icon-line-chart-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),n(Ol,{onSort:l[5]||(l[5]=e=>c("followers",e)),sorted:f("followers"),scope:"col"},{default:y((()=>[n(ql,null,{tooltip:y((()=>[h(u(g(d)("Favorites")),1)])),default:y((()=>[l[10]||(l[10]=i("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"])])]),i("tbody",null,[(t(!0),r(s,null,k(e.datasets,(e=>{var l;return t(),r("tr",{key:e.id},[i("td",null,[n($l,null,{default:y((()=>[i("a",{class:"fr-link fr-reset-link",href:v(e)},[n(g(V),{text:e.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Ll)])),_:2},1024)]),i("td",null,[n(xl,{type:p(e).type},{default:y((()=>[h(u(p(e).label),1)])),_:2},1032,["type"])]),i("td",null,u(g(j)(e.created_at)),1),i("td",null,u(g(j)(e.last_modified)),1),i("td",null,u(m(e)),1),i("td",null,[n(g(U),{class:"w-100",score:e.quality.score},null,8,["score"])]),i("td",El,u(g(O)(e.metrics.discussions)),1),i("td",Il,u(g(O)(e.metrics.views)),1),i("td",Vl,u(g(O)(null!==(l=e.metrics.resources_downloads)&&void 0!==l?l:0)),1),i("td",Ul,u(g(O)(e.metrics.reuses)),1),i("td",Yl,u(g(O)(e.metrics.followers)),1)])})),128))])])),_:1},8,["loading"]))}}),Nl=c(null);function Wl(){return{currentOrganization:x(Nl),setCurrentOrganization:e=>{Nl.value=e}}}const Fl=["href"],Zl=["src","alt"],Jl=a({__name:"AdminPublishButton",props:{type:{}},setup(e){const l=e,{t:a}=M(),s=f((()=>{switch(l.type){case"dataset":return N;case"harvester":return`${Y}harvester/new/`;case"reuse":return H}}));return(e,l)=>(t(),r("a",{href:s.value,class:"fr-btn fr-icon-add-line fr-btn--icon-left"},[h(u(g(a)("Publish on"))+" ",1),i("img",{class:"fr-ml-1v",src:g("/_themes/gouvfr/assets/logotype-white.svg"),loading:"lazy",alt:g(W)},null,8,Zl)],8,Fl))}}),Gl={key:0},Kl={class:"fr-breadcrumb__link","aria-current":"page"},Xl={class:"fr-h3 fr-mb-5v"},Ql={class:"fr-p-3w flex items-center justify-between relative"},ea=["id"],la=["aria-expanded"],aa={class:"flex items-center fr-ml-4v buttons"},ta={class:"fr-col-auto fr-ml-3v fr-m-0"},ra=["disabled","href","title"],sa=["aria-labelledby"],na={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},oa={class:"fr-col"},ia={class:"subtitle subtitle--uppercase fr-m-0"},ua={key:0,class:"fr-col-auto fr-grid-row fr-grid-row--middle"},da=["href"],ca={class:"text-align-center fr-py-1w"},fa=["src"],ma={class:"fr-text--bold fr-my-3v"},va=a({__name:"Datasets",props:{oid:{}},setup(e){const{t:l}=M(),a=e,s=c([]),o=c(!1),d=c(1),m=c(10),w=c(0),k=c("created"),x=c("desc"),$=f((()=>`${"asc"===x.value?"":"-"}${k.value}`)),A=c(""),D=F(A,ee),{currentOrganization:B}=Wl(),S=Z();function j(e,l){k.value=e,x.value=l}v((async()=>{o.value=!0,s.value=[];try{let e;if(a.oid)e=await J(a.oid,D.value,d.value,m.value,$.value);else{if(!S.value)return;e=await G(S.value.id,D.value,d.value,m.value,$.value)}s.value=e.data,d.value=e.page,m.value=e.page_size,w.value=e.total}finally{o.value=!1}}));const R=c(!1),O=z(),T=c(null),P=c(null),q=c(null),L=c(null),E=c(null),V=c(null);v((async()=>{if(a.oid){{const e=await fetch(`https://metric-api.data.gouv.fr/api/organizations/data/?organization_id__exact=${a.oid}&metric_month__sort=desc&page_size=12`),l=await e.json();T.value={},q.value={},E.value={};for(const{metric_month:a,monthly_download_resource:t,monthly_visit_dataset:r,monthly_visit_reuse:s}of l.data)T.value[a]=r,q.value[a]=t,E.value[a]=s}{const e=await fetch(`https://metric-api.data.gouv.fr/api/organizations_total/data/?organization_id__exact=${a.oid}`),l=await e.json();l.data[0]&&(P.value=l.data[0].visit_dataset,L.value=l.data[0].download_resource,V.value=l.data[0].visit_reuse)}}}));const U=f((()=>{if(!T.value||!q.value||!E.value)return null;let e="month,visit_datasets,download_resource,visit_reuse\n";for(const l in T.value)e+=`${l},${T.value[l]},${q.value[l]},${E.value[l]}\n`;return URL.createObjectURL(new Blob([e],{type:"text/csv"}))}));return(e,a)=>{const c=C("router-link");return t(),r("div",null,[n(kl,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),g(B)?(t(),r("li",Gl,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(B).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Kl,u(g(l)("Datasets")),1)])])),_:1}),i("h1",Xl,u(g(l)("Datasets")),1),e.oid&&!o.value&&w.value>0?(t(),r("div",{key:0,class:p(["bg-white border rounded-xxs fr-mb-3w",{"fr-pb-4v":R.value}])},[i("header",Ql,[i("div",null,[i("h4",{class:"fr-mb-1v flex items-center",id:g(O)},[i("button",{type:"button",onClick:a[0]||(a[0]=e=>R.value=!R.value),class:"fr-p-0 fr-text flex items-center font-bold","data-testid":"expand-button","aria-expanded":R.value},[h(u(e.$t("Statistics on your datasets"))+" ",1),a[2]||(a[2]=i("span",{class:"absolute inset-0 z-1"},null,-1))],8,la)],8,ea)]),i("div",aa,[i("p",ta,[i("a",{disabled:!U.value,href:U.value||"",rel:"ugc nofollow noopener",title:g(l)("Download file"),download:"stats.csv",class:"relative fr-btn fr-btn--sm fr-btn--icon-left fr-icon-test-tube-line fr-icon-download-line fr-icon--sm z-2"},u(e.$t("Download")),9,ra)]),i("div",{class:p(["fr-icon--sm fr-ml-4v",{"fr-icon-arrow-up-s-line":R.value,"fr-icon-arrow-down-s-line":!R.value}])},null,2)])]),R.value?(t(),r("section",{key:0,"aria-labelledby":g(O),class:"flex fr-pb-3w fr-pl-3w fr-pr-3w"},[n(g(_l),{title:e.$t("Views"),data:T.value,type:"line",summary:P.value,class:"w-1/3"},null,8,["title","data","summary"]),n(g(_l),{title:e.$t("Downloads"),data:q.value,type:"line",summary:L.value,class:"w-1/3"},null,8,["title","data","summary"]),n(g(_l),{title:e.$t("Reuses Visits"),data:E.value,type:"line",summary:V.value,class:"w-1/3"},null,8,["title","data","summary"])],8,sa)):_("",!0)],2)):_("",!0),i("div",na,[i("div",oa,[i("h2",ia,u(g(l)("{n} datasets",w.value)),1)]),e.oid?(t(),r("div",ua,[i("div",null,[i("a",{href:g(K)(e.oid,w.value),class:"fr-btn fr-btn--sm fr-icon-download-line fr-btn--icon-left"},u(g(l)("Download catalog")),9,da)])])):_("",!0)]),o.value||w.value>0?(t(),b(Hl,{key:1,datasets:s.value,loading:o.value,"sort-direction":x.value,sortedBy:k.value,onSort:j},null,8,["datasets","loading","sort-direction","sortedBy"])):(t(),b(I,{key:2,class:"fr-my-2w"},{default:y((()=>[i("div",ca,[i("img",{src:g(X),alt:"",loading:"lazy"},null,8,fa),i("p",ma,u(g(l)("You haven't published a dataset yet")),1),n(Jl,{type:"dataset"})])])),_:1})),w.value>m.value?(t(),b(g(Q),{key:3,page:d.value,"page-size":m.value,"total-results":w.value,onChange:a[1]||(a[1]=e=>d.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}}),pa=P(va,[["__scopeId","data-v-93674b91"]]),ba=["href"],ga={key:0},ya=a({__name:"AdminDataservicesTable",props:{dataservices:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(e){const l=e,{t:a}=M();function o(e){return`${Y}dataservices/${e.id}/`}function d(e){return e.private?{label:a("Draft"),type:"default"}:{label:a("Public"),type:"info"}}function c(e){return e.is_restricted?{label:a("Restricted"),type:"warning"}:{label:a("Open"),type:"success"}}return(e,f)=>(t(),b(Sl,{loading:e.loading},{default:y((()=>{return[i("thead",null,[n(Ol,{onSort:f[0]||(f[0]=l=>e.$emit("sort","title",l)),sorted:(m="title",l.sortedBy===m?l.sortDirection:null),scope:"col"},{default:y((()=>[h(u(g(a)("Dataservice title")),1)])),_:1},8,["sorted"]),n(Ol,null,{default:y((()=>[h(u(g(a)("Status")),1)])),_:1}),n(Ol,null,{default:y((()=>[h(u(g(a)("Access")),1)])),_:1}),n(Ol,null,{default:y((()=>[h(u(g(a)("Created at")),1)])),_:1}),n(Ol,null,{default:y((()=>[h(u(g(a)("Rate Limiting")),1)])),_:1}),n(Ol,null,{default:y((()=>[h(u(g(a)("Availability")),1)])),_:1})]),i("tbody",null,[(t(!0),r(s,null,k(e.dataservices,(e=>(t(),r("tr",null,[i("td",null,[n($l,null,{default:y((()=>[i("a",{class:"fr-link fr-reset-link",href:o(e)},[n(g(V),{text:e.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,ba)])),_:2},1024)]),i("td",null,[n(xl,{type:d(e).type},{default:y((()=>[h(u(d(e).label),1)])),_:2},1032,["type"])]),i("td",null,[n(xl,{type:c(e).type},{default:y((()=>[h(u(c(e).label),1)])),_:2},1032,["type"])]),i("td",null,u(g(j)(e.created_at)),1),i("td",null,u(e.rate_limiting),1),i("td",null,[e.availability?(t(),r("span",ga,u(e.availability)+"%",1)):_("",!0)])])))),256))])];var m})),_:1},8,["loading"]))}}),_a={class:"fr-container--fluid"},ha={key:0},wa={class:"fr-breadcrumb__link","aria-current":"page"},ka={class:"fr-h3"},xa={class:"subtitle subtitle--uppercase"},za={class:"text-align-center fr-py-1w"},Ca=["src"],$a={class:"fr-text--bold fr-my-3v"},Aa=a({__name:"Dataservices",props:{oid:{}},setup(e){const{t:l}=M(),a=e,s=c([]),o=c(!1),d=c(1),m=c(10),p=c(0),w=c("title"),k=c("desc"),x=f((()=>`${"asc"===k.value?"":"-"}${w.value}`)),{currentOrganization:z}=Wl(),$=Z();function A(e,l){w.value=e,k.value=l}return v((async()=>{o.value=!0,s.value=[];try{let e;if(a.oid)e=await le(a.oid,d.value,m.value,x.value);else{if(!$.value)return;e=await ae($.value.id,d.value,m.value,x.value)}s.value=e.data,d.value=e.page,m.value=e.page_size,p.value=e.total}finally{o.value=!1}})),(e,a)=>{const c=C("router-link");return t(),r("div",_a,[n(kl,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),g(z)?(t(),r("li",ha,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(z).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",wa,u(g(l)("Dataservices")),1)])])),_:1}),i("h1",ka,u(g(l)("Dataservices")),1),i("h2",xa,u(g(l)("{n} dataservices",p.value)),1),o.value||p.value>0?(t(),b(ya,{key:0,dataservices:s.value,loading:o.value,sortDirection:k.value,sortedBy:w.value,onSort:A},null,8,["dataservices","loading","sortDirection","sortedBy"])):(t(),b(I,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:y((()=>[i("div",za,[i("img",{src:g(te),alt:"",loading:"lazy"},null,8,Ca),i("p",$a,u(g(l)("You haven't published a dataservice yet")),1),n(Jl,{type:"dataservice"})])])),_:1})),p.value>m.value?(t(),b(g(Q),{key:2,page:d.value,"page-size":m.value,"total-results":p.value,onChange:a[0]||(a[0]=e=>d.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}}),Da=["href"],Ba={class:"monospace"},Sa={class:"monospace"},ja={class:"monospace"},Ra={class:"monospace"},Ma=a({__name:"AdminReusesTable",props:{reuses:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(e){const l=e,{t:a}=M();function o(e){return l.sortedBy===e?l.sortDirection:null}function d(e){return`${Y}reuse/${e.id}/`}function c(e){return e.deleted?{label:a("Deleted"),type:"error"}:e.archived?{label:a("Archived"),type:"warning"}:e.private?{label:a("Draft"),type:"default"}:{label:a("Public"),type:"info"}}return(e,l)=>(t(),b(Sl,{loading:e.loading},{default:y((()=>[i("thead",null,[n(Ol,{onSort:l[0]||(l[0]=l=>e.$emit("sort","title",l)),sorted:o("title"),scope:"col"},{default:y((()=>[h(u(g(a)("Reuse title")),1)])),_:1},8,["sorted"]),n(Ol,null,{default:y((()=>[h(u(g(a)("Status")),1)])),_:1}),n(Ol,{onSort:l[1]||(l[1]=l=>e.$emit("sort","created",l)),sorted:o("created"),scope:"col"},{default:y((()=>[h(u(g(a)("Created at")),1)])),_:1},8,["sorted"]),n(Ol,{onSort:l[2]||(l[2]=l=>e.$emit("sort","datasets",l)),sorted:o("datasets"),scope:"col"},{default:y((()=>[h(u(g(a)("Datasets")),1)])),_:1},8,["sorted"]),n(Ol,{scope:"col"},{default:y((()=>[n(ql,null,{tooltip:y((()=>[h(u(g(a)("Discussions")),1)])),default:y((()=>[l[5]||(l[5]=i("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),n(Ol,{onSort:l[3]||(l[3]=l=>e.$emit("sort","views",l)),sorted:o("views"),scope:"col"},{default:y((()=>[n(ql,null,{tooltip:y((()=>[h(u(g(a)("Views")),1)])),default:y((()=>[l[6]||(l[6]=i("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),n(Ol,{onSort:l[4]||(l[4]=l=>e.$emit("sort","followers",l)),sorted:o("followers"),scope:"col"},{default:y((()=>[n(ql,null,{tooltip:y((()=>[h(u(g(a)("Favorites")),1)])),default:y((()=>[l[7]||(l[7]=i("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"])]),i("tbody",null,[(t(!0),r(s,null,k(e.reuses,(e=>(t(),r("tr",null,[i("td",null,[n($l,null,{default:y((()=>[i("a",{class:"fr-link fr-reset-link",href:d(e)},[n(g(V),{text:e.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Da)])),_:2},1024)]),i("td",null,[n(xl,{type:c(e).type},{default:y((()=>[h(u(c(e).label),1)])),_:2},1032,["type"])]),i("td",null,u(g(j)(e.created_at)),1),i("td",Ba,u(g(O)(e.datasets.length)),1),i("td",Sa,u(g(O)(e.metrics.discussions)),1),i("td",ja,u(g(O)(e.metrics.views)),1),i("td",Ra,u(g(O)(e.metrics.followers)),1)])))),256))])])),_:1},8,["loading"]))}}),Oa={class:"fr-container--fluid"},Ta={key:0},Pa={class:"fr-breadcrumb__link","aria-current":"page"},qa={class:"fr-h3 fr-mb-5v"},La={class:"subtitle subtitle--uppercase fr-mb-0"},Ea={class:"text-align-center fr-py-1w"},Ia=["src"],Va={class:"fr-text--bold fr-my-3v"},Ua=a({__name:"Reuses",props:{oid:{}},setup(e){const{t:l}=M(),a=e,s=c([]),o=c(!1),d=c(1),m=c(10),p=c(0),w=c("created"),k=c("desc"),x=f((()=>`${"asc"===k.value?"":"-"}${w.value}`)),{currentOrganization:z}=Wl(),$=Z();function A(e,l){w.value=e,k.value=l}return v((async()=>{o.value=!0,s.value=[];try{let e;if(a.oid)e=await re(a.oid,d.value,m.value,x.value);else{if(!$.value)return;e=await se($.value.id,d.value,m.value,x.value)}s.value=e.data,d.value=e.page,m.value=e.page_size,p.value=e.total}finally{o.value=!1}})),(e,a)=>{const c=C("router-link");return t(),r("div",Oa,[n(kl,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),g(z)?(t(),r("li",Ta,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(z).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Pa,u(g(l)("Reuses")),1)])])),_:1}),i("h1",qa,u(g(l)("Reuses")),1),i("h2",La,u(g(l)("{n} reuses of your organization",s.value.length)),1),o.value||p.value>0?(t(),b(Ma,{key:0,reuses:s.value,loading:o.value,sortDirection:k.value,sortedBy:w.value,onSort:A},null,8,["reuses","loading","sortDirection","sortedBy"])):(t(),b(I,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:y((()=>[i("div",Ea,[i("img",{src:g("/_themes/gouvfr/assets/reuse.svg"),alt:"",loading:"lazy"},null,8,Ia),i("p",Va,u(g(l)("You haven't published a reuse yet")),1),n(Jl,{type:"reuse"})])])),_:1})),p.value>m.value?(t(),b(g(Q),{key:2,page:d.value,"page-size":m.value,"total-results":p.value,onChange:a[0]||(a[0]=e=>d.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}}),Ya={class:"fr-breadcrumb__link","aria-current":"page"},Ha={key:0,class:"fr-h1"},Na={class:"fr-alert fr-alert--info"},Wa={class:"fr-alert__title"},Fa={href:"/admin/me/"},Za=a({__name:"Me",setup(e){const{t:l}=M(),a=Z();return(e,s)=>{const o=C("router-link");return t(),r("div",null,[n(kl,null,{default:y((()=>[i("li",null,[n(o,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),i("li",null,[i("a",Ya,u(g(l)("Me")),1)])])),_:1}),g(a)?(t(),r("h1",Ha,u(g(a).first_name)+" "+u(g(a).last_name),1)):_("",!0),i("div",Na,[i("h3",Wa,u(g(l)("This is a WIP page")),1),i("p",null,[i("a",Fa,u(g(l)("You can edit your profil on the current admin.")),1)])])])}}}),Ja='<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5 12V18C5 18 5 21 12 21C19 21 19 18 19 18V12" stroke="currentColor" stroke-width="1.5"/>\n<path d="M5 6V12C5 12 5 15 12 15C19 15 19 12 19 12V6" stroke="currentColor" stroke-width="1.5"/>\n<path d="M12 3C19 3 19 6 19 6C19 6 19 9 12 9C5 9 5 6 5 6C5 6 5 3 12 3Z" stroke="currentColor" stroke-width="1.5"/>\n</svg>\n',Ga={class:"fr-sidemenu__item"},Ka=["innerHTML"],Xa=P(a({__name:"AdminSidebarLink",props:{label:{},icon:{},iconHtml:{},to:{}},setup:e=>(e,l)=>{const a=C("router-link");return t(),r("li",Ga,[i("div",{class:p([{"fr-icon-svg fr-icon--sm":e.iconHtml},"fr-enlarge-link fr-sidemenu__link fr-mb-1w"])},[e.iconHtml?(t(),r("div",{key:0,class:"fr-mr-1w fr-grid-row",innerHTML:e.iconHtml},null,8,Ka)):e.icon?(t(),r("div",{key:1,class:p([e.icon,"fr-mr-1w fr-icon--sm"]),"aria-hidden":"true"},null,2)):_("",!0),n(a,{to:e.to},{default:y((()=>[n(g(V),{text:e.label,"auto-resize":!0,"max-lines":1},null,8,["text"])])),_:1},8,["to"])],2)])}}),[["__scopeId","data-v-239d0721"]]),Qa=["aria-expanded","aria-controls","aria-current"],et={class:"fr-mx-1w"},lt={class:"logo logo--sm"},at={class:"fr-mx-1w fr-col text-overflow-ellipsis"},tt=["id"],rt={class:"fr-sidemenu__list fr-mx-1w fr-my-3v"},st=a({__name:"AdminSidebarMenu",props:{user:{},organization:{},isOpened:{type:Boolean}},emits:["open","click"],setup(e){const l=e,{t:a}=M(),o=T("menu");return $((()=>{setTimeout((()=>{!function(e,l){const a=document.getElementById(o);l(a)&&(e?l(a).collapse.disclose():l(a).collapse.conceal())}(l.isOpened,globalThis.dsfr)}),200)})),(e,l)=>(t(),r("li",{class:p(["fr-sidemenu__item",{"fr-sidemenu__item--active":e.isOpened}])},[i("button",{class:"fr-sidemenu__btn","aria-expanded":e.isOpened,"aria-controls":g(o),"aria-current":e.isOpened,onClick:l[0]||(l[0]=l=>e.$emit("open"))},[e.user?(t(),r(s,{key:0},[e.user?(t(),b(g(S),{key:0,user:e.user,size:24,rounded:!0},null,8,["user"])):_("",!0),i("p",et,u(g(a)("My Profile")),1)],64)):e.organization?(t(),r(s,{key:1},[i("div",lt,[n(ne,{type:"organization",src:e.organization.logo_thumbnail,size:20},null,8,["src"])]),i("p",at,u(e.organization.name),1)],64)):_("",!0)],8,Qa),i("div",{class:"fr-collapse","data-fr-js-collapse":"",id:g(o)},[i("ul",rt,[e.user?(t(),r(s,{key:0},[n(Xa,{icon:"fr-icon-account-circle-line",label:g(a)("Me"),to:{name:"me"}},null,8,["label"]),n(Xa,{iconHtml:g(Ja),label:g(a)("Datasets"),to:{name:"me-datasets"}},null,8,["iconHtml","label"]),n(Xa,{icon:"fr-icon-code-s-slash-line",label:g(a)("Dataservices"),to:{name:"me-dataservices"}},null,8,["label"]),n(Xa,{icon:"fr-icon-line-chart-line",label:g(a)("Reuses"),to:{name:"me-reuses"}},null,8,["label"]),n(Xa,{icon:"fr-icon-git-pull-request-line",label:g(a)("Community Resources"),to:{name:"me-community-resources"}},null,8,["label"])],64)):e.organization?(t(),r(s,{key:1},[n(Xa,{iconHtml:g(Ja),label:g(a)("Datasets"),to:{name:"organization-datasets",params:{oid:e.organization.id}},onClick:l[1]||(l[1]=l=>e.$emit("click"))},null,8,["iconHtml","label","to"]),n(Xa,{icon:"fr-icon-code-s-slash-line",label:g(a)("Dataservices"),to:{name:"organization-dataservices",params:{oid:e.organization.id}},onClick:l[2]||(l[2]=l=>e.$emit("click"))},null,8,["label","to"]),n(Xa,{icon:"fr-icon-line-chart-line",label:g(a)("Reuses"),to:{name:"organization-reuses",params:{oid:e.organization.id}},onClick:l[3]||(l[3]=l=>e.$emit("click"))},null,8,["label","to"]),n(Xa,{icon:"fr-icon-chat-3-line",label:g(a)("Discussions"),to:{name:"organization-discussions",params:{oid:e.organization.id}},onClick:l[4]||(l[4]=l=>e.$emit("click"))},null,8,["label","to"]),n(Xa,{icon:"fr-icon-parent-line",label:g(a)("Members"),to:{name:"organization-members",params:{oid:e.organization.id}},onClick:l[5]||(l[5]=l=>e.$emit("click"))},null,8,["label","to"]),n(Xa,{icon:"fr-icon-server-line",label:g(a)("Harvesters"),to:{name:"organization-harvesters",params:{oid:e.organization.id}},onClick:l[6]||(l[6]=l=>e.$emit("click"))},null,8,["label","to"]),n(Xa,{icon:"fr-icon-git-pull-request-line",label:g(a)("Community Resources"),to:{name:"organization-community-resources",params:{oid:e.organization.id}},onClick:l[7]||(l[7]=l=>e.$emit("click"))},null,8,["label","to"]),n(Xa,{icon:"fr-icon-user-line",label:g(a)("Profile"),to:{name:"organization-profile",params:{oid:e.organization.id}},onClick:l[8]||(l[8]=l=>e.$emit("click"))},null,8,["label","to"])],64)):_("",!0)])],8,tt)],2))}}),nt=P(st,[["__scopeId","data-v-130fdfda"]]),ot={class:"fr-container--fluid h-100"},it={class:"fr-grid-row h-100 bg-grey-50"},ut={class:"fr-col-12 fr-col-md-4 fr-col-lg-3 fr-col-xl-2"},dt=["aria-label"],ct={class:"fr-sidemenu__inner"},ft=["aria-controls"],mt=["id"],vt={class:"fr-sidemenu__list"},pt={class:"fr-col-12 fr-col-md-8 fr-col-lg-9 fr-col-xl-10 h-100 fr-px-2w overflow-auto"},bt=a({__name:"Admin",setup(e){const{t:l}=M(),a=oe(),n=T("menu"),o=c(null),d=c(),{setCurrentOrganization:f}=Wl(),v=ie();function p(e){return e===d.value}function y(e){d.value=e.id}return m((async()=>{var e;if(o.value=await ue(),a.name||(o.value.organizations.length>0?v.replace({name:"organization-datasets",params:{oid:o.value.organizations[0].id}}):v.replace({name:"me"})),"me"===a.name)d.value=null===(e=de)||void 0===e?void 0:e.id;else if(o.value.organizations.length>0){let e=o.value.organizations[0];var l;a.params.oid&&(e=null!==(l=o.value.organizations.find((e=>e.id===a.params.oid)))&&void 0!==l?l:e),y(e),f(e)}})),(e,d)=>{const c=C("router-view");return t(),r("div",ot,[i("div",it,[i("div",ut,[i("nav",{class:"fr-sidemenu fr-pr-0","aria-label":g(l)("Administration menu")},[i("div",ct,[i("button",{class:"fr-sidemenu__btn",hidden:"","aria-controls":g(n),"aria-expanded":"false"},u(g(l)("Open menu")),9,ft),i("div",{class:"fr-collapse",id:g(n)},[i("ul",vt,[g(de)?(t(),b(nt,{key:0,user:g(de),"is-opened":p(g(de).id),onOpen:d[0]||(d[0]=e=>y(g(de)))},null,8,["user","is-opened"])):_("",!0),o.value?(t(!0),r(s,{key:1},k(o.value.organizations,(e=>(t(),b(nt,{organization:e,"is-opened":p(e.id),onOpen:()=>y(e),onClick:()=>g(f)(e)},null,8,["organization","is-opened","onOpen","onClick"])))),256)):_("",!0)])],8,mt)])],8,dt)]),i("div",pt,[(t(),b(c,{key:g(a).fullPath,class:"fr-container--fluid"}))])])])}}}),gt=P(bt,[["__scopeId","data-v-4869f570"]]),yt=["aria-labelledby","id"],_t={class:"fr-container fr-container--fluid fr-container-md"},ht={class:"fr-grid-row fr-grid-row--center"},wt={class:"fr-col-12 fr-col-md-8"},kt={class:"fr-modal__body"},xt={class:"fr-modal__header"},zt=["title","aria-controls"],Ct={class:"fr-modal__content"},$t=["id"],At={class:"fr-modal__footer"},Dt={class:"fr-btns-group fr-btns-group--right fr-btns-group--sm fr-btns-group--inline-lg fr-btns-group--icon-left"},Bt=["disabled"],St=["disabled"],jt=a({__name:"AdminAddMemberModal",props:{id:{},oid:{},roles:{}},emits:["memberAdded"],setup(e,{emit:l}){const a=e,r=l,{t:s}=M(),{toast:o}=pe(),d=c(!1),m=c(),v=c("editor"),p=f((()=>"fr-modal-title-user-"+a.id));async function y(){try{d.value=!0,m.value&&(await me(a.oid,m.value,v.value),r("memberAdded"),w())}catch(e){o.error(s("An error occurred while update member role."))}finally{d.value=!1}}function h(e){return e.map((e=>{var l;const a={...e,avatar_thumbnail:null!==(l=e.avatar_url)&&void 0!==l?l:void 0};return{value:a.id,label:a.first_name+" "+a.last_name,image:ve(a,32)}}))}function w(){d.value=!1,m.value=void 0,v.value="editor";const e=document.getElementById(a.id);globalThis.dsfr(e).modal.conceal()}return(e,l)=>(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":p.value,role:"dialog",id:e.id,class:"fr-modal"},[i("div",_t,[i("div",ht,[i("div",wt,[i("div",kt,[i("div",xt,[i("button",{class:"fr-btn--close fr-btn",title:g(s)("Close the modal dialog"),"aria-controls":e.id},u(g(s)("Close")),9,zt)]),i("form",{onSubmit:D(y,["prevent"])},[i("div",Ct,[i("h1",{id:p.value,class:"fr-modal__title fr-mb-2w"},u(g(s)("Add member to the organization")),9,$t),n(ce,{placeholder:e.$t("Search a user"),searchPlaceholder:e.$t("Search a user..."),suggestUrl:"/users/suggest/",values:m.value,onChange:l[0]||(l[0]=e=>m.value=e),allOption:e.$t("Select a user"),addAllOption:!1,onSuggest:h,roundedImages:!0},null,8,["placeholder","searchPlaceholder","values","allOption"]),e.roles.length>0?(t(),b(fe,{key:0,label:g(s)("Role of the member"),"model-value":v.value,"onUpdate:modelValue":l[1]||(l[1]=e=>v.value=e),options:e.roles},null,8,["label","model-value","options"])):_("",!0)]),i("div",At,[i("div",Dt,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"button",onClick:w,disabled:d.value},u(g(s)("Cancel")),9,Bt),i("button",{class:"fr-btn",type:"submit",disabled:d.value},u(g(s)("Add to the organization")),9,St)])])],32)])])])])],8,yt)]))}}),Rt=["aria-controls"],Mt=a({__name:"AdminAddMemberButton",props:{oid:{},roles:{}},emits:["memberAdded"],setup(e){const l=e,{t:a}=M(),o=f((()=>"fr-modal-add-user-"+l.oid));return(e,l)=>(t(),r(s,null,[i("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-icon-add-line","data-fr-opened":"false","aria-controls":o.value},u(g(a)("Add member")),9,Rt),n(jt,{id:o.value,oid:e.oid,roles:e.roles,onMemberAdded:l[0]||(l[0]=l=>e.$emit("memberAdded"))},null,8,["id","oid","roles"])],64))}}),Ot={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Tt=a({__name:"AdminDangerZone",setup:e=>(e,l)=>(t(),b(g(be),{color:"error",type:"secondary",weight:"regular"},{default:y((()=>[i("div",Ot,[w(e.$slots,"default")])])),_:3}))}),Pt={class:"fr-px-1v rounded-2 monospace fr-text--sm text-mention-grey bg-grey-100 fr-m-0"},qt=a({__name:"AdminEmail",props:{email:{}},setup:e=>(e,l)=>(t(),r("p",Pt,u(e.email),1))}),Lt=["aria-labelledby","id"],Et={class:"fr-container fr-container--fluid fr-container-md"},It={class:"fr-grid-row fr-grid-row--center"},Vt={class:"fr-col-12 fr-col-md-8"},Ut={class:"fr-modal__body"},Yt={class:"fr-modal__header"},Ht=["title","aria-controls"],Nt={class:"fr-modal__content"},Wt=["id"],Ft={class:"fr-grid-row fr-grid-row--middle fr-mb-2w"},Zt={class:"fr-text--bold fr-m-0 fr-mr-1v"},Jt={class:"fr-col"},Gt={class:"fr-col-auto"},Kt=["disabled"],Xt={class:"fr-col"},Qt={class:"fr-m-0 text-grey-500"},er={class:"fr-m-0 fr-text--xs text-default-error"},lr={class:"fr-col-auto"},ar=["disabled"],tr=a({__name:"AdminEditMemberModal",props:{id:{},member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(e,{emit:l}){const a=e,r=l,s=f((()=>"fr-modal-title-user-"+a.id)),{t:o}=M(),{toast:d}=pe(),m=c(!1);function v(){m.value=!1;const e=document.getElementById(a.id);globalThis.dsfr(e).modal.conceal()}return(e,l)=>{return t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":s.value,role:"dialog",id:e.id,class:"fr-modal"},[i("div",Et,[i("div",It,[i("div",Vt,[i("div",Ut,[i("div",Yt,[i("button",{class:"fr-btn--close fr-btn",title:g(o)("Close the modal dialog"),"aria-controls":e.id},u(g(o)("Close")),9,Ht)]),i("div",Nt,[i("h1",{id:s.value,class:"fr-modal__title fr-mb-2w"},u(g(o)("Edit member")),9,Wt),i("div",Ft,[n(g(S),{class:"fr-mr-1v",user:e.member.user,rounded:!0,size:24},null,8,["user"]),i("p",Zt,u(e.member.user.first_name)+" "+u(e.member.user.last_name),1),e.member.user.email?(t(),b(qt,{key:0,email:e.member.user.email},null,8,["email"])):_("",!0)]),i("form",{class:"fr-grid-row fr-grid-row--gutters fr-grid-row--bottom",onSubmit:l[1]||(l[1]=D((l=>async function(e){if(e.newRole)try{m.value=!0,await ge(a.oid,e.user.id,e.newRole),r("memberUpdated"),v()}catch(l){d.error(o("An error occurred while update member role."))}finally{m.value=!1}else v()}(e.member)),["prevent"]))},[i("div",Jt,[e.roles.length>0?(t(),b(fe,{key:0,label:g(o)("Role of the member"),"model-value":e.member.role,"onUpdate:modelValue":l[0]||(l[0]=l=>e.member.newRole=l),options:(c=e.member.role,a.roles.map((e=>{const l={...e};return l.value===c&&(l.selected=!0),l})))},null,8,["label","model-value","options"])):_("",!0)]),i("div",Gt,[i("button",{class:"fr-btn",type:"submit",disabled:m.value},u(g(o)("Validate")),9,Kt)])],32),n(Tt,{class:"fr-mt-2w"},{default:y((()=>[i("div",Xt,[i("p",Qt,u(g(o)("Remove member from the organization")),1),i("p",er,u(g(o)("Be careful, this action can't be reverse.")),1)]),i("div",lr,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-logout-box-r-line",disabled:m.value,onClick:l[2]||(l[2]=l=>async function(e){try{m.value=!0,await ye(a.oid,e.user.id),r("memberUpdated")}catch(l){d.error(o("An error occurred while removing this member."))}finally{m.value=!1}}(e.member))},u(g(o)("Remove member")),9,ar)])])),_:1})])])])])])],8,Lt)]);var c}}}),rr=["aria-controls"],sr=a({__name:"AdminEditMemberButton",props:{member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(e){const l=e,{t:a}=M(),o=f((()=>"fr-modal-user-"+l.member.user.id));return(e,l)=>(t(),r(s,null,[i("button",{class:"fr-btn fr-btn--sm fr-btn--secondary-grey-500 fr-btn--tertiary-no-outline fr-icon-pencil-line","data-fr-opened":"false","aria-controls":o.value},u(g(a)("Edit")),9,rr),n(tr,{id:o.value,member:e.member,oid:e.oid,roles:e.roles,onMemberUpdated:l[0]||(l[0]=l=>e.$emit("memberUpdated"))},null,8,["id","member","oid","roles"])],64))}}),nr={class:"fr-mt-n9v fr-mb-2w"},or={class:"fr-badge fr-badge--info fr-badge--no-icon"},ir={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},ur={class:"fr-col"},dr={class:"fr-grid-row fr-grid-row--middle"},cr={class:"fr-text--bold fr-m-0 fr-mr-1v"},fr={class:"fr-m-0"},mr={class:"fr-ml-3v fr-mt-1-5v fr-mb-0 filet filet-default-grey fr-text--sm"},vr={key:0,class:"fr-col-auto fr-grid-row flex-direction-column"},pr=["disabled"],br=["disabled","aria-controls"],gr=["aria-labelledby","id"],yr={class:"fr-container fr-container--fluid fr-container-md"},_r={class:"fr-grid-row fr-grid-row--center"},hr={class:"fr-col-12 fr-col-md-8"},wr={class:"fr-modal__body"},kr={class:"fr-modal__header"},xr=["title","aria-controls"],zr={class:"fr-modal__content"},Cr=["id"],$r={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--right"},Ar={class:"fr-col-auto"},Dr=["disabled"],Br={class:"fr-col-auto"},Sr=["disabled"],jr=a({__name:"AdminMembershipRequest",props:{loading:{type:Boolean},oid:{},request:{},showActions:{type:Boolean}},emits:["accept","refuse"],setup(e,{emit:l}){const a=e,s=l,{t:o}=M(),d=c(""),f=T("modal"),m=T("modalTitle");function v(){const e=document.getElementById(f);globalThis.dsfr(e).modal.conceal()}function p(){s("refuse",a.request.id,d.value),v()}function w(){d.value="",v()}return(e,l)=>{const a=C("AdminMembershipRequest",!0);return t(),b(I,{class:"drop-shadow rounded-xxs fr-mt-3w"},{default:y((()=>[i("div",nr,[i("p",or,[l[2]||(l[2]=i("span",{class:"fr-icon-user-add-line fr-icon--sm","aria-hidden":"true"},null,-1)),h(" "+u(g(o)("Membership Request")),1)])]),i("div",ir,[i("div",ur,[i("div",dr,[n(g(S),{class:"fr-mr-1v",user:e.request.user,rounded:!0,size:24},null,8,["user"]),i("p",cr,u(e.request.user.first_name)+" "+u(e.request.user.last_name),1),e.request.user.email?(t(),b(qt,{key:0,email:e.request.user.email,class:"fr-mr-1v"},null,8,["email"])):_("",!0),i("p",fr,u(g(o)("asks to join the organization.")),1)]),i("div",mr,u(e.request.comment),1)]),e.showActions?(t(),r("div",vr,[i("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-mb-1w fr-icon-check-line",onClick:l[0]||(l[0]=l=>e.$emit("accept",e.request.id)),disabled:e.loading,"data-testid":"accept"},u(g(o)("Accept request")),9,pr),i("button",{class:"fr-btn fr-btn--icon-left fr-btn--sm fr-btn--secondary fr-btn--secondary--error fr-icon-close-line",disabled:e.loading,"data-fr-opened":"false","aria-controls":g(f),"data-testid":"refuse"},u(g(o)("Refuse")),9,br),(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":g(m),role:"dialog",id:g(f),class:"fr-modal","data-testid":"modal"},[i("div",yr,[i("div",_r,[i("div",hr,[i("div",wr,[i("div",kr,[i("button",{class:"fr-btn--close fr-btn",title:g(o)("Close the modal dialog"),"aria-controls":g(f),onClick:D(w,["prevent"])},u(g(o)("Close")),9,xr)]),i("div",zr,[i("h1",{id:g(m),class:"fr-modal__title fr-mb-2w"},u(g(o)("Refuse membership request")),9,Cr),n(a,{class:"fr-mt-4w fr-mb-2w",loading:!1,oid:e.oid,request:e.request,"show-actions":!1},null,8,["oid","request"]),i("form",{onSubmit:D(p,["prevent"]),onReset:w},[n(_e,{label:g(o)("You can provide the refusal reason:"),modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=e=>d.value=e),"data-testid":"comment-group"},null,8,["label","modelValue"]),i("div",$r,[i("div",Ar,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"reset",disabled:e.loading,"data-testid":"cancel-modal-button"},u(g(o)("Cancel")),9,Dr)]),i("div",Br,[i("button",{class:"fr-btn",type:"submit",disabled:e.loading,"data-testid":"refuse-modal-button"},u(g(o)("Refuse request")),9,Sr)])])],32)])])])])])],8,gr)]))])):_("",!0)])])),_:1})}}}),Rr={key:0},Mr={class:"fr-breadcrumb__link","aria-current":"page"},Or={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-center"},Tr={class:"fr-col-12 fr-col-md"},Pr={class:"fr-h3 fr-mb-0"},qr={key:0,class:"fr-col-auto"},Lr={class:"subtitle subtitle--uppercase fr-mt-5v fr-mb-0"},Er={class:"fr-text--bold fr-m-0"},Ir={class:"fr-m-0 fr-text--xs text-mention-grey f-italic inline-flex items-center"},Vr={key:0},Ur={key:1},Yr={key:0},Hr=a({__name:"Members",props:{oid:{}},setup(e){const l=e;q(he);const{t:a}=M(),{toast:o}=pe(),d=c([]),w=f((()=>we||$.value.some((e=>{var l;return e.user.id===(null===(l=de)||void 0===l?void 0:l.id)&&"admin"===e.role})))),x=c([]),{currentOrganization:z}=Wl(),$=c([]),A=c(!1);function D(e){var l,a;return null!==(l=null===(a=x.value.find((l=>l.value===e)))||void 0===a?void 0:a.label)&&void 0!==l?l:e}async function B(){A.value=!0,$.value=[];try{const e=await $e(l.oid);$.value=e.members}finally{A.value=!1}}async function S(){const e=await ke(l.oid);d.value=e}async function R(e){A.value=!0;const t=[];try{await Ae(l.oid,e),t.push(S()),t.push(B())}catch(r){o.error(a("An error occurred while accepting this membership."))}finally{Promise.all(t).finally((()=>A.value=!1))}}async function O(e,t){A.value=!0;const r=[];try{await De(l.oid,e,t),r.push(S()),r.push(B())}catch(s){o.error(a("An error occurred while refusing this membership."))}finally{Promise.all(r).finally((()=>A.value=!1))}}return v((()=>{w.value&&ke(l.oid).then((e=>d.value=e))})),m((()=>{xe().then(ze).then((e=>x.value=e)),B()})),(e,l)=>{const o=C("router-link"),c=C("TextClamp");return t(),r("div",null,[n(kl,null,{default:y((()=>[i("li",null,[n(o,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(a)("Administration")),1)])),_:1})]),g(z)?(t(),r("li",Rr,[n(o,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(z).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Mr,u(g(a)("Members")),1)])])),_:1}),i("div",Or,[i("div",Tr,[i("h1",Pr,u(g(a)("Members")),1)]),w.value?(t(),r("div",qr,[n(Mt,{oid:e.oid,roles:x.value,onMemberAdded:B},null,8,["oid","roles"])])):_("",!0)]),d.value.length?(t(),r(s,{key:0},[i("h2",Lr,u(g(a)("{n} requests",{n:d.value.length})),1),(t(!0),r(s,null,k(d.value,(l=>(t(),b(jr,{class:"fr-mb-4w",key:l.id,loading:A.value,oid:e.oid,request:l,"show-actions":!0,onAccept:R,onRefuse:O},null,8,["loading","oid","request"])))),128))],64)):_("",!0),i("h2",{class:p(["subtitle subtitle--uppercase fr-mb-0",{"fr-mt-n3v":d.value.length,"fr-mt-5v":!d.value.length}])},u(g(a)("{n} members",{n:$.value.length})),3),n(Sl,{class:"fr-table--layout-fixed",loading:A.value},{default:y((()=>[i("thead",null,[i("tr",null,[n(Ol,{scope:"col"},{default:y((()=>[h(u(g(a)("Members")),1)])),_:1}),n(Ol,{scope:"col"},{default:y((()=>[h(u(g(a)("Status")),1)])),_:1}),n(Ol,{scope:"col"},{default:y((()=>[h(u(g(a)("Member since")),1)])),_:1}),n(Ol,{scope:"col"},{default:y((()=>[h(u(g(a)("Last connection")),1)])),_:1}),w.value?(t(),b(Ol,{key:0,scope:"col"},{default:y((()=>[h(u(g(a)("Action")),1)])),_:1})):_("",!0)])]),i("tbody",null,[(t(!0),r(s,null,k($.value,(l=>{return t(),r("tr",{key:l.user.id},[i("td",null,[i("p",Er,u(l.user.first_name)+" "+u(l.user.last_name),1),i("p",Ir,[n(g(E),{height:12,width:12,name:"ri-mail-line"}),n(ql,null,{default:y((()=>[n(c,{class:"fr-px-1v",text:l.user.email,"auto-resize":!0,"max-lines":1},null,8,["text"])])),_:2},1024)])]),i("td",null,[n(xl,{type:(s=l.role,"admin"===s?"info":"default")},{default:y((()=>[h(u(D(l.role)),1)])),_:2},1032,["type"])]),i("td",null,u(g(j)(l.since)),1),i("td",null,[l.user.last_login_at?(t(),r("span",Vr,u(g(Ce)(l.user.last_login_at)),1)):(t(),r("span",Ur,u(g(a)("No connection")),1))]),w.value?(t(),r("td",Yr,[n(sr,{member:l,oid:e.oid,roles:x.value,onMemberUpdated:B},null,8,["member","oid","roles"])])):_("",!0)]);var s})),128))])])),_:1},8,["loading"])])}}}),Nr={class:"fr-container--fluid"},Wr={key:0},Fr={class:"fr-breadcrumb__link","aria-current":"page"},Zr={class:"fr-h3 fr-mb-5v"},Jr={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-between"},Gr={class:"fr-col-12 fr-col-md fr-grid-row fr-grid-row--middle"},Kr={class:"fr-ml-3v fr-my-0 fr-h3"},Xr=["title"],Qr={class:"fr-col-auto"},es=["href"],ls=["id"],as=["disabled","onClick"],ts={class:"fr-col"},rs={class:"fr-m-0 text-grey-500"},ss={class:"fr-m-0 fr-text--xs text-default-error"},ns={class:"fr-col-auto"},os=["disabled","aria-controls"],is=["aria-labelledby","id"],us={class:"fr-container fr-container--fluid fr-container-md"},ds={class:"fr-grid-row fr-grid-row--center"},cs={class:"fr-col-12 fr-col-md-8"},fs={class:"fr-modal__body"},ms={class:"fr-modal__header"},vs=["title","aria-controls"],ps={class:"fr-modal__content"},bs=["id"],gs={class:"fr-text--bold"},ys={class:"fr-modal__footer"},_s={class:"fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left"},hs=["disabled"],ws=a({__name:"Profile",props:{oid:{}},setup(e){const{t:l}=M(),{toast:a}=pe(),s=e,o=ie(),d=c(null),{currentOrganization:f}=Wl(),v=c(null),{organizationCertified:p}=Be(v),w=c([]),k=c(!1),x=T("modal"),z=T("modalTitle");function $(){f.value&&(k.value=!0,Re(f.value.id).then((()=>{o.replace("/"),window.location.reload()})).catch((()=>a.error(l("An error occured when deleting the organization.")))).finally((()=>k.value=!1)))}async function D(e,t){k.value=!0;try{v.value=await Me(e),a.success(l("Organization updated !"))}catch(r){a.error(l("An error occured when updating the organization."))}finally{k.value=!1}if(t&&v.value){k.value=!0;try{const e=await Oe(v.value.id,t);v.value.logo_thumbnail=e.image}catch(r){a.error(l("Failed to upload logo, you can upload it again in your management panel"))}finally{k.value=!1}}}return m((async()=>{k.value=!0;try{v.value=await $e(s.oid)}finally{k.value=!1}})),(e,a)=>{const s=C("router-link");return t(),r("div",Nr,[n(kl,null,{default:y((()=>[i("li",null,[n(s,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),g(f)?(t(),r("li",Wr,[n(s,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(f).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Fr,u(g(l)("Profile")),1)])])),_:1}),i("h1",Zr,u(g(l)("Profile")),1),v.value?(t(),b(I,{key:0,class:"fr-mb-5v"},{default:y((()=>[i("div",Jr,[i("div",Gr,[n(g(Se),{src:v.value.logo,type:"organization",size:80,class:"rounded-xxs border"},null,8,["src"]),i("div",Kr,[h(u(v.value.name)+" ",1),g(p)?(t(),r("span",{key:0,class:"fr-icon-success-line fr-icon--lg text-blue-400",title:g(l)("The identity of this public service is certified by {certifier}",{certifier:g(W)}),"aria-hidden":"true"},null,8,Xr)):_("",!0)])]),i("div",Qr,[i("a",{href:v.value.page,class:"fr-btn fr-btn--sm fr-btn--secondary fr-btn--secondary-grey-500 fr-btn--icon-left fr-icon-eye-line"},u(g(l)("See the organization page")),9,es)])])])),_:1})):_("",!0),d.value?(t(),r("h2",{key:1,class:"subtitle subtitle--uppercase fr-mb-5v",id:d.value.legend},u(g(l)("Edit profile")),9,ls)):_("",!0),k.value&&!v.value?(t(),b(Al,{key:2})):_("",!0),v.value?(t(),b(je,{key:3,organization:v.value,errors:w.value,showLegend:!1,showWell:!1,ref_key:"form",ref:d,onSubmit:D},{submitButton:y((({submit:e})=>[i("button",{class:"fr-btn fr-btn--icon-left fr-icon-save-line",disabled:k.value,"data-testid":"submitButton",onClick:e},u(g(l)("Save")),9,as)])),default:y((()=>[n(Tt,{class:"fr-mt-6w"},{default:y((()=>[i("div",ts,[i("p",rs,u(g(l)("Delete the organization")),1),i("p",ss,u(g(l)("Be careful, this action can't be reverse.")),1)]),i("div",ns,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-delete-line",disabled:k.value,"data-fr-opened":"false","aria-controls":g(x)},u(g(l)("Delete")),9,os),(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":g(z),role:"dialog",id:g(x),class:"fr-modal"},[i("div",us,[i("div",ds,[i("div",cs,[i("div",fs,[i("div",ms,[i("button",{class:"fr-btn--close fr-btn",title:g(l)("Close the modal dialog"),"aria-controls":g(x)},u(g(l)("Close")),9,vs)]),i("div",ps,[i("h1",{id:g(z),class:"fr-modal__title fr-mb-2w"},u(g(l)("Are you sure you want to delete this organization ?")),9,bs),i("p",gs,u(g(l)("This action can't be reverse.")),1),i("p",null,u(g(l)("All content published with this organization will stay online, with the same URL but in an anonymous form, i.e. without being linked to a data producer.")),1),i("p",null,u(g(l)("If you want to delete your published content too, start by deleting the contents before deleting your account.")),1)]),i("div",ys,[i("div",_s,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error",role:"button",disabled:k.value,onClick:$},u(g(l)("Delete")),9,hs)])])])])])])],8,is)]))])])),_:1})])),_:1},8,["organization","errors"])):_("",!0)])}}});async function ks(e){switch(e.class){case"Dataservice":return Ye(e.id);case"Dataset":return Ue(e.id);case"Post":return async function(e){return(await Te.get(`posts/${e}/`)).data}(e.id);case"Reuse":return Ve(e.id);default:return null}}function xs(e,l){return null===e?null:{title:zs(e),icon:$s(l),page:Cs(e)}}function zs(e){return null===e?"":"title"in e?e.title:"headline"in e?e.headline:He(e,`Unknown type ${e}`)}function Cs(e){return null===e?"":"page"in e?e.page:"self_web_url"in e?e.self_web_url:He(e,`Unknown type ${e}`)}function $s(e){switch(e){case"Dataservice":return"ri-terminal-line";case"Dataset":return"ri-database-2-line";case"Post":return"ri-article-line";case"Reuse":return"ri-line-chart-line";default:return""}}q(Ee,Le,qe,Pe);const As={class:"fr-text--bold"},Ds={key:0},Bs=["href"],Ss={class:"inline-flex items-center"},js=["href"],Rs=a({__name:"AdminDiscussionsTable",props:{discussions:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(e){const a=e,{t:o}=M(),d=c({}),f=c({});function m(e,l){return l?l.page+"#/discussions/"+e:""}function p(e){return a.sortedBy===e?a.sortDirection:null}function w(e){return e.discussion.slice(-1)[0]}return v((async()=>{for(const e of a.discussions)if(!(e.subject.id in d.value)){const l=ks(e.subject);d.value[e.subject.id]=l;const a=await d.value[e.subject.id];f.value[e.subject.id]=xs(a,e.subject.class)}})),(e,a)=>(t(),b(Sl,{class:"fr-table--layout-fixed",loading:e.loading},{default:y((()=>[i("thead",null,[n(Ol,{onSort:a[0]||(a[0]=l=>e.$emit("sort","title",l)),sorted:p("title"),scope:"col"},{default:y((()=>[h(u(g(o)("Discussion")),1)])),_:1},8,["sorted"]),n(Ol,{scope:"col"},{default:y((()=>[h(u(g(o)("Number of comments")),1)])),_:1}),n(Ol,{scope:"col"},{default:y((()=>[h(u(g(o)("Last comment")),1)])),_:1}),n(Ol,{onSort:a[1]||(a[1]=l=>e.$emit("sort","closed",l)),sorted:p("closed"),scope:"col"},{default:y((()=>[h(u(g(o)("Closed at")),1)])),_:1},8,["sorted"]),n(Ol,{scope:"col",style:{width:"25%"}},{default:y((()=>[h(u(g(o)("Link to the discussion")),1)])),_:1})]),i("tbody",null,[(t(!0),r(s,null,k(e.discussions,(e=>{var a,d,c;return t(),r("tr",null,[i("td",null,[i("p",As,[n(g(V),{text:e.title,"auto-resize":!0,"max-lines":1},null,8,["text"])]),f.value[e.subject.id]?(t(),r("p",Ds,[i("a",{class:"fr-link inline-flex",href:null===(a=f.value[e.subject.id])||void 0===a?void 0:a.page},[n(g(E),{height:12,class:"self-center",name:null===(d=f.value[e.subject.id])||void 0===d?void 0:d.icon},null,8,["name"]),n(g(V),{class:"overflow-wrap-anywhere",text:null===(c=f.value[e.subject.id])||void 0===c?void 0:c.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,Bs)])):_("",!0)]),i("td",null,u(e.discussion.length),1),i("td",null,[i("div",null,[i("p",null,u(g(j)(w(e).posted_on)),1),i("p",Ss,[h(u(g(o)("by "))+" ",1),n(g(l),{class:"fr-ml-1v",user:w(e).posted_by},null,8,["user"])])])]),i("td",null,[e.closed?(t(),r(s,{key:0},[h(u(g(j)(e.closed)),1)],64)):_("",!0)]),i("td",null,[f.value[e.subject.id]?(t(),r("a",{key:0,class:"fr-link inline-flex",href:m(e.id,f.value[e.subject.id]),target:"_blank"},[n(g(V),{text:m(e.id,f.value[e.subject.id]),"auto-resize":!0,"max-lines":1},null,8,["text"])],8,js)):_("",!0)])])})),256))])])),_:1},8,["loading"]))}}),Ms={class:"fr-container--fluid"},Os={key:0},Ts={class:"fr-breadcrumb__link","aria-current":"page"},Ps={class:"fr-h3 fr-mb-5v"},qs={class:"subtitle subtitle--uppercase fr-m-0"},Ls={class:"text-align-center fr-py-1w"},Es=["src"],Is={class:"fr-text--bold fr-my-3v"},Vs=a({__name:"Discussions",props:{oid:{}},setup(e){const{t:l}=M(),a=e,s=c(!1),o=c(1),d=c(10),m=c(0),p=c("created"),w=c("desc"),k=f((()=>`${"asc"===w.value?"":"-"}${p.value}`)),x=c([]),{currentOrganization:z}=Wl();function $(e,l){p.value=e,w.value=l}return v((async()=>{s.value=!0,x.value=[];try{const e=await async function(e,l,a,t){return(await Te.get(Ie("discussions/"),{params:{org:e,sort:t,page_size:a,page:l}})).data}(a.oid,o.value,d.value,k.value);x.value=e.data,o.value=e.page,d.value=e.page_size,m.value=e.total}finally{s.value=!1}})),(e,a)=>{const c=C("router-link");return t(),r("div",Ms,[n(kl,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),g(z)?(t(),r("li",Os,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(z).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Ts,u(g(l)("Discussions")),1)])])),_:1}),i("h1",Ps,u(g(l)("Discussions")),1),i("h2",qs,u(g(l)("{n} discussions",m.value)),1),s.value||m.value>0?(t(),b(Rs,{key:0,discussions:x.value,loading:s.value,"sort-direction":w.value,sortedBy:p.value,onSort:$},null,8,["discussions","loading","sort-direction","sortedBy"])):(t(),b(I,{key:1,class:"fr-my-2w"},{default:y((()=>[i("div",Ls,[i("img",{src:g("/_themes/gouvfr/assets/discussion.svg"),alt:"",loading:"lazy"},null,8,Es),i("p",Is,u(g(l)("There is no discussion yet")),1)])])),_:1})),m.value>d.value?(t(),b(g(Q),{key:2,page:o.value,"page-size":d.value,"total-results":m.value,onChange:a[0]||(a[0]=e=>o.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}}),Us={class:"fr-container--fluid"},Ys={key:0},Hs={class:"fr-breadcrumb__link","aria-current":"page"},Ns={class:"fr-h3 fr-mb-5v"},Ws={class:"subtitle subtitle--uppercase fr-m-0"},Fs=["href"],Zs={class:"text-align-center fr-py-1w"},Js=["src"],Gs={class:"fr-text--bold fr-my-3v"},Ks=a({__name:"Harvesters",props:{oid:{}},setup(e){const{t:l}=M(),a=e,o=c(!1),d=c(1),f=c(10),m=c(0),p=c([]),w=c({}),{currentOrganization:x}=Wl();function z(e){return`${Y}harvester/${e.id}/`}function $(e){return e.last_job&&w.value[e.last_job.id]?w.value[e.last_job.id].items.filter((e=>e.dataservice)).length:0}function A(e){return e.last_job&&w.value[e.last_job.id]?w.value[e.last_job.id].items.filter((e=>e.dataset)).length:0}function D(e){var a;switch(null===(a=e.last_job)||void 0===a?void 0:a.status){case"pending":return{label:l("Pending"),type:"default"};case"initializing":return{label:l("Initializing"),type:"info"};case"initialized":return{label:l("Initialized"),type:"default"};case"processing":return{label:l("Processing"),type:"info"};case"done":return{label:l("Done"),type:"success"};case"done-errors":return{label:l("Done with errors"),type:"warning"};case"failed":return{label:l("Failed"),type:"error"};default:return{label:l("No job yet"),type:"default"}}}return v((async()=>{o.value=!0,p.value=[];try{const l=await async function(e,l,a){return(await Te.get(Ie("harvest/sources/"),{params:{owner:e,deleted:!0,page:l,page_size:a}})).data}(a.oid,d.value,f.value);p.value=l.data,d.value=l.page,f.value=l.page_size,m.value=l.total;const t=[];for(const a of p.value){var e;null!==(e=a.last_job)&&void 0!==e&&e.id&&t.push(Te.get(`harvest/job/${a.last_job.id}/`))}const r=await Promise.allSettled(t);for(const e of r)"fulfilled"===e.status&&(w.value[e.value.data.id]=e.value.data)}finally{o.value=!1}})),(e,a)=>{const c=C("router-link");return t(),r("div",Us,[n(kl,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),g(x)?(t(),r("li",Ys,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(x).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Hs,u(g(l)("Harvesters")),1)])])),_:1}),i("h1",Ns,u(g(l)("Harvesters")),1),i("h2",Ws,u(g(l)("{n} harvesters",m.value)),1),o.value||m.value?(t(),b(Sl,{key:0,loading:o.value},{default:y((()=>[i("thead",null,[n(Ol,{scope:"col"},{default:y((()=>[h(u(g(l)("Name")),1)])),_:1}),n(Ol,{scope:"col"},{default:y((()=>[h(u(g(l)("Status")),1)])),_:1}),n(Ol,{scope:"col"},{default:y((()=>[h(u(g(l)("Created at")),1)])),_:1}),n(Ol,{scope:"col"},{default:y((()=>[h(u(g(l)("Last run")),1)])),_:1}),n(Ol,{scope:"col"},{default:y((()=>[h(u(g(l)("Datasets")),1)])),_:1}),n(Ol,{scope:"col"},{default:y((()=>[h(u(g(l)("Dataservices")),1)])),_:1})]),i("tbody",null,[(t(!0),r(s,null,k(p.value,(e=>{var a;return t(),r("tr",null,[i("td",null,[n($l,null,{default:y((()=>[i("a",{class:"fr-link fr-reset-link",href:z(e)},[n(g(V),{text:e.name,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Fs)])),_:2},1024)]),i("td",null,[n(xl,{type:D(e).type},{default:y((()=>[h(u(D(e).label),1)])),_:2},1032,["type"])]),i("td",null,u(g(j)(e.created_at)),1),i("td",null,[null!==(a=e.last_job)&&void 0!==a&&a.ended?(t(),r(s,{key:0},[h(u(g(j)(e.last_job.ended)),1)],64)):(t(),r(s,{key:1},[h(u(g(l)("Not yet")),1)],64))]),i("td",null,u(A(e)),1),i("td",null,u($(e)),1)])})),256))])])),_:1},8,["loading"])):(t(),b(I,{key:1,class:"fr-my-2w"},{default:y((()=>[i("div",Zs,[i("img",{src:g("/_themes/gouvfr/assets/harvester.svg"),alt:"",loading:"lazy"},null,8,Js),i("p",Gs,u(g(l)("There is no harvesters yet")),1),n(Jl,{type:"harvester"})])])),_:1})),m.value>f.value?(t(),b(g(Q),{key:2,page:d.value,"page-size":f.value,"total-results":m.value,onChange:a[0]||(a[0]=e=>d.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}}),Xs=["href"],Qs={key:0},en=["href"],ln={class:"fr-p-1v monospaced bg-grey-100 fr-text--sm text-mention-grey rounded-xxs"},an=a({__name:"AdminCommunityResourcesTable",props:{communityResources:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(e){const l=e,{t:a}=M();function o(e){return l.sortedBy===e?l.sortDirection:null}function d(e){return`${Y}dataset/${e.dataset.id}/community-resource/${e.id}/`}function c(e){const l=e.extras&&"check:available"in e.extras;return l&&!1===e.extras["check:available"]?{label:a("Unavailable"),type:"error"}:l?{label:a("Available"),type:"info"}:{label:a("Not checked yet"),type:"default"}}return(e,l)=>{const f=C("Vicon");return t(),b(Sl,{loading:e.loading},{default:y((()=>[i("thead",null,[n(Ol,{onSort:l[0]||(l[0]=l=>e.$emit("sort","title",l)),sorted:o("title"),scope:"col"},{default:y((()=>[h(u(g(a)("Resource title")),1)])),_:1},8,["sorted"]),n(Ol,null,{default:y((()=>[h(u(g(a)("Status")),1)])),_:1}),n(Ol,null,{default:y((()=>[h(u(g(a)("Format")),1)])),_:1}),n(Ol,{onSort:l[1]||(l[1]=l=>e.$emit("sort","created_at_internal",l)),sorted:o("created_at_internal"),scope:"col"},{default:y((()=>[h(u(g(a)("Created at")),1)])),_:1},8,["sorted"]),n(Ol,{onSort:l[2]||(l[2]=l=>e.$emit("sort","last_modified_internal",l)),sorted:o("last_modified_internal"),scope:"col"},{default:y((()=>[h(u(g(a)("Modified at")),1)])),_:1},8,["sorted"])]),i("tbody",null,[(t(!0),r(s,null,k(e.communityResources,(l=>{var a,s;return t(),r("tr",null,[i("td",null,[n($l,{class:"fr-text--bold"},{default:y((()=>[i("a",{class:"fr-link fr-reset-link",href:d(l)},[n(g(V),{text:l.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Xs)])),_:2},1024),e.datasets[l.dataset.id]?(t(),r("p",Qs,[i("a",{class:"fr-link inline-flex",href:null===(a=e.datasets[l.dataset.id])||void 0===a?void 0:a.page},[n(f,{height:12,class:"self-center",name:e.getSubjectTypeIcon("Dataset")},null,8,["name"]),n(g(V),{class:"overflow-wrap-anywhere",text:null===(s=e.datasets[l.dataset.id])||void 0===s?void 0:s.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,en)])):_("",!0)]),i("td",null,[n(xl,{type:c(l).type},{default:y((()=>[h(u(c(l).label),1)])),_:2},1032,["type"])]),i("td",null,[i("code",ln,u(l.format),1)]),i("td",null,u(g(j)(l.created_at)),1),i("td",null,u(g(j)(l.last_modified)),1)])})),256))])])),_:1},8,["loading"])}}}),tn={class:"fr-container--fluid"},rn={key:0},sn={class:"fr-breadcrumb__link","aria-current":"page"},nn={class:"fr-h3 fr-mb-5v"},on={class:"subtitle subtitle--uppercase fr-m-0"},un={class:"text-align-center fr-py-1w"},dn=["src"],cn={class:"fr-text--bold fr-my-3v"},fn=a({__name:"CommunityResources",props:{oid:{}},setup(e){const{t:l}=M(),a=e,s=c([]),o=c(!1),d=c(1),m=c(10),p=c(0),w=c("created_at_internal"),k=c("desc"),x=f((()=>`${"asc"===k.value?"":"-"}${w.value}`)),{currentOrganization:z}=Wl(),$=Z();function A(e,l){w.value=e,k.value=l}return v((async()=>{o.value=!0,s.value=[];try{let e;if(a.oid)e=await Ne(a.oid,d.value,m.value,x.value);else{if(!$.value)return;e=await We($.value.id,d.value,m.value,x.value)}s.value=e.data,d.value=e.page,m.value=e.page_size,p.value=e.total}finally{o.value=!1}})),(e,a)=>{const c=C("router-link");return t(),r("div",tn,[n(kl,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),g(z)?(t(),r("li",rn,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(z).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",sn,u(g(l)("Community Resources")),1)])])),_:1}),i("h1",nn,u(g(l)("Community Resources")),1),i("h2",on,u(g(l)("{n} community resources",s.value.length)),1),o.value||p.value>0?(t(),b(an,{key:0,"community-resources":s.value,loading:o.value,sortDirection:k.value,sortedBy:w.value,onSort:A},null,8,["community-resources","loading","sortDirection","sortedBy"])):(t(),b(I,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:y((()=>[i("div",un,[i("img",{src:g(Fe),alt:"",loading:"lazy"},null,8,dn),i("p",cn,u(g(l)("You haven't published a community resource yet")),1)])])),_:1})),p.value>m.value?(t(),b(g(Q),{key:2,page:d.value,"page-size":m.value,"total-results":p.value,onChange:a[0]||(a[0]=e=>d.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}});Ze({admin_root:Y,default_lang:Je.global.locale.value,only_locales:Je.global.locale.value,schema_documentation_url:Ge,schema_validata_url:Ke,show_copy_resource_permalink:!0,tabular_api_url:Xe,tabular_page_size:Qe,title:W});const mn=[{path:"/me",children:[{path:"",component:Za,name:"me"},{path:"datasets",component:pa,name:"me-datasets"},{path:"dataservices",component:Aa,name:"me-dataservices"},{path:"reuses",component:Ua,name:"me-reuses"},{path:"community-resources",component:fn,name:"me-community-resources"}]},{path:"/organizations/:oid",children:[{path:"datasets",component:pa,props:!0,name:"organization-datasets"},{path:"dataservices",component:Aa,props:!0,name:"organization-dataservices"},{path:"reuses",component:Ua,props:!0,name:"organization-reuses"},{path:"discussions",component:Vs,props:!0,name:"organization-discussions"},{path:"members",component:Hr,props:!0,name:"organization-members"},{path:"harvesters",component:Ks,props:!0,name:"organization-harvesters"},{path:"community-resources",component:fn,props:!0,name:"organization-community-resources"},{path:"profile",component:ws,props:!0,name:"organization-profile"}]}],vn=el({history:ll(),routes:mn}),pn=B(gt);al(pn),pn.use(tl),pn.use(rl),pn.use(Je),pn.use(vn),pn.mount("#admin"),globalThis.dsfr.start(),console.log("JS is injected !")}}}));
