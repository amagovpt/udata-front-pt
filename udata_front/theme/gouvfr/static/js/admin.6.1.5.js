import{defineComponent as T,openBlock as u,createElementBlock as $,Fragment as I,createVNode as l,mergeProps as ye,createElementVNode as e,toDisplayString as s,useTemplateRef as Fe,ref as k,computed as M,onMounted as re,watchEffect as Y,normalizeClass as N,createBlock as D,unref as t,withCtx as c,createCommentVNode as A,createTextVNode as w,renderSlot as W,renderList as F,readonly as Ge,useId as Je,resolveComponent as P,watchPostEffect as Ze,Teleport as me,withModifiers as fe,createApp as Ke}from"vue";import{C as _e,K as q,bB as Qe,v as B,E as H,G,_ as X,b as $e,bC as Xe,h as we,ap as J,y as E,A as et,bj as se,bD as tt,bE as st,az as ke,bn as ot,bF as pe,bG as at,bH as nt,bI as lt,au as rt,L as ie,ah as it,bJ as dt,bK as ut,bf as ct,bL as ft,bM as je,a$ as mt,$ as te,a9 as _t,aY as Pe,bN as pt,aA as vt,a1 as ve,a3 as bt,bO as gt,bP as ht,aO as yt,bQ as $t,bR as wt,bS as Se,bT as kt,bU as zt,bV as Ct,bW as qe,bX as At,bY as Dt,x as St,B as Rt,bi as Tt,bZ as Ot,b_ as Mt,bl as Bt,a as de,b$ as xt,c0 as It,c1 as Lt,c2 as jt,aa as Ue,c3 as Pt,c4 as qt,c5 as He,c6 as Ut,c7 as Ht,aw as Vt,bp as Et,bs as he,a_ as Yt,bt as Nt,bv as Wt,bw as Ft,c8 as Gt,c9 as Jt,bx as Zt,by as Kt,bz as Qt}from"./sentry.6.1.5.js";import{ContentLoader as Re}from"vue-content-loader";import"./_commonjsHelpers.6.1.5.js";function Nl(){import.meta.url,import("_").catch(()=>1);async function*_(){}}const Xt={class:"fr-ml-1v fr-text--bold"},es=T({__name:"AvatarWithName",props:{user:{},size:{default:12}},setup(_){return(o,a)=>(u(),$(I,null,[l(_e,ye(o.$attrs,{user:o.user,size:o.size,rounded:!0}),null,16,["user","size"]),e("span",Xt,s(o.user.first_name)+" "+s(o.user.last_name),1)],64))}}),ts={ref:"canvasRef",width:"120",height:"30"},ss={class:"fr-grid-row justify-between"},os={class:"text-xxs fr-m-0 text-mention-grey"},as={class:"text-xxs fr-m-0 text-mention-grey"},Te="#B6CFFB",le="#3558A2",ns="rgba(53, 88, 162, 0.7)",ls="rgba(182, 207, 251, 0.7)",rs=T({__name:"SmallChart",props:{data:{},type:{},lastWithLowEmphasis:{type:Boolean,default:!1}},setup(_){const o=_,a=(y,h)=>y.p1DataIndex===r.value.length-1?h:null,v=Fe("canvasRef"),d=k(null),i=k(null),n=M(()=>{const y=Object.keys(o.data);y.sort();let h={};for(const C of y)h[C]=o.data[C];return h}),r=M(()=>Object.keys(n.value)),p=M(()=>Object.values(n.value)),b=M(()=>o.type==="bar"?{barPercentage:1,categoryPercentage:.9,backgroundColor:r.value.map((y,h)=>h===r.value.length-1?o.lastWithLowEmphasis?ls:le:Te)}:o.type==="line"&&o.lastWithLowEmphasis?{segment:{borderColor:y=>a(y,ns)||le,borderDash:y=>a(y,[3,3])||[6,0]}}:{}),f=M(()=>r.value.length?q(r.value[0],"MM/YY"):null),g=M(()=>r.value.length?q(r.value[r.value.length-1],"MM/YY"):null),m={animation:!1,responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!1}},elements:{bar:{backgroundColor:Te,borderRadius:2,hoverBackgroundColor:le},line:{backgroundColor:le,borderColor:le,borderJoinStyle:"round",tension:.35},point:{radius:0}},scales:{x:{display:!1,grid:{display:!1},ticks:{display:!1}},y:{display:!1,grid:{display:!1},ticks:{display:!1}}},layout:{padding:{top:1.5}}};return re(()=>{d.value=v.value?v.value.getContext("2d"):null}),Y(()=>{d.value&&(i.value&&i.value.destroy(),i.value=new Qe(d.value,{data:{labels:r.value,datasets:[{data:p.value,type:o.type,...b.value}]},options:m}))}),(y,h)=>(u(),$("div",null,[e("canvas",ts,null,512),e("div",ss,[e("p",os,s(f.value),1),e("p",as,s(g.value),1)])]))}}),is={class:"fr-text--sm fr-m-0"},ds={class:"fr-grid-row fr-grid-row--middle"},us={key:1,class:"h1 line-height-1 fr-m-0"},cs={key:3,class:"fr-ml-1w"},fs={key:0,class:"fr-mt-1w fr-text--regular text-transform-none fr-badge fr-badge--no-icon fr-badge--success"},ms={class:"fr-mr-1v"},ge=T({__name:"StatBox",props:{title:{},data:{},type:{},summary:{}},setup(_){const o=_,{t:a}=B(),v=M(()=>o.data?Object.keys(o.data):[]),d=M(()=>o.data?Object.values(o.data):[]),i=M(()=>v.value.length?v.value.reduce((b,f)=>f>b?f:b):null),n=M(()=>i.value?v.value.indexOf(i.value):null),r=M(()=>n.value!==null?d.value[n.value]:null),p=M(()=>Math.max(...d.value)>0);return(b,f)=>(u(),$("div",{class:N({"text-mention-grey":!p.value&&!b.summary})},[e("h3",is,s(b.title),1),e("div",ds,[b.summary===null?(u(),D(t(Re),{key:0,width:92,height:32,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},{default:c(()=>f[0]||(f[0]=[e("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"92",height:"32"},null,-1)])),_:1})):(u(),$("p",us,s(t(H)(b.summary,2)),1)),b.data===null?(u(),D(t(Re),{key:2,width:120,height:30,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",class:"fr-ml-1w"},{default:c(()=>f[1]||(f[1]=[e("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"120",height:"30"},null,-1)])),_:1})):p.value?(u(),$("div",cs,[l(rs,{type:b.type,data:b.data,lastWithLowEmphasis:!0},null,8,["type","data"])])):A("",!0)]),r.value&&i.value?(u(),$("p",fs,[e("strong",ms," +Â "+s(t(H)(r.value,2)),1),w(" "+s(t(a)(" in "))+" "+s(t(q)(i.value,"MMM YYYY")),1)])):A("",!0)],2))}}),_s=["aria-label"],ps={class:"fr-breadcrumb__list"},Z={__name:"Breadcrumb",setup(_){const{t:o}=B();return(a,v)=>(u(),$("nav",{rol:"navigation","aria-label":t(o)("You're here:"),class:"fr-breadcrumb fr-mb-5v"},[e("ol",ps,[W(a.$slots,"default")])],8,_s))}},ue=T({__name:"AdminBadge",props:{type:{}},setup(_){return(o,a)=>(u(),$("p",{class:N(["fr-badge",{"fr-badge--blue-cumulus":o.type==="info","fr-badge--error fr-badge--no-icon":o.type==="error","fr-badge--warning fr-badge--no-icon":o.type==="warning","fr-badge--success fr-badge--no-icon":o.type==="success"}])},[W(o.$slots,"default")],2))}}),vs=["aria-describedby"],bs=["id"],gs=T({inheritAttrs:!1,__name:"AdminContentWithTooltip",setup(_){const o=G(),a=k(),v=k("");return re(()=>{a.value&&(v.value=a.value.textContent||"")}),(d,i)=>(u(),$(I,null,[e("p",ye(d.$attrs,{"aria-describedby":t(o),ref_key:"contentRef",ref:a}),[W(d.$slots,"default",{},void 0,!0)],16,vs),e("span",{class:"fr-hidden-xl fr-tooltip fr-placement",id:t(o),role:"tooltip","aria-hidden":"true"},s(v.value),9,bs)],64))}});const be=X(gs,[["__scopeId","data-v-d192f17a"]]),Ve=T({__name:"AdminLoader",props:{scale:{default:4}},setup(_){return $e(Xe),(o,a)=>(u(),D(t(we),{name:"ri-loader-5-line",animation:"spin",scale:o.scale,fill:"var(--blue-cumulus-sun-368-moon-732)"},null,8,["scale"]))}}),hs={class:"fr-table fr-mb-2w"},ys=T({__name:"AdminTable",props:{loading:{type:Boolean,default:!1}},setup(_){return(o,a)=>(u(),$("div",hs,[e("table",null,[W(o.$slots,"default",{},void 0,!0)]),o.loading?(u(),D(J,{key:0,class:"fr-p-4w text-align-center"},{default:c(()=>[l(Ve)]),_:1})):A("",!0)]))}});const oe=X(ys,[["__scopeId","data-v-cae574a4"]]),$s={class:"fr-text--bold"},ws={key:1,class:"fr-grid-row fr-grid-row--middle justify-between"},ks=["title"],zs=T({__name:"AdminTableTh",props:{sorted:{}},emits:["sort"],setup(_,{emit:o}){const a=_,v=o,{t:d}=B(),i=M(()=>a.sorted!==void 0);function n(){return a.sorted==="desc"?v("sort","asc"):v("sort","desc")}return(r,p)=>(u(),$("th",$s,[i.value?(u(),$("div",ws,[W(r.$slots,"default",{},void 0,!0),e("button",{class:N(["fr-ml-1w fr-btn fr-btn--sm fr-btn--tertiary-no-outline",{"fr-icon-arrow-down-line":!r.sorted||r.sorted==="asc","fr-icon-arrow-up-line":r.sorted==="desc","text-grey-500":r.sorted,"text-mention-grey":!r.sorted}]),onClick:n,title:t(d)("Sort")},s(t(d)("Sort")),11,ks)])):W(r.$slots,"default",{key:0},void 0,!0)]))}});const R=X(zs,[["__scopeId","data-v-5acf0bf0"]]),Cs=["aria-describedby"],As=["id"],V=T({__name:"Tooltip",setup(_){const o=G("tooltip");return(a,v)=>(u(),$(I,null,[e("p",ye(a.$attrs,{"aria-describedby":t(o)}),[W(a.$slots,"default")],16,Cs),e("span",{class:"fr-tooltip fr-placement",id:t(o),role:"tooltip","aria-hidden":"true"},[W(a.$slots,"tooltip")],8,As)],64))}}),Ds=["href"],Ss={class:"monospace"},Rs={class:"monospace"},Ts={class:"monospace"},Os={class:"monospace"},Ms={class:"monospace"},Bs=T({__name:"AdminDatasetsTable",props:{datasets:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(_,{emit:o}){const a=o,v=_,{t:d}=B();function i(f,g){a("sort",f,g)}function n(f){return v.sortedBy===f?v.sortDirection:null}function r(f){return Array.isArray(f.resources)?f.resources.length:f.resources.total}function p(f){return"".concat(se,"dataset/").concat(f.id,"/")}function b(f){return f.deleted?{label:d("Deleted"),type:"error"}:f.archived?{label:d("Archived"),type:"warning"}:f.private?{label:d("Draft"),type:"default"}:{label:d("Public"),type:"info"}}return(f,g)=>(u(),D(oe,{loading:f.loading},{default:c(()=>[e("thead",null,[e("tr",null,[l(R,{onSort:g[0]||(g[0]=m=>i("title",m)),sorted:n("title"),scope:"col"},{default:c(()=>[w(s(t(d)("Title of the dataset")),1)]),_:1},8,["sorted"]),l(R,{scope:"col"},{default:c(()=>[w(s(t(d)("Status")),1)]),_:1}),l(R,{onSort:g[1]||(g[1]=m=>i("created",m)),sorted:n("created"),scope:"col"},{default:c(()=>[w(s(t(d)("Created at")),1)]),_:1},8,["sorted"]),l(R,{onSort:g[2]||(g[2]=m=>i("last_update",m)),sorted:n("last_update"),scope:"col"},{default:c(()=>[w(s(t(d)("Updated at")),1)]),_:1},8,["sorted"]),l(R,{scope:"col"},{default:c(()=>[w(s(t(d)("Files")),1)]),_:1}),l(R,{scope:"col"},{default:c(()=>[w(s(t(d)("Score")),1)]),_:1}),l(R,{scope:"col"},{default:c(()=>[l(V,null,{tooltip:c(()=>[w(s(t(d)("Discussions")),1)]),default:c(()=>[g[6]||(g[6]=e("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),l(R,{onSort:g[3]||(g[3]=m=>i("views",m)),sorted:n("views"),scope:"col"},{default:c(()=>[l(V,null,{tooltip:c(()=>[w(s(t(d)("Views")),1)]),default:c(()=>[g[7]||(g[7]=e("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),l(R,{scope:"col"},{default:c(()=>[l(V,null,{tooltip:c(()=>[w(s(t(d)("Downloads")),1)]),default:c(()=>[g[8]||(g[8]=e("span",{class:"fr-icon--sm fr-icon-download-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),l(R,{onSort:g[4]||(g[4]=m=>i("reuses",m)),sorted:n("reuses"),scope:"col"},{default:c(()=>[l(V,null,{tooltip:c(()=>[w(s(t(d)("Reuses")),1)]),default:c(()=>[g[9]||(g[9]=e("span",{class:"fr-icon--sm fr-icon-line-chart-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),l(R,{onSort:g[5]||(g[5]=m=>i("followers",m)),sorted:n("followers"),scope:"col"},{default:c(()=>[l(V,null,{tooltip:c(()=>[w(s(t(d)("Favorites")),1)]),default:c(()=>[g[10]||(g[10]=e("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"])])]),e("tbody",null,[(u(!0),$(I,null,F(f.datasets,m=>{var y;return u(),$("tr",{key:m.id},[e("td",null,[l(be,null,{default:c(()=>[e("a",{class:"fr-link fr-reset-link",href:p(m)},[l(t(E),{text:m.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Ds)]),_:2},1024)]),e("td",null,[l(ue,{type:b(m).type},{default:c(()=>[w(s(b(m).label),1)]),_:2},1032,["type"])]),e("td",null,s(t(q)(m.created_at)),1),e("td",null,s(t(q)(m.last_modified)),1),e("td",null,s(r(m)),1),e("td",null,[l(t(et),{class:"w-100",score:m.quality.score},null,8,["score"])]),e("td",Ss,s(t(H)(m.metrics.discussions)),1),e("td",Rs,s(t(H)(m.metrics.views)),1),e("td",Ts,s(t(H)((y=m.metrics.resources_downloads)!=null?y:0)),1),e("td",Os,s(t(H)(m.metrics.reuses)),1),e("td",Ms,s(t(H)(m.metrics.followers)),1)])}),128))])]),_:1},8,["loading"]))}}),Oe=k(null);function K(){const _=o=>{Oe.value=o};return{currentOrganization:Ge(Oe),setCurrentOrganization:_}}const xs="/_themes/gouvfr/assets/logotype-white.svg",Is=["href"],Ls=["src","alt"],ze=T({__name:"AdminPublishButton",props:{type:{}},setup(_){const o=_,{t:a}=B(),v=M(()=>{switch(o.type){case"dataset":return st;case"harvester":return"".concat(se,"harvester/new/");case"reuse":return tt}});return(d,i)=>(u(),$("a",{href:v.value,class:"fr-btn fr-icon-add-line fr-btn--icon-left"},[w(s(t(a)("Publish on"))+" ",1),e("img",{class:"fr-ml-1v",src:t(xs),loading:"lazy",alt:t(ke)},null,8,Ls)],8,Is))}}),js={key:0},Ps={class:"fr-breadcrumb__link","aria-current":"page"},qs={class:"fr-h3 fr-mb-5v"},Us={class:"fr-p-3w flex items-center justify-between relative"},Hs=["id"],Vs=["aria-expanded"],Es={class:"flex items-center fr-ml-4v buttons"},Ys={class:"fr-col-auto fr-ml-3v fr-m-0"},Ns=["disabled","href","title"],Ws=["aria-labelledby"],Fs={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Gs={class:"fr-col"},Js={class:"subtitle subtitle--uppercase fr-m-0"},Zs={key:0,class:"fr-col-auto fr-grid-row fr-grid-row--middle"},Ks=["href"],Qs={class:"text-align-center fr-py-1w"},Xs=["src"],eo={class:"fr-text--bold fr-my-3v"},to=T({__name:"Datasets",props:{oid:{}},setup(_){const{t:o}=B(),a=_,v=k([]),d=k(!1),i=k(1),n=k(10),r=k(0),p=k("created"),b=k("desc"),f=M(()=>"".concat(b.value==="asc"?"":"-").concat(p.value)),g=k(""),m=ot(g,it),{currentOrganization:y}=K(),h=pe();function C(x,L){p.value=x,b.value=L}Y(async()=>{d.value=!0,v.value=[];try{let x;if(a.oid)x=await at(a.oid,m.value,i.value,n.value,f.value);else if(h.value)x=await nt(h.value.id,m.value,i.value,n.value,f.value);else return;v.value=x.data,i.value=x.page,n.value=x.page_size,r.value=x.total}finally{d.value=!1}});const z=k(!1),S=Je(),O=k(null),Q=k(null),j=k(null),Ce=k(null),ne=k(null),Ae=k(null);Y(async()=>{if(a.oid){{const L=await(await fetch("https://metric-api.data.gouv.fr/api/organizations/data/?organization_id__exact=".concat(a.oid,"&metric_month__sort=desc&page_size=12"))).json();O.value={},j.value={},ne.value={};for(const{metric_month:ee,monthly_download_resource:ce,monthly_visit_dataset:Ne,monthly_visit_reuse:We}of L.data)O.value[ee]=Ne,j.value[ee]=ce,ne.value[ee]=We}{const L=await(await fetch("https://metric-api.data.gouv.fr/api/organizations_total/data/?organization_id__exact=".concat(a.oid))).json();L.data[0]&&(Q.value=L.data[0].visit_dataset,Ce.value=L.data[0].download_resource,Ae.value=L.data[0].visit_reuse)}}});const De=M(()=>{if(!O.value||!j.value||!ne.value)return null;let x="month,visit_datasets,download_resource,visit_reuse\n";for(const L in O.value)x+="".concat(L,",").concat(O.value[L],",").concat(j.value[L],",").concat(ne.value[L],"\n");return URL.createObjectURL(new Blob([x],{type:"text/csv"}))});return(x,L)=>{const ee=P("router-link");return u(),$("div",null,[l(Z,null,{default:c(()=>[e("li",null,[l(ee,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(o)("Administration")),1)]),_:1})]),t(y)?(u(),$("li",js,[l(ee,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(y).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",Ps,s(t(o)("Datasets")),1)])]),_:1}),e("h1",qs,s(t(o)("Datasets")),1),x.oid&&!d.value&&r.value>0?(u(),$("div",{key:0,class:N(["bg-white border rounded-xxs fr-mb-3w",{"fr-pb-4v":z.value}])},[e("header",Us,[e("div",null,[e("h4",{class:"fr-mb-1v flex items-center",id:t(S)},[e("button",{type:"button",onClick:L[0]||(L[0]=ce=>z.value=!z.value),class:"fr-p-0 fr-text flex items-center font-bold","data-testid":"expand-button","aria-expanded":z.value},[w(s(x.$t("Statistics on your datasets"))+" ",1),L[2]||(L[2]=e("span",{class:"absolute inset-0 z-1"},null,-1))],8,Vs)],8,Hs)]),e("div",Es,[e("p",Ys,[e("a",{disabled:!De.value,href:De.value||"",rel:"ugc nofollow noopener",title:t(o)("Download file"),download:"stats.csv",class:"relative fr-btn fr-btn--sm fr-btn--icon-left fr-icon-test-tube-line fr-icon-download-line fr-icon--sm z-2"},s(x.$t("Download")),9,Ns)]),e("div",{class:N(["fr-icon--sm fr-ml-4v",{"fr-icon-arrow-up-s-line":z.value,"fr-icon-arrow-down-s-line":!z.value}])},null,2)])]),z.value?(u(),$("section",{key:0,"aria-labelledby":t(S),class:"flex fr-pb-3w fr-pl-3w fr-pr-3w"},[l(t(ge),{title:x.$t("Views"),data:O.value,type:"line",summary:Q.value,class:"w-1/3"},null,8,["title","data","summary"]),l(t(ge),{title:x.$t("Downloads"),data:j.value,type:"line",summary:Ce.value,class:"w-1/3"},null,8,["title","data","summary"]),l(t(ge),{title:x.$t("Reuses Visits"),data:ne.value,type:"line",summary:Ae.value,class:"w-1/3"},null,8,["title","data","summary"])],8,Ws)):A("",!0)],2)):A("",!0),e("div",Fs,[e("div",Gs,[e("h2",Js,s(t(o)("{n} datasets",r.value)),1)]),x.oid?(u(),$("div",Zs,[e("div",null,[e("a",{href:t(lt)(x.oid,r.value),class:"fr-btn fr-btn--sm fr-icon-download-line fr-btn--icon-left"},s(t(o)("Download catalog")),9,Ks)])])):A("",!0)]),d.value||r.value>0?(u(),D(Bs,{key:1,datasets:v.value,loading:d.value,"sort-direction":b.value,sortedBy:p.value,onSort:C},null,8,["datasets","loading","sort-direction","sortedBy"])):(u(),D(J,{key:2,class:"fr-my-2w"},{default:c(()=>[e("div",Qs,[e("img",{src:t(rt),alt:"",loading:"lazy"},null,8,Xs),e("p",eo,s(t(o)("You haven't published a dataset yet")),1),l(ze,{type:"dataset"})])]),_:1})),r.value>n.value?(u(),D(t(ie),{key:3,page:i.value,"page-size":n.value,"total-results":r.value,onChange:L[1]||(L[1]=ce=>i.value=ce)},null,8,["page","page-size","total-results"])):A("",!0)])}}});const Me=X(to,[["__scopeId","data-v-93674b91"]]),so=["href"],oo={class:"monospace"},ao={class:"monospace"},no={class:"monospace"},lo={class:"monospace"},ro=T({__name:"AdminReusesTable",props:{reuses:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(_){const o=_,{t:a}=B();function v(n){return o.sortedBy===n?o.sortDirection:null}function d(n){return"".concat(se,"reuse/").concat(n.id,"/")}function i(n){return n.deleted?{label:a("Deleted"),type:"error"}:n.archived?{label:a("Archived"),type:"warning"}:n.private?{label:a("Draft"),type:"default"}:{label:a("Public"),type:"info"}}return(n,r)=>(u(),D(oe,{loading:n.loading},{default:c(()=>[e("thead",null,[l(R,{onSort:r[0]||(r[0]=p=>n.$emit("sort","title",p)),sorted:v("title"),scope:"col"},{default:c(()=>[w(s(t(a)("Reuse title")),1)]),_:1},8,["sorted"]),l(R,null,{default:c(()=>[w(s(t(a)("Status")),1)]),_:1}),l(R,{onSort:r[1]||(r[1]=p=>n.$emit("sort","created",p)),sorted:v("created"),scope:"col"},{default:c(()=>[w(s(t(a)("Created at")),1)]),_:1},8,["sorted"]),l(R,{onSort:r[2]||(r[2]=p=>n.$emit("sort","datasets",p)),sorted:v("datasets"),scope:"col"},{default:c(()=>[w(s(t(a)("Datasets")),1)]),_:1},8,["sorted"]),l(R,{scope:"col"},{default:c(()=>[l(V,null,{tooltip:c(()=>[w(s(t(a)("Discussions")),1)]),default:c(()=>[r[5]||(r[5]=e("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),l(R,{onSort:r[3]||(r[3]=p=>n.$emit("sort","views",p)),sorted:v("views"),scope:"col"},{default:c(()=>[l(V,null,{tooltip:c(()=>[w(s(t(a)("Views")),1)]),default:c(()=>[r[6]||(r[6]=e("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),l(R,{onSort:r[4]||(r[4]=p=>n.$emit("sort","followers",p)),sorted:v("followers"),scope:"col"},{default:c(()=>[l(V,null,{tooltip:c(()=>[w(s(t(a)("Favorites")),1)]),default:c(()=>[r[7]||(r[7]=e("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"])]),e("tbody",null,[(u(!0),$(I,null,F(n.reuses,p=>(u(),$("tr",null,[e("td",null,[l(be,null,{default:c(()=>[e("a",{class:"fr-link fr-reset-link",href:d(p)},[l(t(E),{text:p.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,so)]),_:2},1024)]),e("td",null,[l(ue,{type:i(p).type},{default:c(()=>[w(s(i(p).label),1)]),_:2},1032,["type"])]),e("td",null,s(t(q)(p.created_at)),1),e("td",oo,s(t(H)(p.datasets.length)),1),e("td",ao,s(t(H)(p.metrics.discussions)),1),e("td",no,s(t(H)(p.metrics.views)),1),e("td",lo,s(t(H)(p.metrics.followers)),1)]))),256))])]),_:1},8,["loading"]))}}),io="/_themes/gouvfr/assets/reuse.svg",uo={class:"fr-container--fluid"},co={key:0},fo={class:"fr-breadcrumb__link","aria-current":"page"},mo={class:"fr-h3 fr-mb-5v"},_o={class:"subtitle subtitle--uppercase fr-mb-0"},po={class:"text-align-center fr-py-1w"},vo=["src"],bo={class:"fr-text--bold fr-my-3v"},Be=T({__name:"Reuses",props:{oid:{}},setup(_){const{t:o}=B(),a=_,v=k([]),d=k(!1),i=k(1),n=k(10),r=k(0),p=k("created"),b=k("desc"),f=M(()=>"".concat(b.value==="asc"?"":"-").concat(p.value)),{currentOrganization:g}=K(),m=pe();function y(h,C){p.value=h,b.value=C}return Y(async()=>{d.value=!0,v.value=[];try{let h;if(a.oid)h=await dt(a.oid,i.value,n.value,f.value);else if(m.value)h=await ut(m.value.id,i.value,n.value,f.value);else return;v.value=h.data,i.value=h.page,n.value=h.page_size,r.value=h.total}finally{d.value=!1}}),(h,C)=>{const z=P("router-link");return u(),$("div",uo,[l(Z,null,{default:c(()=>[e("li",null,[l(z,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(o)("Administration")),1)]),_:1})]),t(g)?(u(),$("li",co,[l(z,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(g).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",fo,s(t(o)("Reuses")),1)])]),_:1}),e("h1",mo,s(t(o)("Reuses")),1),e("h2",_o,s(t(o)("{n} reuses of your organization",v.value.length)),1),d.value||r.value>0?(u(),D(ro,{key:0,reuses:v.value,loading:d.value,sortDirection:b.value,sortedBy:p.value,onSort:y},null,8,["reuses","loading","sortDirection","sortedBy"])):(u(),D(J,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:c(()=>[e("div",po,[e("img",{src:t(io),alt:"",loading:"lazy"},null,8,vo),e("p",bo,s(t(o)("You haven't published a reuse yet")),1),l(ze,{type:"reuse"})])]),_:1})),r.value>n.value?(u(),D(t(ie),{key:2,page:i.value,"page-size":n.value,"total-results":r.value,onChange:C[0]||(C[0]=S=>i.value=S)},null,8,["page","page-size","total-results"])):A("",!0)])}}}),go={class:"fr-breadcrumb__link","aria-current":"page"},ho={key:0,class:"fr-h1"},yo={class:"fr-alert fr-alert--info"},$o={class:"fr-alert__title"},wo={href:"/admin/me/"},ko=T({__name:"Me",setup(_){const{t:o}=B(),a=pe();return(v,d)=>{const i=P("router-link");return u(),$("div",null,[l(Z,null,{default:c(()=>[e("li",null,[l(i,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(o)("Administration")),1)]),_:1})]),e("li",null,[e("a",go,s(t(o)("Me")),1)])]),_:1}),t(a)?(u(),$("h1",ho,s(t(a).first_name)+" "+s(t(a).last_name),1)):A("",!0),e("div",yo,[e("h3",$o,s(t(o)("This is a WIP page")),1),e("p",null,[e("a",wo,s(t(o)("You can edit your profil on the current admin.")),1)])])])}}}),xe='<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5 12V18C5 18 5 21 12 21C19 21 19 18 19 18V12" stroke="currentColor" stroke-width="1.5"/>\n<path d="M5 6V12C5 12 5 15 12 15C19 15 19 12 19 12V6" stroke="currentColor" stroke-width="1.5"/>\n<path d="M12 3C19 3 19 6 19 6C19 6 19 9 12 9C5 9 5 6 5 6C5 6 5 3 12 3Z" stroke="currentColor" stroke-width="1.5"/>\n</svg>\n',zo={class:"fr-sidemenu__item"},Co=["innerHTML"],Ao=T({__name:"AdminSidebarLink",props:{label:{},icon:{},iconHtml:{},to:{}},setup(_){return(o,a)=>{const v=P("router-link");return u(),$("li",zo,[e("div",{class:N([{"fr-icon-svg fr-icon--sm":o.iconHtml},"fr-enlarge-link fr-sidemenu__link fr-mb-1w"])},[o.iconHtml?(u(),$("div",{key:0,class:"fr-mr-1w fr-grid-row",innerHTML:o.iconHtml},null,8,Co)):o.icon?(u(),$("div",{key:1,class:N([o.icon,"fr-mr-1w fr-icon--sm"]),"aria-hidden":"true"},null,2)):A("",!0),l(v,{to:o.to},{default:c(()=>[l(t(E),{text:o.label,"auto-resize":!0,"max-lines":1},null,8,["text"])]),_:1},8,["to"])],2)])}}});const U=X(Ao,[["__scopeId","data-v-239d0721"]]),Do=["aria-expanded","aria-controls","aria-current"],So={class:"fr-mx-1w"},Ro={class:"logo logo--sm"},To={class:"fr-mx-1w fr-col text-overflow-ellipsis"},Oo=["id"],Mo={class:"fr-sidemenu__list fr-mx-1w fr-my-3v"},Bo=T({__name:"AdminSidebarMenu",props:{user:{},organization:{},isOpened:{type:Boolean}},emits:["open","click"],setup(_){const o=_,{t:a}=B(),v=G("menu");function d(i,n){const r=document.getElementById(v);n(r)&&(i?n(r).collapse.disclose():n(r).collapse.conceal())}return Ze(()=>{setTimeout(()=>{d(o.isOpened,globalThis.dsfr)},200)}),(i,n)=>(u(),$("li",{class:N(["fr-sidemenu__item",{"fr-sidemenu__item--active":i.isOpened}])},[e("button",{class:"fr-sidemenu__btn","aria-expanded":i.isOpened,"aria-controls":t(v),"aria-current":i.isOpened,onClick:n[0]||(n[0]=r=>i.$emit("open"))},[i.user?(u(),$(I,{key:0},[i.user?(u(),D(t(_e),{key:0,user:i.user,size:24,rounded:!0},null,8,["user"])):A("",!0),e("p",So,s(t(a)("My Profile")),1)],64)):i.organization?(u(),$(I,{key:1},[e("div",Ro,[l(ct,{type:"organization",src:i.organization.logo_thumbnail,size:20},null,8,["src"])]),e("p",To,s(i.organization.name),1)],64)):A("",!0)],8,Do),e("div",{class:"fr-collapse","data-fr-js-collapse":"",id:t(v)},[e("ul",Mo,[i.user?(u(),$(I,{key:0},[l(U,{icon:"fr-icon-account-circle-line",label:t(a)("Me"),to:{name:"me"}},null,8,["label"]),l(U,{iconHtml:t(xe),label:t(a)("Datasets"),to:{name:"me-datasets"}},null,8,["iconHtml","label"]),l(U,{icon:"fr-icon-line-chart-line",label:t(a)("Reuses"),to:{name:"me-reuses"}},null,8,["label"]),l(U,{icon:"fr-icon-git-pull-request-line",label:t(a)("Community Resources"),to:{name:"me-community-resources"}},null,8,["label"])],64)):i.organization?(u(),$(I,{key:1},[l(U,{iconHtml:t(xe),label:t(a)("Datasets"),to:{name:"organization-datasets",params:{oid:i.organization.id}},onClick:n[1]||(n[1]=r=>i.$emit("click"))},null,8,["iconHtml","label","to"]),l(U,{icon:"fr-icon-line-chart-line",label:t(a)("Reuses"),to:{name:"organization-reuses",params:{oid:i.organization.id}},onClick:n[2]||(n[2]=r=>i.$emit("click"))},null,8,["label","to"]),l(U,{icon:"fr-icon-chat-3-line",label:t(a)("Discussions"),to:{name:"organization-discussions",params:{oid:i.organization.id}},onClick:n[3]||(n[3]=r=>i.$emit("click"))},null,8,["label","to"]),l(U,{icon:"fr-icon-parent-line",label:t(a)("Members"),to:{name:"organization-members",params:{oid:i.organization.id}},onClick:n[4]||(n[4]=r=>i.$emit("click"))},null,8,["label","to"]),l(U,{icon:"fr-icon-server-line",label:t(a)("Harvesters"),to:{name:"organization-harvesters",params:{oid:i.organization.id}},onClick:n[5]||(n[5]=r=>i.$emit("click"))},null,8,["label","to"]),l(U,{icon:"fr-icon-git-pull-request-line",label:t(a)("Community Resources"),to:{name:"organization-community-resources",params:{oid:i.organization.id}},onClick:n[6]||(n[6]=r=>i.$emit("click"))},null,8,["label","to"]),l(U,{icon:"fr-icon-user-line",label:t(a)("Profile"),to:{name:"organization-profile",params:{oid:i.organization.id}},onClick:n[7]||(n[7]=r=>i.$emit("click"))},null,8,["label","to"])],64)):A("",!0)])],8,Oo)],2))}});const Ie=X(Bo,[["__scopeId","data-v-68a29c5a"]]),xo={class:"fr-container--fluid h-100"},Io={class:"fr-grid-row h-100 bg-grey-50"},Lo={class:"fr-col-12 fr-col-md-4 fr-col-lg-3 fr-col-xl-2"},jo=["aria-label"],Po={class:"fr-sidemenu__inner"},qo=["aria-controls"],Uo=["id"],Ho={class:"fr-sidemenu__list"},Vo={class:"fr-col-12 fr-col-md-8 fr-col-lg-9 fr-col-xl-10 h-100 fr-px-2w overflow-auto"},Eo=T({__name:"Admin",setup(_){const{t:o}=B(),a=ft(),v=G("menu"),d=k(null),i=k(),{setCurrentOrganization:n}=K(),r=je();function p(f){return f===i.value}function b(f){i.value=f.id}return re(async()=>{var f,g;if(d.value=await mt(),a.name||(d.value.organizations.length>0?r.replace({name:"organization-datasets",params:{oid:d.value.organizations[0].id}}):r.replace({name:"me"})),a.name==="me")i.value=(f=te)==null?void 0:f.id;else if(d.value.organizations.length>0){let m=d.value.organizations[0];a.params.oid&&(m=(g=d.value.organizations.find(y=>y.id===a.params.oid))!=null?g:m),b(m),n(m)}}),(f,g)=>{const m=P("router-view");return u(),$("div",xo,[e("div",Io,[e("div",Lo,[e("nav",{class:"fr-sidemenu fr-pr-0","aria-label":t(o)("Administration menu")},[e("div",Po,[e("button",{class:"fr-sidemenu__btn",hidden:"","aria-controls":t(v),"aria-expanded":"false"},s(t(o)("Open menu")),9,qo),e("div",{class:"fr-collapse",id:t(v)},[e("ul",Ho,[t(te)?(u(),D(Ie,{key:0,user:t(te),"is-opened":p(t(te).id),onOpen:g[0]||(g[0]=y=>b(t(te)))},null,8,["user","is-opened"])):A("",!0),d.value?(u(!0),$(I,{key:1},F(d.value.organizations,y=>(u(),D(Ie,{organization:y,"is-opened":p(y.id),onOpen:()=>b(y),onClick:()=>t(n)(y)},null,8,["organization","is-opened","onOpen","onClick"]))),256)):A("",!0)])],8,Uo)])],8,jo)]),e("div",Vo,[(u(),D(m,{key:t(a).fullPath,class:"fr-container--fluid"}))])])])}}});const Yo=X(Eo,[["__scopeId","data-v-364348c3"]]),No=["aria-labelledby","id"],Wo={class:"fr-container fr-container--fluid fr-container-md"},Fo={class:"fr-grid-row fr-grid-row--center"},Go={class:"fr-col-12 fr-col-md-8"},Jo={class:"fr-modal__body"},Zo={class:"fr-modal__header"},Ko=["title","aria-controls"],Qo={class:"fr-modal__content"},Xo=["id"],ea={class:"fr-modal__footer"},ta={class:"fr-btns-group fr-btns-group--right fr-btns-group--sm fr-btns-group--inline-lg fr-btns-group--icon-left"},sa=["disabled"],oa=["disabled"],aa=T({__name:"AdminAddMemberModal",props:{id:{},oid:{},roles:{}},emits:["memberAdded"],setup(_,{emit:o}){const a=_,v=o,{t:d}=B(),{toast:i}=ve(),n=k(!1),r=k(),p=k("editor"),b=M(()=>"fr-modal-title-user-"+a.id);async function f(){try{n.value=!0,r.value&&(await pt(a.oid,r.value,p.value),v("memberAdded"),m())}catch(y){i.error(d("An error occurred while update member role."))}finally{n.value=!1}}function g(y){return y.map(h=>{var z;const C={...h,avatar_thumbnail:(z=h.avatar_url)!=null?z:void 0};return{value:C.id,label:C.first_name+" "+C.last_name,image:vt(C,32)}})}function m(){n.value=!1,r.value=void 0,p.value="editor";const y=document.getElementById(a.id);globalThis.dsfr(y).modal.conceal()}return(y,h)=>(u(),D(me,{to:"body"},[e("dialog",{"aria-labelledby":b.value,role:"dialog",id:y.id,class:"fr-modal"},[e("div",Wo,[e("div",Fo,[e("div",Go,[e("div",Jo,[e("div",Zo,[e("button",{class:"fr-btn--close fr-btn",title:t(d)("Close the modal dialog"),"aria-controls":y.id},s(t(d)("Close")),9,Ko)]),e("form",{onSubmit:fe(f,["prevent"])},[e("div",Qo,[e("h1",{id:b.value,class:"fr-modal__title fr-mb-2w"},s(t(d)("Add member to the organization")),9,Xo),l(_t,{placeholder:y.$t("Search a user"),searchPlaceholder:y.$t("Search a user..."),suggestUrl:"/users/suggest/",values:r.value,onChange:h[0]||(h[0]=C=>r.value=C),allOption:y.$t("Select a user"),addAllOption:!1,onSuggest:g,roundedImages:!0},null,8,["placeholder","searchPlaceholder","values","allOption"]),y.roles.length>0?(u(),D(Pe,{key:0,label:t(d)("Role of the member"),"model-value":p.value,"onUpdate:modelValue":h[1]||(h[1]=C=>p.value=C),options:y.roles},null,8,["label","model-value","options"])):A("",!0)]),e("div",ea,[e("div",ta,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"button",onClick:m,disabled:n.value},s(t(d)("Cancel")),9,sa),e("button",{class:"fr-btn",type:"submit",disabled:n.value},s(t(d)("Add to the organization")),9,oa)])])],32)])])])])],8,No)]))}}),na=["aria-controls"],la=T({__name:"AdminAddMemberButton",props:{oid:{},roles:{}},emits:["memberAdded"],setup(_){const o=_,{t:a}=B(),v=M(()=>"fr-modal-add-user-"+o.oid);return(d,i)=>(u(),$(I,null,[e("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-icon-add-line","data-fr-opened":"false","aria-controls":v.value},s(t(a)("Add member")),9,na),l(aa,{id:v.value,oid:d.oid,roles:d.roles,onMemberAdded:i[0]||(i[0]=n=>d.$emit("memberAdded"))},null,8,["id","oid","roles"])],64))}}),ra={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Ee=T({__name:"AdminDangerZone",setup(_){return(o,a)=>(u(),D(t(bt),{color:"error",type:"secondary",weight:"regular"},{default:c(()=>[e("div",ra,[W(o.$slots,"default")])]),_:3}))}}),ia={class:"fr-px-1v rounded-2 monospace fr-text--sm text-mention-grey bg-grey-100 fr-m-0"},Ye=T({__name:"AdminEmail",props:{email:{}},setup(_){return(o,a)=>(u(),$("p",ia,s(o.email),1))}}),da=["aria-labelledby","id"],ua={class:"fr-container fr-container--fluid fr-container-md"},ca={class:"fr-grid-row fr-grid-row--center"},fa={class:"fr-col-12 fr-col-md-8"},ma={class:"fr-modal__body"},_a={class:"fr-modal__header"},pa=["title","aria-controls"],va={class:"fr-modal__content"},ba=["id"],ga={class:"fr-grid-row fr-grid-row--middle fr-mb-2w"},ha={class:"fr-text--bold fr-m-0 fr-mr-1v"},ya={class:"fr-col"},$a={class:"fr-col-auto"},wa=["disabled"],ka={class:"fr-col"},za={class:"fr-m-0 text-grey-500"},Ca={class:"fr-m-0 fr-text--xs text-default-error"},Aa={class:"fr-col-auto"},Da=["disabled"],Sa=T({__name:"AdminEditMemberModal",props:{id:{},member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(_,{emit:o}){const a=_,v=o,d=M(()=>"fr-modal-title-user-"+a.id),{t:i}=B(),{toast:n}=ve(),r=k(!1);async function p(m){if(!m.newRole){g();return}try{r.value=!0,await gt(a.oid,m.user.id,m.newRole),v("memberUpdated"),g()}catch(y){n.error(i("An error occurred while update member role."))}finally{r.value=!1}}async function b(m){try{r.value=!0,await ht(a.oid,m.user.id),v("memberUpdated")}catch(y){n.error(i("An error occurred while removing this member."))}finally{r.value=!1}}function f(m){return a.roles.map(y=>{const h={...y};return h.value===m&&(h.selected=!0),h})}function g(){r.value=!1;const m=document.getElementById(a.id);globalThis.dsfr(m).modal.conceal()}return(m,y)=>(u(),D(me,{to:"body"},[e("dialog",{"aria-labelledby":d.value,role:"dialog",id:m.id,class:"fr-modal"},[e("div",ua,[e("div",ca,[e("div",fa,[e("div",ma,[e("div",_a,[e("button",{class:"fr-btn--close fr-btn",title:t(i)("Close the modal dialog"),"aria-controls":m.id},s(t(i)("Close")),9,pa)]),e("div",va,[e("h1",{id:d.value,class:"fr-modal__title fr-mb-2w"},s(t(i)("Edit member")),9,ba),e("div",ga,[l(t(_e),{class:"fr-mr-1v",user:m.member.user,rounded:!0,size:24},null,8,["user"]),e("p",ha,s(m.member.user.first_name)+" "+s(m.member.user.last_name),1),m.member.user.email?(u(),D(Ye,{key:0,email:m.member.user.email},null,8,["email"])):A("",!0)]),e("form",{class:"fr-grid-row fr-grid-row--gutters fr-grid-row--bottom",onSubmit:y[1]||(y[1]=fe(h=>p(m.member),["prevent"]))},[e("div",ya,[m.roles.length>0?(u(),D(Pe,{key:0,label:t(i)("Role of the member"),"model-value":m.member.role,"onUpdate:modelValue":y[0]||(y[0]=h=>m.member.newRole=h),options:f(m.member.role)},null,8,["label","model-value","options"])):A("",!0)]),e("div",$a,[e("button",{class:"fr-btn",type:"submit",disabled:r.value},s(t(i)("Validate")),9,wa)])],32),l(Ee,{class:"fr-mt-2w"},{default:c(()=>[e("div",ka,[e("p",za,s(t(i)("Remove member from the organization")),1),e("p",Ca,s(t(i)("Be careful, this action can't be reverse.")),1)]),e("div",Aa,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-logout-box-r-line",disabled:r.value,onClick:y[2]||(y[2]=h=>b(m.member))},s(t(i)("Remove member")),9,Da)])]),_:1})])])])])])],8,da)]))}}),Ra=["aria-controls"],Ta=T({__name:"AdminEditMemberButton",props:{member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(_){const o=_,{t:a}=B(),v=M(()=>"fr-modal-user-"+o.member.user.id);return(d,i)=>(u(),$(I,null,[e("button",{class:"fr-btn fr-btn--sm fr-btn--secondary-grey-500 fr-btn--tertiary-no-outline fr-icon-pencil-line","data-fr-opened":"false","aria-controls":v.value},s(t(a)("Edit")),9,Ra),l(Sa,{id:v.value,member:d.member,oid:d.oid,roles:d.roles,onMemberUpdated:i[0]||(i[0]=n=>d.$emit("memberUpdated"))},null,8,["id","member","oid","roles"])],64))}}),Oa={class:"fr-mt-n9v fr-mb-2w"},Ma={class:"fr-badge fr-badge--info fr-badge--no-icon"},Ba={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},xa={class:"fr-col"},Ia={class:"fr-grid-row fr-grid-row--middle"},La={class:"fr-text--bold fr-m-0 fr-mr-1v"},ja={class:"fr-m-0"},Pa={class:"fr-ml-3v fr-mt-1-5v fr-mb-0 filet filet-default-grey fr-text--sm"},qa={key:0,class:"fr-col-auto fr-grid-row flex-direction-column"},Ua=["disabled"],Ha=["disabled","aria-controls"],Va=["aria-labelledby","id"],Ea={class:"fr-container fr-container--fluid fr-container-md"},Ya={class:"fr-grid-row fr-grid-row--center"},Na={class:"fr-col-12 fr-col-md-8"},Wa={class:"fr-modal__body"},Fa={class:"fr-modal__header"},Ga=["title","aria-controls"],Ja={class:"fr-modal__content"},Za=["id"],Ka={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--right"},Qa={class:"fr-col-auto"},Xa=["disabled"],en={class:"fr-col-auto"},tn=["disabled"],sn=T({__name:"AdminMembershipRequest",props:{loading:{type:Boolean},oid:{},request:{},showActions:{type:Boolean}},emits:["accept","refuse"],setup(_,{emit:o}){const a=_,v=o,{t:d}=B(),i=k(""),n=G("modal"),r=G("modalTitle");function p(){const g=document.getElementById(n);globalThis.dsfr(g).modal.conceal()}function b(){v("refuse",a.request.id,i.value),p()}function f(){i.value="",p()}return(g,m)=>{const y=P("AdminMembershipRequest",!0);return u(),D(J,{class:"drop-shadow rounded-xxs fr-mt-3w"},{default:c(()=>[e("div",Oa,[e("p",Ma,[m[2]||(m[2]=e("span",{class:"fr-icon-user-add-line fr-icon--sm","aria-hidden":"true"},null,-1)),w(" "+s(t(d)("Membership Request")),1)])]),e("div",Ba,[e("div",xa,[e("div",Ia,[l(t(_e),{class:"fr-mr-1v",user:g.request.user,rounded:!0,size:24},null,8,["user"]),e("p",La,s(g.request.user.first_name)+" "+s(g.request.user.last_name),1),g.request.user.email?(u(),D(Ye,{key:0,email:g.request.user.email,class:"fr-mr-1v"},null,8,["email"])):A("",!0),e("p",ja,s(t(d)("asks to join the organization.")),1)]),e("div",Pa,s(g.request.comment),1)]),g.showActions?(u(),$("div",qa,[e("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-mb-1w fr-icon-check-line",onClick:m[0]||(m[0]=h=>g.$emit("accept",g.request.id)),disabled:g.loading,"data-testid":"accept"},s(t(d)("Accept request")),9,Ua),e("button",{class:"fr-btn fr-btn--icon-left fr-btn--sm fr-btn--secondary fr-btn--secondary--error fr-icon-close-line",disabled:g.loading,"data-fr-opened":"false","aria-controls":t(n),"data-testid":"refuse"},s(t(d)("Refuse")),9,Ha),(u(),D(me,{to:"body"},[e("dialog",{"aria-labelledby":t(r),role:"dialog",id:t(n),class:"fr-modal","data-testid":"modal"},[e("div",Ea,[e("div",Ya,[e("div",Na,[e("div",Wa,[e("div",Fa,[e("button",{class:"fr-btn--close fr-btn",title:t(d)("Close the modal dialog"),"aria-controls":t(n),onClick:fe(f,["prevent"])},s(t(d)("Close")),9,Ga)]),e("div",Ja,[e("h1",{id:t(r),class:"fr-modal__title fr-mb-2w"},s(t(d)("Refuse membership request")),9,Za),l(y,{class:"fr-mt-4w fr-mb-2w",loading:!1,oid:g.oid,request:g.request,"show-actions":!1},null,8,["oid","request"]),e("form",{onSubmit:fe(b,["prevent"]),onReset:f},[l(yt,{label:t(d)("You can provide the refusal reason:"),modelValue:i.value,"onUpdate:modelValue":m[1]||(m[1]=h=>i.value=h),"data-testid":"comment-group"},null,8,["label","modelValue"]),e("div",Ka,[e("div",Qa,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"reset",disabled:g.loading,"data-testid":"cancel-modal-button"},s(t(d)("Cancel")),9,Xa)]),e("div",en,[e("button",{class:"fr-btn",type:"submit",disabled:g.loading,"data-testid":"refuse-modal-button"},s(t(d)("Refuse request")),9,tn)])])],32)])])])])])],8,Va)]))])):A("",!0)])]),_:1})}}}),on={key:0},an={class:"fr-breadcrumb__link","aria-current":"page"},nn={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-center"},ln={class:"fr-col-12 fr-col-md"},rn={class:"fr-h3 fr-mb-0"},dn={key:0,class:"fr-col-auto"},un={class:"subtitle subtitle--uppercase fr-mt-5v fr-mb-0"},cn={class:"fr-text--bold fr-m-0"},fn={class:"fr-m-0 fr-text--xs text-mention-grey f-italic inline-flex items-center"},mn={key:0},_n={key:1},pn={key:0},vn=T({__name:"Members",props:{oid:{}},setup(_){const o=_;$e($t);const{t:a}=B(),{toast:v}=ve(),d=k([]),i=M(()=>wt||p.value.some(z=>{var S;return z.user.id===((S=te)==null?void 0:S.id)&&z.role==="admin"})),n=k([]),{currentOrganization:r}=K(),p=k([]),b=k(!1);function f(z){var S,O;return(O=(S=n.value.find(Q=>Q.value===z))==null?void 0:S.label)!=null?O:z}function g(z){return z==="admin"?"info":"default"}async function m(){b.value=!0,p.value=[];try{const z=await qe(o.oid);p.value=z.members}finally{b.value=!1}}async function y(){const z=await Se(o.oid);d.value=z}async function h(z){b.value=!0;const S=[];try{await At(o.oid,z),S.push(y()),S.push(m())}catch(O){v.error(a("An error occurred while accepting this membership."))}finally{Promise.all(S).finally(()=>b.value=!1)}}async function C(z,S){b.value=!0;const O=[];try{await Dt(o.oid,z,S),O.push(y()),O.push(m())}catch(Q){v.error(a("An error occurred while refusing this membership."))}finally{Promise.all(O).finally(()=>b.value=!1)}}return Y(()=>{i.value&&Se(o.oid).then(z=>d.value=z)}),re(()=>{kt().then(zt).then(z=>n.value=z),m()}),(z,S)=>{const O=P("router-link"),Q=P("TextClamp");return u(),$("div",null,[l(Z,null,{default:c(()=>[e("li",null,[l(O,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(a)("Administration")),1)]),_:1})]),t(r)?(u(),$("li",on,[l(O,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(r).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",an,s(t(a)("Members")),1)])]),_:1}),e("div",nn,[e("div",ln,[e("h1",rn,s(t(a)("Members")),1)]),i.value?(u(),$("div",dn,[l(la,{oid:z.oid,roles:n.value,onMemberAdded:m},null,8,["oid","roles"])])):A("",!0)]),d.value.length?(u(),$(I,{key:0},[e("h2",un,s(t(a)("{n} requests",{n:d.value.length})),1),(u(!0),$(I,null,F(d.value,j=>(u(),D(sn,{class:"fr-mb-4w",key:j.id,loading:b.value,oid:z.oid,request:j,"show-actions":!0,onAccept:h,onRefuse:C},null,8,["loading","oid","request"]))),128))],64)):A("",!0),e("h2",{class:N(["subtitle subtitle--uppercase fr-mb-0",{"fr-mt-n3v":d.value.length,"fr-mt-5v":!d.value.length}])},s(t(a)("{n} members",{n:p.value.length})),3),l(oe,{class:"fr-table--layout-fixed",loading:b.value},{default:c(()=>[e("thead",null,[e("tr",null,[l(R,{scope:"col"},{default:c(()=>[w(s(t(a)("Members")),1)]),_:1}),l(R,{scope:"col"},{default:c(()=>[w(s(t(a)("Status")),1)]),_:1}),l(R,{scope:"col"},{default:c(()=>[w(s(t(a)("Member since")),1)]),_:1}),l(R,{scope:"col"},{default:c(()=>[w(s(t(a)("Last connection")),1)]),_:1}),i.value?(u(),D(R,{key:0,scope:"col"},{default:c(()=>[w(s(t(a)("Action")),1)]),_:1})):A("",!0)])]),e("tbody",null,[(u(!0),$(I,null,F(p.value,j=>(u(),$("tr",{key:j.user.id},[e("td",null,[e("p",cn,s(j.user.first_name)+" "+s(j.user.last_name),1),e("p",fn,[l(t(we),{height:12,width:12,name:"ri-mail-line"}),l(V,null,{default:c(()=>[l(Q,{class:"fr-px-1v",text:j.user.email,"auto-resize":!0,"max-lines":1},null,8,["text"])]),_:2},1024)])]),e("td",null,[l(ue,{type:g(j.role)},{default:c(()=>[w(s(f(j.role)),1)]),_:2},1032,["type"])]),e("td",null,s(t(q)(j.since)),1),e("td",null,[j.user.last_login_at?(u(),$("span",mn,s(t(Ct)(j.user.last_login_at)),1)):(u(),$("span",_n,s(t(a)("No connection")),1))]),i.value?(u(),$("td",pn,[l(Ta,{member:j,oid:z.oid,roles:n.value,onMemberUpdated:m},null,8,["member","oid","roles"])])):A("",!0)]))),128))])]),_:1},8,["loading"])])}}}),bn={class:"fr-container--fluid"},gn={key:0},hn={class:"fr-breadcrumb__link","aria-current":"page"},yn={class:"fr-h3 fr-mb-5v"},$n={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-between"},wn={class:"fr-col-12 fr-col-md fr-grid-row fr-grid-row--middle"},kn={class:"fr-ml-3v fr-my-0 fr-h3"},zn=["title"],Cn={class:"fr-col-auto"},An=["href"],Dn=["id"],Sn=["disabled","onClick"],Rn={class:"fr-col"},Tn={class:"fr-m-0 text-grey-500"},On={class:"fr-m-0 fr-text--xs text-default-error"},Mn={class:"fr-col-auto"},Bn=["disabled","aria-controls"],xn=["aria-labelledby","id"],In={class:"fr-container fr-container--fluid fr-container-md"},Ln={class:"fr-grid-row fr-grid-row--center"},jn={class:"fr-col-12 fr-col-md-8"},Pn={class:"fr-modal__body"},qn={class:"fr-modal__header"},Un=["title","aria-controls"],Hn={class:"fr-modal__content"},Vn=["id"],En={class:"fr-text--bold"},Yn={class:"fr-modal__footer"},Nn={class:"fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left"},Wn=["disabled"],Fn=T({__name:"Profile",props:{oid:{}},setup(_){const{t:o}=B(),{toast:a}=ve(),v=_,d=je(),i=k(null),{currentOrganization:n}=K(),r=k(null),{organizationCertified:p}=St(r),b=k([]),f=k(!1),g=G("modal"),m=G("modalTitle");function y(){n.value&&(f.value=!0,Ot(n.value.id).then(()=>{d.replace("/"),window.location.reload()}).catch(()=>a.error(o("An error occured when deleting the organization."))).finally(()=>f.value=!1))}async function h(C,z){f.value=!0;try{r.value=await Mt(C),a.success(o("Organization updated !"))}catch(S){a.error(o("An error occured when updating the organization."))}finally{f.value=!1}if(z&&r.value){f.value=!0;try{const S=await Bt(r.value.id,z);r.value.logo_thumbnail=S.image}catch(S){a.error(o("Failed to upload logo, you can upload it again in your management panel"))}finally{f.value=!1}}}return re(async()=>{f.value=!0;try{r.value=await qe(v.oid)}finally{f.value=!1}}),(C,z)=>{const S=P("router-link");return u(),$("div",bn,[l(Z,null,{default:c(()=>[e("li",null,[l(S,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(o)("Administration")),1)]),_:1})]),t(n)?(u(),$("li",gn,[l(S,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(n).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",hn,s(t(o)("Profile")),1)])]),_:1}),e("h1",yn,s(t(o)("Profile")),1),r.value?(u(),D(J,{key:0,class:"fr-mb-5v"},{default:c(()=>[e("div",$n,[e("div",wn,[l(t(Rt),{src:r.value.logo,type:"organization",size:80,class:"rounded-xxs border"},null,8,["src"]),e("div",kn,[w(s(r.value.name)+" ",1),t(p)?(u(),$("span",{key:0,class:"fr-icon-success-line fr-icon--lg text-blue-400",title:t(o)("The identity of this public service is certified by {certifier}",{certifier:t(ke)}),"aria-hidden":"true"},null,8,zn)):A("",!0)])]),e("div",Cn,[e("a",{href:r.value.page,class:"fr-btn fr-btn--sm fr-btn--secondary fr-btn--secondary-grey-500 fr-btn--icon-left fr-icon-eye-line"},s(t(o)("See the organization page")),9,An)])])]),_:1})):A("",!0),i.value?(u(),$("h2",{key:1,class:"subtitle subtitle--uppercase fr-mb-5v",id:i.value.legend},s(t(o)("Edit profile")),9,Dn)):A("",!0),f.value&&!r.value?(u(),D(Ve,{key:2})):A("",!0),r.value?(u(),D(Tt,{key:3,organization:r.value,errors:b.value,showLegend:!1,showWell:!1,ref_key:"form",ref:i,onSubmit:h},{submitButton:c(({submit:O})=>[e("button",{class:"fr-btn fr-btn--icon-left fr-icon-save-line",disabled:f.value,"data-testid":"submitButton",onClick:O},s(t(o)("Save")),9,Sn)]),default:c(()=>[l(Ee,{class:"fr-mt-6w"},{default:c(()=>[e("div",Rn,[e("p",Tn,s(t(o)("Delete the organization")),1),e("p",On,s(t(o)("Be careful, this action can't be reverse.")),1)]),e("div",Mn,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-delete-line",disabled:f.value,"data-fr-opened":"false","aria-controls":t(g)},s(t(o)("Delete")),9,Bn),(u(),D(me,{to:"body"},[e("dialog",{"aria-labelledby":t(m),role:"dialog",id:t(g),class:"fr-modal"},[e("div",In,[e("div",Ln,[e("div",jn,[e("div",Pn,[e("div",qn,[e("button",{class:"fr-btn--close fr-btn",title:t(o)("Close the modal dialog"),"aria-controls":t(g)},s(t(o)("Close")),9,Un)]),e("div",Hn,[e("h1",{id:t(m),class:"fr-modal__title fr-mb-2w"},s(t(o)("Are you sure you want to delete this organization ?")),9,Vn),e("p",En,s(t(o)("This action can't be reverse.")),1),e("p",null,s(t(o)("All content published with this organization will stay online, with the same URL but in an anonymous form, i.e. without being linked to a data producer.")),1),e("p",null,s(t(o)("If you want to delete your published content too, start by deleting the contents before deleting your account.")),1)]),e("div",Yn,[e("div",Nn,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error",role:"button",disabled:f.value,onClick:y},s(t(o)("Delete")),9,Wn)])])])])])])],8,xn)]))])]),_:1})]),_:1},8,["organization","errors"])):A("",!0)])}}});async function Gn(_){return(await de.get("posts/".concat(_,"/"))).data}async function Jn(_){return(await de.get("dataservices/".concat(_,"/"))).data}$e(jt,Lt,It,xt);async function Zn(_,o,a,v){return(await de.get(Ue("discussions/"),{params:{org:_,sort:v,page_size:a,page:o}})).data}async function Kn(_){switch(_.class){case"Dataservice":return Jn(_.id);case"Dataset":return qt(_.id);case"Post":return Gn(_.id);case"Reuse":return Pt(_.id);default:return null}}function Qn(_,o){return _===null?null:{title:Xn(_),icon:tl(o),page:el(_)}}function Xn(_){return _===null?"":"title"in _?_.title:"headline"in _?_.headline:He(_,"Unknown type ".concat(_))}function el(_){return _===null?"":"page"in _?_.page:"self_web_url"in _?_.self_web_url:He(_,"Unknown type ".concat(_))}function tl(_){switch(_){case"Dataservice":return"ri-terminal-line";case"Dataset":return"ri-database-2-line";case"Post":return"ri-article-line";case"Reuse":return"ri-line-chart-line";default:return""}}const sl={class:"fr-text--bold"},ol={key:0},al=["href"],nl={class:"inline-flex items-center"},ll=["href"],rl=T({__name:"AdminDiscussionsTable",props:{discussions:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(_){const o=_,{t:a}=B(),v=k({}),d=k({});Y(async()=>{for(const p of o.discussions)if(!(p.subject.id in v.value)){const b=Kn(p.subject);v.value[p.subject.id]=b;const f=await v.value[p.subject.id];d.value[p.subject.id]=Qn(f,p.subject.class)}});function i(p,b){return b?b.page+"#/discussions/"+p:""}function n(p){return o.sortedBy===p?o.sortDirection:null}function r(p){return p.discussion.slice(-1)[0]}return(p,b)=>(u(),D(oe,{class:"fr-table--layout-fixed",loading:p.loading},{default:c(()=>[e("thead",null,[l(R,{onSort:b[0]||(b[0]=f=>p.$emit("sort","title",f)),sorted:n("title"),scope:"col"},{default:c(()=>[w(s(t(a)("Discussion")),1)]),_:1},8,["sorted"]),l(R,{scope:"col"},{default:c(()=>[w(s(t(a)("Number of comments")),1)]),_:1}),l(R,{scope:"col"},{default:c(()=>[w(s(t(a)("Last comment")),1)]),_:1}),l(R,{onSort:b[1]||(b[1]=f=>p.$emit("sort","closed",f)),sorted:n("closed"),scope:"col"},{default:c(()=>[w(s(t(a)("Closed at")),1)]),_:1},8,["sorted"]),l(R,{scope:"col",style:{width:"25%"}},{default:c(()=>[w(s(t(a)("Link to the discussion")),1)]),_:1})]),e("tbody",null,[(u(!0),$(I,null,F(p.discussions,f=>{var g,m,y;return u(),$("tr",null,[e("td",null,[e("p",sl,[l(t(E),{text:f.title,"auto-resize":!0,"max-lines":1},null,8,["text"])]),d.value[f.subject.id]?(u(),$("p",ol,[e("a",{class:"fr-link inline-flex",href:(g=d.value[f.subject.id])==null?void 0:g.page},[l(t(we),{height:12,class:"self-center",name:(m=d.value[f.subject.id])==null?void 0:m.icon},null,8,["name"]),l(t(E),{class:"overflow-wrap-anywhere",text:(y=d.value[f.subject.id])==null?void 0:y.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,al)])):A("",!0)]),e("td",null,s(f.discussion.length),1),e("td",null,[e("div",null,[e("p",null,s(t(q)(r(f).posted_on)),1),e("p",nl,[w(s(t(a)("by "))+" ",1),l(t(es),{class:"fr-ml-1v",user:r(f).posted_by},null,8,["user"])])])]),e("td",null,[f.closed?(u(),$(I,{key:0},[w(s(t(q)(f.closed)),1)],64)):A("",!0)]),e("td",null,[d.value[f.subject.id]?(u(),$("a",{key:0,class:"fr-link inline-flex",href:i(f.id,d.value[f.subject.id]),target:"_blank"},[l(t(E),{text:i(f.id,d.value[f.subject.id]),"auto-resize":!0,"max-lines":1},null,8,["text"])],8,ll)):A("",!0)])])}),256))])]),_:1},8,["loading"]))}}),il="/_themes/gouvfr/assets/discussion.svg",dl={class:"fr-container--fluid"},ul={key:0},cl={class:"fr-breadcrumb__link","aria-current":"page"},fl={class:"fr-h3 fr-mb-5v"},ml={class:"subtitle subtitle--uppercase fr-m-0"},_l={class:"text-align-center fr-py-1w"},pl=["src"],vl={class:"fr-text--bold fr-my-3v"},bl=T({__name:"Discussions",props:{oid:{}},setup(_){const{t:o}=B(),a=_,v=k(!1),d=k(1),i=k(10),n=k(0),r=k("created"),p=k("desc"),b=M(()=>"".concat(p.value==="asc"?"":"-").concat(r.value)),f=k([]),{currentOrganization:g}=K();function m(y,h){r.value=y,p.value=h}return Y(async()=>{v.value=!0,f.value=[];try{const y=await Zn(a.oid,d.value,i.value,b.value);f.value=y.data,d.value=y.page,i.value=y.page_size,n.value=y.total}finally{v.value=!1}}),(y,h)=>{const C=P("router-link");return u(),$("div",dl,[l(Z,null,{default:c(()=>[e("li",null,[l(C,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(o)("Administration")),1)]),_:1})]),t(g)?(u(),$("li",ul,[l(C,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(g).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",cl,s(t(o)("Discussions")),1)])]),_:1}),e("h1",fl,s(t(o)("Discussions")),1),e("h2",ml,s(t(o)("{n} discussions",n.value)),1),v.value||n.value>0?(u(),D(rl,{key:0,discussions:f.value,loading:v.value,"sort-direction":p.value,sortedBy:r.value,onSort:m},null,8,["discussions","loading","sort-direction","sortedBy"])):(u(),D(J,{key:1,class:"fr-my-2w"},{default:c(()=>[e("div",_l,[e("img",{src:t(il),alt:"",loading:"lazy"},null,8,pl),e("p",vl,s(t(o)("There is no discussion yet")),1)])]),_:1})),n.value>i.value?(u(),D(t(ie),{key:2,page:d.value,"page-size":i.value,"total-results":n.value,onChange:h[0]||(h[0]=z=>d.value=z)},null,8,["page","page-size","total-results"])):A("",!0)])}}});async function gl(_,o,a){return(await de.get(Ue("harvest/sources/"),{params:{owner:_,deleted:!0,page:o,page_size:a}})).data}const hl="/_themes/gouvfr/assets/harvester.svg",yl={class:"fr-container--fluid"},$l={key:0},wl={class:"fr-breadcrumb__link","aria-current":"page"},kl={class:"fr-h3 fr-mb-5v"},zl={class:"subtitle subtitle--uppercase fr-m-0"},Cl=["href"],Al={class:"text-align-center fr-py-1w"},Dl=["src"],Sl={class:"fr-text--bold fr-my-3v"},Rl=T({__name:"Harvesters",props:{oid:{}},setup(_){const{t:o}=B(),a=_,v=k(!1),d=k(1),i=k(10),n=k(0),r=k([]),p=k({}),{currentOrganization:b}=K();function f(h){return"".concat(se,"harvester/").concat(h.id,"/")}function g(h){return!h.last_job||!p.value[h.last_job.id]?0:p.value[h.last_job.id].items.filter(C=>C.dataservice).length}function m(h){return!h.last_job||!p.value[h.last_job.id]?0:p.value[h.last_job.id].items.filter(C=>C.dataset).length}function y(h){var C;switch((C=h.last_job)==null?void 0:C.status){case"pending":return{label:o("Pending"),type:"default"};case"initializing":return{label:o("Initializing"),type:"info"};case"initialized":return{label:o("Initialized"),type:"default"};case"processing":return{label:o("Processing"),type:"info"};case"done":return{label:o("Done"),type:"success"};case"done-errors":return{label:o("Done with errors"),type:"warning"};case"failed":return{label:o("Failed"),type:"error"};default:return{label:o("No job yet"),type:"default"}}}return Y(async()=>{var h;v.value=!0,r.value=[];try{const C=await gl(a.oid,d.value,i.value);r.value=C.data,d.value=C.page,i.value=C.page_size,n.value=C.total;const z=[];for(const O of r.value)(h=O.last_job)!=null&&h.id&&z.push(de.get("harvest/job/".concat(O.last_job.id,"/")));const S=await Promise.allSettled(z);for(const O of S)O.status==="fulfilled"&&(p.value[O.value.data.id]=O.value.data)}finally{v.value=!1}}),(h,C)=>{const z=P("router-link");return u(),$("div",yl,[l(Z,null,{default:c(()=>[e("li",null,[l(z,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(o)("Administration")),1)]),_:1})]),t(b)?(u(),$("li",$l,[l(z,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(b).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",wl,s(t(o)("Harvesters")),1)])]),_:1}),e("h1",kl,s(t(o)("Harvesters")),1),e("h2",zl,s(t(o)("{n} harvesters",n.value)),1),v.value||n.value?(u(),D(oe,{key:0,loading:v.value},{default:c(()=>[e("thead",null,[l(R,{scope:"col"},{default:c(()=>[w(s(t(o)("Name")),1)]),_:1}),l(R,{scope:"col"},{default:c(()=>[w(s(t(o)("Status")),1)]),_:1}),l(R,{scope:"col"},{default:c(()=>[w(s(t(o)("Created at")),1)]),_:1}),l(R,{scope:"col"},{default:c(()=>[w(s(t(o)("Last run")),1)]),_:1}),l(R,{scope:"col"},{default:c(()=>[w(s(t(o)("Datasets")),1)]),_:1}),l(R,{scope:"col"},{default:c(()=>[w(s(t(o)("Dataservices")),1)]),_:1})]),e("tbody",null,[(u(!0),$(I,null,F(r.value,S=>{var O;return u(),$("tr",null,[e("td",null,[l(be,null,{default:c(()=>[e("a",{class:"fr-link fr-reset-link",href:f(S)},[l(t(E),{text:S.name,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Cl)]),_:2},1024)]),e("td",null,[l(ue,{type:y(S).type},{default:c(()=>[w(s(y(S).label),1)]),_:2},1032,["type"])]),e("td",null,s(t(q)(S.created_at)),1),e("td",null,[(O=S.last_job)!=null&&O.ended?(u(),$(I,{key:0},[w(s(t(q)(S.last_job.ended)),1)],64)):(u(),$(I,{key:1},[w(s(t(o)("Not yet")),1)],64))]),e("td",null,s(m(S)),1),e("td",null,s(g(S)),1)])}),256))])]),_:1},8,["loading"])):(u(),D(J,{key:1,class:"fr-my-2w"},{default:c(()=>[e("div",Al,[e("img",{src:t(hl),alt:"",loading:"lazy"},null,8,Dl),e("p",Sl,s(t(o)("There is no harvesters yet")),1),l(ze,{type:"harvester"})])]),_:1})),n.value>i.value?(u(),D(t(ie),{key:2,page:d.value,"page-size":i.value,"total-results":n.value,onChange:C[0]||(C[0]=S=>d.value=S)},null,8,["page","page-size","total-results"])):A("",!0)])}}}),Tl=["href"],Ol={key:0},Ml=["href"],Bl={class:"fr-p-1v monospaced bg-grey-100 fr-text--sm text-mention-grey rounded-xxs"},xl=T({__name:"AdminCommunityResourcesTable",props:{communityResources:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(_){const o=_,{t:a}=B();function v(n){return o.sortedBy===n?o.sortDirection:null}function d(n){return"".concat(se,"dataset/").concat(n.dataset.id,"/community-resource/").concat(n.id,"/")}function i(n){const r=n.extras&&"check:available"in n.extras;return r&&n.extras["check:available"]===!1?{label:a("Unavailable"),type:"error"}:r?{label:a("Available"),type:"info"}:{label:a("Not checked yet"),type:"default"}}return(n,r)=>{const p=P("Vicon");return u(),D(oe,{loading:n.loading},{default:c(()=>[e("thead",null,[l(R,{onSort:r[0]||(r[0]=b=>n.$emit("sort","title",b)),sorted:v("title"),scope:"col"},{default:c(()=>[w(s(t(a)("Resource title")),1)]),_:1},8,["sorted"]),l(R,null,{default:c(()=>[w(s(t(a)("Status")),1)]),_:1}),l(R,null,{default:c(()=>[w(s(t(a)("Format")),1)]),_:1}),l(R,{onSort:r[1]||(r[1]=b=>n.$emit("sort","created_at_internal",b)),sorted:v("created_at_internal"),scope:"col"},{default:c(()=>[w(s(t(a)("Created at")),1)]),_:1},8,["sorted"]),l(R,{onSort:r[2]||(r[2]=b=>n.$emit("sort","last_modified_internal",b)),sorted:v("last_modified_internal"),scope:"col"},{default:c(()=>[w(s(t(a)("Modified at")),1)]),_:1},8,["sorted"])]),e("tbody",null,[(u(!0),$(I,null,F(n.communityResources,b=>{var f,g;return u(),$("tr",null,[e("td",null,[l(be,{class:"fr-text--bold"},{default:c(()=>[e("a",{class:"fr-link fr-reset-link",href:d(b)},[l(t(E),{text:b.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Tl)]),_:2},1024),n.datasets[b.dataset.id]?(u(),$("p",Ol,[e("a",{class:"fr-link inline-flex",href:(f=n.datasets[b.dataset.id])==null?void 0:f.page},[l(p,{height:12,class:"self-center",name:n.getSubjectTypeIcon("Dataset")},null,8,["name"]),l(t(E),{class:"overflow-wrap-anywhere",text:(g=n.datasets[b.dataset.id])==null?void 0:g.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,Ml)])):A("",!0)]),e("td",null,[l(ue,{type:i(b).type},{default:c(()=>[w(s(i(b).label),1)]),_:2},1032,["type"])]),e("td",null,[e("code",Bl,s(b.format),1)]),e("td",null,s(t(q)(b.created_at)),1),e("td",null,s(t(q)(b.last_modified)),1)])}),256))])]),_:1},8,["loading"])}}}),Il={class:"fr-container--fluid"},Ll={key:0},jl={class:"fr-breadcrumb__link","aria-current":"page"},Pl={class:"fr-h3 fr-mb-5v"},ql={class:"subtitle subtitle--uppercase fr-m-0"},Ul={class:"text-align-center fr-py-1w"},Hl=["src"],Vl={class:"fr-text--bold fr-my-3v"},Le=T({__name:"CommunityResources",props:{oid:{}},setup(_){const{t:o}=B(),a=_,v=k([]),d=k(!1),i=k(1),n=k(10),r=k(0),p=k("created_at_internal"),b=k("desc"),f=M(()=>"".concat(b.value==="asc"?"":"-").concat(p.value)),{currentOrganization:g}=K(),m=pe();function y(h,C){p.value=h,b.value=C}return Y(async()=>{d.value=!0,v.value=[];try{let h;if(a.oid)h=await Ut(a.oid,i.value,n.value,f.value);else if(m.value)h=await Ht(m.value.id,i.value,n.value,f.value);else return;v.value=h.data,i.value=h.page,n.value=h.page_size,r.value=h.total}finally{d.value=!1}}),(h,C)=>{const z=P("router-link");return u(),$("div",Il,[l(Z,null,{default:c(()=>[e("li",null,[l(z,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(o)("Administration")),1)]),_:1})]),t(g)?(u(),$("li",Ll,[l(z,{class:"fr-breadcrumb__link",to:"/"},{default:c(()=>[w(s(t(g).name),1)]),_:1})])):A("",!0),e("li",null,[e("a",jl,s(t(o)("Community Resources")),1)])]),_:1}),e("h1",Pl,s(t(o)("Community Resources")),1),e("h2",ql,s(t(o)("{n} community resources",v.value.length)),1),d.value||r.value>0?(u(),D(xl,{key:0,"community-resources":v.value,loading:d.value,sortDirection:b.value,sortedBy:p.value,onSort:y},null,8,["community-resources","loading","sortDirection","sortedBy"])):(u(),D(J,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:c(()=>[e("div",Ul,[e("img",{src:t(Vt),alt:"",loading:"lazy"},null,8,Hl),e("p",Vl,s(t(o)("You haven't published a community resource yet")),1)])]),_:1})),r.value>n.value?(u(),D(t(ie),{key:2,page:i.value,"page-size":n.value,"total-results":r.value,onChange:C[0]||(C[0]=S=>i.value=S)},null,8,["page","page-size","total-results"])):A("",!0)])}}});Et({admin_root:se,default_lang:he.global.locale.value,only_locales:he.global.locale.value,schema_documentation_url:Yt,schema_validata_url:Nt,show_copy_resource_permalink:!0,tabular_api_url:Wt,tabular_page_size:Ft,title:ke});const El=[{path:"/me",children:[{path:"",component:ko,name:"me"},{path:"datasets",component:Me,name:"me-datasets"},{path:"reuses",component:Be,name:"me-reuses"},{path:"community-resources",component:Le,name:"me-community-resources"}]},{path:"/organizations/:oid",children:[{path:"datasets",component:Me,props:!0,name:"organization-datasets"},{path:"reuses",component:Be,props:!0,name:"organization-reuses"},{path:"discussions",component:bl,props:!0,name:"organization-discussions"},{path:"members",component:vn,props:!0,name:"organization-members"},{path:"harvesters",component:Rl,props:!0,name:"organization-harvesters"},{path:"community-resources",component:Le,props:!0,name:"organization-community-resources"},{path:"profile",component:Fn,props:!0,name:"organization-profile"}]}],Yl=Gt({history:Jt(),routes:El}),ae=Ke(Yo);Zt(ae);ae.use(Kt);ae.use(Qt);ae.use(he);ae.use(Yl);ae.mount("#admin");globalThis.dsfr.start();console.log("JS is injected !");export{Nl as __vite_legacy_guard};
