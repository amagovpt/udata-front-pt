System.register(["vue","./sentry-legacy.6.1.5.js","vue-content-loader","./_commonjsHelpers-legacy.6.1.5.js"],(function(e,l){"use strict";var a,t,r,s,n,o,i,u,d,c,f,m,v,p,b,g,y,_,h,w,k,x,z,C,$,A,D,S,B,j,R,M,O,T,P,q,E,I,L,V,U,H,Y,N,F,W,J,Z,G,K,Q,X,ee,le,ae,te,re,se,ne,oe,ie,ue,de,ce,fe,me,ve,pe,be,ge,ye,_e,he,we,ke,xe,ze,Ce,$e,Ae,De,Se,Be,je,Re,Me,Oe,Te,Pe,qe,Ee,Ie,Le,Ve,Ue,He,Ye,Ne,Fe,We,Je,Ze,Ge,Ke,Qe,Xe,el,ll;return{setters:[e=>{a=e.defineComponent,t=e.openBlock,r=e.createElementBlock,s=e.Fragment,n=e.createVNode,o=e.mergeProps,i=e.createElementVNode,u=e.toDisplayString,d=e.useTemplateRef,c=e.ref,f=e.computed,m=e.onMounted,v=e.watchEffect,p=e.normalizeClass,b=e.createBlock,g=e.unref,y=e.withCtx,_=e.createCommentVNode,h=e.createTextVNode,w=e.renderSlot,k=e.renderList,x=e.readonly,z=e.useId,C=e.resolveComponent,$=e.watchPostEffect,A=e.Teleport,D=e.withModifiers,S=e.createApp},e=>{B=e.C,j=e.K,R=e.bB,M=e.v,O=e.E,T=e.G,P=e._,q=e.b,E=e.bC,I=e.h,L=e.ap,V=e.y,U=e.A,H=e.bj,Y=e.bD,N=e.bE,F=e.az,W=e.bn,J=e.bF,Z=e.bG,G=e.bH,K=e.bI,Q=e.au,X=e.L,ee=e.ah,le=e.bJ,ae=e.bK,te=e.bf,re=e.bL,se=e.bM,ne=e.a$,oe=e.$,ie=e.a9,ue=e.aY,de=e.bN,ce=e.aA,fe=e.a1,me=e.a3,ve=e.bO,pe=e.bP,be=e.aO,ge=e.bQ,ye=e.bR,_e=e.bS,he=e.bT,we=e.bU,ke=e.bV,xe=e.bW,ze=e.bX,Ce=e.bY,$e=e.x,Ae=e.B,De=e.bi,Se=e.bZ,Be=e.b_,je=e.bl,Re=e.a,Me=e.b$,Oe=e.c0,Te=e.c1,Pe=e.c2,qe=e.aa,Ee=e.c3,Ie=e.c4,Le=e.c5,Ve=e.c6,Ue=e.c7,He=e.aw,Ye=e.bp,Ne=e.bs,Fe=e.a_,We=e.bt,Je=e.bv,Ze=e.bw,Ge=e.c8,Ke=e.c9,Qe=e.bx,Xe=e.by,el=e.bz},e=>{ll=e.ContentLoader},null],execute:function(){const e={class:"fr-ml-1v fr-text--bold"},l=a({__name:"AvatarWithName",props:{user:{},size:{default:12}},setup:l=>(l,a)=>(t(),r(s,null,[n(B,o(l.$attrs,{user:l.user,size:l.size,rounded:!0}),null,16,["user","size"]),i("span",e,u(l.user.first_name)+" "+u(l.user.last_name),1)],64))}),al={ref:"canvasRef",width:"120",height:"30"},tl={class:"fr-grid-row justify-between"},rl={class:"text-xxs fr-m-0 text-mention-grey"},sl={class:"text-xxs fr-m-0 text-mention-grey"},nl="#B6CFFB",ol="#3558A2",il=a({__name:"SmallChart",props:{data:{},type:{},lastWithLowEmphasis:{type:Boolean,default:!1}},setup(e){const l=e,a=(e,l)=>e.p1DataIndex===b.value.length-1?l:null,s=d("canvasRef"),n=c(null),o=c(null),p=f((()=>{const e=Object.keys(l.data);e.sort();let a={};for(const t of e)a[t]=l.data[t];return a})),b=f((()=>Object.keys(p.value))),g=f((()=>Object.values(p.value))),y=f((()=>"bar"===l.type?{barPercentage:1,categoryPercentage:.9,backgroundColor:b.value.map(((e,a)=>a===b.value.length-1?l.lastWithLowEmphasis?"rgba(182, 207, 251, 0.7)":ol:nl))}:"line"===l.type&&l.lastWithLowEmphasis?{segment:{borderColor:e=>a(e,"rgba(53, 88, 162, 0.7)")||ol,borderDash:e=>a(e,[3,3])||[6,0]}}:{})),_=f((()=>b.value.length?j(b.value[0],"MM/YY"):null)),h=f((()=>b.value.length?j(b.value[b.value.length-1],"MM/YY"):null)),w={animation:!1,responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!1}},elements:{bar:{backgroundColor:nl,borderRadius:2,hoverBackgroundColor:ol},line:{backgroundColor:ol,borderColor:ol,borderJoinStyle:"round",tension:.35},point:{radius:0}},scales:{x:{display:!1,grid:{display:!1},ticks:{display:!1}},y:{display:!1,grid:{display:!1},ticks:{display:!1}}},layout:{padding:{top:1.5}}};return m((()=>{n.value=s.value?s.value.getContext("2d"):null})),v((()=>{n.value&&(o.value&&o.value.destroy(),o.value=new R(n.value,{data:{labels:b.value,datasets:[{data:g.value,type:l.type,...y.value}]},options:w}))})),(e,l)=>(t(),r("div",null,[i("canvas",al,null,512),i("div",tl,[i("p",rl,u(_.value),1),i("p",sl,u(h.value),1)])]))}}),ul={class:"fr-text--sm fr-m-0"},dl={class:"fr-grid-row fr-grid-row--middle"},cl={key:1,class:"h1 line-height-1 fr-m-0"},fl={key:3,class:"fr-ml-1w"},ml={key:0,class:"fr-mt-1w fr-text--regular text-transform-none fr-badge fr-badge--no-icon fr-badge--success"},vl={class:"fr-mr-1v"},pl=a({__name:"StatBox",props:{title:{},data:{},type:{},summary:{}},setup(e){const l=e,{t:a}=M(),s=f((()=>l.data?Object.keys(l.data):[])),o=f((()=>l.data?Object.values(l.data):[])),d=f((()=>s.value.length?s.value.reduce(((e,l)=>l>e?l:e)):null)),c=f((()=>d.value?s.value.indexOf(d.value):null)),m=f((()=>null!==c.value?o.value[c.value]:null)),v=f((()=>Math.max(...o.value)>0));return(e,l)=>(t(),r("div",{class:p({"text-mention-grey":!v.value&&!e.summary})},[i("h3",ul,u(e.title),1),i("div",dl,[null===e.summary?(t(),b(g(ll),{key:0,width:92,height:32,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},{default:y((()=>l[0]||(l[0]=[i("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"92",height:"32"},null,-1)]))),_:1})):(t(),r("p",cl,u(g(O)(e.summary,2)),1)),null===e.data?(t(),b(g(ll),{key:2,width:120,height:30,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",class:"fr-ml-1w"},{default:y((()=>l[1]||(l[1]=[i("rect",{x:"0",y:"0",rx:"3",ry:"3",width:"120",height:"30"},null,-1)]))),_:1})):v.value?(t(),r("div",fl,[n(il,{type:e.type,data:e.data,lastWithLowEmphasis:!0},null,8,["type","data"])])):_("",!0)]),m.value&&d.value?(t(),r("p",ml,[i("strong",vl," +Â "+u(g(O)(m.value,2)),1),h(" "+u(g(a)(" in "))+" "+u(g(j)(d.value,"MMM YYYY")),1)])):_("",!0)],2))}}),bl=["aria-label"],gl={class:"fr-breadcrumb__list"},yl={__name:"Breadcrumb",setup(e){const{t:l}=M();return(e,a)=>(t(),r("nav",{rol:"navigation","aria-label":g(l)("You're here:"),class:"fr-breadcrumb fr-mb-5v"},[i("ol",gl,[w(e.$slots,"default")])],8,bl))}},_l=a({__name:"AdminBadge",props:{type:{}},setup:e=>(e,l)=>(t(),r("p",{class:p(["fr-badge",{"fr-badge--blue-cumulus":"info"===e.type,"fr-badge--error fr-badge--no-icon":"error"===e.type,"fr-badge--warning fr-badge--no-icon":"warning"===e.type,"fr-badge--success fr-badge--no-icon":"success"===e.type}])},[w(e.$slots,"default")],2))}),hl=["aria-describedby"],wl=["id"],kl=P(a({inheritAttrs:!1,__name:"AdminContentWithTooltip",setup(e){const l=T(),a=c(),n=c("");return m((()=>{a.value&&(n.value=a.value.textContent||"")})),(e,d)=>(t(),r(s,null,[i("p",o(e.$attrs,{"aria-describedby":g(l),ref_key:"contentRef",ref:a}),[w(e.$slots,"default",{},void 0,!0)],16,hl),i("span",{class:"fr-hidden-xl fr-tooltip fr-placement",id:g(l),role:"tooltip","aria-hidden":"true"},u(n.value),9,wl)],64))}}),[["__scopeId","data-v-d192f17a"]]),xl=a({__name:"AdminLoader",props:{scale:{default:4}},setup:e=>(q(E),(e,l)=>(t(),b(g(I),{name:"ri-loader-5-line",animation:"spin",scale:e.scale,fill:"var(--blue-cumulus-sun-368-moon-732)"},null,8,["scale"])))}),zl={class:"fr-table fr-mb-2w"},Cl=a({__name:"AdminTable",props:{loading:{type:Boolean,default:!1}},setup:e=>(e,l)=>(t(),r("div",zl,[i("table",null,[w(e.$slots,"default",{},void 0,!0)]),e.loading?(t(),b(L,{key:0,class:"fr-p-4w text-align-center"},{default:y((()=>[n(xl)])),_:1})):_("",!0)]))}),$l=P(Cl,[["__scopeId","data-v-cae574a4"]]),Al={class:"fr-text--bold"},Dl={key:1,class:"fr-grid-row fr-grid-row--middle justify-between"},Sl=["title"],Bl=P(a({__name:"AdminTableTh",props:{sorted:{}},emits:["sort"],setup(e,{emit:l}){const a=e,s=l,{t:n}=M(),o=f((()=>void 0!==a.sorted));function d(){return"desc"===a.sorted?s("sort","asc"):s("sort","desc")}return(e,l)=>(t(),r("th",Al,[o.value?(t(),r("div",Dl,[w(e.$slots,"default",{},void 0,!0),i("button",{class:p(["fr-ml-1w fr-btn fr-btn--sm fr-btn--tertiary-no-outline",{"fr-icon-arrow-down-line":!e.sorted||"asc"===e.sorted,"fr-icon-arrow-up-line":"desc"===e.sorted,"text-grey-500":e.sorted,"text-mention-grey":!e.sorted}]),onClick:d,title:g(n)("Sort")},u(g(n)("Sort")),11,Sl)])):w(e.$slots,"default",{key:0},void 0,!0)]))}}),[["__scopeId","data-v-5acf0bf0"]]),jl=["aria-describedby"],Rl=["id"],Ml=a({__name:"Tooltip",setup(e){const l=T("tooltip");return(e,a)=>(t(),r(s,null,[i("p",o(e.$attrs,{"aria-describedby":g(l)}),[w(e.$slots,"default")],16,jl),i("span",{class:"fr-tooltip fr-placement",id:g(l),role:"tooltip","aria-hidden":"true"},[w(e.$slots,"tooltip")],8,Rl)],64))}}),Ol=["href"],Tl={class:"monospace"},Pl={class:"monospace"},ql={class:"monospace"},El={class:"monospace"},Il={class:"monospace"},Ll=a({__name:"AdminDatasetsTable",props:{datasets:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(e,{emit:l}){const a=l,o=e,{t:d}=M();function c(e,l){a("sort",e,l)}function f(e){return o.sortedBy===e?o.sortDirection:null}function m(e){return Array.isArray(e.resources)?e.resources.length:e.resources.total}function v(e){return`${H}dataset/${e.id}/`}function p(e){return e.deleted?{label:d("Deleted"),type:"error"}:e.archived?{label:d("Archived"),type:"warning"}:e.private?{label:d("Draft"),type:"default"}:{label:d("Public"),type:"info"}}return(e,l)=>(t(),b($l,{loading:e.loading},{default:y((()=>[i("thead",null,[i("tr",null,[n(Bl,{onSort:l[0]||(l[0]=e=>c("title",e)),sorted:f("title"),scope:"col"},{default:y((()=>[h(u(g(d)("Title of the dataset")),1)])),_:1},8,["sorted"]),n(Bl,{scope:"col"},{default:y((()=>[h(u(g(d)("Status")),1)])),_:1}),n(Bl,{onSort:l[1]||(l[1]=e=>c("created",e)),sorted:f("created"),scope:"col"},{default:y((()=>[h(u(g(d)("Created at")),1)])),_:1},8,["sorted"]),n(Bl,{onSort:l[2]||(l[2]=e=>c("last_update",e)),sorted:f("last_update"),scope:"col"},{default:y((()=>[h(u(g(d)("Updated at")),1)])),_:1},8,["sorted"]),n(Bl,{scope:"col"},{default:y((()=>[h(u(g(d)("Files")),1)])),_:1}),n(Bl,{scope:"col"},{default:y((()=>[h(u(g(d)("Score")),1)])),_:1}),n(Bl,{scope:"col"},{default:y((()=>[n(Ml,null,{tooltip:y((()=>[h(u(g(d)("Discussions")),1)])),default:y((()=>[l[6]||(l[6]=i("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),n(Bl,{onSort:l[3]||(l[3]=e=>c("views",e)),sorted:f("views"),scope:"col"},{default:y((()=>[n(Ml,null,{tooltip:y((()=>[h(u(g(d)("Views")),1)])),default:y((()=>[l[7]||(l[7]=i("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),n(Bl,{scope:"col"},{default:y((()=>[n(Ml,null,{tooltip:y((()=>[h(u(g(d)("Downloads")),1)])),default:y((()=>[l[8]||(l[8]=i("span",{class:"fr-icon--sm fr-icon-download-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),n(Bl,{onSort:l[4]||(l[4]=e=>c("reuses",e)),sorted:f("reuses"),scope:"col"},{default:y((()=>[n(Ml,null,{tooltip:y((()=>[h(u(g(d)("Reuses")),1)])),default:y((()=>[l[9]||(l[9]=i("span",{class:"fr-icon--sm fr-icon-line-chart-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),n(Bl,{onSort:l[5]||(l[5]=e=>c("followers",e)),sorted:f("followers"),scope:"col"},{default:y((()=>[n(Ml,null,{tooltip:y((()=>[h(u(g(d)("Favorites")),1)])),default:y((()=>[l[10]||(l[10]=i("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"])])]),i("tbody",null,[(t(!0),r(s,null,k(e.datasets,(e=>{var l;return t(),r("tr",{key:e.id},[i("td",null,[n(kl,null,{default:y((()=>[i("a",{class:"fr-link fr-reset-link",href:v(e)},[n(g(V),{text:e.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Ol)])),_:2},1024)]),i("td",null,[n(_l,{type:p(e).type},{default:y((()=>[h(u(p(e).label),1)])),_:2},1032,["type"])]),i("td",null,u(g(j)(e.created_at)),1),i("td",null,u(g(j)(e.last_modified)),1),i("td",null,u(m(e)),1),i("td",null,[n(g(U),{class:"w-100",score:e.quality.score},null,8,["score"])]),i("td",Tl,u(g(O)(e.metrics.discussions)),1),i("td",Pl,u(g(O)(e.metrics.views)),1),i("td",ql,u(g(O)(null!==(l=e.metrics.resources_downloads)&&void 0!==l?l:0)),1),i("td",El,u(g(O)(e.metrics.reuses)),1),i("td",Il,u(g(O)(e.metrics.followers)),1)])})),128))])])),_:1},8,["loading"]))}}),Vl=c(null);function Ul(){return{currentOrganization:x(Vl),setCurrentOrganization:e=>{Vl.value=e}}}const Hl=["href"],Yl=["src","alt"],Nl=a({__name:"AdminPublishButton",props:{type:{}},setup(e){const l=e,{t:a}=M(),s=f((()=>{switch(l.type){case"dataset":return N;case"harvester":return`${H}harvester/new/`;case"reuse":return Y}}));return(e,l)=>(t(),r("a",{href:s.value,class:"fr-btn fr-icon-add-line fr-btn--icon-left"},[h(u(g(a)("Publish on"))+" ",1),i("img",{class:"fr-ml-1v",src:g("/_themes/gouvfr/assets/logotype-white.svg"),loading:"lazy",alt:g(F)},null,8,Yl)],8,Hl))}}),Fl={key:0},Wl={class:"fr-breadcrumb__link","aria-current":"page"},Jl={class:"fr-h3 fr-mb-5v"},Zl={class:"fr-p-3w flex items-center justify-between relative"},Gl=["id"],Kl=["aria-expanded"],Ql={class:"flex items-center fr-ml-4v buttons"},Xl={class:"fr-col-auto fr-ml-3v fr-m-0"},ea=["disabled","href","title"],la=["aria-labelledby"],aa={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},ta={class:"fr-col"},ra={class:"subtitle subtitle--uppercase fr-m-0"},sa={key:0,class:"fr-col-auto fr-grid-row fr-grid-row--middle"},na=["href"],oa={class:"text-align-center fr-py-1w"},ia=["src"],ua={class:"fr-text--bold fr-my-3v"},da=a({__name:"Datasets",props:{oid:{}},setup(e){const{t:l}=M(),a=e,s=c([]),o=c(!1),d=c(1),m=c(10),w=c(0),k=c("created"),x=c("desc"),$=f((()=>`${"asc"===x.value?"":"-"}${k.value}`)),A=c(""),D=W(A,ee),{currentOrganization:S}=Ul(),B=J();function j(e,l){k.value=e,x.value=l}v((async()=>{o.value=!0,s.value=[];try{let e;if(a.oid)e=await Z(a.oid,D.value,d.value,m.value,$.value);else{if(!B.value)return;e=await G(B.value.id,D.value,d.value,m.value,$.value)}s.value=e.data,d.value=e.page,m.value=e.page_size,w.value=e.total}finally{o.value=!1}}));const R=c(!1),O=z(),T=c(null),P=c(null),q=c(null),E=c(null),I=c(null),V=c(null);v((async()=>{if(a.oid){{const e=await fetch(`https://metric-api.data.gouv.fr/api/organizations/data/?organization_id__exact=${a.oid}&metric_month__sort=desc&page_size=12`),l=await e.json();T.value={},q.value={},I.value={};for(const{metric_month:a,monthly_download_resource:t,monthly_visit_dataset:r,monthly_visit_reuse:s}of l.data)T.value[a]=r,q.value[a]=t,I.value[a]=s}{const e=await fetch(`https://metric-api.data.gouv.fr/api/organizations_total/data/?organization_id__exact=${a.oid}`),l=await e.json();l.data[0]&&(P.value=l.data[0].visit_dataset,E.value=l.data[0].download_resource,V.value=l.data[0].visit_reuse)}}}));const U=f((()=>{if(!T.value||!q.value||!I.value)return null;let e="month,visit_datasets,download_resource,visit_reuse\n";for(const l in T.value)e+=`${l},${T.value[l]},${q.value[l]},${I.value[l]}\n`;return URL.createObjectURL(new Blob([e],{type:"text/csv"}))}));return(e,a)=>{const c=C("router-link");return t(),r("div",null,[n(yl,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),g(S)?(t(),r("li",Fl,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(S).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Wl,u(g(l)("Datasets")),1)])])),_:1}),i("h1",Jl,u(g(l)("Datasets")),1),e.oid&&!o.value&&w.value>0?(t(),r("div",{key:0,class:p(["bg-white border rounded-xxs fr-mb-3w",{"fr-pb-4v":R.value}])},[i("header",Zl,[i("div",null,[i("h4",{class:"fr-mb-1v flex items-center",id:g(O)},[i("button",{type:"button",onClick:a[0]||(a[0]=e=>R.value=!R.value),class:"fr-p-0 fr-text flex items-center font-bold","data-testid":"expand-button","aria-expanded":R.value},[h(u(e.$t("Statistics on your datasets"))+" ",1),a[2]||(a[2]=i("span",{class:"absolute inset-0 z-1"},null,-1))],8,Kl)],8,Gl)]),i("div",Ql,[i("p",Xl,[i("a",{disabled:!U.value,href:U.value||"",rel:"ugc nofollow noopener",title:g(l)("Download file"),download:"stats.csv",class:"relative fr-btn fr-btn--sm fr-btn--icon-left fr-icon-test-tube-line fr-icon-download-line fr-icon--sm z-2"},u(e.$t("Download")),9,ea)]),i("div",{class:p(["fr-icon--sm fr-ml-4v",{"fr-icon-arrow-up-s-line":R.value,"fr-icon-arrow-down-s-line":!R.value}])},null,2)])]),R.value?(t(),r("section",{key:0,"aria-labelledby":g(O),class:"flex fr-pb-3w fr-pl-3w fr-pr-3w"},[n(g(pl),{title:e.$t("Views"),data:T.value,type:"line",summary:P.value,class:"w-1/3"},null,8,["title","data","summary"]),n(g(pl),{title:e.$t("Downloads"),data:q.value,type:"line",summary:E.value,class:"w-1/3"},null,8,["title","data","summary"]),n(g(pl),{title:e.$t("Reuses Visits"),data:I.value,type:"line",summary:V.value,class:"w-1/3"},null,8,["title","data","summary"])],8,la)):_("",!0)],2)):_("",!0),i("div",aa,[i("div",ta,[i("h2",ra,u(g(l)("{n} datasets",w.value)),1)]),e.oid?(t(),r("div",sa,[i("div",null,[i("a",{href:g(K)(e.oid,w.value),class:"fr-btn fr-btn--sm fr-icon-download-line fr-btn--icon-left"},u(g(l)("Download catalog")),9,na)])])):_("",!0)]),o.value||w.value>0?(t(),b(Ll,{key:1,datasets:s.value,loading:o.value,"sort-direction":x.value,sortedBy:k.value,onSort:j},null,8,["datasets","loading","sort-direction","sortedBy"])):(t(),b(L,{key:2,class:"fr-my-2w"},{default:y((()=>[i("div",oa,[i("img",{src:g(Q),alt:"",loading:"lazy"},null,8,ia),i("p",ua,u(g(l)("You haven't published a dataset yet")),1),n(Nl,{type:"dataset"})])])),_:1})),w.value>m.value?(t(),b(g(X),{key:3,page:d.value,"page-size":m.value,"total-results":w.value,onChange:a[1]||(a[1]=e=>d.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}}),ca=P(da,[["__scopeId","data-v-93674b91"]]),fa=["href"],ma={class:"monospace"},va={class:"monospace"},pa={class:"monospace"},ba={class:"monospace"},ga=a({__name:"AdminReusesTable",props:{reuses:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(e){const l=e,{t:a}=M();function o(e){return l.sortedBy===e?l.sortDirection:null}function d(e){return`${H}reuse/${e.id}/`}function c(e){return e.deleted?{label:a("Deleted"),type:"error"}:e.archived?{label:a("Archived"),type:"warning"}:e.private?{label:a("Draft"),type:"default"}:{label:a("Public"),type:"info"}}return(e,l)=>(t(),b($l,{loading:e.loading},{default:y((()=>[i("thead",null,[n(Bl,{onSort:l[0]||(l[0]=l=>e.$emit("sort","title",l)),sorted:o("title"),scope:"col"},{default:y((()=>[h(u(g(a)("Reuse title")),1)])),_:1},8,["sorted"]),n(Bl,null,{default:y((()=>[h(u(g(a)("Status")),1)])),_:1}),n(Bl,{onSort:l[1]||(l[1]=l=>e.$emit("sort","created",l)),sorted:o("created"),scope:"col"},{default:y((()=>[h(u(g(a)("Created at")),1)])),_:1},8,["sorted"]),n(Bl,{onSort:l[2]||(l[2]=l=>e.$emit("sort","datasets",l)),sorted:o("datasets"),scope:"col"},{default:y((()=>[h(u(g(a)("Datasets")),1)])),_:1},8,["sorted"]),n(Bl,{scope:"col"},{default:y((()=>[n(Ml,null,{tooltip:y((()=>[h(u(g(a)("Discussions")),1)])),default:y((()=>[l[5]||(l[5]=i("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),n(Bl,{onSort:l[3]||(l[3]=l=>e.$emit("sort","views",l)),sorted:o("views"),scope:"col"},{default:y((()=>[n(Ml,null,{tooltip:y((()=>[h(u(g(a)("Views")),1)])),default:y((()=>[l[6]||(l[6]=i("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),n(Bl,{onSort:l[4]||(l[4]=l=>e.$emit("sort","followers",l)),sorted:o("followers"),scope:"col"},{default:y((()=>[n(Ml,null,{tooltip:y((()=>[h(u(g(a)("Favorites")),1)])),default:y((()=>[l[7]||(l[7]=i("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"])]),i("tbody",null,[(t(!0),r(s,null,k(e.reuses,(e=>(t(),r("tr",null,[i("td",null,[n(kl,null,{default:y((()=>[i("a",{class:"fr-link fr-reset-link",href:d(e)},[n(g(V),{text:e.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,fa)])),_:2},1024)]),i("td",null,[n(_l,{type:c(e).type},{default:y((()=>[h(u(c(e).label),1)])),_:2},1032,["type"])]),i("td",null,u(g(j)(e.created_at)),1),i("td",ma,u(g(O)(e.datasets.length)),1),i("td",va,u(g(O)(e.metrics.discussions)),1),i("td",pa,u(g(O)(e.metrics.views)),1),i("td",ba,u(g(O)(e.metrics.followers)),1)])))),256))])])),_:1},8,["loading"]))}}),ya={class:"fr-container--fluid"},_a={key:0},ha={class:"fr-breadcrumb__link","aria-current":"page"},wa={class:"fr-h3 fr-mb-5v"},ka={class:"subtitle subtitle--uppercase fr-mb-0"},xa={class:"text-align-center fr-py-1w"},za=["src"],Ca={class:"fr-text--bold fr-my-3v"},$a=a({__name:"Reuses",props:{oid:{}},setup(e){const{t:l}=M(),a=e,s=c([]),o=c(!1),d=c(1),m=c(10),p=c(0),w=c("created"),k=c("desc"),x=f((()=>`${"asc"===k.value?"":"-"}${w.value}`)),{currentOrganization:z}=Ul(),$=J();function A(e,l){w.value=e,k.value=l}return v((async()=>{o.value=!0,s.value=[];try{let e;if(a.oid)e=await le(a.oid,d.value,m.value,x.value);else{if(!$.value)return;e=await ae($.value.id,d.value,m.value,x.value)}s.value=e.data,d.value=e.page,m.value=e.page_size,p.value=e.total}finally{o.value=!1}})),(e,a)=>{const c=C("router-link");return t(),r("div",ya,[n(yl,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),g(z)?(t(),r("li",_a,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(z).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",ha,u(g(l)("Reuses")),1)])])),_:1}),i("h1",wa,u(g(l)("Reuses")),1),i("h2",ka,u(g(l)("{n} reuses of your organization",s.value.length)),1),o.value||p.value>0?(t(),b(ga,{key:0,reuses:s.value,loading:o.value,sortDirection:k.value,sortedBy:w.value,onSort:A},null,8,["reuses","loading","sortDirection","sortedBy"])):(t(),b(L,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:y((()=>[i("div",xa,[i("img",{src:g("/_themes/gouvfr/assets/reuse.svg"),alt:"",loading:"lazy"},null,8,za),i("p",Ca,u(g(l)("You haven't published a reuse yet")),1),n(Nl,{type:"reuse"})])])),_:1})),p.value>m.value?(t(),b(g(X),{key:2,page:d.value,"page-size":m.value,"total-results":p.value,onChange:a[0]||(a[0]=e=>d.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}}),Aa={class:"fr-breadcrumb__link","aria-current":"page"},Da={key:0,class:"fr-h1"},Sa={class:"fr-alert fr-alert--info"},Ba={class:"fr-alert__title"},ja={href:"/admin/me/"},Ra=a({__name:"Me",setup(e){const{t:l}=M(),a=J();return(e,s)=>{const o=C("router-link");return t(),r("div",null,[n(yl,null,{default:y((()=>[i("li",null,[n(o,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),i("li",null,[i("a",Aa,u(g(l)("Me")),1)])])),_:1}),g(a)?(t(),r("h1",Da,u(g(a).first_name)+" "+u(g(a).last_name),1)):_("",!0),i("div",Sa,[i("h3",Ba,u(g(l)("This is a WIP page")),1),i("p",null,[i("a",ja,u(g(l)("You can edit your profil on the current admin.")),1)])])])}}}),Ma='<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5 12V18C5 18 5 21 12 21C19 21 19 18 19 18V12" stroke="currentColor" stroke-width="1.5"/>\n<path d="M5 6V12C5 12 5 15 12 15C19 15 19 12 19 12V6" stroke="currentColor" stroke-width="1.5"/>\n<path d="M12 3C19 3 19 6 19 6C19 6 19 9 12 9C5 9 5 6 5 6C5 6 5 3 12 3Z" stroke="currentColor" stroke-width="1.5"/>\n</svg>\n',Oa={class:"fr-sidemenu__item"},Ta=["innerHTML"],Pa=P(a({__name:"AdminSidebarLink",props:{label:{},icon:{},iconHtml:{},to:{}},setup:e=>(e,l)=>{const a=C("router-link");return t(),r("li",Oa,[i("div",{class:p([{"fr-icon-svg fr-icon--sm":e.iconHtml},"fr-enlarge-link fr-sidemenu__link fr-mb-1w"])},[e.iconHtml?(t(),r("div",{key:0,class:"fr-mr-1w fr-grid-row",innerHTML:e.iconHtml},null,8,Ta)):e.icon?(t(),r("div",{key:1,class:p([e.icon,"fr-mr-1w fr-icon--sm"]),"aria-hidden":"true"},null,2)):_("",!0),n(a,{to:e.to},{default:y((()=>[n(g(V),{text:e.label,"auto-resize":!0,"max-lines":1},null,8,["text"])])),_:1},8,["to"])],2)])}}),[["__scopeId","data-v-239d0721"]]),qa=["aria-expanded","aria-controls","aria-current"],Ea={class:"fr-mx-1w"},Ia={class:"logo logo--sm"},La={class:"fr-mx-1w fr-col text-overflow-ellipsis"},Va=["id"],Ua={class:"fr-sidemenu__list fr-mx-1w fr-my-3v"},Ha=a({__name:"AdminSidebarMenu",props:{user:{},organization:{},isOpened:{type:Boolean}},emits:["open","click"],setup(e){const l=e,{t:a}=M(),o=T("menu");return $((()=>{setTimeout((()=>{!function(e,l){const a=document.getElementById(o);l(a)&&(e?l(a).collapse.disclose():l(a).collapse.conceal())}(l.isOpened,globalThis.dsfr)}),200)})),(e,l)=>(t(),r("li",{class:p(["fr-sidemenu__item",{"fr-sidemenu__item--active":e.isOpened}])},[i("button",{class:"fr-sidemenu__btn","aria-expanded":e.isOpened,"aria-controls":g(o),"aria-current":e.isOpened,onClick:l[0]||(l[0]=l=>e.$emit("open"))},[e.user?(t(),r(s,{key:0},[e.user?(t(),b(g(B),{key:0,user:e.user,size:24,rounded:!0},null,8,["user"])):_("",!0),i("p",Ea,u(g(a)("My Profile")),1)],64)):e.organization?(t(),r(s,{key:1},[i("div",Ia,[n(te,{type:"organization",src:e.organization.logo_thumbnail,size:20},null,8,["src"])]),i("p",La,u(e.organization.name),1)],64)):_("",!0)],8,qa),i("div",{class:"fr-collapse","data-fr-js-collapse":"",id:g(o)},[i("ul",Ua,[e.user?(t(),r(s,{key:0},[n(Pa,{icon:"fr-icon-account-circle-line",label:g(a)("Me"),to:{name:"me"}},null,8,["label"]),n(Pa,{iconHtml:g(Ma),label:g(a)("Datasets"),to:{name:"me-datasets"}},null,8,["iconHtml","label"]),n(Pa,{icon:"fr-icon-line-chart-line",label:g(a)("Reuses"),to:{name:"me-reuses"}},null,8,["label"]),n(Pa,{icon:"fr-icon-git-pull-request-line",label:g(a)("Community Resources"),to:{name:"me-community-resources"}},null,8,["label"])],64)):e.organization?(t(),r(s,{key:1},[n(Pa,{iconHtml:g(Ma),label:g(a)("Datasets"),to:{name:"organization-datasets",params:{oid:e.organization.id}},onClick:l[1]||(l[1]=l=>e.$emit("click"))},null,8,["iconHtml","label","to"]),n(Pa,{icon:"fr-icon-line-chart-line",label:g(a)("Reuses"),to:{name:"organization-reuses",params:{oid:e.organization.id}},onClick:l[2]||(l[2]=l=>e.$emit("click"))},null,8,["label","to"]),n(Pa,{icon:"fr-icon-chat-3-line",label:g(a)("Discussions"),to:{name:"organization-discussions",params:{oid:e.organization.id}},onClick:l[3]||(l[3]=l=>e.$emit("click"))},null,8,["label","to"]),n(Pa,{icon:"fr-icon-parent-line",label:g(a)("Members"),to:{name:"organization-members",params:{oid:e.organization.id}},onClick:l[4]||(l[4]=l=>e.$emit("click"))},null,8,["label","to"]),n(Pa,{icon:"fr-icon-server-line",label:g(a)("Harvesters"),to:{name:"organization-harvesters",params:{oid:e.organization.id}},onClick:l[5]||(l[5]=l=>e.$emit("click"))},null,8,["label","to"]),n(Pa,{icon:"fr-icon-git-pull-request-line",label:g(a)("Community Resources"),to:{name:"organization-community-resources",params:{oid:e.organization.id}},onClick:l[6]||(l[6]=l=>e.$emit("click"))},null,8,["label","to"]),n(Pa,{icon:"fr-icon-user-line",label:g(a)("Profile"),to:{name:"organization-profile",params:{oid:e.organization.id}},onClick:l[7]||(l[7]=l=>e.$emit("click"))},null,8,["label","to"])],64)):_("",!0)])],8,Va)],2))}}),Ya=P(Ha,[["__scopeId","data-v-68a29c5a"]]),Na={class:"fr-container--fluid h-100"},Fa={class:"fr-grid-row h-100 bg-grey-50"},Wa={class:"fr-col-12 fr-col-md-4 fr-col-lg-3 fr-col-xl-2"},Ja=["aria-label"],Za={class:"fr-sidemenu__inner"},Ga=["aria-controls"],Ka=["id"],Qa={class:"fr-sidemenu__list"},Xa={class:"fr-col-12 fr-col-md-8 fr-col-lg-9 fr-col-xl-10 h-100 fr-px-2w overflow-auto"},et=a({__name:"Admin",setup(e){const{t:l}=M(),a=re(),n=T("menu"),o=c(null),d=c(),{setCurrentOrganization:f}=Ul(),v=se();function p(e){return e===d.value}function y(e){d.value=e.id}return m((async()=>{var e;if(o.value=await ne(),a.name||(o.value.organizations.length>0?v.replace({name:"organization-datasets",params:{oid:o.value.organizations[0].id}}):v.replace({name:"me"})),"me"===a.name)d.value=null===(e=oe)||void 0===e?void 0:e.id;else if(o.value.organizations.length>0){let e=o.value.organizations[0];var l;a.params.oid&&(e=null!==(l=o.value.organizations.find((e=>e.id===a.params.oid)))&&void 0!==l?l:e),y(e),f(e)}})),(e,d)=>{const c=C("router-view");return t(),r("div",Na,[i("div",Fa,[i("div",Wa,[i("nav",{class:"fr-sidemenu fr-pr-0","aria-label":g(l)("Administration menu")},[i("div",Za,[i("button",{class:"fr-sidemenu__btn",hidden:"","aria-controls":g(n),"aria-expanded":"false"},u(g(l)("Open menu")),9,Ga),i("div",{class:"fr-collapse",id:g(n)},[i("ul",Qa,[g(oe)?(t(),b(Ya,{key:0,user:g(oe),"is-opened":p(g(oe).id),onOpen:d[0]||(d[0]=e=>y(g(oe)))},null,8,["user","is-opened"])):_("",!0),o.value?(t(!0),r(s,{key:1},k(o.value.organizations,(e=>(t(),b(Ya,{organization:e,"is-opened":p(e.id),onOpen:()=>y(e),onClick:()=>g(f)(e)},null,8,["organization","is-opened","onOpen","onClick"])))),256)):_("",!0)])],8,Ka)])],8,Ja)]),i("div",Xa,[(t(),b(c,{key:g(a).fullPath,class:"fr-container--fluid"}))])])])}}}),lt=P(et,[["__scopeId","data-v-364348c3"]]),at=["aria-labelledby","id"],tt={class:"fr-container fr-container--fluid fr-container-md"},rt={class:"fr-grid-row fr-grid-row--center"},st={class:"fr-col-12 fr-col-md-8"},nt={class:"fr-modal__body"},ot={class:"fr-modal__header"},it=["title","aria-controls"],ut={class:"fr-modal__content"},dt=["id"],ct={class:"fr-modal__footer"},ft={class:"fr-btns-group fr-btns-group--right fr-btns-group--sm fr-btns-group--inline-lg fr-btns-group--icon-left"},mt=["disabled"],vt=["disabled"],pt=a({__name:"AdminAddMemberModal",props:{id:{},oid:{},roles:{}},emits:["memberAdded"],setup(e,{emit:l}){const a=e,r=l,{t:s}=M(),{toast:o}=fe(),d=c(!1),m=c(),v=c("editor"),p=f((()=>"fr-modal-title-user-"+a.id));async function y(){try{d.value=!0,m.value&&(await de(a.oid,m.value,v.value),r("memberAdded"),w())}catch(e){o.error(s("An error occurred while update member role."))}finally{d.value=!1}}function h(e){return e.map((e=>{var l;const a={...e,avatar_thumbnail:null!==(l=e.avatar_url)&&void 0!==l?l:void 0};return{value:a.id,label:a.first_name+" "+a.last_name,image:ce(a,32)}}))}function w(){d.value=!1,m.value=void 0,v.value="editor";const e=document.getElementById(a.id);globalThis.dsfr(e).modal.conceal()}return(e,l)=>(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":p.value,role:"dialog",id:e.id,class:"fr-modal"},[i("div",tt,[i("div",rt,[i("div",st,[i("div",nt,[i("div",ot,[i("button",{class:"fr-btn--close fr-btn",title:g(s)("Close the modal dialog"),"aria-controls":e.id},u(g(s)("Close")),9,it)]),i("form",{onSubmit:D(y,["prevent"])},[i("div",ut,[i("h1",{id:p.value,class:"fr-modal__title fr-mb-2w"},u(g(s)("Add member to the organization")),9,dt),n(ie,{placeholder:e.$t("Search a user"),searchPlaceholder:e.$t("Search a user..."),suggestUrl:"/users/suggest/",values:m.value,onChange:l[0]||(l[0]=e=>m.value=e),allOption:e.$t("Select a user"),addAllOption:!1,onSuggest:h,roundedImages:!0},null,8,["placeholder","searchPlaceholder","values","allOption"]),e.roles.length>0?(t(),b(ue,{key:0,label:g(s)("Role of the member"),"model-value":v.value,"onUpdate:modelValue":l[1]||(l[1]=e=>v.value=e),options:e.roles},null,8,["label","model-value","options"])):_("",!0)]),i("div",ct,[i("div",ft,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"button",onClick:w,disabled:d.value},u(g(s)("Cancel")),9,mt),i("button",{class:"fr-btn",type:"submit",disabled:d.value},u(g(s)("Add to the organization")),9,vt)])])],32)])])])])],8,at)]))}}),bt=["aria-controls"],gt=a({__name:"AdminAddMemberButton",props:{oid:{},roles:{}},emits:["memberAdded"],setup(e){const l=e,{t:a}=M(),o=f((()=>"fr-modal-add-user-"+l.oid));return(e,l)=>(t(),r(s,null,[i("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-icon-add-line","data-fr-opened":"false","aria-controls":o.value},u(g(a)("Add member")),9,bt),n(pt,{id:o.value,oid:e.oid,roles:e.roles,onMemberAdded:l[0]||(l[0]=l=>e.$emit("memberAdded"))},null,8,["id","oid","roles"])],64))}}),yt={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},_t=a({__name:"AdminDangerZone",setup:e=>(e,l)=>(t(),b(g(me),{color:"error",type:"secondary",weight:"regular"},{default:y((()=>[i("div",yt,[w(e.$slots,"default")])])),_:3}))}),ht={class:"fr-px-1v rounded-2 monospace fr-text--sm text-mention-grey bg-grey-100 fr-m-0"},wt=a({__name:"AdminEmail",props:{email:{}},setup:e=>(e,l)=>(t(),r("p",ht,u(e.email),1))}),kt=["aria-labelledby","id"],xt={class:"fr-container fr-container--fluid fr-container-md"},zt={class:"fr-grid-row fr-grid-row--center"},Ct={class:"fr-col-12 fr-col-md-8"},$t={class:"fr-modal__body"},At={class:"fr-modal__header"},Dt=["title","aria-controls"],St={class:"fr-modal__content"},Bt=["id"],jt={class:"fr-grid-row fr-grid-row--middle fr-mb-2w"},Rt={class:"fr-text--bold fr-m-0 fr-mr-1v"},Mt={class:"fr-col"},Ot={class:"fr-col-auto"},Tt=["disabled"],Pt={class:"fr-col"},qt={class:"fr-m-0 text-grey-500"},Et={class:"fr-m-0 fr-text--xs text-default-error"},It={class:"fr-col-auto"},Lt=["disabled"],Vt=a({__name:"AdminEditMemberModal",props:{id:{},member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(e,{emit:l}){const a=e,r=l,s=f((()=>"fr-modal-title-user-"+a.id)),{t:o}=M(),{toast:d}=fe(),m=c(!1);function v(){m.value=!1;const e=document.getElementById(a.id);globalThis.dsfr(e).modal.conceal()}return(e,l)=>{return t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":s.value,role:"dialog",id:e.id,class:"fr-modal"},[i("div",xt,[i("div",zt,[i("div",Ct,[i("div",$t,[i("div",At,[i("button",{class:"fr-btn--close fr-btn",title:g(o)("Close the modal dialog"),"aria-controls":e.id},u(g(o)("Close")),9,Dt)]),i("div",St,[i("h1",{id:s.value,class:"fr-modal__title fr-mb-2w"},u(g(o)("Edit member")),9,Bt),i("div",jt,[n(g(B),{class:"fr-mr-1v",user:e.member.user,rounded:!0,size:24},null,8,["user"]),i("p",Rt,u(e.member.user.first_name)+" "+u(e.member.user.last_name),1),e.member.user.email?(t(),b(wt,{key:0,email:e.member.user.email},null,8,["email"])):_("",!0)]),i("form",{class:"fr-grid-row fr-grid-row--gutters fr-grid-row--bottom",onSubmit:l[1]||(l[1]=D((l=>async function(e){if(e.newRole)try{m.value=!0,await ve(a.oid,e.user.id,e.newRole),r("memberUpdated"),v()}catch(l){d.error(o("An error occurred while update member role."))}finally{m.value=!1}else v()}(e.member)),["prevent"]))},[i("div",Mt,[e.roles.length>0?(t(),b(ue,{key:0,label:g(o)("Role of the member"),"model-value":e.member.role,"onUpdate:modelValue":l[0]||(l[0]=l=>e.member.newRole=l),options:(c=e.member.role,a.roles.map((e=>{const l={...e};return l.value===c&&(l.selected=!0),l})))},null,8,["label","model-value","options"])):_("",!0)]),i("div",Ot,[i("button",{class:"fr-btn",type:"submit",disabled:m.value},u(g(o)("Validate")),9,Tt)])],32),n(_t,{class:"fr-mt-2w"},{default:y((()=>[i("div",Pt,[i("p",qt,u(g(o)("Remove member from the organization")),1),i("p",Et,u(g(o)("Be careful, this action can't be reverse.")),1)]),i("div",It,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-logout-box-r-line",disabled:m.value,onClick:l[2]||(l[2]=l=>async function(e){try{m.value=!0,await pe(a.oid,e.user.id),r("memberUpdated")}catch(l){d.error(o("An error occurred while removing this member."))}finally{m.value=!1}}(e.member))},u(g(o)("Remove member")),9,Lt)])])),_:1})])])])])])],8,kt)]);var c}}}),Ut=["aria-controls"],Ht=a({__name:"AdminEditMemberButton",props:{member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(e){const l=e,{t:a}=M(),o=f((()=>"fr-modal-user-"+l.member.user.id));return(e,l)=>(t(),r(s,null,[i("button",{class:"fr-btn fr-btn--sm fr-btn--secondary-grey-500 fr-btn--tertiary-no-outline fr-icon-pencil-line","data-fr-opened":"false","aria-controls":o.value},u(g(a)("Edit")),9,Ut),n(Vt,{id:o.value,member:e.member,oid:e.oid,roles:e.roles,onMemberUpdated:l[0]||(l[0]=l=>e.$emit("memberUpdated"))},null,8,["id","member","oid","roles"])],64))}}),Yt={class:"fr-mt-n9v fr-mb-2w"},Nt={class:"fr-badge fr-badge--info fr-badge--no-icon"},Ft={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Wt={class:"fr-col"},Jt={class:"fr-grid-row fr-grid-row--middle"},Zt={class:"fr-text--bold fr-m-0 fr-mr-1v"},Gt={class:"fr-m-0"},Kt={class:"fr-ml-3v fr-mt-1-5v fr-mb-0 filet filet-default-grey fr-text--sm"},Qt={key:0,class:"fr-col-auto fr-grid-row flex-direction-column"},Xt=["disabled"],er=["disabled","aria-controls"],lr=["aria-labelledby","id"],ar={class:"fr-container fr-container--fluid fr-container-md"},tr={class:"fr-grid-row fr-grid-row--center"},rr={class:"fr-col-12 fr-col-md-8"},sr={class:"fr-modal__body"},nr={class:"fr-modal__header"},or=["title","aria-controls"],ir={class:"fr-modal__content"},ur=["id"],dr={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--right"},cr={class:"fr-col-auto"},fr=["disabled"],mr={class:"fr-col-auto"},vr=["disabled"],pr=a({__name:"AdminMembershipRequest",props:{loading:{type:Boolean},oid:{},request:{},showActions:{type:Boolean}},emits:["accept","refuse"],setup(e,{emit:l}){const a=e,s=l,{t:o}=M(),d=c(""),f=T("modal"),m=T("modalTitle");function v(){const e=document.getElementById(f);globalThis.dsfr(e).modal.conceal()}function p(){s("refuse",a.request.id,d.value),v()}function w(){d.value="",v()}return(e,l)=>{const a=C("AdminMembershipRequest",!0);return t(),b(L,{class:"drop-shadow rounded-xxs fr-mt-3w"},{default:y((()=>[i("div",Yt,[i("p",Nt,[l[2]||(l[2]=i("span",{class:"fr-icon-user-add-line fr-icon--sm","aria-hidden":"true"},null,-1)),h(" "+u(g(o)("Membership Request")),1)])]),i("div",Ft,[i("div",Wt,[i("div",Jt,[n(g(B),{class:"fr-mr-1v",user:e.request.user,rounded:!0,size:24},null,8,["user"]),i("p",Zt,u(e.request.user.first_name)+" "+u(e.request.user.last_name),1),e.request.user.email?(t(),b(wt,{key:0,email:e.request.user.email,class:"fr-mr-1v"},null,8,["email"])):_("",!0),i("p",Gt,u(g(o)("asks to join the organization.")),1)]),i("div",Kt,u(e.request.comment),1)]),e.showActions?(t(),r("div",Qt,[i("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-mb-1w fr-icon-check-line",onClick:l[0]||(l[0]=l=>e.$emit("accept",e.request.id)),disabled:e.loading,"data-testid":"accept"},u(g(o)("Accept request")),9,Xt),i("button",{class:"fr-btn fr-btn--icon-left fr-btn--sm fr-btn--secondary fr-btn--secondary--error fr-icon-close-line",disabled:e.loading,"data-fr-opened":"false","aria-controls":g(f),"data-testid":"refuse"},u(g(o)("Refuse")),9,er),(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":g(m),role:"dialog",id:g(f),class:"fr-modal","data-testid":"modal"},[i("div",ar,[i("div",tr,[i("div",rr,[i("div",sr,[i("div",nr,[i("button",{class:"fr-btn--close fr-btn",title:g(o)("Close the modal dialog"),"aria-controls":g(f),onClick:D(w,["prevent"])},u(g(o)("Close")),9,or)]),i("div",ir,[i("h1",{id:g(m),class:"fr-modal__title fr-mb-2w"},u(g(o)("Refuse membership request")),9,ur),n(a,{class:"fr-mt-4w fr-mb-2w",loading:!1,oid:e.oid,request:e.request,"show-actions":!1},null,8,["oid","request"]),i("form",{onSubmit:D(p,["prevent"]),onReset:w},[n(be,{label:g(o)("You can provide the refusal reason:"),modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=e=>d.value=e),"data-testid":"comment-group"},null,8,["label","modelValue"]),i("div",dr,[i("div",cr,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"reset",disabled:e.loading,"data-testid":"cancel-modal-button"},u(g(o)("Cancel")),9,fr)]),i("div",mr,[i("button",{class:"fr-btn",type:"submit",disabled:e.loading,"data-testid":"refuse-modal-button"},u(g(o)("Refuse request")),9,vr)])])],32)])])])])])],8,lr)]))])):_("",!0)])])),_:1})}}}),br={key:0},gr={class:"fr-breadcrumb__link","aria-current":"page"},yr={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-center"},_r={class:"fr-col-12 fr-col-md"},hr={class:"fr-h3 fr-mb-0"},wr={key:0,class:"fr-col-auto"},kr={class:"subtitle subtitle--uppercase fr-mt-5v fr-mb-0"},xr={class:"fr-text--bold fr-m-0"},zr={class:"fr-m-0 fr-text--xs text-mention-grey f-italic inline-flex items-center"},Cr={key:0},$r={key:1},Ar={key:0},Dr=a({__name:"Members",props:{oid:{}},setup(e){const l=e;q(ge);const{t:a}=M(),{toast:o}=fe(),d=c([]),w=f((()=>ye||$.value.some((e=>{var l;return e.user.id===(null===(l=oe)||void 0===l?void 0:l.id)&&"admin"===e.role})))),x=c([]),{currentOrganization:z}=Ul(),$=c([]),A=c(!1);function D(e){var l,a;return null!==(l=null===(a=x.value.find((l=>l.value===e)))||void 0===a?void 0:a.label)&&void 0!==l?l:e}async function S(){A.value=!0,$.value=[];try{const e=await xe(l.oid);$.value=e.members}finally{A.value=!1}}async function B(){const e=await _e(l.oid);d.value=e}async function R(e){A.value=!0;const t=[];try{await ze(l.oid,e),t.push(B()),t.push(S())}catch(r){o.error(a("An error occurred while accepting this membership."))}finally{Promise.all(t).finally((()=>A.value=!1))}}async function O(e,t){A.value=!0;const r=[];try{await Ce(l.oid,e,t),r.push(B()),r.push(S())}catch(s){o.error(a("An error occurred while refusing this membership."))}finally{Promise.all(r).finally((()=>A.value=!1))}}return v((()=>{w.value&&_e(l.oid).then((e=>d.value=e))})),m((()=>{he().then(we).then((e=>x.value=e)),S()})),(e,l)=>{const o=C("router-link"),c=C("TextClamp");return t(),r("div",null,[n(yl,null,{default:y((()=>[i("li",null,[n(o,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(a)("Administration")),1)])),_:1})]),g(z)?(t(),r("li",br,[n(o,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(z).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",gr,u(g(a)("Members")),1)])])),_:1}),i("div",yr,[i("div",_r,[i("h1",hr,u(g(a)("Members")),1)]),w.value?(t(),r("div",wr,[n(gt,{oid:e.oid,roles:x.value,onMemberAdded:S},null,8,["oid","roles"])])):_("",!0)]),d.value.length?(t(),r(s,{key:0},[i("h2",kr,u(g(a)("{n} requests",{n:d.value.length})),1),(t(!0),r(s,null,k(d.value,(l=>(t(),b(pr,{class:"fr-mb-4w",key:l.id,loading:A.value,oid:e.oid,request:l,"show-actions":!0,onAccept:R,onRefuse:O},null,8,["loading","oid","request"])))),128))],64)):_("",!0),i("h2",{class:p(["subtitle subtitle--uppercase fr-mb-0",{"fr-mt-n3v":d.value.length,"fr-mt-5v":!d.value.length}])},u(g(a)("{n} members",{n:$.value.length})),3),n($l,{class:"fr-table--layout-fixed",loading:A.value},{default:y((()=>[i("thead",null,[i("tr",null,[n(Bl,{scope:"col"},{default:y((()=>[h(u(g(a)("Members")),1)])),_:1}),n(Bl,{scope:"col"},{default:y((()=>[h(u(g(a)("Status")),1)])),_:1}),n(Bl,{scope:"col"},{default:y((()=>[h(u(g(a)("Member since")),1)])),_:1}),n(Bl,{scope:"col"},{default:y((()=>[h(u(g(a)("Last connection")),1)])),_:1}),w.value?(t(),b(Bl,{key:0,scope:"col"},{default:y((()=>[h(u(g(a)("Action")),1)])),_:1})):_("",!0)])]),i("tbody",null,[(t(!0),r(s,null,k($.value,(l=>{return t(),r("tr",{key:l.user.id},[i("td",null,[i("p",xr,u(l.user.first_name)+" "+u(l.user.last_name),1),i("p",zr,[n(g(I),{height:12,width:12,name:"ri-mail-line"}),n(Ml,null,{default:y((()=>[n(c,{class:"fr-px-1v",text:l.user.email,"auto-resize":!0,"max-lines":1},null,8,["text"])])),_:2},1024)])]),i("td",null,[n(_l,{type:(s=l.role,"admin"===s?"info":"default")},{default:y((()=>[h(u(D(l.role)),1)])),_:2},1032,["type"])]),i("td",null,u(g(j)(l.since)),1),i("td",null,[l.user.last_login_at?(t(),r("span",Cr,u(g(ke)(l.user.last_login_at)),1)):(t(),r("span",$r,u(g(a)("No connection")),1))]),w.value?(t(),r("td",Ar,[n(Ht,{member:l,oid:e.oid,roles:x.value,onMemberUpdated:S},null,8,["member","oid","roles"])])):_("",!0)]);var s})),128))])])),_:1},8,["loading"])])}}}),Sr={class:"fr-container--fluid"},Br={key:0},jr={class:"fr-breadcrumb__link","aria-current":"page"},Rr={class:"fr-h3 fr-mb-5v"},Mr={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-between"},Or={class:"fr-col-12 fr-col-md fr-grid-row fr-grid-row--middle"},Tr={class:"fr-ml-3v fr-my-0 fr-h3"},Pr=["title"],qr={class:"fr-col-auto"},Er=["href"],Ir=["id"],Lr=["disabled","onClick"],Vr={class:"fr-col"},Ur={class:"fr-m-0 text-grey-500"},Hr={class:"fr-m-0 fr-text--xs text-default-error"},Yr={class:"fr-col-auto"},Nr=["disabled","aria-controls"],Fr=["aria-labelledby","id"],Wr={class:"fr-container fr-container--fluid fr-container-md"},Jr={class:"fr-grid-row fr-grid-row--center"},Zr={class:"fr-col-12 fr-col-md-8"},Gr={class:"fr-modal__body"},Kr={class:"fr-modal__header"},Qr=["title","aria-controls"],Xr={class:"fr-modal__content"},es=["id"],ls={class:"fr-text--bold"},as={class:"fr-modal__footer"},ts={class:"fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left"},rs=["disabled"],ss=a({__name:"Profile",props:{oid:{}},setup(e){const{t:l}=M(),{toast:a}=fe(),s=e,o=se(),d=c(null),{currentOrganization:f}=Ul(),v=c(null),{organizationCertified:p}=$e(v),w=c([]),k=c(!1),x=T("modal"),z=T("modalTitle");function $(){f.value&&(k.value=!0,Se(f.value.id).then((()=>{o.replace("/"),window.location.reload()})).catch((()=>a.error(l("An error occured when deleting the organization.")))).finally((()=>k.value=!1)))}async function D(e,t){k.value=!0;try{v.value=await Be(e),a.success(l("Organization updated !"))}catch(r){a.error(l("An error occured when updating the organization."))}finally{k.value=!1}if(t&&v.value){k.value=!0;try{const e=await je(v.value.id,t);v.value.logo_thumbnail=e.image}catch(r){a.error(l("Failed to upload logo, you can upload it again in your management panel"))}finally{k.value=!1}}}return m((async()=>{k.value=!0;try{v.value=await xe(s.oid)}finally{k.value=!1}})),(e,a)=>{const s=C("router-link");return t(),r("div",Sr,[n(yl,null,{default:y((()=>[i("li",null,[n(s,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),g(f)?(t(),r("li",Br,[n(s,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(f).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",jr,u(g(l)("Profile")),1)])])),_:1}),i("h1",Rr,u(g(l)("Profile")),1),v.value?(t(),b(L,{key:0,class:"fr-mb-5v"},{default:y((()=>[i("div",Mr,[i("div",Or,[n(g(Ae),{src:v.value.logo,type:"organization",size:80,class:"rounded-xxs border"},null,8,["src"]),i("div",Tr,[h(u(v.value.name)+" ",1),g(p)?(t(),r("span",{key:0,class:"fr-icon-success-line fr-icon--lg text-blue-400",title:g(l)("The identity of this public service is certified by {certifier}",{certifier:g(F)}),"aria-hidden":"true"},null,8,Pr)):_("",!0)])]),i("div",qr,[i("a",{href:v.value.page,class:"fr-btn fr-btn--sm fr-btn--secondary fr-btn--secondary-grey-500 fr-btn--icon-left fr-icon-eye-line"},u(g(l)("See the organization page")),9,Er)])])])),_:1})):_("",!0),d.value?(t(),r("h2",{key:1,class:"subtitle subtitle--uppercase fr-mb-5v",id:d.value.legend},u(g(l)("Edit profile")),9,Ir)):_("",!0),k.value&&!v.value?(t(),b(xl,{key:2})):_("",!0),v.value?(t(),b(De,{key:3,organization:v.value,errors:w.value,showLegend:!1,showWell:!1,ref_key:"form",ref:d,onSubmit:D},{submitButton:y((({submit:e})=>[i("button",{class:"fr-btn fr-btn--icon-left fr-icon-save-line",disabled:k.value,"data-testid":"submitButton",onClick:e},u(g(l)("Save")),9,Lr)])),default:y((()=>[n(_t,{class:"fr-mt-6w"},{default:y((()=>[i("div",Vr,[i("p",Ur,u(g(l)("Delete the organization")),1),i("p",Hr,u(g(l)("Be careful, this action can't be reverse.")),1)]),i("div",Yr,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-delete-line",disabled:k.value,"data-fr-opened":"false","aria-controls":g(x)},u(g(l)("Delete")),9,Nr),(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":g(z),role:"dialog",id:g(x),class:"fr-modal"},[i("div",Wr,[i("div",Jr,[i("div",Zr,[i("div",Gr,[i("div",Kr,[i("button",{class:"fr-btn--close fr-btn",title:g(l)("Close the modal dialog"),"aria-controls":g(x)},u(g(l)("Close")),9,Qr)]),i("div",Xr,[i("h1",{id:g(z),class:"fr-modal__title fr-mb-2w"},u(g(l)("Are you sure you want to delete this organization ?")),9,es),i("p",ls,u(g(l)("This action can't be reverse.")),1),i("p",null,u(g(l)("All content published with this organization will stay online, with the same URL but in an anonymous form, i.e. without being linked to a data producer.")),1),i("p",null,u(g(l)("If you want to delete your published content too, start by deleting the contents before deleting your account.")),1)]),i("div",as,[i("div",ts,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error",role:"button",disabled:k.value,onClick:$},u(g(l)("Delete")),9,rs)])])])])])])],8,Fr)]))])])),_:1})])),_:1},8,["organization","errors"])):_("",!0)])}}});async function ns(e){switch(e.class){case"Dataservice":return async function(e){return(await Re.get(`dataservices/${e}/`)).data}(e.id);case"Dataset":return Ie(e.id);case"Post":return async function(e){return(await Re.get(`posts/${e}/`)).data}(e.id);case"Reuse":return Ee(e.id);default:return null}}function os(e,l){return null===e?null:{title:is(e),icon:ds(l),page:us(e)}}function is(e){return null===e?"":"title"in e?e.title:"headline"in e?e.headline:Le(e,`Unknown type ${e}`)}function us(e){return null===e?"":"page"in e?e.page:"self_web_url"in e?e.self_web_url:Le(e,`Unknown type ${e}`)}function ds(e){switch(e){case"Dataservice":return"ri-terminal-line";case"Dataset":return"ri-database-2-line";case"Post":return"ri-article-line";case"Reuse":return"ri-line-chart-line";default:return""}}q(Pe,Te,Oe,Me);const cs={class:"fr-text--bold"},fs={key:0},ms=["href"],vs={class:"inline-flex items-center"},ps=["href"],bs=a({__name:"AdminDiscussionsTable",props:{discussions:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(e){const a=e,{t:o}=M(),d=c({}),f=c({});function m(e,l){return l?l.page+"#/discussions/"+e:""}function p(e){return a.sortedBy===e?a.sortDirection:null}function w(e){return e.discussion.slice(-1)[0]}return v((async()=>{for(const e of a.discussions)if(!(e.subject.id in d.value)){const l=ns(e.subject);d.value[e.subject.id]=l;const a=await d.value[e.subject.id];f.value[e.subject.id]=os(a,e.subject.class)}})),(e,a)=>(t(),b($l,{class:"fr-table--layout-fixed",loading:e.loading},{default:y((()=>[i("thead",null,[n(Bl,{onSort:a[0]||(a[0]=l=>e.$emit("sort","title",l)),sorted:p("title"),scope:"col"},{default:y((()=>[h(u(g(o)("Discussion")),1)])),_:1},8,["sorted"]),n(Bl,{scope:"col"},{default:y((()=>[h(u(g(o)("Number of comments")),1)])),_:1}),n(Bl,{scope:"col"},{default:y((()=>[h(u(g(o)("Last comment")),1)])),_:1}),n(Bl,{onSort:a[1]||(a[1]=l=>e.$emit("sort","closed",l)),sorted:p("closed"),scope:"col"},{default:y((()=>[h(u(g(o)("Closed at")),1)])),_:1},8,["sorted"]),n(Bl,{scope:"col",style:{width:"25%"}},{default:y((()=>[h(u(g(o)("Link to the discussion")),1)])),_:1})]),i("tbody",null,[(t(!0),r(s,null,k(e.discussions,(e=>{var a,d,c;return t(),r("tr",null,[i("td",null,[i("p",cs,[n(g(V),{text:e.title,"auto-resize":!0,"max-lines":1},null,8,["text"])]),f.value[e.subject.id]?(t(),r("p",fs,[i("a",{class:"fr-link inline-flex",href:null===(a=f.value[e.subject.id])||void 0===a?void 0:a.page},[n(g(I),{height:12,class:"self-center",name:null===(d=f.value[e.subject.id])||void 0===d?void 0:d.icon},null,8,["name"]),n(g(V),{class:"overflow-wrap-anywhere",text:null===(c=f.value[e.subject.id])||void 0===c?void 0:c.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,ms)])):_("",!0)]),i("td",null,u(e.discussion.length),1),i("td",null,[i("div",null,[i("p",null,u(g(j)(w(e).posted_on)),1),i("p",vs,[h(u(g(o)("by "))+" ",1),n(g(l),{class:"fr-ml-1v",user:w(e).posted_by},null,8,["user"])])])]),i("td",null,[e.closed?(t(),r(s,{key:0},[h(u(g(j)(e.closed)),1)],64)):_("",!0)]),i("td",null,[f.value[e.subject.id]?(t(),r("a",{key:0,class:"fr-link inline-flex",href:m(e.id,f.value[e.subject.id]),target:"_blank"},[n(g(V),{text:m(e.id,f.value[e.subject.id]),"auto-resize":!0,"max-lines":1},null,8,["text"])],8,ps)):_("",!0)])])})),256))])])),_:1},8,["loading"]))}}),gs={class:"fr-container--fluid"},ys={key:0},_s={class:"fr-breadcrumb__link","aria-current":"page"},hs={class:"fr-h3 fr-mb-5v"},ws={class:"subtitle subtitle--uppercase fr-m-0"},ks={class:"text-align-center fr-py-1w"},xs=["src"],zs={class:"fr-text--bold fr-my-3v"},Cs=a({__name:"Discussions",props:{oid:{}},setup(e){const{t:l}=M(),a=e,s=c(!1),o=c(1),d=c(10),m=c(0),p=c("created"),w=c("desc"),k=f((()=>`${"asc"===w.value?"":"-"}${p.value}`)),x=c([]),{currentOrganization:z}=Ul();function $(e,l){p.value=e,w.value=l}return v((async()=>{s.value=!0,x.value=[];try{const e=await async function(e,l,a,t){return(await Re.get(qe("discussions/"),{params:{org:e,sort:t,page_size:a,page:l}})).data}(a.oid,o.value,d.value,k.value);x.value=e.data,o.value=e.page,d.value=e.page_size,m.value=e.total}finally{s.value=!1}})),(e,a)=>{const c=C("router-link");return t(),r("div",gs,[n(yl,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),g(z)?(t(),r("li",ys,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(z).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",_s,u(g(l)("Discussions")),1)])])),_:1}),i("h1",hs,u(g(l)("Discussions")),1),i("h2",ws,u(g(l)("{n} discussions",m.value)),1),s.value||m.value>0?(t(),b(bs,{key:0,discussions:x.value,loading:s.value,"sort-direction":w.value,sortedBy:p.value,onSort:$},null,8,["discussions","loading","sort-direction","sortedBy"])):(t(),b(L,{key:1,class:"fr-my-2w"},{default:y((()=>[i("div",ks,[i("img",{src:g("/_themes/gouvfr/assets/discussion.svg"),alt:"",loading:"lazy"},null,8,xs),i("p",zs,u(g(l)("There is no discussion yet")),1)])])),_:1})),m.value>d.value?(t(),b(g(X),{key:2,page:o.value,"page-size":d.value,"total-results":m.value,onChange:a[0]||(a[0]=e=>o.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}}),$s={class:"fr-container--fluid"},As={key:0},Ds={class:"fr-breadcrumb__link","aria-current":"page"},Ss={class:"fr-h3 fr-mb-5v"},Bs={class:"subtitle subtitle--uppercase fr-m-0"},js=["href"],Rs={class:"text-align-center fr-py-1w"},Ms=["src"],Os={class:"fr-text--bold fr-my-3v"},Ts=a({__name:"Harvesters",props:{oid:{}},setup(e){const{t:l}=M(),a=e,o=c(!1),d=c(1),f=c(10),m=c(0),p=c([]),w=c({}),{currentOrganization:x}=Ul();function z(e){return`${H}harvester/${e.id}/`}function $(e){return e.last_job&&w.value[e.last_job.id]?w.value[e.last_job.id].items.filter((e=>e.dataservice)).length:0}function A(e){return e.last_job&&w.value[e.last_job.id]?w.value[e.last_job.id].items.filter((e=>e.dataset)).length:0}function D(e){var a;switch(null===(a=e.last_job)||void 0===a?void 0:a.status){case"pending":return{label:l("Pending"),type:"default"};case"initializing":return{label:l("Initializing"),type:"info"};case"initialized":return{label:l("Initialized"),type:"default"};case"processing":return{label:l("Processing"),type:"info"};case"done":return{label:l("Done"),type:"success"};case"done-errors":return{label:l("Done with errors"),type:"warning"};case"failed":return{label:l("Failed"),type:"error"};default:return{label:l("No job yet"),type:"default"}}}return v((async()=>{o.value=!0,p.value=[];try{const l=await async function(e,l,a){return(await Re.get(qe("harvest/sources/"),{params:{owner:e,deleted:!0,page:l,page_size:a}})).data}(a.oid,d.value,f.value);p.value=l.data,d.value=l.page,f.value=l.page_size,m.value=l.total;const t=[];for(const a of p.value){var e;null!==(e=a.last_job)&&void 0!==e&&e.id&&t.push(Re.get(`harvest/job/${a.last_job.id}/`))}const r=await Promise.allSettled(t);for(const e of r)"fulfilled"===e.status&&(w.value[e.value.data.id]=e.value.data)}finally{o.value=!1}})),(e,a)=>{const c=C("router-link");return t(),r("div",$s,[n(yl,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),g(x)?(t(),r("li",As,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(x).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Ds,u(g(l)("Harvesters")),1)])])),_:1}),i("h1",Ss,u(g(l)("Harvesters")),1),i("h2",Bs,u(g(l)("{n} harvesters",m.value)),1),o.value||m.value?(t(),b($l,{key:0,loading:o.value},{default:y((()=>[i("thead",null,[n(Bl,{scope:"col"},{default:y((()=>[h(u(g(l)("Name")),1)])),_:1}),n(Bl,{scope:"col"},{default:y((()=>[h(u(g(l)("Status")),1)])),_:1}),n(Bl,{scope:"col"},{default:y((()=>[h(u(g(l)("Created at")),1)])),_:1}),n(Bl,{scope:"col"},{default:y((()=>[h(u(g(l)("Last run")),1)])),_:1}),n(Bl,{scope:"col"},{default:y((()=>[h(u(g(l)("Datasets")),1)])),_:1}),n(Bl,{scope:"col"},{default:y((()=>[h(u(g(l)("Dataservices")),1)])),_:1})]),i("tbody",null,[(t(!0),r(s,null,k(p.value,(e=>{var a;return t(),r("tr",null,[i("td",null,[n(kl,null,{default:y((()=>[i("a",{class:"fr-link fr-reset-link",href:z(e)},[n(g(V),{text:e.name,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,js)])),_:2},1024)]),i("td",null,[n(_l,{type:D(e).type},{default:y((()=>[h(u(D(e).label),1)])),_:2},1032,["type"])]),i("td",null,u(g(j)(e.created_at)),1),i("td",null,[null!==(a=e.last_job)&&void 0!==a&&a.ended?(t(),r(s,{key:0},[h(u(g(j)(e.last_job.ended)),1)],64)):(t(),r(s,{key:1},[h(u(g(l)("Not yet")),1)],64))]),i("td",null,u(A(e)),1),i("td",null,u($(e)),1)])})),256))])])),_:1},8,["loading"])):(t(),b(L,{key:1,class:"fr-my-2w"},{default:y((()=>[i("div",Rs,[i("img",{src:g("/_themes/gouvfr/assets/harvester.svg"),alt:"",loading:"lazy"},null,8,Ms),i("p",Os,u(g(l)("There is no harvesters yet")),1),n(Nl,{type:"harvester"})])])),_:1})),m.value>f.value?(t(),b(g(X),{key:2,page:d.value,"page-size":f.value,"total-results":m.value,onChange:a[0]||(a[0]=e=>d.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}}),Ps=["href"],qs={key:0},Es=["href"],Is={class:"fr-p-1v monospaced bg-grey-100 fr-text--sm text-mention-grey rounded-xxs"},Ls=a({__name:"AdminCommunityResourcesTable",props:{communityResources:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(e){const l=e,{t:a}=M();function o(e){return l.sortedBy===e?l.sortDirection:null}function d(e){return`${H}dataset/${e.dataset.id}/community-resource/${e.id}/`}function c(e){const l=e.extras&&"check:available"in e.extras;return l&&!1===e.extras["check:available"]?{label:a("Unavailable"),type:"error"}:l?{label:a("Available"),type:"info"}:{label:a("Not checked yet"),type:"default"}}return(e,l)=>{const f=C("Vicon");return t(),b($l,{loading:e.loading},{default:y((()=>[i("thead",null,[n(Bl,{onSort:l[0]||(l[0]=l=>e.$emit("sort","title",l)),sorted:o("title"),scope:"col"},{default:y((()=>[h(u(g(a)("Resource title")),1)])),_:1},8,["sorted"]),n(Bl,null,{default:y((()=>[h(u(g(a)("Status")),1)])),_:1}),n(Bl,null,{default:y((()=>[h(u(g(a)("Format")),1)])),_:1}),n(Bl,{onSort:l[1]||(l[1]=l=>e.$emit("sort","created_at_internal",l)),sorted:o("created_at_internal"),scope:"col"},{default:y((()=>[h(u(g(a)("Created at")),1)])),_:1},8,["sorted"]),n(Bl,{onSort:l[2]||(l[2]=l=>e.$emit("sort","last_modified_internal",l)),sorted:o("last_modified_internal"),scope:"col"},{default:y((()=>[h(u(g(a)("Modified at")),1)])),_:1},8,["sorted"])]),i("tbody",null,[(t(!0),r(s,null,k(e.communityResources,(l=>{var a,s;return t(),r("tr",null,[i("td",null,[n(kl,{class:"fr-text--bold"},{default:y((()=>[i("a",{class:"fr-link fr-reset-link",href:d(l)},[n(g(V),{text:l.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Ps)])),_:2},1024),e.datasets[l.dataset.id]?(t(),r("p",qs,[i("a",{class:"fr-link inline-flex",href:null===(a=e.datasets[l.dataset.id])||void 0===a?void 0:a.page},[n(f,{height:12,class:"self-center",name:e.getSubjectTypeIcon("Dataset")},null,8,["name"]),n(g(V),{class:"overflow-wrap-anywhere",text:null===(s=e.datasets[l.dataset.id])||void 0===s?void 0:s.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,Es)])):_("",!0)]),i("td",null,[n(_l,{type:c(l).type},{default:y((()=>[h(u(c(l).label),1)])),_:2},1032,["type"])]),i("td",null,[i("code",Is,u(l.format),1)]),i("td",null,u(g(j)(l.created_at)),1),i("td",null,u(g(j)(l.last_modified)),1)])})),256))])])),_:1},8,["loading"])}}}),Vs={class:"fr-container--fluid"},Us={key:0},Hs={class:"fr-breadcrumb__link","aria-current":"page"},Ys={class:"fr-h3 fr-mb-5v"},Ns={class:"subtitle subtitle--uppercase fr-m-0"},Fs={class:"text-align-center fr-py-1w"},Ws=["src"],Js={class:"fr-text--bold fr-my-3v"},Zs=a({__name:"CommunityResources",props:{oid:{}},setup(e){const{t:l}=M(),a=e,s=c([]),o=c(!1),d=c(1),m=c(10),p=c(0),w=c("created_at_internal"),k=c("desc"),x=f((()=>`${"asc"===k.value?"":"-"}${w.value}`)),{currentOrganization:z}=Ul(),$=J();function A(e,l){w.value=e,k.value=l}return v((async()=>{o.value=!0,s.value=[];try{let e;if(a.oid)e=await Ve(a.oid,d.value,m.value,x.value);else{if(!$.value)return;e=await Ue($.value.id,d.value,m.value,x.value)}s.value=e.data,d.value=e.page,m.value=e.page_size,p.value=e.total}finally{o.value=!1}})),(e,a)=>{const c=C("router-link");return t(),r("div",Vs,[n(yl,null,{default:y((()=>[i("li",null,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(l)("Administration")),1)])),_:1})]),g(z)?(t(),r("li",Us,[n(c,{class:"fr-breadcrumb__link",to:"/"},{default:y((()=>[h(u(g(z).name),1)])),_:1})])):_("",!0),i("li",null,[i("a",Hs,u(g(l)("Community Resources")),1)])])),_:1}),i("h1",Ys,u(g(l)("Community Resources")),1),i("h2",Ns,u(g(l)("{n} community resources",s.value.length)),1),o.value||p.value>0?(t(),b(Ls,{key:0,"community-resources":s.value,loading:o.value,sortDirection:k.value,sortedBy:w.value,onSort:A},null,8,["community-resources","loading","sortDirection","sortedBy"])):(t(),b(L,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:y((()=>[i("div",Fs,[i("img",{src:g(He),alt:"",loading:"lazy"},null,8,Ws),i("p",Js,u(g(l)("You haven't published a community resource yet")),1)])])),_:1})),p.value>m.value?(t(),b(g(X),{key:2,page:d.value,"page-size":m.value,"total-results":p.value,onChange:a[0]||(a[0]=e=>d.value=e)},null,8,["page","page-size","total-results"])):_("",!0)])}}});Ye({admin_root:H,default_lang:Ne.global.locale.value,only_locales:Ne.global.locale.value,schema_documentation_url:Fe,schema_validata_url:We,show_copy_resource_permalink:!0,tabular_api_url:Je,tabular_page_size:Ze,title:F});const Gs=[{path:"/me",children:[{path:"",component:Ra,name:"me"},{path:"datasets",component:ca,name:"me-datasets"},{path:"reuses",component:$a,name:"me-reuses"},{path:"community-resources",component:Zs,name:"me-community-resources"}]},{path:"/organizations/:oid",children:[{path:"datasets",component:ca,props:!0,name:"organization-datasets"},{path:"reuses",component:$a,props:!0,name:"organization-reuses"},{path:"discussions",component:Cs,props:!0,name:"organization-discussions"},{path:"members",component:Dr,props:!0,name:"organization-members"},{path:"harvesters",component:Ts,props:!0,name:"organization-harvesters"},{path:"community-resources",component:Zs,props:!0,name:"organization-community-resources"},{path:"profile",component:ss,props:!0,name:"organization-profile"}]}],Ks=Ge({history:Ke(),routes:Gs}),Qs=S(lt);Qe(Qs),Qs.use(Xe),Qs.use(el),Qs.use(Ne),Qs.use(Ks),Qs.mount("#admin"),globalThis.dsfr.start(),console.log("JS is injected !")}}}));
