<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Campos: CKAN para uData Database</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --bg-color: #f1f5f9;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --code-bg: #f8fafc;
            --code-text: #0f172a;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
            margin: 0;
            padding: 40px 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 64px;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -0.04em;
            margin-top: 0;
            margin-bottom: 2rem;
            color: #0f172a;
            line-height: 1.1;
        }

        h1::after {
            content: '';
            display: block;
            width: 80px;
            height: 6px;
            background: var(--primary);
            margin-top: 1rem;
            border-radius: 3px;
        }

        h2 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-top: 3.5rem;
            margin-bottom: 1.25rem;
            color: #0f172a;
            letter-spacing: -0.02em;
        }

        h3 {
            font-size: 1.35rem;
            font-weight: 600;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            color: #1e293b;
        }

        h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 1.5rem;
            color: #334155;
        }

        p {
            margin-bottom: 1.25rem;
            font-size: 1.05rem;
            color: #334155;
        }

        strong {
            color: #0f172a;
            font-weight: 600;
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.9em;
            border: 1px solid var(--border-color);
            color: #2563eb;
        }

        pre {
            background-color: #0f172a;
            color: #f8fafc;
            padding: 1.5rem;
            border-radius: 12px;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            box-shadow: inset 0 2px 4px 0 rgb(0 0 0 / 0.05);
        }

        pre code {
            background: transparent;
            border: none;
            padding: 0;
            color: inherit;
            font-size: inherit;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 2.5rem 0;
            font-size: 0.95rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        th {
            background-color: #f8fafc;
            font-weight: 600;
            text-align: left;
            padding: 14px 20px;
            border-bottom: 2px solid var(--border-color);
            color: #475569;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }

        td {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: top;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background-color: #f8fafc;
        }

        @media (max-width: 768px) {
            .container {
                padding: 32px;
            }
            h1 {
                font-size: 2rem;
            }
            table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
<h1>Mapa de Campos: CKAN para uData Database</h1>
<p>Este documento mapeia os campos obtidos do harvester <code>CkanBackend</code> (CKAN API v3) para os campos da tabela/coleção <code>datasets</code> na base de dados do uData (modelo <code>Dataset</code>).</p>
<h2>Fonte de Dados</h2>
<p><strong>API CKAN</strong>: Comprehensive Knowledge Archive Network
- Endpoint: <code>{source_url}/api/3/action/</code>
- Protocolo: REST API JSON
- Versão: API v3 (suporta CKAN \u003e= 1.8)
- Ações principais:
  - <code>package_list</code> - Lista de nomes de datasets
  - <code>package_search</code> - Pesquisa com filtros
  - <code>package_show</code> - Detalhes de um dataset</p>
<h2>Resumo do Mapeamento</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Campo Fonte (CKAN API)</th>
<th style="text-align: left;">Propriedade JSON</th>
<th style="text-align: left;">Campo Destino (uData <code>Dataset</code>)</th>
<th style="text-align: left;">Notas / Lógica</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Dataset</strong></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><code>id</code></td>
<td style="text-align: left;"><code>data['id']</code></td>
<td style="text-align: left;"><code>remote_id</code> (HarvestItem)</td>
<td style="text-align: left;">UUID do dataset (substitui <code>name</code>).</td>
</tr>
<tr>
<td style="text-align: left;"><code>name</code></td>
<td style="text-align: left;"><code>data['name']</code></td>
<td style="text-align: left;"><code>slug</code></td>
<td style="text-align: left;">Nome técnico/slug do dataset.</td>
</tr>
<tr>
<td style="text-align: left;"><code>title</code></td>
<td style="text-align: left;"><code>data['title']</code></td>
<td style="text-align: left;"><code>title</code></td>
<td style="text-align: left;">Título do dataset.</td>
</tr>
<tr>
<td style="text-align: left;"><code>notes</code></td>
<td style="text-align: left;"><code>data['notes']</code></td>
<td style="text-align: left;"><code>description</code></td>
<td style="text-align: left;">Descrição (HTML parseado).</td>
</tr>
<tr>
<td style="text-align: left;"><code>license_id</code></td>
<td style="text-align: left;"><code>data['license_id']</code></td>
<td style="text-align: left;"><code>license</code></td>
<td style="text-align: left;">Identificador da licença.</td>
</tr>
<tr>
<td style="text-align: left;"><code>license_title</code></td>
<td style="text-align: left;"><code>data['license_title']</code></td>
<td style="text-align: left;"><code>license</code></td>
<td style="text-align: left;">Título da licença (fallback).</td>
</tr>
<tr>
<td style="text-align: left;"><code>tags[].name</code></td>
<td style="text-align: left;"><code>data['tags']</code></td>
<td style="text-align: left;"><code>tags</code></td>
<td style="text-align: left;">Lista de tags.</td>
</tr>
<tr>
<td style="text-align: left;"><code>metadata_created</code></td>
<td style="text-align: left;"><code>data['metadata_created']</code></td>
<td style="text-align: left;"><code>harvest.created_at</code></td>
<td style="text-align: left;">Data de criação.</td>
</tr>
<tr>
<td style="text-align: left;"><code>metadata_modified</code></td>
<td style="text-align: left;"><code>data['metadata_modified']</code></td>
<td style="text-align: left;"><code>harvest.modified_at</code></td>
<td style="text-align: left;">Data de modificação.</td>
</tr>
<tr>
<td style="text-align: left;"><code>name</code></td>
<td style="text-align: left;"><code>data['name']</code></td>
<td style="text-align: left;"><code>harvest.ckan_name</code></td>
<td style="text-align: left;">Nome CKAN original.</td>
</tr>
<tr>
<td style="text-align: left;"><code>url</code></td>
<td style="text-align: left;"><code>data['url']</code></td>
<td style="text-align: left;"><code>harvest.remote_url</code></td>
<td style="text-align: left;">URL remota (se válida).</td>
</tr>
<tr>
<td style="text-align: left;">(Código)</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><code>harvest.remote_url</code></td>
<td style="text-align: left;">URL do dataset no CKAN (fallback).</td>
</tr>
<tr>
<td style="text-align: left;">(URL inválida)</td>
<td style="text-align: left;"><code>data['url']</code></td>
<td style="text-align: left;"><code>harvest.ckan_source</code></td>
<td style="text-align: left;">URL original se inválida.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Extras</strong></td>
<td style="text-align: left;"><code>data['extras']</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Campos adicionais CKAN.</td>
</tr>
<tr>
<td style="text-align: left;"><code>spatial</code></td>
<td style="text-align: left;"><code>extra['value']</code> (GeoJSON)</td>
<td style="text-align: left;"><code>spatial.geom</code></td>
<td style="text-align: left;">Cobertura espacial (GeoJSON).</td>
</tr>
<tr>
<td style="text-align: left;"><code>spatial-text</code></td>
<td style="text-align: left;"><code>extra['value']</code></td>
<td style="text-align: left;"><code>spatial.zones</code> ou <code>extras['ckan:spatial-text']</code></td>
<td style="text-align: left;">Zona geográfica (texto).</td>
</tr>
<tr>
<td style="text-align: left;"><code>spatial-uri</code></td>
<td style="text-align: left;"><code>extra['value']</code></td>
<td style="text-align: left;"><code>extras['ckan:spatial-uri']</code></td>
<td style="text-align: left;">URI da zona geográfica.</td>
</tr>
<tr>
<td style="text-align: left;"><code>frequency</code></td>
<td style="text-align: left;"><code>extra['value']</code></td>
<td style="text-align: left;"><code>frequency</code></td>
<td style="text-align: left;">Frequência de atualização.</td>
</tr>
<tr>
<td style="text-align: left;"><code>temporal_start</code></td>
<td style="text-align: left;"><code>extra['value']</code></td>
<td style="text-align: left;"><code>temporal_coverage.start</code></td>
<td style="text-align: left;">Início da cobertura temporal.</td>
</tr>
<tr>
<td style="text-align: left;"><code>temporal_end</code></td>
<td style="text-align: left;"><code>extra['value']</code></td>
<td style="text-align: left;"><code>temporal_coverage.end</code></td>
<td style="text-align: left;">Fim da cobertura temporal.</td>
</tr>
<tr>
<td style="text-align: left;">Outros extras</td>
<td style="text-align: left;"><code>extra['key']</code> / <code>extra['value']</code></td>
<td style="text-align: left;"><code>extras[key]</code></td>
<td style="text-align: left;">Copiados para extras.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Resource</strong></td>
<td style="text-align: left;"><code>data['resources']</code></td>
<td style="text-align: left;"><strong>Resource</strong></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><code>id</code></td>
<td style="text-align: left;"><code>res['id']</code></td>
<td style="text-align: left;"><code>id</code></td>
<td style="text-align: left;">UUID do recurso (preservado).</td>
</tr>
<tr>
<td style="text-align: left;"><code>name</code></td>
<td style="text-align: left;"><code>res['name']</code></td>
<td style="text-align: left;"><code>title</code></td>
<td style="text-align: left;">Título do recurso.</td>
</tr>
<tr>
<td style="text-align: left;"><code>description</code></td>
<td style="text-align: left;"><code>res['description']</code></td>
<td style="text-align: left;"><code>description</code></td>
<td style="text-align: left;">Descrição (HTML parseado).</td>
</tr>
<tr>
<td style="text-align: left;"><code>url</code></td>
<td style="text-align: left;"><code>res['url']</code></td>
<td style="text-align: left;"><code>url</code></td>
<td style="text-align: left;">URL do recurso.</td>
</tr>
<tr>
<td style="text-align: left;"><code>format</code></td>
<td style="text-align: left;"><code>res['format']</code></td>
<td style="text-align: left;"><code>format</code></td>
<td style="text-align: left;">Formato do ficheiro.</td>
</tr>
<tr>
<td style="text-align: left;"><code>mimetype</code></td>
<td style="text-align: left;"><code>res['mimetype']</code></td>
<td style="text-align: left;"><code>mime</code></td>
<td style="text-align: left;">MIME type.</td>
</tr>
<tr>
<td style="text-align: left;"><code>hash</code></td>
<td style="text-align: left;"><code>res['hash']</code></td>
<td style="text-align: left;"><code>hash</code></td>
<td style="text-align: left;">Hash do ficheiro.</td>
</tr>
<tr>
<td style="text-align: left;"><code>created</code></td>
<td style="text-align: left;"><code>res['created']</code></td>
<td style="text-align: left;"><code>harvest.issued_at</code></td>
<td style="text-align: left;">Data de criação.</td>
</tr>
<tr>
<td style="text-align: left;"><code>last_modified</code></td>
<td style="text-align: left;"><code>res['last_modified']</code></td>
<td style="text-align: left;"><code>harvest.modified_at</code></td>
<td style="text-align: left;">Data de modificação.</td>
</tr>
<tr>
<td style="text-align: left;">(Código)</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><code>filetype</code></td>
<td style="text-align: left;">Fixo: <code>'remote'</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><code>resource_type</code></td>
<td style="text-align: left;"><code>res['resource_type']</code></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Filtro (apenas tipos permitidos).</td>
</tr>
</tbody>
</table>
<h2>Detalhes Específicos</h2>
<h3>1. Autenticação</h3>
<p>Suporta API key para acesso a datasets privados:</p>
<pre><code class="language-python">headers = {
    'content-type': 'application/json',
    'Authorization': self.config.get('apikey')
}
</code></pre>
<h3>2. Filtros de Colheita</h3>
<p>Suporta filtros configuráveis:
- <strong>Organization</strong>: Filtra por organização CKAN
- <strong>Tag</strong>: Filtra por tag</p>
<pre><code class="language-python">filters = [
    {'key': 'organization', 'value': 'my-org'},
    {'key': 'tags', 'value': 'environment', 'type': 'exclude'}
]
</code></pre>
<p><strong>Query construída:</strong></p>
<pre><code>organization:my-org AND -tags:environment
</code></pre>
<p><strong>Limite:</strong> 1000 datasets por pesquisa (limite da API CKAN)</p>
<h3>3. Identificador do Dataset</h3>
<p>O harvester usa inicialmente o <code>name</code> mas depois atualiza para o <code>id</code>:</p>
<pre><code class="language-python"># Fase 1: Usa name
self.process_dataset(name)

# Fase 2: Substitui por id
if result.get('id'):
    item.remote_id = result['id']
</code></pre>
<h3>4. Compatibilidade DKAN</h3>
<p>Suporta DKAN (fork do CKAN) que retorna lista em vez de objeto:</p>
<pre><code class="language-python">result = response['result']
if type(result) is list:
    result = result[0]
</code></pre>
<h3>5. Validação de Schema</h3>
<p>Valida os dados contra schema Voluptuous:</p>
<pre><code class="language-python">data = self.validate(result, self.schema)
</code></pre>
<p><strong>Campos validados:</strong>
- Tipos de dados corretos
- Normalização de strings
- Conversão de datas
- Validação de emails
- Normalização de tags</p>
<h3>6. Skip se Sem Recursos</h3>
<p>Datasets sem recursos são ignorados:</p>
<pre><code class="language-python">if not len(data.get('resources', [])):
    raise HarvestSkipException(f&quot;Dataset {data['name']} has no record&quot;)
</code></pre>
<h3>7. Licença</h3>
<p>Usa heurística para identificar licença:</p>
<pre><code class="language-python">default_license = dataset.license or License.default()
dataset.license = License.guess(
    data['license_id'],
    data['license_title'],
    default=default_license
)
</code></pre>
<h3>8. Extras CKAN</h3>
<h4>8.1 Spatial (GeoJSON)</h4>
<p>Converte GeoJSON para MultiPolygon:</p>
<pre><code class="language-python">spatial_geom = json.loads(extra['value'])

if spatial_geom['type'] == 'Polygon':
    coordinates = [spatial_geom['coordinates']]
elif spatial_geom['type'] == 'MultiPolygon':
    coordinates = spatial_geom['coordinates']
else:
    raise HarvestException('Unsupported spatial geometry')

dataset.spatial.geom = {
    'type': 'MultiPolygon',
    'coordinates': coordinates
}
</code></pre>
<h4>8.2 Spatial-Text</h4>
<p>Tenta encontrar zona geográfica no uData:</p>
<pre><code class="language-python">qs = GeoZone.objects(db.Q(name=value) | db.Q(slug=value))
if qs.count() == 1:
    spatial_zone = qs.first()
    dataset.spatial.zones = [spatial_zone]
else:
    dataset.extras['ckan:spatial-text'] = value
</code></pre>
<h4>8.3 Frequency</h4>
<p>Tenta converter para UpdateFrequency:</p>
<pre><code class="language-python"># Tenta RDF frequency
if freq := frequency_from_rdf(value):
    dataset.frequency = freq
else:
    # Tenta valor direto
    try:
        dataset.frequency = UpdateFrequency(value)
    except ValueError:
        dataset.extras['ckan:frequency'] = value
</code></pre>
<h4>8.4 Temporal Coverage</h4>
<pre><code class="language-python">temporal_start = daterange_start(extra['value'])
temporal_end = daterange_end(extra['value'])

if temporal_start and temporal_end:
    dataset.temporal_coverage = db.DateRange(
        start=temporal_start,
        end=temporal_end
    )
</code></pre>
<h4>8.5 Outros Extras</h4>
<p>Extras não reconhecidos são copiados:</p>
<pre><code class="language-python">dataset.extras[extra['key']] = value
</code></pre>
<p><strong>Nota:</strong> Extras vazios são ignorados.</p>
<h3>9. Remote URL</h3>
<p>Ordem de prioridade:
1. Campo <code>url</code> do dataset (se válido)
2. URL do dataset no CKAN: <code>{source_url}/dataset/{name}</code></p>
<pre><code class="language-python">dataset.harvest.remote_url = self.dataset_url(data['name'])
if data.get('url'):
    try:
        url = uris.validate(data['url'])
        dataset.harvest.remote_url = url
    except uris.ValidationError:
        dataset.harvest.ckan_source = data['url']
</code></pre>
<h3>10. Recursos (Resources)</h3>
<h4>10.1 Tipos Permitidos</h4>
<pre><code class="language-python">ALLOWED_RESOURCE_TYPES = ('dkan', 'file', 'file.upload', 'api', 'metadata')

if res['resource_type'] not in ALLOWED_RESOURCE_TYPES:
    continue
</code></pre>
<h4>10.2 Preservação de UUID</h4>
<p>Os recursos mantêm o UUID original do CKAN:</p>
<pre><code class="language-python">try:
    resource = get_by(dataset.resources, 'id', UUID(res['id']))
except Exception:
    log.error('Unable to parse resource ID %s', res['id'])
    continue

if not resource:
    resource = Resource(id=res['id'])
    dataset.resources.append(resource)
</code></pre>
<h4>10.3 Metadados de Harvest</h4>
<p>Cada recurso tem metadados de colheita:</p>
<pre><code class="language-python">if not resource.harvest:
    resource.harvest = HarvestResourceMetadata()

resource.harvest.issued_at = res['created']
resource.harvest.modified_at = res['last_modified']
</code></pre>
<h3>11. Tratamento de Erros CKAN</h3>
<p>CKAN pode retornar 200 mesmo em erro:</p>
<pre><code class="language-python">data = response.json()
if data.get('success', False):
    return data
else:
    error = data.get('error')
    if isinstance(error, dict):
        msg = error.get('message', 'Unknown error')
        if '__type' in error:
            msg = ': '.join((error['__type'], msg))
    else:
        msg = error
    raise HarvestException(msg)
</code></pre>
<h2>Schema de Validação</h2>
<h3>Resource Schema</h3>
<pre><code class="language-python">resource = {
    'id': str,
    'position': int,
    'name': All(DefaultTo(''), str),
    'description': All(str, normalize_string),
    'format': All(str, Lower),
    'mimetype': Any(All(str, Lower), None),
    'size': Any(Coerce(int), None),
    'hash': Any(All(str, hash), None),
    'created': All(str, to_date),
    'last_modified': Any(All(str, to_date), None),
    'url': All(str),
    'resource_type': All(empty_none, DefaultTo('file'), str, Any(*RESOURCE_TYPES)),
}
</code></pre>
<h3>Tag Schema</h3>
<pre><code class="language-python">tag = {
    'id': str,
    Optional('vocabulary_id'): Any(str, None),
    Optional('display_name'): str,
    'name': All(str, normalize_tag),
    Optional('state'): str,
}
</code></pre>
<h3>Organization Schema</h3>
<pre><code class="language-python">organization = {
    'id': str,
    'description': str,
    'created': All(str, to_date),
    'title': str,
    'name': All(str, slug),
    'revision_timestamp': All(str, to_date),
    'is_organization': boolean,
    'state': str,
    'image_url': str,
    'revision_id': str,
    'type': 'organization',
    'approval_status': 'approved'
}
</code></pre>
<h2>Exemplo de Mapeamento</h2>
<h3>Resposta CKAN API (simplificado)</h3>
<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;result&quot;: {
    &quot;id&quot;: &quot;123e4567-e89b-12d3-a456-426614174000&quot;,
    &quot;name&quot;: &quot;dados-ambientais&quot;,
    &quot;title&quot;: &quot;Dados Ambientais de Portugal&quot;,
    &quot;notes&quot;: &quot;&lt;p&gt;Descrição dos dados ambientais&lt;/p&gt;&quot;,
    &quot;license_id&quot;: &quot;cc-by&quot;,
    &quot;license_title&quot;: &quot;Creative Commons Attribution&quot;,
    &quot;metadata_created&quot;: &quot;2023-01-15T10:30:00&quot;,
    &quot;metadata_modified&quot;: &quot;2024-01-20T14:45:00&quot;,
    &quot;url&quot;: &quot;https://example.pt/dados-ambientais&quot;,
    &quot;tags&quot;: [
      {&quot;name&quot;: &quot;ambiente&quot;},
      {&quot;name&quot;: &quot;qualidade-ar&quot;}
    ],
    &quot;extras&quot;: [
      {&quot;key&quot;: &quot;spatial&quot;, &quot;value&quot;: &quot;{\&quot;type\&quot;:\&quot;Polygon\&quot;,\&quot;coordinates\&quot;:[...]}&quot;},
      {&quot;key&quot;: &quot;temporal_start&quot;, &quot;value&quot;: &quot;2020-01-01&quot;},
      {&quot;key&quot;: &quot;temporal_end&quot;, &quot;value&quot;: &quot;2023-12-31&quot;},
      {&quot;key&quot;: &quot;frequency&quot;, &quot;value&quot;: &quot;http://purl.org/cld/freq/monthly&quot;}
    ],
    &quot;resources&quot;: [
      {
        &quot;id&quot;: &quot;abc-123&quot;,
        &quot;name&quot;: &quot;Dados CSV&quot;,
        &quot;url&quot;: &quot;https://example.pt/data.csv&quot;,
        &quot;format&quot;: &quot;CSV&quot;,
        &quot;mimetype&quot;: &quot;text/csv&quot;,
        &quot;resource_type&quot;: &quot;file&quot;,
        &quot;created&quot;: &quot;2023-01-15T10:30:00&quot;,
        &quot;last_modified&quot;: &quot;2024-01-20T14:45:00&quot;
      }
    ]
  }
}
</code></pre>
<h3>Dataset uData resultante</h3>
<pre><code class="language-python">dataset.remote_id = &quot;123e4567-e89b-12d3-a456-426614174000&quot;
dataset.slug = &quot;dados-ambientais&quot;
dataset.title = &quot;Dados Ambientais de Portugal&quot;
dataset.description = &quot;Descrição dos dados ambientais&quot;
dataset.license = License('cc-by')
dataset.tags = [&quot;ambiente&quot;, &quot;qualidade-ar&quot;]
dataset.frequency = UpdateFrequency.MONTHLY

dataset.harvest = HarvestDatasetMetadata(
    created_at=datetime(2023, 1, 15, 10, 30, 0),
    modified_at=datetime(2024, 1, 20, 14, 45, 0),
    ckan_name='dados-ambientais',
    remote_url='https://example.pt/dados-ambientais'
)

dataset.spatial = SpatialCoverage(
    geom={'type': 'MultiPolygon', 'coordinates': [...]}
)

dataset.temporal_coverage = DateRange(
    start=date(2020, 1, 1),
    end=date(2023, 12, 31)
)

dataset.resources = [
    Resource(
        id=&quot;abc-123&quot;,
        title=&quot;Dados CSV&quot;,
        url=&quot;https://example.pt/data.csv&quot;,
        format=&quot;csv&quot;,
        mime=&quot;text/csv&quot;,
        filetype=&quot;remote&quot;,
        harvest=HarvestResourceMetadata(
            issued_at=datetime(2023, 1, 15, 10, 30, 0),
            modified_at=datetime(2024, 1, 20, 14, 45, 0)
        )
    )
]
</code></pre>
    </div>
</body>
</html>